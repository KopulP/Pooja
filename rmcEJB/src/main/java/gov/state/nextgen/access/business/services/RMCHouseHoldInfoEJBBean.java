package gov.state.nextgen.access.business.services;

import java.sql.Timestamp;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.SortedSet;
import java.util.TreeSet;

import javax.annotation.Resource;
import javax.ejb.EJB;
import javax.ejb.SessionContext;
import javax.ejb.TransactionAttribute;
import javax.ejb.TransactionAttributeType;

import org.apache.commons.lang.StringUtils;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.ObjectWriter;

import gov.state.address.validation.service.client.AddressValidation;
import gov.state.nextgen.access.business.customEntities.CP_APP_IN_ASSISTANCE_Custom_Cargo;
import gov.state.nextgen.access.business.customEntities.CP_APP_IN_ASSISTANCE_Custom_Collection;
import gov.state.nextgen.access.business.customEntities.INDIVIDUAL_Custom_Cargo;
import gov.state.nextgen.access.business.customEntities.INDIVIDUAL_Custom_Collection;
import gov.state.nextgen.access.business.customEntities.RMC_RESPONSE_Custom_Cargo;
import gov.state.nextgen.access.business.customEntities.RMC_RESPONSE_Custom_Collection;
import gov.state.nextgen.access.business.entities.APP_ABS_PRNT_Cargo;
import gov.state.nextgen.access.business.entities.APP_ABS_PRNT_Collection;
import gov.state.nextgen.access.business.entities.APP_AR_LG_CNTC_Cargo;
import gov.state.nextgen.access.business.entities.APP_AR_LG_CNTC_Collection;
import gov.state.nextgen.access.business.entities.APP_FILE_HELP_Cargo;
import gov.state.nextgen.access.business.entities.APP_FILE_HELP_Collection;
import gov.state.nextgen.access.business.entities.APP_HSHL_RLT_Cargo;
import gov.state.nextgen.access.business.entities.APP_HSHL_RLT_Collection;
import gov.state.nextgen.access.business.entities.APP_INDV_Cargo;
import gov.state.nextgen.access.business.entities.APP_INDV_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_ABSNP_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_ABSNP_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_CHILD_INFO_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_CHILD_INFO_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_DABL_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_DABL_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_DRUG_FELN_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_DRUG_FELN_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_HLTH_INS_BNFTS_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_HLTH_INS_BNFTS_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_INST_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_INST_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_MEDCR_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_MEDCR_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_OTHR_HLTH_INS_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_OTHR_HLTH_INS_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_OUT_ST_BNFT_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_OUT_ST_BNFT_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_PLAN_HLTH_BABIES_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_PLAN_HLTH_BABIES_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_PREG_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_PREG_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_SCHLE_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_SCHLE_Collection;
import gov.state.nextgen.access.business.entities.APP_IN_SPS_IMPOV_Cargo;
import gov.state.nextgen.access.business.entities.APP_IN_SPS_IMPOV_Collection;
import gov.state.nextgen.access.business.entities.APP_PGM_RQST_Cargo;
import gov.state.nextgen.access.business.entities.APP_PGM_RQST_Collection;
import gov.state.nextgen.access.business.entities.APP_PRGM_INDV_Cargo;
import gov.state.nextgen.access.business.entities.APP_PRGM_INDV_Collection;
import gov.state.nextgen.access.business.entities.APP_RGST_Cargo;
import gov.state.nextgen.access.business.entities.APP_RGST_Collection;
import gov.state.nextgen.access.business.entities.Address_Custom_Cargo;
import gov.state.nextgen.access.business.entities.Address_Custom_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_ESGIN_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_ESGIN_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_ASSISTANCE_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_ASSISTANCE_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_CARE_PROV_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_CARE_PROV_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_IRWE_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_IRWE_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_LST_HLTH_INS_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_LST_HLTH_INS_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_MED_INS_CVRG_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_MED_INS_CVRG_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAXDEPENDENTS_OH_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAXDEPENDENTS_OH_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAX_DEPENDENTS_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAX_DEPENDENTS_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAX_INFORMATION_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAX_INFORMATION_Collection;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAX_RETURN_Cargo;
import gov.state.nextgen.access.business.entities.CP_APP_IN_TAX_RETURN_Collection;
import gov.state.nextgen.access.business.entities.INDV_LIVE_CHG_Cargo;
import gov.state.nextgen.access.business.entities.INDV_LIVE_CHG_Collection;
import gov.state.nextgen.access.business.entities.NO_ONE_Cargo;
import gov.state.nextgen.access.business.entities.NO_ONE_Collection;
import gov.state.nextgen.access.business.entities.RMB_RQST_Cargo;
import gov.state.nextgen.access.business.entities.RMB_RQST_Collection;
import gov.state.nextgen.access.business.entities.RMC_INDV_ID_Collection;
import gov.state.nextgen.access.business.entities.RMC_IN_PRFL_Cargo;
import gov.state.nextgen.access.business.entities.RMC_IN_PRFL_Collection;
import gov.state.nextgen.access.business.entities.RMC_RQST_Cargo;
import gov.state.nextgen.access.business.entities.RMC_RQST_Collection;
import gov.state.nextgen.access.business.rules.ABHouseHoldMemberBO;
import gov.state.nextgen.access.business.rules.ABHouseHoldRelationshipBO;
import gov.state.nextgen.access.business.rules.ABHouseholdInformationSummaryBO;
import gov.state.nextgen.access.business.rules.ABHouseholdMembersSummaryBO;
import gov.state.nextgen.access.business.rules.ABProgramInformationBO;
import gov.state.nextgen.access.business.rules.ABRegistrationBO;
import gov.state.nextgen.access.business.rules.ABRegistrationSummaryBO;
import gov.state.nextgen.access.business.rules.ARHouseHoldMemberBO;
import gov.state.nextgen.access.business.rules.ARHouseholdMembersSummaryBO;
import gov.state.nextgen.access.business.rules.ARTDPValidator;
import gov.state.nextgen.access.business.rules.OutOfStateBenefitsBO;
import gov.state.nextgen.access.business.rules.RMBPeopleGatePostBO;
import gov.state.nextgen.access.business.rules.TaxReturnBO;
import gov.state.nextgen.access.business.rules.WorkRelatedExpenseBO;
import gov.state.nextgen.access.business.rules.assets.TaxClaimDependantBO;
import gov.state.nextgen.access.business.rules.benefitcase.ContactInformationBO;
import gov.state.nextgen.access.business.rules.benefits.HealthCareCoverageBO;
import gov.state.nextgen.access.business.rules.help.CompleteTheApplicationBO;
import gov.state.nextgen.access.business.rules.help.HelpWithApplicationBO;
import gov.state.nextgen.access.business.rules.household.ARDisabilityBO;
import gov.state.nextgen.access.business.rules.household.AbsentParentBO;
import gov.state.nextgen.access.business.rules.household.AssistanceBO;
import gov.state.nextgen.access.business.rules.household.ContactInfoBO;
import gov.state.nextgen.access.business.rules.household.DisabilityBO;
import gov.state.nextgen.access.business.rules.household.DrugFelonyBO;
import gov.state.nextgen.access.business.rules.household.HouseHoldInfoBO;
import gov.state.nextgen.access.business.rules.household.HouseHoldRelationshipBO;
import gov.state.nextgen.access.business.rules.household.LivingArrangementBO;
import gov.state.nextgen.access.business.rules.household.LostHealthInsBO;
import gov.state.nextgen.access.business.rules.household.MaritalBO;
import gov.state.nextgen.access.business.rules.household.MedicareBO;
import gov.state.nextgen.access.business.rules.household.MovedInBO;
import gov.state.nextgen.access.business.rules.household.PregnancyBO;
import gov.state.nextgen.access.business.rules.household.SchoolEnrollmentBO;
import gov.state.nextgen.access.business.utility.AgeUtil;
import gov.state.nextgen.access.business.validation.ChangingValidation;
import gov.state.nextgen.access.business.validation.rmc.details.ARACDValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARCONValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARDFDValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARHDDValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARHMAValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARHMDValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARHMIValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARHPDValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARHSEValidator;
import gov.state.nextgen.access.business.validation.rmc.details.ARLHIValidator;
import gov.state.nextgen.access.business.validation.rmc.details.MovedOutValidator;
import gov.state.nextgen.access.business.validation.rmc.questions.ARHOHValidator;
import gov.state.nextgen.access.business.validation.rmc.questions.ARHPGValidator;
import gov.state.nextgen.access.business.validation.rmc.questions.ARPIQValidator;
import gov.state.nextgen.access.business.validation.rmc.selection.ARHISValidator;
import gov.state.nextgen.access.business.validation.rmc.selection.ARMOVValidator;
import gov.state.nextgen.access.business.validation.rmc.selection.ARPCSValidator;
import gov.state.nextgen.access.business.validation.rmc.summary.ARHCSValidator;
import gov.state.nextgen.access.business.validation.rmc.types.ARCTAValidator;
import gov.state.nextgen.access.management.applications.CategorySequenceDetail;
import gov.state.nextgen.access.management.applications.CategorySequenceDetailsComparator;
import gov.state.nextgen.access.management.applications.IAppProfileManager;
import gov.state.nextgen.access.management.applications.IApplicationManager;
import gov.state.nextgen.access.management.applications.ICategorySelectionProfileManager;
import gov.state.nextgen.access.management.applications.IRMCResponseProfileManager;
import gov.state.nextgen.access.management.applications.RMBRequestManager;
import gov.state.nextgen.access.management.applications.RMCRequestManager;
import gov.state.nextgen.access.management.constants.AppConstants;
import gov.state.nextgen.access.management.individuals.PeopleHandler;
import gov.state.nextgen.access.management.programs.FwProgramManager;
import gov.state.nextgen.access.management.programs.IProgramManager;
import gov.state.nextgen.access.management.rules.PeopleRulesBO;
import gov.state.nextgen.access.management.rules.RulesBO;
import gov.state.nextgen.access.management.util.DisplayFormatter;
import gov.state.nextgen.access.management.util.IndivTypeSeqBean;
import gov.state.nextgen.access.management.util.IndividualAge;
import gov.state.nextgen.access.presentation.entities.listview.ARAbsentParentSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.ARAddDisabilityDtlsSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.ARAddPersonDtlsSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.ARCitizenshipListView;
import gov.state.nextgen.access.presentation.entities.listview.ARDeathDetailsSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.ARHeadOfHouseholdSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.ARLeftTheHomeSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.ARPregChangeDtlsSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBAbsentParentListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBAddTaxClaimDependentSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBAddTaxInformationSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBCareTakerListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBContactInformationChangeSelectionListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBDisabilityDetailsListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBDrugFelonySummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBHelpFromOthersSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBHouseHoldMemberListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBPeopleChangeSelectionListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBPersonalInfoSelectionListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBPregnancyChangeSelectionListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBPregnancyDetailsListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBProbationParoleSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.RMBRelationShipDetailsListView;
import gov.state.nextgen.access.presentation.entities.listview.RMCContactInfoSummaryListView;
import gov.state.nextgen.access.presentation.entities.listview.RMCDisabilityListView;
import gov.state.nextgen.access.presentation.entities.listview.RMCHouseHoldRelationshipsListview;
import gov.state.nextgen.framework.business.entities.AbstractCargo;
import gov.state.nextgen.framework.business.entities.FwTransaction;
import gov.state.nextgen.framework.driver.DriverManager;
import gov.state.nextgen.framework.driver.IDriver;
import gov.state.nextgen.framework.exceptions.FwException;
import gov.state.nextgen.framework.exceptions.FwWrappedException;
import gov.state.nextgen.framework.factories.FwServiceFactory;
import gov.state.nextgen.framework.management.configuration.FwConfigurationManager;
import gov.state.nextgen.framework.management.constants.FwConstants;
import gov.state.nextgen.framework.management.logging.wkp.ILog;
import gov.state.nextgen.framework.management.messages.FwMessage;
import gov.state.nextgen.framework.management.messages.FwMessageList;
import gov.state.nextgen.framework.management.references.IReferenceConstants;
import gov.state.nextgen.framework.management.references.IReferenceTableData;
import gov.state.nextgen.framework.management.references.IReferenceTableManager;
import gov.state.nextgen.framework.management.references.ReferenceTableManager;
import gov.state.nextgen.framework.management.util.FwDataCriteria;
import gov.state.nextgen.framework.management.util.FwDataSortOrder;
import gov.state.nextgen.framework.presentation.entities.listview.IListviewFormatter;

/**
 * RMCHouseHoldInfoEJBBean - SessionFacade Object skeleton auto generated -
 * Architecture Team
 *
 * Creation Date :Tue Feb 06 13:47:45 CST 2007 Modified By: Modified on:
 */

/* ************************************************************************************
 ******************  SONAR FIXES MADE IN THIS CODE *************************************
 ** ISSUE DESCRIPTION                  NATURE OF FIX                        DATE     ***
 ** ==================                 =============                                 ***
 **                                                                                  ***
 ** Avoid commented code               Deleted Commented code             08/31/2015  **
 *                                     Lage Blocks of commented code                  **
 **                                    are converted to javadoc                       **
 **                                                                                   **
 ***************************************************************************************
 */

@javax.ejb.Stateless
@javax.ejb.LocalBean
@javax.ejb.TransactionManagement(javax.ejb.TransactionManagementType.CONTAINER)
public class RMCHouseHoldInfoEJBBean extends RMCSessionBean {

	/** The Constant PEOPLE_HOUSEHOLD_INDIV_COVERED_KEY. */
	private static final String PEOPLE_HOUSEHOLD_INDIV_COVERED_KEY = "PEOPLE_HOUSEHOLD_INDIV_COVERED";
	
	/** The Constant RESP_MAP_HOUSEHOLD_INDIV_COVERED_KEY. */
	private static final String RESP_MAP_HOUSEHOLD_INDIV_COVERED_KEY = "RESP_MAP_HOUSEHOLD_INDIV_COVERED";
	
	/** The Constant COVERAGE_COLLECTION_KEY. */
	private static final String COVERAGE_COLLECTION_KEY = "CP_APP_IN_MED_INS_CVRG_Collection";
	
	/** The Constant HOUSEHOLD_INDIV_COVERED_COMP_ID. */
	private static final String HOUSEHOLD_INDIV_COVERED_COMP_ID = "HOUSEHOLD_INDIV_COVERED";
	
	/** The Constant HOUSEHOLD_INFO_SUMMARY_PAGE_ID. */
	private static final String HOUSEHOLD_INFO_SUMMARY_PAGE_ID = "AROBS";
	
	/** The Constant HOUSEHOLD_INFO_GATEPOST_ID. */
	private static final String HOUSEHOLD_INFO_GATEPOST_ID = "AROBC";
	
	/** The Constant ADDITIONAL_INFORMATION_SUMMARY_PAGE_ID. */
	private static final String ADDITIONAL_INFORMATION_SUMMARY_PAGE_ID = "AROBS";
	
	/** The Constant APP_IN_PREG_COLLECTION_KEY. */
	private static final String APP_IN_PREG_COLLECTION_KEY = "APP_IN_PREG_Collection";
	
	/** The Constant HEALTH_INSURANCE_SCREEN_ID. */
	private static final String HEALTH_INSURANCE_SCREEN_ID = "ARHIN";
	
	/** The Constant APP_IN_OTHR_HLTH_INS_COLLECTION_KEY. */
	private static final String APP_IN_OTHR_HLTH_INS_COLLECTION_KEY = "APP_IN_OTHR_HLTH_INS_Collection";
	
	private static final String APP_IN_HLTH_INS_BNFTS_COLLECTION_KEY = "APP_IN_HLTH_INS_BNFTS_Collection";
	
	/** The relation ship map. */
	private static Map relationShipMap = new HashMap();
	@EJB
	private RMCHouseHoldInfoEJBBean rmcHouseHoldInfoEJBBean;
	
	private static final String ARTAX = "ARTAX";
	/**
	 * Constructor.
	 */
	public RMCHouseHoldInfoEJBBean() {
	}
	// EDSP Starts

	/**
	 * Load head of household details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void loadHeadOfHouseholdDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHeadOfHouseholdDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			Map pageCollection = txnBean.getPageCollection();
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final RMC_IN_PRFL_Collection appInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			final RMB_RQST_Collection rmbRqstColl = (RMB_RQST_Collection) session
					.get(AppConstants.RMB_RQST_COLLECTION);
			if(null!=rmbRqstColl){
			final RMB_RQST_Cargo rmbRqstCargo = rmbRqstColl.getCargo(0);
			rmbRqstCargo.setHead_of_household_stat_ind(FwConstants.YES);
			}
			componentManager.getComponents(
					(String) request.get(FwConstants.CURRENT_PAGE_ID), txnBean);
			createAndLoadResponseMapsToPageCollectionARHOH(appInPrflColl,
					pageCollection, peopleHandler, true, driverStatus,
					appNumber);
			session.put(FwConstants.BEFORE_COLLECTION,
					txnBean.getPageCollection());
			pageCollection = displayProgramSpecificInfo(session, pageCollection);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHeadOfHouseholdDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHeadOfHouseholdDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHeadOfHouseholdDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHeadOfHouseholdDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHeadOfHouseholdDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store head of household details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storeHeadOfHouseholdDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHeadOfHouseholdDetails() - START");
		try {
			final int numQuestions = 1;
			RMC_IN_PRFL_Collection pageCollAppInPrflColl = null;

			// define a short array for the questions
			final short[] questionsArray = new short[numQuestions];
			questionsArray[0] = IRMCResponseProfileManager.HEAD_OF_HOUSE; // head_of_house


			// get variables from session and page collection
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			final Map request = txnBean.getRequest();
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);

			// get current page status
			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);

			// get the appNumber from session
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);

			// Read in APP_IN_PROFILE from session
			final RMC_IN_PRFL_Collection sesAppInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			// get size of the collection
			final int sesAppPrflCollSize = sesAppInPrflColl.size();

			// Read in APP_IN_PROFILE from page coll.
			pageCollAppInPrflColl = (RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection");

			// get the beforecollection map
			final Map beforeCollection = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			String response = FwConstants.EMPTY_STRING;
			final RMB_RQST_Collection pageRMBRqstColl = (RMB_RQST_Collection) pageCollection
					.get("RMB_RQST_Collection");
			final RMB_RQST_Cargo rmbRqstCargo = pageRMBRqstColl.getCargo(0);
			response = rmbRqstCargo.getHead_of_household_stat_ind();

			final RMC_IN_PRFL_Collection appInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			rmcResponseProfileManager.preparePageColl(pageCollAppInPrflColl,
					sesAppInPrflColl, questionsArray);

			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			FwMessageList validateInfo = null;
			final ARHOHValidator validationBO = new ARHOHValidator();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			if (backToMyAccess == null) {
				if (AppConstants.YES.equalsIgnoreCase(response)) {
					validateInfo = validationBO
							.validateARHOH(pageCollAppInPrflColl);
				}
			}

			if (checkBackToMyAccessSelected(request) || validateInfo != null
					&& validateInfo.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				// vgundlap
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1,2,3 lines Commented
				 * Code in this block
				 */

				componentManager.getComponents("ARHOH", txnBean);

				if (!checkForWarningMesgs(reqWarningMsgs,
						validationBO.getMessageList())) {
					if (backToMyAccess == null) {
						request.put(FwConstants.MESSAGE_LIST,
								validationBO.getMessageList());
					}

					createAndLoadResponseMapsToPageCollectionARHOH(
							appInPrflColl, pageCollection, peopleHandler, true,
							driverStatus, appNumber);
					pageCollection.put("RMB_Rqst_Cargo", rmbRqstCargo);
					pageCollection.put("PEOPLE_INTER_RESP_COLL_BEFORE",
							beforeCollection
							.get("PEOPLE_INTER_RESP_COLL_BEFORE"));
					if (beforeCollection.containsKey("RESPONSE")) {
						pageCollection.put("RESPONSE",
								beforeCollection.get("RESPONSE"));
					}
					txnBean.setPageCollection(pageCollection);
					return;
				}
			}

			// Head of house hold logic
			// If any new sections are added in future then add the condition
			// null in both cargos

			final short[] aResponseIds = new short[1];
			aResponseIds[0] = IRMCResponseProfileManager.HEAD_OF_HOUSE;
			final RMC_IN_PRFL_Collection rmcPrflColl = new RMC_IN_PRFL_Collection();
			RMC_IN_PRFL_Cargo sesRmcInPrflCargo = null;
			for (int i = 0; i < pageCollAppInPrflColl.size(); i++) {
				final RMC_IN_PRFL_Cargo rCargo = pageCollAppInPrflColl
						.getCargo(i);
				final String[] aResponseValues = new String[1];
				aResponseValues[0] = rCargo.getHead_of_household_resp();
				for (int j = 0; j < sesAppPrflCollSize; j++) {
					sesRmcInPrflCargo = sesAppInPrflColl.getCargo(j);
					if (sesRmcInPrflCargo.getIndv_seq_num().equalsIgnoreCase(
							rCargo.getIndv_seq_num())) {
						break;
					}
				}

				rmcResponseProfileManager.translateProfileResponses(
						rCargo.getHead_of_household_resp(),
						sesRmcInPrflCargo.getHead_of_household_resp(),
						pageStatus, IRMCResponseProfileManager.HEAD_OF_HOUSE,
						sesRmcInPrflCargo);
				if (rCargo.getHead_of_household_resp() != null) {
					aResponseValues[0] = "R";
					rCargo.setHead_of_household_resp("R");
				} else {
					aResponseValues[0] = FwConstants.NO;
					rCargo.setHead_of_household_resp(FwConstants.NO);
				}
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 3,1 lines Commented
				 * Code in this block
				 */

				rmcResponseProfileManager
				.persist(appNumber, rCargo.getIndv_seq_num(),
						aResponseIds, aResponseValues);
				rmcPrflColl.addCargo(sesRmcInPrflCargo);
			}

			session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcPrflColl);

			driverManager.makeComplete(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNumber);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHeadOfHouseholdDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHeadOfHouseholdDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHeadOfHouseholdDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHeadOfHouseholdDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHeadOfHouseholdDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load citizenship declaration.
	 *
	 * @param txnBean the txn bean
	 */
	public void loadCitizenshipDeclaration(final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();

		final ARHouseHoldMemberBO hmbo = new ARHouseHoldMemberBO();
		final ARHouseholdMembersSummaryBO hmSummarybo = new ARHouseholdMembersSummaryBO();
		CP_APP_ESGIN_Collection appEsignColl = null;
		final APP_INDV_Collection appIndvChildrenColl = new APP_INDV_Collection();
		Map listViewMap = null;

		int age = 0;
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadCitizenshipDeclaration() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map httpSession = (Map) session.get(FwConstants.HTTP_SESSION);

			final Map pageCollection = txnBean.getPageCollection();
			String appNumber = null;
			String languageCd = (String) httpSession.get(AppConstants.LANGUAGE);
			if (languageCd == null || languageCd.trim().length() == 0) {
				languageCd = "EN";
			}

			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);

			appNumber = (String) session.get(AppConstants.APP_NUMBER);

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, currentPageID,
					driverArray);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadCitizenshipDeclaration:End");

			appEsignColl = hmbo.loadCitizenshipDeclarationDetails(appNumber);

			pageCollection.put("CP_APP_ESGIN_Collection", appEsignColl);

			if (session.get(FwConstants.BEFORE_COLLECTION) != null) {
				((Map) session.get(FwConstants.BEFORE_COLLECTION))
				.putAll(pageCollection);
			} else {
				final Map beforeColl = new HashMap();
				beforeColl.putAll(pageCollection);
				session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			}

			// ***************************** Adding List View to Page
			// ***********************************//
			final APP_INDV_Collection appIndvColl = hmSummarybo
					.loadHouseholdMembers(appNumber);

			// Prepare children collection for the listview
			for (int i = 0; i < appIndvColl.size(); i++) {
				final APP_INDV_Cargo tempCargo = (APP_INDV_Cargo) appIndvColl
						.get(i);
				age = AgeUtil.calculateAge(tempCargo.getBrth_dt());
				if (age > 19) {
					continue;
				} else {
					appIndvChildrenColl.add(tempCargo);
				}
			}
			listViewMap = new HashMap();
			listViewMap.put("APP_INDV_Collection", appIndvChildrenColl);
			final ARCitizenshipListView listviewbean1 = new ARCitizenshipListView();
			listviewbean1.setLanguage(languageCd);
			listviewbean1.setDisplayData(appIndvChildrenColl);
			listviewbean1.setCitCollection(appIndvChildrenColl);
			listviewbean1.setName("ARCitizenshipListViewDetials");
			listviewbean1.setPageSize(100);
			final boolean[] sortableCols1 = new boolean[5];
			listviewbean1.setSortableColumns(sortableCols1);
			pageCollection.put("ARCitizenshipListViewDetials", listviewbean1);
			// ***************************** Adding List View to Page
			// ***********************************//
			session.put("rmc.householdmumber.collection", appIndvColl);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
			txnBean.setSession(session);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadCitizenshipDeclaration");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadCitizenshipDeclaration");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadCitizenshipDeclaration", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadCitizenshipDeclaration");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadCitizenshipDeclaration() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store citizenship declaration.
	 *
	 * @param txnBean the txn bean
	 */
	public void storeCitizenshipDeclaration(final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeCitizenshipDeclaration() - START");
		String appNumber = null;
		FwMessageList validateInfo = null;
		CP_APP_ESGIN_Collection esignColl = null;
		CP_APP_ESGIN_Collection esignBeforeColl = null;
		final ARHouseHoldMemberBO hmBo = new ARHouseHoldMemberBO();
		CP_APP_ESGIN_Cargo appEsignCargo = null;
		CP_APP_ESGIN_Cargo appEsignBeforeCargo = null;
		Map listViewMap = null;
		final ARHouseholdMembersSummaryBO hmSummarybo = new ARHouseholdMembersSummaryBO();
		int age = 0;
		final APP_INDV_Collection appIndvChildrenColl = new APP_INDV_Collection();
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBEan::storeCitizenshipDeclaration:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);

			final Map httpSession = (Map) session.get(FwConstants.HTTP_SESSION);
			String languageCd = (String) httpSession.get(AppConstants.LANGUAGE);
			if (languageCd == null || languageCd.trim().length() == 0) {
				languageCd = "EN";
			}

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);

			// Get The before collection from session
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			beforeColl.get("CP_APP_ESGIN_Collection");
			if (beforeColl != null && !beforeColl.isEmpty()) {
				if (beforeColl.containsKey("CP_APP_ESGIN_Collection")) {
					esignBeforeColl = (CP_APP_ESGIN_Collection) beforeColl
							.get("CP_APP_ESGIN_Collection");
				}
			}
			if (esignBeforeColl != null && !esignBeforeColl.isEmpty()) {
				appEsignBeforeCargo = (CP_APP_ESGIN_Cargo) esignBeforeColl
						.get(0);
			}
			// Get the Esign page level collection from page collection
			esignColl = (CP_APP_ESGIN_Collection) pageCollection
					.get("CP_APP_ESGIN_Collection");

			if (esignColl != null && !esignColl.isEmpty()) {
				appEsignCargo = (CP_APP_ESGIN_Cargo) esignColl.get(0);
			}

			final java.util.Date date = new java.util.Date();

			final Timestamp currentTimestamp = new Timestamp(date.getTime());
			final String applCitzDeclEsignDate = currentTimestamp.toString();

			appEsignCargo.setApp_num(appNumber);

			appEsignCargo.setSeq_num(FwConstants.ONE);

			appEsignCargo.setSrc_app_ind("RN");

			appEsignCargo.setAppl_citz_decl_esign_date(applCitzDeclEsignDate);

			validateInfo = hmBo.validateCitizenDetails(esignColl);

			if (validateInfo != null && validateInfo.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST, validateInfo);
				pageCollection.put("CP_APP_ESGIN_Collection", esignColl);

				final APP_INDV_Collection appIndvColl = hmSummarybo
						.loadHouseholdMembers(appNumber);
				for (int i = 0; i < appIndvColl.size(); i++) {
					final APP_INDV_Cargo tempCargo = (APP_INDV_Cargo) appIndvColl
							.get(i);
					age = AgeUtil.calculateAge(tempCargo.getBrth_dt());
					if (age > 19) {
						continue;
					} else {
						appIndvChildrenColl.add(tempCargo);
					}
				}

				listViewMap = new HashMap();
				listViewMap.put("APP_INDV_Collection", appIndvChildrenColl);

				final ARCitizenshipListView listviewbean1 = new ARCitizenshipListView();
				listviewbean1.setLanguage(languageCd);
				listviewbean1.setDisplayData(appIndvChildrenColl);
				listviewbean1.setCitCollection(appIndvChildrenColl);
				listviewbean1.setName("ARCitizenshipListViewDetials");
				listviewbean1.setPageSize(100);
				final boolean[] sortableCols1 = new boolean[5];
				listviewbean1.setSortableColumns(sortableCols1);

				pageCollection.put("ARCitizenshipListViewDetials",
						listviewbean1);

				return;
			}

			if (appEsignBeforeCargo != null) {
				appEsignCargo = (CP_APP_ESGIN_Cargo) isChanged(
						appEsignBeforeCargo, appEsignCargo);
			}

			if (appEsignCargo.isDirty()) {
				appEsignCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
			} else {
				appEsignCargo.setRowAction(FwConstants.ROWACTION_INSERT);
			}
			hmBo.storeCitizenshipDeclaration(esignColl);

			if (driverStatus != FwConstants.DRIVER_COMPLETE) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);

			}

			/*** Start : Declaration of Citizenchip */
			APP_INDV_Collection appIndvColl=(APP_INDV_Collection) session.get("rmc.householdmumber.collection");
			final APP_INDV_Collection appIndvChildrenColl1 = new APP_INDV_Collection();
			boolean hasKids=false;
			for (int i = 0; i < appIndvColl.size(); i++) {
				final APP_INDV_Cargo tempCargo = (APP_INDV_Cargo) appIndvColl
						.get(i);
				age = AgeUtil.calculateAge(tempCargo.getBrth_dt());
				if (age > 19) {
					continue;
				} else {
					if(tempCargo!=null){
						String usCtznSw=tempCargo.getUs_ctzn_sw();
						if(FwConstants.YES.equalsIgnoreCase(usCtznSw)){
							tempCargo.setCitizenVerifyInd(usCtznSw);
						}
					}
					tempCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					appIndvChildrenColl1.add(tempCargo);
					hasKids=true;
				}
			}
			if(hasKids){
				if (appIndvColl != null && !appIndvColl.isEmpty()) {
					final APP_INDV_Collection indvCollection=new APP_INDV_Collection();
					final APP_INDV_Cargo cargo=(APP_INDV_Cargo) appIndvColl.get(0);
					if (cargo != null
							&& FwConstants.YES.equalsIgnoreCase(cargo
									.getUs_ctzn_sw())) {
						cargo.setCitizenVerifyInd("Y");
						cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						indvCollection.add(cargo);
						indvCollection.persist(FwConstants.DAO);
					}
				}
			}
			if(appIndvChildrenColl1!=null && !appIndvChildrenColl1.isEmpty()){
				appIndvChildrenColl1.persist(FwConstants.DAO);
			}
			/*** End :  Declaration of Citizenchip */
			/*MAGI LOGIC STARTS*/
			
			final ABHouseholdMembersSummaryBO  aSummaryBO= new ABHouseholdMembersSummaryBO();
			Boolean medFlag = aSummaryBO.loadMedicaidProgram(appNumber);
			if(medFlag){
				final APP_INDV_Collection tempColl = aSummaryBO.loadHouseholdMembers(appNumber);
				int ageMagi = 0;
				boolean fullMedicaid = false;
				for (int j = 0; j < tempColl.size(); j++) {
					final APP_INDV_Cargo tempCargo = (APP_INDV_Cargo) tempColl
							.get(j);
					ageMagi = AgeUtil.calculateAge(tempCargo.getBrth_dt());
					if ((FwConstants.YES
									.equals(tempCargo.getDisabled_resp()) || (ageMagi >= 65))) {
						fullMedicaid = true;
						break;
					}
				}
				if(fullMedicaid){
					aSummaryBO.updateMagiProgram(appNumber);
					short[] pgmKey = (short[]) session.get(FwConstants.RMC_PROGRAM_KEY);
					pgmKey[FwConstants.MAGI_INDEX] = Short.valueOf(FwConstants.ONE);
					session.put(FwConstants.RMC_PROGRAM_KEY, pgmKey);
				}
			}
			
			
			
			/*MAGI LOGIC ENDS*/
			
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBEan::storeCitizenshipDeclaration:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeCitizenshipDeclaration");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeCitizenshipDeclaration");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeCitizenshipDeclaration", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeCitizenshipDeclaration");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeCitizenshipDeclaration() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load individual change selection.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void loadIndividualChangeSelection(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadIndividualChangeSelection() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadIndividualChangeSelection:Start");
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			final Map httpSession = (Map) session.get(FwConstants.HTTP_SESSION);
			Map beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// get people handler from session
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			// now get the components for the current page
			componentManager.getComponents("ARPCS", txnBean);
			pageCollection.get(FwConstants.PAGE_COMPONENT_LIST);
			// get rmc_in_prfl from session
			final RMC_IN_PRFL_Collection sessRMCInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			// get session RMC_CHG_SEL_PRFL
			SortedSet sessChgSelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			// get RMB_RQST from session
			final RMB_RQST_Collection rmbRqstColl = (RMB_RQST_Collection) session
					.get(AppConstants.RMB_RQST_COLLECTION);
			final RMB_RQST_Cargo rmbRqstCargo = rmbRqstColl.getCargo(0);
			// get language from httpsession
			final String languageCd = (String) httpSession
					.get(AppConstants.LANGUAGE);
			final RMC_RESPONSE_Custom_Collection rmcRespColl = new RMC_RESPONSE_Custom_Collection();
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, "ARPCS", driverArray);
			boolean loadCatSelProfile = false;

			if ((sessChgSelectionProfile == null || sessChgSelectionProfile
					.isEmpty())
					&& driverStatus != FwConstants.DRIVER_NOT_REQUIRED) {
				// load selection profile form the data base
				loadCatSelProfile = true;
			} else if (sessChgSelectionProfile != null
					&& !sessChgSelectionProfile.isEmpty()) {
				// here we need to check the session profile is housing/utility
				// session profile
				CategorySequenceDetail catSeqDetail = categorySelectionProfileManager
						.getCurrentSequenceDetail(sessChgSelectionProfile);
				if (catSeqDetail == null) {
					catSeqDetail = categorySelectionProfileManager
							.getNextSequenceDetail(sessChgSelectionProfile);
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 4,2 lines Commented
					 * Code in this block
					 */

					if (catSeqDetail != null
							&& AppConstants.RMC_CAT_HO_COMP_PRFL
							.equals(catSeqDetail
									.getChangeSelectionCategoryCd())) {
						loadCatSelProfile = false;
					} else {
						loadCatSelProfile = true;
					}
				}
			}

			// now loading the cat selection profile from the data base
			if (loadCatSelProfile) {
				final String catategoryCodes = AppConstants.RMC_CAT_HO_COMP_PRFL;
				// EDSP temp
				sessChgSelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNum,
								catategoryCodes);

				session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
						sessChgSelectionProfile);
			}

			// Contact information
			final ContactInfoBO contactInfoBO = new ContactInfoBO();
			final APP_RGST_Collection appRgstColl = contactInfoBO
					.loadContactInfoDetails(appNum);

			final RMBContactInformationChangeSelectionListView cntcListView = new RMBContactInformationChangeSelectionListView();
			final Map datMap = new HashMap();

			datMap.put("APP_RGST_Collection", appRgstColl);
			final List statusList = new ArrayList();
			// TO DO: COMM "H"
			if (FwConstants.YES.equals(rmbRqstCargo.getAdr_chg_stat_ind())) {

				final APP_RGST_Cargo rgstCargo = contactInfoBO
						.splitContactInfoColl(appRgstColl,
								AppConstants.RMC_MODIFIED_RECORD_IND);
				if ((driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
						"ARPCS", driverArray) == FwConstants.DRIVER_COMPLETE || driverManager
						.getAFBStatus(FwConstants.RMC_DRIVER, "ARPCS",
								driverArray) == FwConstants.DRIVER_VISIT_AGAIN)
								&& rgstCargo != null) {
					statusList.add(0, "C");
					statusList.add(1, FwConstants.SPACE);
				} else {
					if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
							"ARPCS", driverArray) == FwConstants.DRIVER_REQUIRED) {
						statusList.add(0, FwConstants.NO);
						statusList.add(1, FwConstants.SPACE);
					} else if ((driverManager.getAFBStatus(
							FwConstants.RMC_DRIVER, "ARPCS", driverArray) == FwConstants.DRIVER_COMPLETE || driverManager
							.getAFBStatus(FwConstants.RMC_DRIVER, "ARPCS",
									driverArray) == FwConstants.DRIVER_VISIT_AGAIN)
									&& driverManager.getAFBStatus(
											FwConstants.RMC_DRIVER, "ARACD",
											driverArray) == FwConstants.DRIVER_REQUIRED) {
						statusList.add(0, "R");
						statusList.add(1, FwConstants.SPACE);
					} else if (driverManager.getAFBStatus(
							FwConstants.RMC_DRIVER, "ARPCS", driverArray) == FwConstants.DRIVER_COMPLETE
							&& driverManager.getAFBStatus(
									FwConstants.RMC_DRIVER, "ARACD",
									driverArray) == FwConstants.DRIVER_NOT_REQUIRED) {
						statusList.add(0, FwConstants.SPACE);
						statusList.add(1, FwConstants.NO);
					} else {
						statusList.add(0, FwConstants.NO);
						statusList.add(1, FwConstants.SPACE);
					}
				}
			} else {
				statusList.add(0, FwConstants.SPACE);
				statusList.add(1, FwConstants.NO);
			}

			datMap.put("RGST_STATUS", statusList);
			cntcListView.setLanguage(languageCd);
			// EDSP temp
			cntcListView.setDisplayData(datMap);

			log(ILog.INFO, "ccccc");
			cntcListView.setName("ContactInformation_ListView");
			cntcListView.setPageSize(100);

			// people section
			final ABHouseHoldMemberBO hhBO = new ABHouseHoldMemberBO();
			final APP_INDV_Collection appIndvColl = hhBO
					.loadAppIndvColl(appNum);
			final INDIVIDUAL_Custom_Collection indvCustColl = peopleHandler
					.getAllIndividualsOnCase();
			final APP_INDV_Collection appIndvFilterColl = contactInfoBO
					.filterDeletedIndividuals(indvCustColl, appIndvColl);

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2,1 lines Commented Code in
			 * this block
			 */

			final RMBPeopleChangeSelectionListView peopleInSideHomListView = new RMBPeopleChangeSelectionListView();
			final List indvInSideHomDataList = new ArrayList();
			indvInSideHomDataList.add(0, appIndvFilterColl);
			indvInSideHomDataList.add(1, sessChgSelectionProfile);
			indvInSideHomDataList.add(2, peopleHandler);

			peopleInSideHomListView.setLanguage(languageCd);
			// EDSP temp

			peopleInSideHomListView.setName("PeopleInformation_ListView");
			peopleInSideHomListView.setDisplayData(indvInSideHomDataList);
			peopleInSideHomListView.setPageSize(100);

			final APP_INDV_Collection appIndvOutSideHomColl = contactInfoBO
					.filterChldOutofHomeIndiv(indvCustColl, appIndvColl);

			final RMBPeopleChangeSelectionListView peopleOutSideHomListView = new RMBPeopleChangeSelectionListView();
			final List indvOutSideHomDataList = new ArrayList();
			indvOutSideHomDataList.add(0, appIndvOutSideHomColl);
			indvOutSideHomDataList.add(1, sessChgSelectionProfile);
			indvOutSideHomDataList.add(2, peopleHandler);

			peopleOutSideHomListView.setLanguage(languageCd);
			// EDSP temp-

			peopleOutSideHomListView.setName("OutSideHomePeopleInfo_ListView");
			peopleOutSideHomListView.setDisplayData(indvOutSideHomDataList);
			peopleOutSideHomListView.setPageSize(100);

			// Preganacy Section
			final RMBPregnancyChangeSelectionListView pregnancyListView = new RMBPregnancyChangeSelectionListView();
			final PregnancyBO pregBO = new PregnancyBO();
			final List pregDataList = new ArrayList();
			final APP_IN_PREG_Collection pregColl = pregBO
					.loadPregnancyDetails(appNum, AppConstants.CWW_RECORD_IND);
			final APP_IN_PREG_Collection pregCollRE = pregBO
					.loadPregnancyDetails(appNum,
							AppConstants.RMC_END_RECORD_IND);
			pregDataList.add(0, pregColl);
			pregDataList.add(1, sessChgSelectionProfile);
			pregnancyListView.setLanguage(languageCd);
			// EDSP temp
			pregnancyListView.setDisplayData(pregDataList);

			pregnancyListView.setName("PregnancyInformation_ListView");
			pregnancyListView.setPageSize(100);

			final DrugFelonyBO drugBO = new DrugFelonyBO();
			final List drugFelonyDataList = new ArrayList();
			final APP_IN_DRUG_FELN_Collection drugColl = drugBO
					.loadDrugFelonyDetails(appNum, AppConstants.CWW_RECORD_IND);
			drugFelonyDataList.add(0, drugColl);
			drugFelonyDataList.add(1, sessChgSelectionProfile);
			// set required calues to page collection
			createandLoadARPCSResponseMapsToPageCollection(rmcRespColl,
					pageCollection, peopleHandler, false, driverStatus,
					txnBean, rmbRqstCargo, sessRMCInPrflColl);
			pageCollection.put("HOUSEHOLD_COMP_INDV_SEL_RESP_COLL_BEFORE",
					rmcRespColl);
			pageCollection.put("APP_INDV_Collection", appIndvFilterColl);
			pageCollection.put("ContactInformation_ListView", cntcListView);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3,2,2 lines Commented Code
			 * in this block
			 */

			pageCollection.put("PeopleInformation_ListView",
					peopleInSideHomListView);

			pageCollection.put("PregnancyInformation_ListView",
					pregnancyListView);
			pageCollection.put(APP_IN_PREG_COLLECTION_KEY, pregColl);
			pageCollection.put("APP_IN_PREG_Collection_RE", pregCollRE);
			pageCollection.put("APP_IN_DRUG_FELN_Collection", drugColl);
			pageCollection.put("APP_INDV_Collection", appIndvFilterColl);
			pageCollection.put("APP_RGST_Collection", appRgstColl);

			pageCollection.put("RMB_Rqst_Cargo", rmbRqstCargo);

			final INDIVIDUAL_Custom_Collection people5260 = (INDIVIDUAL_Custom_Collection) pageCollection
					.get("PEOPLE_5260");

			pageCollection.put("PEOPLE_5260", people5260);

			if (beforeColl == null) {
				beforeColl = new HashMap();
				session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			}
			beforeColl.putAll(pageCollection);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadIndividualChangeSelection:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			log(ILog.ERROR, fe.getMessage());
			log(ILog.ERROR, fe.getMessage());
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadIndividualChangeSelection");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadIndividualChangeSelection");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadIndividualChangeSelection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadIndividualChangeSelection");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadIndividualChangeSelection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store individual change selection.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storeIndividualChangeSelection(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeIndividualChangeSelection() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeIndividualChangeSelection:Start");
			final Map request = txnBean.getRequest();
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();

			RMC_RESPONSE_Custom_Collection rmcRespCustomColl = new RMC_RESPONSE_Custom_Collection();
			SortedSet sessChgSelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			rmcRespCustomColl = (RMC_RESPONSE_Custom_Collection) pageCollection
					.get("RMC_RESPONSE_Custom_Collection");
			// get app_num
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final Map httpSession = (Map) session.get(FwConstants.HTTP_SESSION);
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final ARPCSValidator validator = new ARPCSValidator();
			final RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
					.get(AppConstants.RMC_RQST);
			final RMB_RQST_Collection rmbRqstColl = (RMB_RQST_Collection) session
					.get(AppConstants.RMB_RQST_COLLECTION);
			final RMB_RQST_Cargo rmbRqstCargo = rmbRqstColl.getCargo(0);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// update this logic
			for (int i = 0; i < rmcRespCustomColl.size(); i++) {
				final RMC_RESPONSE_Custom_Cargo respCargo = rmcRespCustomColl
						.getCargo(i);
				if (respCargo.getUserEndSelectionInd() != null
						&& FwConstants.ZERO.equalsIgnoreCase(respCargo
								.getUserEndSelectionInd())) {
					respCargo.setUserEndSelectionInd(respCargo.getResponse());
				}
			}

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
					.getAllIndividuals();
			final int indvSize = indvColl.size();
			final Map indvNameMap = new HashMap();
			for (int i = 0; i < indvSize; i++) {
				final INDIVIDUAL_Custom_Cargo indvCargo = (INDIVIDUAL_Custom_Cargo) indvColl
						.get(i);
				indvNameMap.put(indvCargo.getIndv_seq_num(),
						indvCargo.getFst_nam());
			}

			request.get("changeSelection_pregAddRadio");
			request.get("changeSelection_drugAddRadio");

			final Map peopleMap = new HashMap();
			peopleMap.put(APP_IN_PREG_COLLECTION_KEY,
					beforeColl.get(APP_IN_PREG_COLLECTION_KEY));
			peopleMap.put("APP_IN_PREG_Collection_RE",
					beforeColl.get("APP_IN_PREG_Collection_RE"));
			peopleMap.put("APP_IN_DRUG_FELN_Collection",
					beforeColl.get("APP_IN_DRUG_FELN_Collection"));
			peopleMap.put("APP_INDV_Collection",
					beforeColl.get("APP_INDV_Collection"));
			peopleMap.put("APP_RGST_Collection",
					beforeColl.get("APP_RGST_Collection"));
			final String languageCd = (String) httpSession
					.get(AppConstants.LANGUAGE);
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			if (backToMyAccess == null) {

				validator.validatePeopleChangeSelection(rmbRqstCargo,
						rmcRespCustomColl, peopleMap, indvNameMap);
			}

			if (checkBackToMyAccessSelected(request) || validator.hasMessages()) {

				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
				}
				final Map currPageResponse = txnBean.getPageCollection();
				pageCollection.putAll(beforeColl);
				final RMC_RESPONSE_Custom_Collection currRespColl = (RMC_RESPONSE_Custom_Collection) currPageResponse
						.get("RMC_RESPONSE_Custom_Collection");

				getPeopleCollectionForValidation(currRespColl, pageCollection,
						peopleHandler, AppConstants.BECAME_PREGNANT, true,
						txnBean);
				getPeopleCollectionForValidation(currRespColl, pageCollection,
						peopleHandler, AppConstants.BECAME_DRUG_FELONY, true,
						txnBean);

				pageCollection.put("RESP_MAP_BP",
						pageCollection.get("RESP_MAP_BP"));
				pageCollection.put("RESP_MAP_BD",
						pageCollection.get("RESP_MAP_BD"));
				// Removing the individuals selected for drug Felony and
				// Pregnancy.
				if (rmcRespCustomColl != null) {
					for (int i = 0; i < rmcRespCustomColl.size(); i++) {
						final RMC_RESPONSE_Custom_Cargo rmcCustCargo = rmcRespCustomColl
								.getResult(i);
						if ("BD".equals(rmcCustCargo.getCategoryType().trim())
								|| "BP".equals(rmcCustCargo.getCategoryType())) {
							rmcRespCustomColl.remove(i);
							i--;
						}
					}
				}

				if (rmcRespCustomColl != null && !rmcRespCustomColl.isEmpty()) {
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented
					 * Code in this block
					 */

					sessChgSelectionProfile = categorySelectionProfileManager
							.buildSelectionProfileAfterValidation(
									sessChgSelectionProfile, rmcRespCustomColl);

				}
				final ContactInfoBO contactInfoBO = new ContactInfoBO();

				final APP_IN_PREG_Collection pregColl = (APP_IN_PREG_Collection) pageCollection
						.get(APP_IN_PREG_COLLECTION_KEY);
				final APP_IN_DRUG_FELN_Collection drugColl = (APP_IN_DRUG_FELN_Collection) pageCollection
						.get("APP_IN_DRUG_FELN_Collection");
				final APP_INDV_Collection appIndvColl = (APP_INDV_Collection) pageCollection
						.get("APP_INDV_Collection");
				final APP_RGST_Collection appRgstColl = (APP_RGST_Collection) pageCollection
						.get("APP_RGST_Collection");
				final Map datMap = new HashMap();
				datMap.put("APP_RGST_Collection", appRgstColl);

				final List statusList = new ArrayList();
				if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARPCS",
						driverArray) == FwConstants.DRIVER_REQUIRED) {
					if (rmcRespCustomColl != null
							&& !rmcRespCustomColl.isEmpty()) {
						for (int i = 0; i < rmcRespCustomColl.size(); i++) {
							final RMC_RESPONSE_Custom_Cargo rmcCustCargo = rmcRespCustomColl
									.getResult(i);
							if ("AC".equals(rmcCustCargo.getCategoryType()
									.trim())) {
								if (FwConstants.ZERO.equals(rmcCustCargo
										.getUserEndSelectionInd())) {
									statusList.add(0, "R");
									statusList.add(1, FwConstants.SPACE);
								} else if (FwConstants.ONE.equals(rmcCustCargo
										.getUserEndSelectionInd())) {
									statusList.add(0, FwConstants.SPACE);
									statusList.add(1, FwConstants.NO);
								} else {
									statusList.add(0, FwConstants.SPACE);
									statusList.add(1, FwConstants.NO);
								}
							}
						}
					} else {
						statusList.add(0, FwConstants.NO);
						statusList.add(1, FwConstants.SPACE);
					}

					if (statusList.isEmpty()) {
						statusList.add(0, FwConstants.NO);
						statusList.add(1, FwConstants.SPACE);
					}
				} else {
					final APP_RGST_Cargo rgstCargo = contactInfoBO
							.splitContactInfoColl(appRgstColl,
									AppConstants.RMC_MODIFIED_RECORD_IND);
					if (rgstCargo != null) {
						statusList.add(0, "C");
						statusList.add(1, FwConstants.SPACE);
					} else {
						if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
								"ARPCS", driverArray) == FwConstants.DRIVER_VISIT_AGAIN) {

							statusList.add(0, FwConstants.NO);
							statusList.add(1, FwConstants.SPACE);
						} else {
							statusList.add(0, FwConstants.SPACE);
							statusList.add(1, FwConstants.NO);
						}

					}
				}
				final RMBContactInformationChangeSelectionListView cntcListView = new RMBContactInformationChangeSelectionListView();

				datMap.put("RGST_STATUS", statusList);
				cntcListView.setLanguage(languageCd);
				cntcListView.setDisplayData(datMap);
				cntcListView.setName("ContactInformation_ListView");
				cntcListView.setPageSize(100);

				// help from others

				final HouseHoldInfoBO infoBO = new HouseHoldInfoBO();
				infoBO.loadHelpFromOthersDetails(appNum);

				final INDIVIDUAL_Custom_Collection indvCustColl = peopleHandler
						.getInHomeIndividuals();
				final APP_INDV_Collection appIndvFilterColl = contactInfoBO
						.filterDeletedIndividuals(indvCustColl, appIndvColl);

				contactInfoBO.filterInsideHomeIndiv(indvCustColl, appIndvColl);

				final RMBPeopleChangeSelectionListView peopleInSideHomListView = new RMBPeopleChangeSelectionListView();
				final List indvInSideHomDataList = new ArrayList();
				indvInSideHomDataList.add(0, appIndvFilterColl);
				indvInSideHomDataList.add(1, sessChgSelectionProfile);
				indvInSideHomDataList.add(2, peopleHandler);

				peopleInSideHomListView.setLanguage(languageCd);
				peopleInSideHomListView.setName("PeopleInformation_ListView");
				peopleInSideHomListView.setDisplayData(indvInSideHomDataList);
				peopleInSideHomListView.setPageSize(100);

				final APP_INDV_Collection appIndvOutSideHomColl = contactInfoBO
						.filterChldOutofHomeIndiv(indvCustColl, appIndvColl);

				final RMBPeopleChangeSelectionListView peopleOutSideHomListView = new RMBPeopleChangeSelectionListView();
				final List indvOutSideHomDataList = new ArrayList();
				indvOutSideHomDataList.add(0, appIndvOutSideHomColl);
				indvOutSideHomDataList.add(1, sessChgSelectionProfile);
				indvOutSideHomDataList.add(2, peopleHandler);

				peopleOutSideHomListView.setLanguage(languageCd);
				peopleOutSideHomListView
				.setName("OutSideHomePeopleInfo_ListView");
				peopleOutSideHomListView.setDisplayData(indvOutSideHomDataList);
				peopleOutSideHomListView.setPageSize(100);

				// Preganacy Section
				final RMBPregnancyChangeSelectionListView pregnancyListView = new RMBPregnancyChangeSelectionListView();
				final List pregDataList = new ArrayList();
				pregDataList.add(0, pregColl);
				pregDataList.add(1, sessChgSelectionProfile);

				pregnancyListView.setLanguage(languageCd);
				pregnancyListView.setDisplayData(pregDataList);
				pregnancyListView.setName("PregnancyInformation_ListView");
				pregnancyListView.setPageSize(100);

				final List drugFelonyDataList = new ArrayList();
				drugFelonyDataList.add(0, drugColl);
				drugFelonyDataList.add(1, sessChgSelectionProfile);

				// set required calues to page collection

				driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARPCS",
						driverArray);
				pageCollection.put("ContactInformation_ListView", cntcListView);
				pageCollection.put("PeopleInformation_ListView",
						peopleInSideHomListView);
				pageCollection.put("OutSideHomePeopleInfo_ListView",
						peopleOutSideHomListView);
				pageCollection.put("PregnancyInformation_ListView",
						pregnancyListView);

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code
				 * in this block
				 */

				pageCollection.put("RMB_Rqst_Cargo", rmbRqstCargo);
				pageCollection.put("RMC_Rqst_Cargo", rmcRqstCargo);
				pageCollection.put("RMB_RQST_Collection",
						beforeColl.get("RMB_RQST_Collection"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				beforeColl.get("HOUSEHOLD_COMP_INDV_SEL_RESP_COLL_BEFORE");

				pageCollection.put("DRUGACCESS", FwConstants.READ_WRITE_ACCESS);
				pageCollection.put("PREGACCESS", FwConstants.READ_WRITE_ACCESS);
				pageCollection
				.put("PEOPLE_5260", beforeColl.get("PEOPLE_5260"));
				txnBean.setPageCollection(pageCollection);
				return;
			}

			// Address changes page scheduling logic
			RMC_RESPONSE_Custom_Cargo addrRespCargo = null;

			boolean acRemoved = false;
			for (int i = 0; i < rmcRespCustomColl.size(); i++) {
				if ("AC".equals(rmcRespCustomColl.getCargo(i).getCategoryType())) {
					addrRespCargo = rmcRespCustomColl.getCargo(i);
					rmcRespCustomColl.remove(i);
					acRemoved = true;
				}

				// Adding Pregnancy logic 40362
				if (!acRemoved
						&& AppConstants.PREGNANCY_ENDED
						.equalsIgnoreCase(rmcRespCustomColl.getCargo(i)
								.getCategoryType())
								&& rmcRespCustomColl
								.getCargo(i)
								.getUserEndSelectionInd()
								.equalsIgnoreCase(
										String.valueOf(AppConstants.RMC_CHG_SEL_IND))) {
					rmcRespCustomColl.getCargo(i).setCategoryType(
							AppConstants.PREGNANCY_CHANGE);
				}
				if (!acRemoved
						&& AppConstants.PREGNANCY_ENDED
						.equalsIgnoreCase(rmcRespCustomColl.getCargo(i)
								.getCategoryType())
								&& rmcRespCustomColl
								.getCargo(i)
								.getUserEndSelectionInd()
								.equalsIgnoreCase(
										String.valueOf(AppConstants.RMB_NO_CHANGE_SEL_IND))) {
					rmcRespCustomColl.getCargo(i).setCategoryType(
							AppConstants.PREGNANCY_CHANGE);
				}
			}

			// for help from others
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 4,2 lines Commented Code in
			 * this block
			 */

			if (addrRespCargo != null) {
				if (addrRespCargo.getResponse().equals(
						String.valueOf(AppConstants.RMC_CHG_SEL_IND))) {
					if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
							"ARACD", driverArray) == FwConstants.DRIVER_NOT_REQUIRED) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARACD", driverArray, appNum);
					}
				} else {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARACD", driverArray,
							appNum);
				}
			}

			session.remove("WarningMessageShown");
			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			if (categorySelectionProfile == null
					|| categorySelectionProfile.isEmpty()) {

				categorySelectionProfile = categorySelectionProfileManager
						.buildSelectionProfile(rmcRespCustomColl, appNum,
						AppConstants.RMC_CAT_HO_COMP_PRFL);
			} else {
				final List catTypeList = new ArrayList();
				catTypeList.add(AppConstants.INDV_DMGRPH_CHANGE);
				catTypeList.add(AppConstants.BECAME_PREGNANT);
				catTypeList.add(AppConstants.PREGNANCY_ENDED);
				catTypeList.add(AppConstants.PREGNANCY_CHANGE);
				catTypeList.add(AppConstants.CHANGE_DRUG_FELONY);
				catTypeList.add(AppConstants.BECAME_DRUG_FELONY);

				categorySelectionProfileManager.rebuildSelectionProfile(
						categorySelectionProfile, rmcRespCustomColl, appNum,
						AppConstants.RMC_CAT_HO_COMP_PRFL, catTypeList);
			}
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);

			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);


			final Map pageIdCatTypeHm = new HashMap();
			pageIdCatTypeHm.put(AppConstants.INDV_DMGRPH_CHANGE, "ARHMI");
			pageIdCatTypeHm.put(AppConstants.BECAME_PREGNANT, "ARHPD");
			pageIdCatTypeHm.put(AppConstants.PREGNANCY_ENDED, "ARHPD");
			pageIdCatTypeHm.put(AppConstants.PREGNANCY_CHANGE, "ARHPD");
			pageIdCatTypeHm.put(AppConstants.BECAME_DRUG_FELONY, "ARDFD");
			pageIdCatTypeHm.put(AppConstants.CHANGE_DRUG_FELONY, "ARDFD");

			final RMC_RESPONSE_Custom_Collection rmcRespBeforeColl = (RMC_RESPONSE_Custom_Collection) beforeColl
					.get("HOUSEHOLD_COMP_INDV_SEL_RESP_COLL_BEFORE");

			final Map beforeCollMap = new HashMap();
			final int rmcRespBeforeCollSize = rmcRespBeforeColl.size();
			for (int j = 0; j < rmcRespBeforeCollSize; j++) {
				final RMC_RESPONSE_Custom_Cargo beforeCargo = (RMC_RESPONSE_Custom_Cargo) rmcRespBeforeColl
						.get(j);
				final String beforeCargoCatType = beforeCargo.getCategoryType();
				final String beforeCargoIndivSeqNum = beforeCargo
						.getIndvSeqNum();
				String beforeCargoResponse = null;
				if (beforeCargo.getResponse() != null
						&& beforeCargo.getResponse().trim().length() > 0) {
					beforeCargoResponse = beforeCargo.getResponse();
				}
				final String key = beforeCargoCatType + "_"
						+ beforeCargoIndivSeqNum;
				final String value = beforeCargoResponse;
				beforeCollMap.put(key, value);
			}

			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			indivColl = peopleHandler.getAllIndividuals();
			boolean isAnySelection = false;
			final Iterator itr = pageIdCatTypeHm.keySet().iterator();
			// for each category
			while (itr.hasNext()) {
				final String catId = (String) itr.next();
				final int indivCollSize = indivColl.size();
				final List changesList = new ArrayList(indivCollSize);
				final String pageId = (String) pageIdCatTypeHm.get(catId);
				// for each individual
				for (int k = 0; k < indivCollSize; k++) {
					final INDIVIDUAL_Custom_Cargo indivCargo = indivColl
							.getResult(k);
					final String indivSeqNum = indivCargo.getIndv_seq_num();
					final short catSeqNum = 0;
					final char currentResponse = categorySelectionProfileManager
							.getSequenceDetailStatus(categorySelectionProfile,
									Short.parseShort(indivSeqNum), catSeqNum,
									catId);
					final String currRespStr = String.valueOf(currentResponse);
					final String beforeResp = (String) beforeCollMap.get(catId
							+ "_" + indivSeqNum);

					if (!currRespStr
							.equals(String
									.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))) {
						isAnySelection = true;
					}

					if (currRespStr.equals(beforeResp)) {
						if (!FwConstants.NO.equals(currRespStr)) {
							if (currRespStr
									.equals(String
											.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))
											|| currRespStr
											.equals(String
													.valueOf(ICategorySelectionProfileManager.STATUS_VISIT_AGAIN))) {
								changesList.add("Comp");
							} else {
								changesList.add("Req");
							}
						} else if (FwConstants.NO.equals(currRespStr)) {
							changesList.add("NotReq");
						}

					}
					// if there was a selection before and no selection now
					if (beforeResp != null
							&& !beforeResp
							.equals(String
									.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))
									&& currRespStr
									.equals(String
											.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))) {
						changesList.add("makeAbsNotReq");
					// if no selection before and a selection now
					} else if ((beforeResp == null || beforeResp
							.equals(String
									.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED)))
									&& !currRespStr
									.equals(String
											.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))
											&& !currRespStr
											.equals(String
													.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))) {
						changesList.add("makeReq");
					} else if ((beforeResp == null || beforeResp
							.equals(String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED)))
									&& currRespStr
									.equals(String
											.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))) {
						if (AppConstants.PREGNANCY_ENDED.equals(catId)
								|| AppConstants.PREGNANCY_CHANGE.equals(catId)
								|| AppConstants.BECAME_PREGNANT.equals(catId)) {
							final Map tempMap = new HashMap();
							tempMap.put(AppConstants.PREGNANCY_ENDED,
									AppConstants.PREGNANCY_ENDED);
							tempMap.put(AppConstants.PREGNANCY_CHANGE,
									AppConstants.PREGNANCY_CHANGE);
							tempMap.put(AppConstants.BECAME_PREGNANT,
									AppConstants.BECAME_PREGNANT);
							tempMap.remove(catId);
							if (categorySelectionProfileManager.checkEmpty(
									categorySelectionProfile, tempMap)) {
								changesList.add("makeAbsNotReq");
							}
						} else if (AppConstants.BECAME_DRUG_FELONY
								.equals(catId)
								|| AppConstants.CHANGE_DRUG_FELONY
								.equals(catId)) {
							final Map tempMap = new HashMap();
							tempMap.put(AppConstants.BECAME_DRUG_FELONY,
									AppConstants.BECAME_DRUG_FELONY);
							tempMap.put(AppConstants.CHANGE_DRUG_FELONY,
									AppConstants.CHANGE_DRUG_FELONY);
							tempMap.remove(catId);
							if (categorySelectionProfileManager.checkEmpty(
									categorySelectionProfile, tempMap)) {
								changesList.add("makeAbsNotReq");
							}
						} else {
							changesList.add("makeAbsNotReq");
						}

					}
				}
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1,1 lines Commented
				 * Code in this block
				 */

				if (changesList.contains("makeReq")) {
					final int driverStatus = driverManager.getAFBStatus(
							FwConstants.RMC_DRIVER, pageId, driverArray);

					if (driverStatus != FwConstants.DRIVER_VISIT_AGAIN) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								pageId, driverArray, appNum);
					}

				} else if (!changesList.contains("makeReq")
						&& !changesList.contains("Req")
						&& changesList.contains("makeAbsNotReq")) {
					final int driverStatus = driverManager.getAFBStatus(
							FwConstants.RMC_DRIVER, pageId, driverArray);
					if (driverStatus != FwConstants.DRIVER_COMPLETE) {
						if ("ARHMI".equals(pageId)) {
							if (driverStatus == FwConstants.DRIVER_REQUIRED
									&& FwConstants.YES.equals(rmbRqstCargo
											.getPrsn_add_stat_ind())) {
								driverManager.makeRequired(
										FwConstants.RMC_DRIVER, pageId,
										driverArray, appNum);
							} else {
								driverManager.makeAbsoluteNotRequired(
										FwConstants.RMC_DRIVER, pageId,
										driverArray, appNum);
							}
						} else {
							driverManager.makeAbsoluteNotRequired(
									FwConstants.RMC_DRIVER, pageId,
									driverArray, appNum);
						}
					}
				}
				if (changesList.contains("Comp")
						&& !changesList.contains("Req")
						&& !changesList.contains("makeReq")) {
					final int driverStatus = driverManager.getAFBStatus(
							FwConstants.RMC_DRIVER, pageId, driverArray);
					if (driverStatus != FwConstants.DRIVER_REQUIRED
							&& driverStatus != FwConstants.DRIVER_VISIT_AGAIN) {
						driverManager.makeComplete(FwConstants.RMC_DRIVER,
								pageId, driverArray, appNum);
					}
				}

			}

			if (isAnySelection) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
						driverArray, appNum);
			} else {
				// Checking the driver status & if it is not any of the
				// following calling 'makeAbsoluteNotRequired'
				final int driverStatus = driverManager.getAFBStatus(
						FwConstants.RMC_DRIVER, "ARHCS", driverArray);
				if (driverStatus != FwConstants.DRIVER_COMPLETE
						&& driverStatus != FwConstants.DRIVER_REQUIRED
						&& driverStatus != FwConstants.DRIVER_VISIT_AGAIN) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARHCS", driverArray,
							appNum);
				}
			}
			// Make individual selection (ARPCS) page complete
			driverManager.makeComplete(FwConstants.RMC_DRIVER, currentPageID,
					driverArray, appNum);
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeIndividualChangeSelection:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeIndividualChangeSelection");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeIndividualChangeSelection");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeIndividualChangeSelection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeIndividualChangeSelection");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeIndividualChangeSelection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * PCR# 40362 - RMB changes Method for Loading the Response Map.
	 *
	 * @param rmcRspnseCustomColl the rmc rspnse custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param getRelavant the get relavant
	 * @param driverStatus the driver status
	 * @param txnBean the txn bean
	 * @param rmbRqstCargo the rmb rqst cargo
	 * @param rmcInPrflColl the rmc in prfl coll
	 * @return the map
	 */
	private Map createandLoadARPCSResponseMapsToPageCollection(
			final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean getRelavant, final int driverStatus,
			final FwTransaction txnBean, final RMB_RQST_Cargo rmbRqstCargo,
			final RMC_IN_PRFL_Collection rmcInPrflColl) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.createandLoadARPCSResponseMapsToPageCollection() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::createandLoadARPIQResponseMapsToPageCollection:Start");

			getPeopleCollectionAndUpdateMaps(rmcRspnseCustomColl,
					pageCollection, peopleHandler,
					AppConstants.INDV_DMGRPH_CHANGE, false, txnBean,
					rmbRqstCargo, true);
			getPeopleCollectionAndUpdateMaps(rmcRspnseCustomColl,
					pageCollection, peopleHandler,
					AppConstants.BECAME_PREGNANT, false, txnBean, rmbRqstCargo,
					true);
			getPeopleCollectionAndUpdateMaps(rmcRspnseCustomColl,
					pageCollection, peopleHandler, "5268", false, txnBean,
					rmbRqstCargo, true);
			getPeopleCollectionAndUpdateMaps(rmcRspnseCustomColl,
					pageCollection, peopleHandler,
					AppConstants.BECAME_DRUG_FELONY, false, txnBean,
					rmbRqstCargo, true);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::createandLoadARPIQResponseMapsToPageCollection:End");
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.createandLoadARPCSResponseMapsToPageCollection() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createandLoadARPCSResponseMapsToPageCollection");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"createandLoadARPIQResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createandLoadARPCSResponseMapsToPageCollection");
		}

	}

	/**
	 * Load people gate post questions.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void loadPeopleGatePostQuestions(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"xxxxxxxxRMCHouseHoldInfoEJBBean.loadPeopleGatePostQuestions() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadPeopleGatePostQuestions:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			Map listViewMap = null;
			String apSeqNumber = null;

			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);

			String languageCd = (String) session.get(AppConstants.LANGUAGE);
			if (languageCd == null || languageCd.trim().length() == 0) {
				languageCd = "EN";
			}

			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl = new RMC_RESPONSE_Custom_Collection();

			SortedSet selectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			boolean loadCatSelProfile = false;

			if ((selectionProfile == null || selectionProfile.isEmpty())
					&& driverStatus != FwConstants.DRIVER_NOT_REQUIRED) {
				loadCatSelProfile = true;
			} else if (selectionProfile != null && !selectionProfile.isEmpty()) {
				CategorySequenceDetail catSeqDetail = categorySelectionProfileManager
						.getCurrentSequenceDetail(selectionProfile);
				if (catSeqDetail == null) {
					catSeqDetail = categorySelectionProfileManager
							.getNextSequenceDetail(selectionProfile);

					if (catSeqDetail != null
							&& AppConstants.RMC_CAT_HH_SUMMARY_PRFL
							.equals(catSeqDetail
									.getChangeSelectionCategoryCd())) {
						loadCatSelProfile = false;
					} else {
						loadCatSelProfile = true;
					}
				}
			}

			if (loadCatSelProfile) {
				final String catategoryCodes = AppConstants.RMC_CAT_HH_SUMMARY_PRFL;
				selectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								catategoryCodes);
				session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
						selectionProfile);
			}

			final PeopleHandler peopleHandler = new PeopleHandler();
			peopleHandler.loadPeopleHandler(appNumber);
			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);
			final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
					.getSortedIndividualsByIndvSeqNum();
			pageCollection.put("INDIVIDUAL_Custom_Collection", indvColl);

			// personalInfo
			final ABHouseholdMembersSummaryBO householdMembersSummaryBO = new ABHouseholdMembersSummaryBO();
			final RMC_INDV_ID_Collection rmcIndvIdColl = householdMembersSummaryBO
					.loadRMCIndvIdCargo(appNumber);

			final APP_INDV_Collection appIndvColl = householdMembersSummaryBO
					.loadCWHouseholdMembers(appNumber);

			listViewMap = new HashMap();
			listViewMap.put("APP_INDV_Collection", appIndvColl);
			listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
			listViewMap.put("SelctionProfile", selectionProfile);
			listViewMap.put("DriverStatus", driverStatus);
			listViewMap.put("RMC_IN_PRFL_Collection", rmcInPrflColl);

			final RMBPersonalInfoSelectionListView personalInfoListView = new RMBPersonalInfoSelectionListView();
			personalInfoListView.setLanguage(languageCd);
			personalInfoListView
			.setName("RMBPersonalInfoSelectionListView_ListView");
			personalInfoListView.setCollection(indvColl);
			personalInfoListView.setDisplayData(listViewMap);
			personalInfoListView.setPageSize(100);

			pageCollection.put("RMBPersonalInfoSelectionListView_ListView",
					personalInfoListView);
			pageCollection.put("APP_INDV_COLLECTION", appIndvColl);
			pageCollection.put("RMC_IN_PRFL_Collection", rmcInPrflColl);

			/*
			 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
			 * javadoc
			 */
			/**
			 * // citizenship /* RMBCitizenshipInfoListView
			 * rmbCitizenShipInfoListView= new RMBCitizenshipInfoListView();
			 * rmbCitizenShipInfoListView.setLanguage(languageCd);
			 * rmbCitizenShipInfoListView
			 * .setName("RMBCitizenshipInfoListView_ListView");
			 * rmbCitizenShipInfoListView.setCollection(indvColl);
			 * rmbCitizenShipInfoListView.setDisplayData(listViewMap);
			 * rmbCitizenShipInfoListView.setPageSize(100);
			 *
			 * pageCollection.put("RMBCitizenshipInfoListView_ListView",
			 * rmbCitizenShipInfoListView);
			 */
			// relationships
			final RMBRelationShipDetailsListView rmbRelationshipListView = new RMBRelationShipDetailsListView();
			listViewMap = new HashMap();
			final HouseHoldRelationshipBO houseHoldRelationshipBO = new HouseHoldRelationshipBO();
			final APP_HSHL_RLT_Collection appHshlRltCollection = houseHoldRelationshipBO
					.loadHouseholdRelationships(appNumber);

			listViewMap.put("APP_HSHL_RLT_Collection", appHshlRltCollection);
			listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
			listViewMap.put("SelctionProfile", selectionProfile);
			listViewMap.put("DriverStatus", driverStatus);
			listViewMap.put("rmcIndvIDColl", rmcIndvIdColl);

			rmbRelationshipListView.setLanguage(languageCd);
			rmbRelationshipListView
			.setName("RMBRelationShipDetailsListView_ListView");
			rmbRelationshipListView.setCollection(indvColl);
			rmbRelationshipListView.setDisplayData(listViewMap);

			pageCollection.put("RMBRelationShipDetailsListView_ListView",
					rmbRelationshipListView);
			pageCollection.put("APP_HSHL_RLT_Collection", appHshlRltCollection);

			// pregnancy
			final PregnancyBO pregnancyBO = new PregnancyBO();
			final APP_IN_PREG_Collection appInPregColl = pregnancyBO
					.loadPregnancyDetails(appNumber);
			final INDIVIDUAL_Custom_Collection pregnantableIndv = PeopleRulesBO
					.getPregnantableIndividuals(indvColl);
			listViewMap = new HashMap();
			listViewMap.put(APP_IN_PREG_COLLECTION_KEY, appInPregColl);
			listViewMap.put("INDIVIDUAL_Custom_Collection", pregnantableIndv);
			listViewMap.put("SelctionProfile", selectionProfile);
			listViewMap.put("DriverStatus", driverStatus);
			listViewMap.put("RMC_IN_PRFL_Collection", rmcInPrflColl);

			final RMBPregnancyDetailsListView pregListView = new RMBPregnancyDetailsListView();
			pregListView.setLanguage(languageCd);
			pregListView.setName("RMBPregnancyDetailsListView_ListView");
			pregListView.setCollection(indvColl);
			pregListView.setDisplayData(listViewMap);

			pageCollection.put("RMBPregnancyDetailsListView_ListView",
					pregListView);
			pageCollection.put(APP_IN_PREG_COLLECTION_KEY, appInPregColl);

			// absentParent
			final RMBAbsentParentListView absentParentListView = new RMBAbsentParentListView();
			final AbsentParentBO absentParentBo = new AbsentParentBO();
			APP_IN_ABSNP_Collection inAbsnpColl = null;
			APP_ABS_PRNT_Collection absPrntColl = null;
			inAbsnpColl = absentParentBo.loadAbsentParentDetails(appNumber);
			pageCollection.put("APP_IN_ABSNP_Collection", inAbsnpColl);
			final APP_IN_ABSNP_Collection inAbsnpColl1 = (APP_IN_ABSNP_Collection) pageCollection
					.get("APP_IN_ABSNP_Collection");

			listViewMap = new HashMap();
			absPrntColl = new APP_ABS_PRNT_Collection();
			for (int i = 0; i < inAbsnpColl1.size(); i++) {
				final APP_IN_ABSNP_Cargo cargo = inAbsnpColl1.getCargo(i);
				apSeqNumber = cargo.getAp_seq_num();
				absPrntColl.addAll(absentParentBo.loadAbsentDetails(appNumber,
						apSeqNumber));
			}
			listViewMap.put("APP_ABS_PRNT_Collection", absPrntColl);
			listViewMap.put("APP_IN_ABSNP_Collection", inAbsnpColl);
			listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
			listViewMap.put("SelctionProfile", selectionProfile);
			listViewMap.put("DriverStatus", driverStatus);

			absentParentListView.setLanguage(languageCd);
			absentParentListView.setName("RMBAbsentParentListView_ListView");
			absentParentListView.setCollection(indvColl);
			absentParentListView.setDisplayData(listViewMap);
			pageCollection.put("RMBAbsentParentListView_ListView",
					absentParentListView);
			pageCollection.put("APP_IN_ABSNP_Collection", inAbsnpColl);
			pageCollection.put("APP_ABS_PRNT_Collection", absPrntColl);
			// disability
			final DisabilityBO dablBO = new DisabilityBO();
			final APP_IN_DABL_Collection dablColl = dablBO
					.loadDisability(appNumber);

			// other than disability
			final INDIVIDUAL_Custom_Collection otherDisabColl = new INDIVIDUAL_Custom_Collection();
			boolean found = false;
			final int invSize = indvColl.size();
			for (int i = 0; i < invSize; i++) {
				final INDIVIDUAL_Custom_Cargo indvcargo = (INDIVIDUAL_Custom_Cargo) indvColl
						.get(i);
				final int disablitySize = dablColl.size();
				for (int j = 0; j < disablitySize; j++) {
					final APP_IN_DABL_Cargo dablcargo = (APP_IN_DABL_Cargo) dablColl
							.get(j);
					if (dablcargo.getIndv_seq_num().equals(
							indvcargo.getIndv_seq_num())) {
						found = true;
						break;
					}
				}

				if (!found) {
					otherDisabColl.add(indvcargo);
				}
				found = false;
			}

			listViewMap = new HashMap();
			listViewMap.put("APP_IN_DABL_Collection", dablColl);
			listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
			listViewMap.put("SelctionProfile", selectionProfile);
			listViewMap.put("DriverStatus", driverStatus);

			final Map dablListMap = new HashMap();

			dablListMap.put("APP_IN_DABL_Collection", dablColl);
			dablListMap.put("INDIVIDUAL_Custom_Collection", indvColl);
			dablListMap.put("RMC_IN_PRFL_Collection", rmcInPrflColl);
			dablListMap.put("Language_Cd", languageCd);
			dablListMap.put("SelctionProfile", selectionProfile);
			dablListMap.put("DriverStatus", driverStatus);

			final RMBDisabilityDetailsListView disablityListView = new RMBDisabilityDetailsListView();
			disablityListView.setLanguage(languageCd);
			disablityListView.setName("RMBDisabilityDetailsListView_ListView");
			disablityListView.setCollection(indvColl);
			disablityListView.setDisplayData(dablListMap);
			pageCollection.put("RMBDisabilityDetailsListView_ListView",
					disablityListView);
			pageCollection.put("APP_IN_DABL_Collection", dablColl);
			pageCollection.put("otherDisabColl", otherDisabColl);
			pageCollection.put("RMC_IN_PRFL_Collection", rmcInPrflColl);

			// caretaker
			final ABHouseHoldRelationshipBO houseHoldRelationBo = new ABHouseHoldRelationshipBO();
			final INDIVIDUAL_Custom_Collection childInvCustColl = new INDIVIDUAL_Custom_Collection();
			if (indvColl != null) {
				for (int i = 0; i < indvColl.size(); i++) {
					final INDIVIDUAL_Custom_Cargo indvSortCargo = indvColl
							.getResult(i);
					if (indvSortCargo.getIndv_age().getYears() <= 18) {
						childInvCustColl.add(indvSortCargo);
					}
				}
			}

			APP_HSHL_RLT_Collection hshlColl = null;
			INDIVIDUAL_Custom_Collection careTakersindCustColl = null;
			final int indivCollSize = indvColl.size();
			final Map childHHCareTakerCustCollMap = new HashMap();
			if (!childInvCustColl.isEmpty()) {
				for (int i = 0; i < childInvCustColl.size(); i++) {
					final INDIVIDUAL_Custom_Cargo childCargo = childInvCustColl
							.getResult(i);
					hshlColl = houseHoldRelationBo.getCareTakerForRMB(
							childCargo, peopleHandler, appNumber,
							AppConstants.CWW_RECORD_IND);
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented
					 * Code in this block
					 */

					careTakersindCustColl = new INDIVIDUAL_Custom_Collection();
					if (null != hshlColl && !hshlColl.isEmpty()) {
						for (int k = 0; k < indivCollSize; k++) {
							final INDIVIDUAL_Custom_Cargo indvcargo = (INDIVIDUAL_Custom_Cargo) indvColl
									.get(k);
							final int hshlCollSize = hshlColl.size();
							for (int j = 0; j < hshlCollSize; j++) {
								final APP_HSHL_RLT_Cargo hshlcargo = (APP_HSHL_RLT_Cargo) hshlColl
										.get(j);
								if (hshlcargo.getSrc_indv_seq_num().equals(
										indvcargo.getIndv_seq_num())) {
									careTakersindCustColl.add(indvcargo);
									break;
								}
							}

						}

						childHHCareTakerCustCollMap.put(
								childCargo.getIndv_seq_num(),
								careTakersindCustColl);
					}

				}
			}

			listViewMap = new HashMap();
			listViewMap.put("childHHCareTakerCustCollMap",
					childHHCareTakerCustCollMap);
			listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
			listViewMap.put("SelctionProfile", selectionProfile);
			listViewMap.put("DriverStatus", driverStatus);
			final RMBCareTakerListView careTakerListView = new RMBCareTakerListView();
			careTakerListView.setLanguage(languageCd);
			careTakerListView.setName("RMBCareTakerListView_ListView");
			careTakerListView.setCollection(indvColl);
			careTakerListView.setDisplayData(listViewMap);

			pageCollection.put("childHHCareTakerCustCollMap",
					childHHCareTakerCustCollMap);
			pageCollection.put("RMBCareTakerListView_ListView",
					careTakerListView);

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in
			 * this block
			 */

			LoadPregResponseMapsToPageCollection(rmcInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler, true,
					driverStatus, txnBean);

			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
			
			//VY
			final ABProgramInformationBO abProgramInformationBO = new ABProgramInformationBO();
			final APP_PGM_RQST_Collection programCollection = abProgramInformationBO
                    .loadRmbProgramInformation(appNumber);
			APP_PGM_RQST_Cargo programCargo = (APP_PGM_RQST_Cargo) programCollection.get(0);
			boolean maInd = ("1").equalsIgnoreCase(programCargo.getFma_rqst_ind());
		    boolean fsInd = ("1").equalsIgnoreCase(programCargo.getFs_rqst_ind());
		    boolean tanfInd = ("1").equalsIgnoreCase(programCargo.getTanf_rqst_ind());
		    boolean wicInd = ("1").equalsIgnoreCase(programCargo.getWic_rqst_ind());
		    boolean ccInd = ("1").equalsIgnoreCase(programCargo.getCc_rqst_ind());
		    
		    if((maInd || fsInd || tanfInd)
		            &&(!wicInd && !ccInd)){
		        final Map httpMapSession = (Map) session
	                    .get(FwConstants.HTTP_SESSION);
	            httpMapSession.put(AppConstants.MENU_ITEM_FINISH_ENABLED,
	                    FwConstants.YES);
		    }
		    
			log(ILog.INFO,"RMCHouseHoldInfoEJBBean::loadPeopleGatePostQuestions:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadPeopleGatePostQuestions");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPeopleGatePostQuestions");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadPeopleGatePostQuestions", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPeopleGatePostQuestions");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadPeopleGatePostQuestions() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store people gate post questions.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */

	public void storePeopleGatePostQuestions(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storePeopleGatePostQuestions() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storePeopleGatePostQuestions:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			Map listViewMap = null;
			final Map httpSessionMap = (Map) session
					.get(FwConstants.HTTP_SESSION);
			final String language = (String) httpSessionMap
					.get(AppConstants.LANGUAGE);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			RMC_IN_PRFL_Collection rmcInPrflSessColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection rmcInPrflPageColl = (RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection");

			final NO_ONE_Collection noOneColl = (NO_ONE_Collection) pageCollection
					.get("NO_ONE_Collection");
			final Map noOneCheckedMap = (Map) beforeColl
					.get(AppConstants.NO_ONE_CHECKED_MAP);
			final RMC_RESPONSE_Custom_Collection beforeRespColl = (RMC_RESPONSE_Custom_Collection) pageCollection
					.get("RMC_RESPONSE_Custom_Collection");


			boolean noOneCollAC = false;
			boolean noOneCollBP = false;
			boolean noOneCollUB = false;
			
			if (noOneColl != null && !noOneColl.isEmpty()) {
				for (int a = 0; a < noOneColl.size(); a++) {
					 NO_ONE_Cargo noOneCargo = noOneColl.getResult(a);
					if ("AC".equals(noOneCargo.getNo_one_name())) {
						noOneCollAC = true;
					}
					if ("BP".equals(noOneCargo.getNo_one_name())) {
						noOneCollBP = true;
					}
					if ("UB".equals(noOneCargo.getNo_one_name())) {
						noOneCollUB = true;
					}

				}
			}

			final MovedInBO movedInBo = new MovedInBO();
			final ARDisabilityBO disabilityBO = new ARDisabilityBO();

			NO_ONE_Cargo noOneCargo = new NO_ONE_Cargo();

			final APP_IN_PREG_Collection appInPregColl = new APP_IN_PREG_Collection();
			final RMC_RESPONSE_Custom_Collection respColl = new RMC_RESPONSE_Custom_Collection();
			for (int i = 0; i < beforeRespColl.size(); i++) {
				RMC_RESPONSE_Custom_Cargo rmcCustomCargo = null;
				rmcCustomCargo = beforeRespColl.getCargo(i);
				if (!FwConstants.NO.equalsIgnoreCase(rmcCustomCargo
						.getResponse())) {
					respColl.add(rmcCustomCargo);
					if(rmcCustomCargo.getCategoryType().indexOf(AppConstants.PERSONAL_INFO)>0){
						RMC_RESPONSE_Custom_Cargo ciCustomCargo = (RMC_RESPONSE_Custom_Cargo) rmcCustomCargo.clone();;
						ciCustomCargo.setCategoryType("HS~"+AppConstants.CITIZEN_INFO);
						respColl.add(ciCustomCargo);
					}
				}

			}
			
			movedInBo.formatResponse(respColl);					

			int size = respColl.size();
			final int respSize = beforeRespColl.size();
			RMC_IN_PRFL_Collection rmcPrflPageColl = null;
			RMC_IN_PRFL_Cargo rmcPrflSessCargo = null;
			RMC_IN_PRFL_Cargo rmcPrflPageCargo = null;

			String seqNum = null;
			String catType = null;
			String indvSeqNum = null;
			RMC_RESPONSE_Custom_Cargo rmcCustomCargo = null;
						
			for (int i = 0; i < size; i++) {
				rmcCustomCargo = respColl.getCargo(i);
				seqNum = rmcCustomCargo.getSeqNum();
				catType = rmcCustomCargo.getCategoryType();
				indvSeqNum = rmcCustomCargo.getIndvSeqNum();
				rmcCustomCargo.getResponse();
				final RMC_RESPONSE_Custom_Cargo rmcCitCustomCargo = new RMC_RESPONSE_Custom_Cargo();

				if (AppConstants.RMC_ADD_NEW_IND.equals(seqNum)) {
					if (AppConstants.PERSONAL_INFO.equals(catType)) {
						indvSeqNum = String.valueOf(movedInBo
								.loadMaxSeqNum(appNum) + 1);
					}
					
					rmcCustomCargo.setIndvSeqNum(indvSeqNum);
					rmcCustomCargo.setSeqNum(FwConstants.ZERO);
					rmcCustomCargo.setUserEndSelectionInd(FwConstants.ZERO);
					// this one is for the page collection
					if (rmcPrflPageColl != null) {
						rmcPrflPageCargo = rmcResponseProfileManager
								.getProfile(rmcPrflPageColl, indvSeqNum);
					} else {
						rmcPrflPageColl = new RMC_IN_PRFL_Collection();
					}
					if (rmcPrflPageCargo == null) {
						rmcPrflPageCargo = new RMC_IN_PRFL_Cargo();
						rmcPrflPageCargo.setApp_num(appNum);
						rmcPrflPageCargo.setIndv_seq_num(indvSeqNum);
						rmcPrflPageColl.addCargo(rmcPrflPageCargo);
					}
					// this one is for the session collection
					if (rmcInPrflSessColl != null) {
						rmcPrflSessCargo = rmcResponseProfileManager
								.getProfile(rmcInPrflSessColl, indvSeqNum);
					} else {
						rmcInPrflSessColl = new RMC_IN_PRFL_Collection();
					}
					if (rmcPrflSessCargo == null) {
						rmcPrflSessCargo = new RMC_IN_PRFL_Cargo();
						rmcPrflSessCargo.setApp_num(appNum);
						rmcPrflSessCargo.setIndv_seq_num(indvSeqNum);
						rmcResponseProfileManager
						.createRMCIndividualProfile(rmcPrflSessCargo);
						rmcInPrflSessColl.addCargo(rmcPrflSessCargo);
					}
					if (AppConstants.PERSONAL_INFO.equals(catType)) {
						rmcPrflPageCargo.setPersonal_info(FwConstants.YES);
						rmcPrflPageCargo.setCitizenship_info(FwConstants.YES);
					}
					if(AppConstants.BECAME_PREGNANT.equals(catType)){
						rmcPrflPageCargo.setPreg_add_stat_sw(FwConstants.YES);
					}
					if (rmcPrflSessCargo.getPersonal_info() == null) {
						rmcPrflSessCargo.setPersonal_info(FwConstants.NO);
					}

					if(AppConstants.RMC_CAT_DABL_PRFL.equals(catType)){
						rmcPrflPageCargo.setDabl_resp(FwConstants.YES);
						
					}

					respColl.remove(i);
					size--;
					i--;
				} else if (AppConstants.PERSONAL_INFO.equals(catType)
						&& rmcCustomCargo.getUserEndSelectionInd() != null
						&& AppConstants.ZERO.equals(rmcCustomCargo
								.getUserEndSelectionInd())) {

					rmcCitCustomCargo.setIndvSeqNum(rmcCustomCargo
							.getIndvSeqNum());
					rmcCitCustomCargo.setUserEndSelectionInd(rmcCustomCargo
							.getResponse());
					rmcCitCustomCargo
					.setChangeSelectionCategoryCd(rmcCustomCargo
							.getChangeSelectionCategoryCd());
					rmcCitCustomCargo.setSeqNum(rmcCustomCargo.getSeqNum());
					rmcCitCustomCargo.setResponse(rmcCustomCargo.getResponse());
					rmcCitCustomCargo
					.setCategoryType(AppConstants.CITIZEN_INFO);
					respColl.add(rmcCitCustomCargo);

				}
			}
			session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflSessColl);

			// validate gatepost selections
			final Map assetValidationMap = new HashMap();
			assetValidationMap.put("APP_IN_DABL_Collection",
					beforeColl.get("APP_IN_DABL_Collection"));
			assetValidationMap.put(APP_IN_PREG_COLLECTION_KEY,
					beforeColl.get(APP_IN_PREG_COLLECTION_KEY));
			assetValidationMap.put("APP_HSHL_RLT_Collection",
					beforeColl.get("APP_HSHL_RLT_Collection"));
			assetValidationMap.put("APP_INDV_COLLECTION",
					beforeColl.get("APP_INDV_COLLECTION"));
			assetValidationMap.put("APP_ABS_PRNT_Collection",
					beforeColl.get("APP_ABS_PRNT_Collection"));
			assetValidationMap.put("childHHCareTakerCustCollMap",
					beforeColl.get("childHHCareTakerCustCollMap"));

			assetValidationMap.put(AppConstants.PEOPLE + "AC",
					beforeColl.get(AppConstants.PEOPLE + "AC"));

			assetValidationMap.put(AppConstants.PEOPLE + "BP",
					beforeColl.get(AppConstants.PEOPLE + "BP"));
			assetValidationMap.put(AppConstants.PEOPLE + "UB",
					beforeColl.get(AppConstants.PEOPLE + "UB"));
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			request.get(FwConstants.WARNING_MSG_DETAILS);
			FwMessageList msgList = null;
			final RMBPeopleGatePostBO rmbPeopleGatePostBo = new RMBPeopleGatePostBO();
			final ABHouseholdMembersSummaryBO householdMembersSummaryBO = new ABHouseholdMembersSummaryBO();
			final RMC_INDV_ID_Collection rmcIndvIdColl = householdMembersSummaryBO
					.loadRMCIndvIdCargo(appNum);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in
			 * this block
			 */

			if (backToMyAccess == null) {

				rmbPeopleGatePostBo.validatePeopleGatePostChangeSelectionRMB(
						respColl, assetValidationMap);

				final INDIVIDUAL_Custom_Collection peopleAC = (INDIVIDUAL_Custom_Collection) assetValidationMap
						.get(AppConstants.PEOPLE + "AC");
				if (null != peopleAC && !peopleAC.isEmpty()) {
					rmbPeopleGatePostBo.validateRmcInPrflPageColl(
							rmcInPrflPageColl, noOneColl, noOneCheckedMap);
				}
			}
			final boolean isWarningMessageShown = false;

			
			if (rmbPeopleGatePostBo.hasMessages()) {
				msgList = rmbPeopleGatePostBo.getMessageList();
			}

			final APP_INDV_Collection appIndvColl = (APP_INDV_Collection) beforeColl
					.get("APP_INDV_COLLECTION");
			final APP_IN_DABL_Collection dablColl = (APP_IN_DABL_Collection) beforeColl
					.get("APP_IN_DABL_Collection");
			final APP_IN_PREG_Collection pregColl = (APP_IN_PREG_Collection) beforeColl
					.get(APP_IN_PREG_COLLECTION_KEY);
			final APP_HSHL_RLT_Collection hshlColl = (APP_HSHL_RLT_Collection) beforeColl
					.get("APP_HSHL_RLT_Collection");
			final APP_IN_ABSNP_Collection appAbsPrntColl = (APP_IN_ABSNP_Collection) beforeColl
					.get("APP_IN_ABSNP_Collection");
			final APP_ABS_PRNT_Collection absPrntColl = (APP_ABS_PRNT_Collection) beforeColl
					.get("APP_ABS_PRNT_Collection");
			final INDIVIDUAL_Custom_Collection indvColl = (INDIVIDUAL_Custom_Collection) beforeColl
					.get("INDIVIDUAL_Custom_Collection");
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) beforeColl
					.get("RMC_IN_PRFL_Collection");

			final INDIVIDUAL_Custom_Collection otherDisabColl = (INDIVIDUAL_Custom_Collection) beforeColl
					.get("otherDisabColl");

			final Map childHHCareTakerCustCollMap = (Map) beforeColl
					.get("childHHCareTakerCustCollMap");
			if (checkBackToMyAccessSelected(request) || msgList != null
					&& !isWarningMessageShown) {

				request.put(FwConstants.MESSAGE_LIST, msgList);

				if (respColl != null && !respColl.isEmpty()) {
					categorySelectionProfile = categorySelectionProfileManager
							.buildSelectionProfileAfterValidation(
									categorySelectionProfile, respColl);
				}
				final RMBPersonalInfoSelectionListView personalInfoListView = (RMBPersonalInfoSelectionListView) beforeColl
						.get("RMBPersonalInfoSelectionListView_ListView");
				final RMBDisabilityDetailsListView disablityListView = (RMBDisabilityDetailsListView) beforeColl
						.get("RMBDisabilityDetailsListView_ListView");
				final RMBAbsentParentListView absentParentListView = (RMBAbsentParentListView) beforeColl
						.get("RMBAbsentParentListView_ListView");
				final RMBPregnancyDetailsListView pregListView = (RMBPregnancyDetailsListView) beforeColl
						.get("RMBPregnancyDetailsListView_ListView");
				final RMBRelationShipDetailsListView rmbRelationshipListView = (RMBRelationShipDetailsListView) beforeColl
						.get("RMBRelationShipDetailsListView_ListView");
				beforeColl.get("RMBCitizenshipInfoListView_ListView");
				final RMBCareTakerListView careTakerListView = (RMBCareTakerListView) beforeColl
						.get("RMBCareTakerListView_ListView");
				pageCollection.put("INDIVIDUAL_Custom_Collection", indvColl);
				listViewMap = new HashMap();
				listViewMap.put("APP_INDV_Collection", appIndvColl);
				listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
				listViewMap.put("SelctionProfile", categorySelectionProfile);
				listViewMap.put("DriverStatus", driverStatus);
				listViewMap = new HashMap();
				listViewMap.put("APP_INDV_Collection", appIndvColl);
				listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
				listViewMap.put("SelctionProfile", categorySelectionProfile);
				listViewMap.put("DriverStatus", driverStatus);
				personalInfoListView.setLanguage(language);
				personalInfoListView
				.setName("RMBPersonalInfoSelectionListView_ListView");
				personalInfoListView.setCollection(indvColl);
				personalInfoListView.setDisplayData(listViewMap);
				personalInfoListView.setPageSize(100);

				pageCollection.put("RMBPersonalInfoSelectionListView_ListView",
						personalInfoListView);
				pageCollection.put("APP_INDV_COLLECTION", appIndvColl);
				listViewMap = new HashMap();
				listViewMap.put("APP_HSHL_RLT_Collection", hshlColl);
				listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
				listViewMap.put("SelctionProfile", categorySelectionProfile);
				listViewMap.put("DriverStatus", driverStatus);
				listViewMap.put("rmcIndvIDColl", rmcIndvIdColl);
				rmbRelationshipListView.setLanguage(language);
				rmbRelationshipListView
				.setName("RMBRelationShipDetailsListView_ListView");
				rmbRelationshipListView.setCollection(indvColl);
				rmbRelationshipListView.setDisplayData(listViewMap);
				pageCollection.put("RMBRelationShipDetailsListView_ListView",
						rmbRelationshipListView);
				pageCollection.put("APP_HSHL_RLT_Collection", hshlColl);
				
				final INDIVIDUAL_Custom_Collection pregnantableIndv = PeopleRulesBO
						.getPregnantableIndividuals(indvColl);
				
				listViewMap = new HashMap();
				listViewMap.put(APP_IN_PREG_COLLECTION_KEY, pregColl);
				listViewMap.put("INDIVIDUAL_Custom_Collection", pregnantableIndv);
				listViewMap.put("SelctionProfile", categorySelectionProfile);
				listViewMap.put("DriverStatus", driverStatus);
				pregListView.setLanguage(language);
				pregListView.setName("RMBPregnancyDetailsListView_ListView");
				pregListView.setCollection(indvColl);
				pregListView.setDisplayData(listViewMap);
				pageCollection.put("RMBPregnancyDetailsListView_ListView",
						pregListView);
				pageCollection.put(APP_IN_PREG_COLLECTION_KEY, pregColl);
				listViewMap = new HashMap();
				listViewMap.put("APP_IN_ABSNP_Collection", appAbsPrntColl);
				listViewMap.put("APP_ABS_PRNT_Collection", absPrntColl);
				listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
				listViewMap.put("SelctionProfile", categorySelectionProfile);
				listViewMap.put("DriverStatus", driverStatus);
				absentParentListView.setLanguage(language);
				absentParentListView
				.setName("RMBAbsentParentListView_ListView");
				absentParentListView.setCollection(indvColl);
				absentParentListView.setDisplayData(listViewMap);
				pageCollection.put("RMBAbsentParentListView_ListView",
						absentParentListView);
				pageCollection.put("APP_IN_ABSNP_Collection", appAbsPrntColl);
				pageCollection.put("APP_ABS_PRNT_Collection", absPrntColl);
				final Map dablListMap = new HashMap();
				dablListMap.put("APP_IN_DABL_Collection", dablColl);
				dablListMap.put("INDIVIDUAL_Custom_Collection", indvColl);
				dablListMap.put("RMC_IN_PRFL_Collection", rmcInPrflColl);
				dablListMap.put("SelctionProfile", categorySelectionProfile);
				dablListMap.put("DriverStatus", driverStatus);
				disablityListView.setLanguage(language);
				disablityListView
				.setName("RMBDisabilityDetailsListView_ListView");
				disablityListView.setCollection(indvColl);
				disablityListView.setDisplayData(dablListMap);
				pageCollection.put("RMBDisabilityDetailsListView_ListView",
						disablityListView);
				pageCollection.put("APP_IN_DABL_Collection", dablColl);
				pageCollection.put("otherDisabColl", otherDisabColl);
				listViewMap = new HashMap();
				listViewMap.put("childHHCareTakerCustCollMap",
						childHHCareTakerCustCollMap);
				listViewMap.put("INDIVIDUAL_Custom_Collection", indvColl);
				listViewMap.put("SelctionProfile", categorySelectionProfile);
				listViewMap.put("DriverStatus", driverStatus);
				careTakerListView.setLanguage(language);
				careTakerListView.setName("RMBCareTakerListView_ListView");
				careTakerListView.setCollection(indvColl);
				careTakerListView.setDisplayData(listViewMap);
				pageCollection.put("childHHCareTakerCustCollMap",
						childHHCareTakerCustCollMap);
				pageCollection.put("RMBCareTakerListView_ListView",
						careTakerListView);

				if (noOneCollBP) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.BECAME_PREGNANT, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.BECAME_PREGNANT, FwConstants.NO);
				}

				if (noOneCollUB) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.UNDERWEIGHT_BIRTH, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.UNDERWEIGHT_BIRTH, FwConstants.NO);
				}

				if (noOneCollAC) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.ABLE_TO_CONCEIVE, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.ABLE_TO_CONCEIVE, FwConstants.NO);
				}
				
				//rmcInPrflPageColl
				Map responseMap_AC  = new HashMap<String,String>();
				Map responseMap_UB  = new HashMap<String,String>();
				if (null != rmcInPrflPageColl && !rmcInPrflPageColl.isEmpty()) {
					for (int i = 0; i < rmcInPrflPageColl.size(); i++) {
						final RMC_IN_PRFL_Cargo cargo = rmcInPrflPageColl.getCargo(i);
						responseMap_AC.put(cargo.getIndv_seq_num(),cargo.getAble_to_conceive_resp());
						responseMap_UB.put(cargo.getIndv_seq_num(),cargo.getUnderweight_birth_resp());
					}
				}
				pageCollection.put("RESP_MAP_AC_Valid",responseMap_AC);
				pageCollection.put("RESP_MAP_UB_Valid",responseMap_UB);
				LoadPregResponseMapsToPageCollection(rmcInPrflSessColl,
						respColl, pageCollection, peopleHandler, true,
						driverStatus, txnBean);
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
				txnBean.setPageCollection(pageCollection);
				return;
			}

			// validation ends

			// handling add new from gatepost - disability, someone moved in
			final short[] responseArray = new short[] {
					IRMCResponseProfileManager.DISABLE,
					IRMCResponseProfileManager.PRSN_INFO_STAT_SW,
					IRMCResponseProfileManager.CITIZENSHIP_INFO,
					IRMCResponseProfileManager.PREG_ADD_STAT_SW };
			boolean disabilityTypeSelRequired = false;
			boolean peopleOneNewRequired = false;
			boolean peopleTwoNewRequired = false;
			boolean pregnancyPageRequired = false;
			if (rmcInPrflSessColl != null) {
				if (rmcPrflPageColl == null) {
					rmcPrflPageColl = new RMC_IN_PRFL_Collection();
				}

				rmcResponseProfileManager.preparePageColl(rmcPrflPageColl,
						rmcInPrflSessColl, responseArray);

				final int rmcInPrflSessCollectionSize = rmcInPrflSessColl
						.size();
				final int rmcInPrflPageCollectionSize = rmcPrflPageColl.size();
				RMC_IN_PRFL_Cargo rmcInPrflPageCargo = null;
				String[] translatedProfileArray = null;
				String indivSeqNum = null;

				final int[] disabilityDetailDirtyIndicator = { IRMCResponseProfileManager.NOT_DIRTY };
				final int[] someoneMovedInDirtyIndicator = { IRMCResponseProfileManager.NOT_DIRTY };
				final int[] citizenshipInfoDirtyIndicator = { IRMCResponseProfileManager.NOT_DIRTY };
				final Map indvResponseMap = new HashMap();
				final boolean[] dirtyIndicatorArray = new boolean[rmcResponseProfileManager
				                                                  .getMaxIndvSeqNumber(rmcInPrflSessColl) + 1];
				char status = IRMCResponseProfileManager.STATUS_NOT_REQUIRED;

				for (int s = 0; s < rmcInPrflSessCollectionSize; s++) {

					final RMC_IN_PRFL_Cargo rmcInPrflSessCargo = rmcInPrflSessColl
							.getCargo(s);
					for (int p = 0; p < rmcInPrflPageCollectionSize; p++) {
						rmcInPrflPageCargo = rmcPrflPageColl.getCargo(p);

						if (rmcInPrflPageCargo.getIndv_seq_num().equals(
								rmcInPrflSessCargo.getIndv_seq_num())) {

							translatedProfileArray = new String[responseArray.length];
							indivSeqNum = rmcInPrflPageCargo.getIndv_seq_num();

							if (rmcResponseProfileManager.determineDirtyStatus(
									rmcInPrflPageCargo.getDabl_resp(),
									rmcInPrflSessCargo.getDabl_resp(),
									disabilityDetailDirtyIndicator,
									driverStatus)) {
								if (!dirtyIndicatorArray[0]) {
									dirtyIndicatorArray[0] = true;
								}
								dirtyIndicatorArray[Integer
								                    .parseInt(indivSeqNum)] = true;
							}

							// Translating Profile Response
							if (!rmcInPrflSessCargo
									.getDabl_resp()
									.equalsIgnoreCase(
											String.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))) {
								rmcResponseProfileManager
								.translateProfileResponses(
										rmcInPrflPageCargo
										.getDabl_resp(),
										rmcInPrflSessCargo
										.getDabl_resp(),
										driverStatus,
										IRMCResponseProfileManager.DISABLE,
										rmcInPrflSessCargo);
							}
							// Setting Response Value in array
							translatedProfileArray[0] = rmcInPrflSessCargo
									.getDabl_resp();
							status = (null != rmcInPrflSessCargo.getDabl_resp()) ? (rmcInPrflSessCargo
									.getDabl_resp().charAt(0))
									: (IRMCResponseProfileManager.STATUS_NOT_REQUIRED);
							// Scheduling Details Page
							if (status == IRMCResponseProfileManager.STATUS_ADD_NEW
									|| status == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
									|| status == IRMCResponseProfileManager.STATUS_REQUIRED) {
								disabilityTypeSelRequired = true;

							}

							if (rmcResponseProfileManager.determineDirtyStatus(
									rmcInPrflPageCargo.getPersonal_info(),
									rmcInPrflSessCargo.getPersonal_info(),
									someoneMovedInDirtyIndicator, driverStatus)) {
								if (!dirtyIndicatorArray[0]) {
									dirtyIndicatorArray[0] = true;
								}
								dirtyIndicatorArray[Integer
								                    .parseInt(indivSeqNum)] = true;
							}

							// Translating Profile Response
							if (!rmcInPrflSessCargo
									.getPersonal_info()
									.equalsIgnoreCase(
											String.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))) {
								rmcResponseProfileManager
								.translateProfileResponses(
										rmcInPrflPageCargo
										.getPersonal_info(),
										rmcInPrflSessCargo
										.getPersonal_info(),
										driverStatus,
										IRMCResponseProfileManager.PRSN_INFO_STAT_SW,
										rmcInPrflSessCargo);
							}

							translatedProfileArray[1] = rmcInPrflSessCargo
									.getPersonal_info();
							status = (null != rmcInPrflSessCargo
									.getPersonal_info()) ? (rmcInPrflSessCargo
									.getPersonal_info().charAt(0))
									: (IRMCResponseProfileManager.STATUS_NOT_REQUIRED);
							if (status == IRMCResponseProfileManager.STATUS_ADD_NEW
									|| status == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
									|| status == IRMCResponseProfileManager.STATUS_REQUIRED) {
								peopleOneNewRequired = true;

							}
							// people in your home 2
							if (rmcResponseProfileManager
									.determineDirtyStatus(rmcInPrflPageCargo
											.getCitizenship_info(),
											rmcInPrflSessCargo
											.getCitizenship_info(),
											citizenshipInfoDirtyIndicator,
											driverStatus)) {
								if (!dirtyIndicatorArray[0]) {
									dirtyIndicatorArray[0] = true;
								}
								dirtyIndicatorArray[Integer
								                    .parseInt(indivSeqNum)] = true;
							}

							// Translating Profile Response
							if (!rmcInPrflSessCargo
									.getCitizenship_info()
									.equalsIgnoreCase(
											String.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))) {
								rmcResponseProfileManager
								.translateProfileResponses(
										rmcInPrflPageCargo
										.getCitizenship_info(),
										rmcInPrflSessCargo
										.getCitizenship_info(),
										driverStatus,
										IRMCResponseProfileManager.CITIZENSHIP_INFO,
										rmcInPrflSessCargo);
							}

							translatedProfileArray[2] = rmcInPrflSessCargo
									.getCitizenship_info();
							status = (null != rmcInPrflSessCargo
									.getCitizenship_info()) ? (rmcInPrflSessCargo
									.getCitizenship_info().charAt(0))
									: (IRMCResponseProfileManager.STATUS_NOT_REQUIRED);
							if (status == IRMCResponseProfileManager.STATUS_ADD_NEW
									|| status == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
									|| status == IRMCResponseProfileManager.STATUS_REQUIRED) {

								peopleTwoNewRequired = true;

							}

							// pregnancy
							if (rmcResponseProfileManager
									.determineDirtyStatus(rmcInPrflPageCargo
											.getPreg_add_stat_sw(),
											rmcInPrflSessCargo
											.getPreg_add_stat_sw(),
											citizenshipInfoDirtyIndicator,
											driverStatus)) {
								if (!dirtyIndicatorArray[0]) {
									dirtyIndicatorArray[0] = true;
								}
								dirtyIndicatorArray[Integer
								                    .parseInt(indivSeqNum)] = true;
							}
							
							// Translating Profile Response
							if (!rmcInPrflSessCargo
									.getPreg_add_stat_sw()
									.equalsIgnoreCase(
											String.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))) {
								rmcResponseProfileManager
								.translateProfileResponses(
										rmcInPrflPageCargo
										.getPreg_add_stat_sw(),
										rmcInPrflSessCargo
										.getPreg_add_stat_sw(),
										driverStatus,
										IRMCResponseProfileManager.PREG_ADD_STAT_SW,
										rmcInPrflSessCargo);
							}

							translatedProfileArray[3] = rmcInPrflSessCargo
									.getPreg_add_stat_sw();
							status = (null != rmcInPrflSessCargo
									.getPreg_add_stat_sw()) ? (rmcInPrflSessCargo
									.getPreg_add_stat_sw().charAt(0))
									: (IRMCResponseProfileManager.STATUS_NOT_REQUIRED);
							if (status == IRMCResponseProfileManager.STATUS_ADD_NEW
									|| status == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
									|| status == IRMCResponseProfileManager.STATUS_REQUIRED) {

								pregnancyPageRequired = true;
								
							}

							indvResponseMap.put(indivSeqNum,
									translatedProfileArray);
							// breaking to pick the next matching individual
							// from session app indv profile
							break;
						}
					}

				}

				// Persistence logic start
				if (dirtyIndicatorArray[0]) {
					String indvSeqNumber = null;
					for (int i = 0; i < rmcInPrflPageCollectionSize; i++) {
						indvSeqNumber = rmcPrflPageColl.getCargo(i)
								.getIndv_seq_num();
						// Changed indvSeqNum to indvSeqNumber
						if (dirtyIndicatorArray[Integer.parseInt(indvSeqNumber)]) {
							rmcResponseProfileManager.persist(appNum,
									indvSeqNumber, responseArray,
									(String[]) indvResponseMap
									.get(indvSeqNumber));
						}
					}
				}
			}

			for (int i = 0; i < respSize; i++) {
				rmcCustomCargo = beforeRespColl.getCargo(i);
				final String categoryType = rmcCustomCargo.getCategoryType();
				rmcCustomCargo.getResponse();
				
				// immigration logic						
				if (categoryType.contains("AB")
						&& FwConstants.ZERO.equals(rmcCustomCargo
								.getUserEndSelectionInd())) {
					
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHAP",
							driverArray, appNum);
					
				}
			}

			if (null != rmcInPrflPageColl && !rmcInPrflPageColl.isEmpty()) {
				for (int i = 0; i < rmcInPrflPageColl.size(); i++) {
					final RMC_IN_PRFL_Cargo cargo = rmcInPrflPageColl
							.getCargo(i);

					if (cargo.getUnderweight_birth_resp() == null) {
						cargo.setUnderweight_birth_resp(FwConstants.NO);
					}
					if (cargo.getAble_to_conceive_resp() == null) {
						cargo.setAble_to_conceive_resp(FwConstants.NO);
					}

					if (cargo.getPreg_add_stat_sw() == null) {
						cargo.setPreg_add_stat_sw(FwConstants.NO);
					}
					if (cargo.getCareTaker_resp() == null) {
						cargo.setCareTaker_resp(FwConstants.NO);
					}
				}
			}

			if (noOneColl != null && !noOneColl.isEmpty()) {
				for (int a = 0; a < noOneColl.size(); a++) {
					noOneCargo = noOneColl.getResult(a);
					if ("AC".equals(noOneCargo.getNo_one_name())) {
						noOneCollAC = true;
					}
					if ("BP".equals(noOneCargo.getNo_one_name())) {
						noOneCollBP = true;
					}
					if ("UB".equals(noOneCargo.getNo_one_name())) {
						noOneCollUB = true;
					}

				}
			}

			final short[] questionsArrayForIndv = new short[3];

			questionsArrayForIndv[0] = IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP;
			questionsArrayForIndv[1] = IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP;
			questionsArrayForIndv[2] = IRMCResponseProfileManager.CARE_TAKER_RESP;

			String[] indivResponseArrayForIndv = null;
			final Map indivResponseMapForIndv = new HashMap();
			RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = null;
			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				indivResponseArrayForIndv = new String[4];
				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
						.getCargo(i);
				RMC_IN_PRFL_Cargo pageCollCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflPageColl,
								sessionCargo.getIndv_seq_num());

				if (pageCollCargo == null) {
					sessionCargo.setUnderweight_birth_resp(FwConstants.NO);
					sessionCargo.setAble_to_conceive_resp(FwConstants.NO);
					sessionCargo.setCareTaker_resp(FwConstants.NO);

					pageCollCargo = new RMC_IN_PRFL_Cargo();
					pageCollCargo.setUnderweight_birth_resp(FwConstants.NO);
					pageCollCargo.setAble_to_conceive_resp(FwConstants.NO);
					pageCollCargo.setCareTaker_resp(FwConstants.NO);

				} else {
					if (null != pageCollCargo.getUnderweight_birth_resp()
							&& !"null".equalsIgnoreCase(pageCollCargo
									.getUnderweight_birth_resp())) {
						sessionCargo.setUnderweight_birth_resp(pageCollCargo
								.getUnderweight_birth_resp());
					} else {
						sessionCargo.setUnderweight_birth_resp(FwConstants.NO);
					}

					if (null != pageCollCargo.getAble_to_conceive_resp()
							&& !"null".equalsIgnoreCase(pageCollCargo
									.getAble_to_conceive_resp())) {
						sessionCargo.setAble_to_conceive_resp(pageCollCargo
								.getAble_to_conceive_resp());
					} else {
						sessionCargo.setAble_to_conceive_resp(FwConstants.NO);
					}
					if (null != pageCollCargo.getCareTaker_resp()
							&& !"null".equalsIgnoreCase(pageCollCargo
									.getCareTaker_resp())) {
						sessionCargo.setCareTaker_resp(pageCollCargo
								.getCareTaker_resp());
					} else {
						sessionCargo.setCareTaker_resp(FwConstants.NO);
					}
					rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
					rmcRespCustomCargo.setIndvSeqNum(sessionCargo
							.getIndv_seq_num());
					rmcRespCustomCargo.setCategoryType(AppConstants.NON_PARENT);
					rmcRespCustomCargo.setSeqNum(i + FwConstants.EMPTY_STRING);
					rmcRespCustomCargo
					.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
					if (FwConstants.NO.equals(sessionCargo.getCareTaker_resp())) {
						rmcRespCustomCargo.setUserEndSelectionInd("2");
					} else {
						rmcRespCustomCargo
						.setUserEndSelectionInd(FwConstants.ZERO);
					}
					respColl.addCargo(rmcRespCustomCargo);

				}
				indivResponseArrayForIndv[0] = sessionCargo
						.getUnderweight_birth_resp();
				indivResponseArrayForIndv[1] = sessionCargo
						.getAble_to_conceive_resp();
				indivResponseArrayForIndv[2] = sessionCargo.getCareTaker_resp();

				indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
						indivResponseArrayForIndv);

				// Add Pregnancy cargo into collection if any individual
				// selected as Pregnant
				if (null != pageCollCargo.getPreg_add_stat_sw()
						&& "R".equalsIgnoreCase(pageCollCargo
								.getPreg_add_stat_sw())) {
					final APP_IN_PREG_Cargo appInPregCargo = new APP_IN_PREG_Cargo();

					appInPregCargo.setApp_num(pageCollCargo.getApp_num());
					appInPregCargo.setIndv_seq_num(pageCollCargo
							.getIndv_seq_num());

					appInPregColl.addCargo(appInPregCargo);
				}
			}

			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
						.getCargo(i);
				rmcResponseProfileManager.persist(appNum, sessionCargo
						.getIndv_seq_num(), questionsArrayForIndv,
						(String[]) indivResponseMapForIndv.get(sessionCargo
								.getIndv_seq_num()));
			}
			if (categorySelectionProfile == null
					|| categorySelectionProfile.isEmpty()) {

				categorySelectionProfile = categorySelectionProfileManager
						.buildSelectionProfile(respColl, appNum,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			} else {
				categorySelectionProfileManager.rebuildSelectionProfile(
						categorySelectionProfile, respColl, appNum,
						AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			}

			final Map personalInfoMap = new HashMap();
			personalInfoMap.put(AppConstants.PERSONAL_INFO,
					AppConstants.PERSONAL_INFO);
			String detailPageStat = null;

			if (peopleOneNewRequired
					|| checkPeoplePageRequired(categorySelectionProfile,
							personalInfoMap)) {
				if (peopleOneNewRequired
						|| !categorySelectionProfileManager
						.areAllSequencesComplete(
								categorySelectionProfile,
								personalInfoMap)) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMI",
							driverArray, appNum);
				} else {
					driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARHMI",
							driverArray, appNum);
				}

			} else {

				detailPageStat = driverManager.getStatus(
						FwConstants.RMC_DRIVER, "ARHMI", driverArray);
				if (!IDriver.DRIVER_STATUS_COMPLETE.equals(detailPageStat)) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHMI", driverArray, appNum);
				}

			}

			// if new person added to household schedule relationship section
			if (peopleOneNewRequired) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHRL",
						driverArray, appNum);
			}

			final Map personalImInfoMap = new HashMap();
			personalImInfoMap.put(AppConstants.CITIZEN_INFO,
					AppConstants.CITIZEN_INFO);

			if (peopleTwoNewRequired
					|| checkPeoplePageRequired(categorySelectionProfile,
							personalImInfoMap)) {
				if (peopleTwoNewRequired
						|| !categorySelectionProfileManager
						.areAllSequencesComplete(
								categorySelectionProfile,
								personalImInfoMap)) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMX",
							driverArray, appNum);
				} else {
					driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARHMX",
							driverArray, appNum);
				}

			} else {

				detailPageStat = driverManager.getStatus(
						FwConstants.RMC_DRIVER, "ARHMX", driverArray);
				if (!IDriver.DRIVER_STATUS_COMPLETE.equals(detailPageStat)) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHMX", driverArray, appNum);
				}

			}

			// pregnancy page schedule
			final Map pregnancyAddMap = new HashMap();
			pregnancyAddMap.put(AppConstants.PREGNANCY_DETAILS,
					AppConstants.PREGNANCY_DETAILS);

			if (pregnancyPageRequired
					|| checkPeoplePageRequired(categorySelectionProfile,
							pregnancyAddMap)) {
				if (pregnancyPageRequired
						|| !categorySelectionProfileManager
						.areAllSequencesComplete(
								categorySelectionProfile,
								pregnancyAddMap)) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHPD",
							driverArray, appNum);
				} else {
					driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARHPD",
							driverArray, appNum);
				}

			} else {

				detailPageStat = driverManager.getStatus(
						FwConstants.RMC_DRIVER, "ARHPD", driverArray);
				if (!IDriver.DRIVER_STATUS_COMPLETE.equals(detailPageStat)) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHPD", driverArray, appNum);
				}

			}

			final Map hsltInfoMap = new HashMap();
			hsltInfoMap.put(AppConstants.RELATIONSHIP_DETAILS,
					AppConstants.RELATIONSHIP_DETAILS);

			if (hshlColl != null && !hshlColl.isEmpty()) {

				if (checkExpenseDetailPageRequired(categorySelectionProfile,
						hsltInfoMap)) {
					if (!categorySelectionProfileManager
							.areAllSequencesComplete(categorySelectionProfile,
									hsltInfoMap)) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARHRL", driverArray, appNum);
					} else {
						driverManager.makeComplete(FwConstants.RMC_DRIVER,
								"ARHRL", driverArray, appNum);
					}
				} else {
					detailPageStat = driverManager.getStatus(
							FwConstants.RMC_DRIVER, "ARHRL", driverArray);
					if (!IDriver.DRIVER_STATUS_COMPLETE.equals(detailPageStat)
							&& !IDriver.DRIVER_STATUS_COMPLETE
							.equals(driverManager.getStatus(
									FwConstants.RMC_DRIVER, pageId,
									driverArray))) {
						driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
								"ARHRL", driverArray, appNum);
					}
				}

			} else {

				if (!IDriver.DRIVER_STATUS_COMPLETE
						.equals(driverManager.getStatus(FwConstants.RMC_DRIVER,
								"ARHRL", driverArray))
								&& !IDriver.DRIVER_STATUS_COMPLETE.equals(driverManager
										.getStatus(FwConstants.RMC_DRIVER, pageId,
												driverArray))) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHRL", driverArray, appNum);
				}
			}

			final Map pregChangeInfoMap = new HashMap();
			pregChangeInfoMap.put(AppConstants.BECAME_PREGNANT,
					AppConstants.BECAME_PREGNANT);

			if (appInPregColl != null && !appInPregColl.isEmpty()) {
				boolean newSelection = false;

				// Check if a new selection
				for (int indexPC = 0; indexPC < appInPregColl.size(); indexPC++) {
					boolean selectedBefore = false;

					for (int indexBC = 0; indexBC < pregColl.size(); indexBC++) {
						if (null != appInPregColl.getCargo(indexPC)
								&& null != pregColl.getCargo(indexBC)
								&& null != appInPregColl.getCargo(indexPC)
								.getIndv_seq_num()
								&& null != pregColl.getCargo(indexBC)
								.getIndv_seq_num()
								&& appInPregColl
								.getCargo(indexPC)
								.getIndv_seq_num()
								.trim()
								.equals(pregColl.getCargo(indexBC)
										.getIndv_seq_num().trim())) {
							selectedBefore = true;
						}
					}

					if (!selectedBefore) {
						newSelection = true;
					}
				}

				if (newSelection) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHPD",
							driverArray, appNum);
				}
			}

			final Map pregInfoMap = new HashMap();
			pregInfoMap.put(AppConstants.PREGNANCY_ENDED,
					AppConstants.PREGNANCY_ENDED);

			if (pregColl != null && !pregColl.isEmpty()) {

				if (checkDetailPageRequiredForEnd(categorySelectionProfile,
						pregInfoMap)) {
					if (!categorySelectionProfileManager
							.areAllSequencesComplete(categorySelectionProfile,
									pregInfoMap)) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARSUM", driverArray, appNum);

					} else {
						driverManager.makeComplete(FwConstants.RMC_DRIVER,
								"ARSUM", driverArray, appNum);
					}
				} else {
					if (!IDriver.DRIVER_STATUS_COMPLETE.equals(driverManager
							.getStatus(FwConstants.RMC_DRIVER, "ARSUM",
									driverArray))) {
						driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
								"ARSUM", driverArray, appNum);
					}
				}

			} else {

				if (!IDriver.DRIVER_STATUS_COMPLETE
						.equals(driverManager.getStatus(FwConstants.RMC_DRIVER,
								"ARSUM", driverArray))) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARSUM", driverArray, appNum);
				}
			}
			final Map dabInfoMap = new HashMap();
			dabInfoMap.put(AppConstants.DISABLED_BLIND,
					AppConstants.DISABLED_BLIND);
			beforeColl.get("APP_IN_DABL_Collection");
			String dablDetailPageStat = null;

			final Map dablCatTypes = disabilityBO.getDisability();

			if (disabilityTypeSelRequired
					|| checkExpenseDetailPageRequired(categorySelectionProfile,
							dablCatTypes)) {
				if (disabilityTypeSelRequired
						|| !categorySelectionProfileManager
						.areAllSequencesComplete(
								categorySelectionProfile, dablCatTypes)) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHDD",
							driverArray, appNum);
				} else {
					driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARHDD",
							driverArray, appNum);
				}
			} else {
				dablDetailPageStat = driverManager.getStatus(
						FwConstants.RMC_DRIVER, "ARHDD", driverArray);
				if (!IDriver.DRIVER_STATUS_COMPLETE.equals(dablDetailPageStat)
						&& !disabilityBO.checkDisabilityDataExistance(appNum)) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHDD", driverArray, appNum);
				} else {
					driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARHDD",
							driverArray, appNum);
				}
			}

			final Map absPrntMap = new HashMap();
			absPrntMap.put(AppConstants.ABS_PARENT, AppConstants.ABS_PARENT);

			final APP_IN_ABSNP_Collection absPrntCol = (APP_IN_ABSNP_Collection) beforeColl
					.get("APP_IN_ABSNP_Collection");
			if (absPrntCol != null && !absPrntCol.isEmpty()) {

				if (checkExpenseDetailPageRequired(categorySelectionProfile,
						absPrntMap)) {
					if (!categorySelectionProfileManager
							.areAllSequencesComplete(categorySelectionProfile,
									absPrntMap)) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARHAP", driverArray, appNum);
					} else {
						driverManager.makeComplete(FwConstants.RMC_DRIVER,
								"ARHAP", driverArray, appNum);
					}
				} else {
					if (!IDriver.DRIVER_STATUS_COMPLETE.equals(driverManager
							.getStatus(FwConstants.RMC_DRIVER, "ARHAP",
									driverArray))) {
						driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
								"ARHAP", driverArray, appNum);
					}
				}

			} else {

				if (!IDriver.DRIVER_STATUS_COMPLETE
						.equals(driverManager.getStatus(FwConstants.RMC_DRIVER,
								"ARHAP", driverArray))) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHAP", driverArray, appNum);
				}
			}
			final Map careTakerMap = new HashMap();
			careTakerMap.put("NP", "NP");
			final List<String> childChangeList = new ArrayList<String>();
			// list the Non CareTaker changes
			boolean isbenefitsPageRequired = false;
			if (categorySelectionProfile != null) {
				// this one form the category selection profile
				final Iterator iter = categorySelectionProfile.iterator();
				CategorySequenceDetail categorySeqDtl = null;
				while (iter.hasNext()) {
					categorySeqDtl = (CategorySequenceDetail) iter.next();
					if (careTakerMap != null
							&& careTakerMap.get(categorySeqDtl
									.getCategoryType()) != null
									&& categorySeqDtl.getUserEndSelectionInd() != AppConstants.RMB_NO_CHANGE_SEL_IND) {
						isbenefitsPageRequired = true;

						childChangeList.add(String.valueOf(categorySeqDtl
								.getIndividualSequence()));
					}
				}
			}
			session.put("CHILD_CARE_TAKER_CHANGE", childChangeList);
			if (childHHCareTakerCustCollMap != null
					&& !childHHCareTakerCustCollMap.isEmpty()) {

				if (isbenefitsPageRequired) {
					if (!categorySelectionProfileManager
							.areAllSequencesComplete(categorySelectionProfile,
									careTakerMap)) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARHPG", driverArray, appNum);
					} else {
						driverManager.makeComplete(FwConstants.RMC_DRIVER,
								"ARHPG", driverArray, appNum);
					}
				} else {
					if (!IDriver.DRIVER_STATUS_COMPLETE.equals(driverManager
							.getStatus(FwConstants.RMC_DRIVER, "ARHPG",
									driverArray))) {
						driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
								"ARHPG", driverArray, appNum);
					}
				}

			} else {

				if (!IDriver.DRIVER_STATUS_COMPLETE
						.equals(driverManager.getStatus(FwConstants.RMC_DRIVER,
								"ARHPG", driverArray))) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHPG", driverArray, appNum);
				}
			}

			// planning healthy babies section
			INDIVIDUAL_Custom_Collection indvCusColl = peopleHandler
					.getAllIndividuals();
			indvCusColl = PeopleRulesBO.getPregnantableIndividuals(indvCusColl);

			final RMC_IN_PRFL_Collection pregnantableProfiles = new RMC_IN_PRFL_Collection();

			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				final RMC_IN_PRFL_Cargo rCargo = rmcInPrflSessColl.getCargo(i);
				for (int j = 0; j < indvCusColl.size(); j++) {
					final INDIVIDUAL_Custom_Cargo aCargo = indvCusColl
							.getResult(j);
					if (aCargo.getIndv_seq_num().equals(
							rCargo.getIndv_seq_num())) {
						pregnantableProfiles.add(rCargo);
					}
				}
			}

			if (pregnantableProfiles != null) {
				APP_IN_PLAN_HLTH_BABIES_Collection cwColl;
				APP_IN_PLAN_HLTH_BABIES_Collection rmColl;
				APP_IN_PLAN_HLTH_BABIES_Collection rnColl;
				String ableToConceiveResp = FwConstants.EMPTY_STRING;
				String underWeightBirthResp = FwConstants.EMPTY_STRING;
				final PregnancyBO pregnancyBO = new PregnancyBO();

				for (int i = 0; i < pregnantableProfiles.size(); i++) {
					final RMC_IN_PRFL_Cargo individualCargo = pregnantableProfiles
							.getCargo(i);
					ableToConceiveResp = individualCargo
							.getAble_to_conceive_resp();
					if (AppConstants.REQUIRED.equals(ableToConceiveResp)) {
						ableToConceiveResp = AppConstants.YES;
					}

					underWeightBirthResp = individualCargo
							.getUnderweight_birth_resp();
					if (AppConstants.REQUIRED.equals(underWeightBirthResp)) {
						underWeightBirthResp = AppConstants.YES;
					}
					final String indSeqNum = individualCargo.getIndv_seq_num();
					// check for cw cargo to determine change or new

					cwColl = pregnancyBO.loadIndvHealtBabiesColl(appNum,
							indSeqNum, AppConstants.CWW_RECORD_IND);
					rmColl = pregnancyBO.loadIndvHealtBabiesColl(appNum,
							indSeqNum, AppConstants.RMC_MODIFIED_RECORD_IND);
					rnColl = pregnancyBO.loadIndvHealtBabiesColl(appNum,
							indSeqNum, AppConstants.RMC_NEW_RECORD_IND);

					if (cwColl.isEmpty() && rmColl.isEmpty()) {
						if (rnColl.isEmpty()) {
							if (AppConstants.YES
									.equalsIgnoreCase(ableToConceiveResp)
									|| AppConstants.YES
									.equalsIgnoreCase(underWeightBirthResp)) {
								storeAndPersist(ableToConceiveResp,
										underWeightBirthResp,
										AppConstants.RMC_NEW_RECORD_IND,
										FwConstants.ROWACTION_INSERT, appNum,
										indSeqNum, null);
							}
						} else if (!rnColl.isEmpty()) {
							final APP_IN_PLAN_HLTH_BABIES_Cargo rnCargo = rnColl
									.getCargo(0);
							if (rnCargo.getAble_to_conceive_resp().equals(
									ableToConceiveResp)
									|| rnCargo.getUnderweight_birth_resp()
									.equals(underWeightBirthResp)) {
								storeAndPersist(ableToConceiveResp,
										underWeightBirthResp,
										AppConstants.RMC_NEW_RECORD_IND,
										FwConstants.ROWACTION_UPDATE, appNum,
										indSeqNum, null);
							}
						}

					} else if (!cwColl.isEmpty()) {
						final APP_IN_PLAN_HLTH_BABIES_Cargo cwCargo = cwColl
								.getCargo(0);

						if (!cwCargo.getAble_to_conceive_resp().equals(
								ableToConceiveResp)
								|| !cwCargo.getUnderweight_birth_resp().equals(
										underWeightBirthResp)) {

							if (rmColl.isEmpty()) {
								storeAndPersist(ableToConceiveResp,
										underWeightBirthResp,
										AppConstants.RMC_MODIFIED_RECORD_IND,
										FwConstants.ROWACTION_INSERT, appNum,
										indSeqNum, cwCargo.getEcp_id());
							} else if (!rmColl.isEmpty()) {
								storeAndPersist(ableToConceiveResp,
										underWeightBirthResp,
										AppConstants.RMC_MODIFIED_RECORD_IND,
										FwConstants.ROWACTION_UPDATE, appNum,
										indSeqNum, cwCargo.getEcp_id());
							}

						}
					}
				}

			}
			rmcResponseProfileManager.getProfile(rmcPrflPageColl, indvSeqNum);

			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);
			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARPGQ",
					driverArray, appNum);
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
			session.put(FwConstants.BEFORE_COLLECTION,
					txnBean.getPageCollection());
			session.put(FwConstants.RMC_DRIVER, driverArray);
			txnBean.setPageCollection(pageCollection);
			txnBean.setSession(session);
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storePeopleGatePostQuestions:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storePeopleGatePostQuestions");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePeopleGatePostQuestions");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storePeopleGatePostQuestions", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePeopleGatePostQuestions");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storePeopleGatePostQuestions() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Check expense detail page required.
	 *
	 * @param categorySelectionProfile the category selection profile
	 * @param catType the cat type
	 * @return true, if successful
	 */
	private boolean checkExpenseDetailPageRequired(
			final SortedSet categorySelectionProfile, final Map catType) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCOtherBenefitsEJBBean.checkExpenseDetailPageRequired() - START");

		try {
			boolean isbenefitsPageRequired = false;
			if (categorySelectionProfile != null) {
				// this one form the category selection profile
				final Iterator iter = categorySelectionProfile.iterator();
				CategorySequenceDetail categorySeqDtl = null;
				while (iter.hasNext()) {
					categorySeqDtl = (CategorySequenceDetail) iter.next();
					if (catType != null
							&& catType.get(categorySeqDtl.getCategoryType()) != null
							&& categorySeqDtl.getUserEndSelectionInd() != AppConstants.RMB_NO_CHANGE_SEL_IND) {
						isbenefitsPageRequired = true;
						break;
					}
				}
			}
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.checkExpenseDetailPageRequired() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return isbenefitsPageRequired;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkExpenseDetailPageRequired");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"checkExpenseDetailPageRequired", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkExpenseDetailPageRequired");
		}
	}

	/**
	 * Load address validation details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadAddressValidationDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadAddressValidationDetails() - START");
		try {
			log(ILog.INFO,
					"HousingExpenseEJBBean::loadAddressValidationDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, pageId,
					driverArray);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final ContactInfoBO bo = new ContactInfoBO();
			// load contact details from db
			final APP_RGST_Collection coll = bo.loadContactInfoDetails(appNum);

			for (int i = 0; i < coll.size(); i++) {
				if (coll.size() > 1) {
					final APP_RGST_Cargo rgstCargo = coll.getCargo(i);
					if (!"RM".equals(rgstCargo.getSrc_app_ind())) {
						coll.remove(i);
					}
				}
			}
			pageCollection.put("APP_RGST_Collection", coll);

			// invoke address validation service

			final String webServiceURL = FwConfigurationManager.getInstance()
					.getEnvironmentProperty("ADDRESS_VALIDATION");
			final AddressValidation validation = new AddressValidation(
					webServiceURL);
			final Address_Custom_Cargo addrCustomCargo = validation
					.getAddressSuggestions(coll.getCargo(0));

			final Address_Custom_Collection addrCustomColl = new Address_Custom_Collection();
			addrCustomColl.add(addrCustomCargo);
			// set to page collection
			pageCollection.put("Address_Custom_Collection", addrCustomColl);

			Map beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			if (beforeColl == null) {
				beforeColl = new HashMap();
				session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			}
			beforeColl.putAll(pageCollection);
			log(ILog.INFO,
					"HousingExpenseEJBBean::loadAddressValidationDetails:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadAddressValidationDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadAddressValidationDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadAddressValidationDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadAddressValidationDetails");		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadAddressValidationDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store address validation details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeAddressValidationDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeAddressValidationDetails() - START");
		try {

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeCollection = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			peopleHandler.getRelevantIndividuals();

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);

			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);

			String homeSelection = (String) request.get("radioGroup_HOME");
			String mailSelection = (String) request.get("radioGroup_MAIL");

			// HOME_FLAG
			if (null == request.get("HOME_FLAG")) {
				homeSelection = "DO NOT VALIDATE";
			}
			// MAIL_FLAG
			if (null == request.get("MAIL_FLAG")) {
				mailSelection = "DO NOT VALIDATE";
			}

			// PERFORM VALIDATION
			final ABRegistrationBO bo = new ABRegistrationBO();
			final FwMessageList validateInfo = bo.validateAddress(
					homeSelection, mailSelection);
			// check for messages
			if (validateInfo != null && validateInfo.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST, validateInfo);

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code
				 * in this block
				 */

				pageCollection.put("APP_RGST_Collection",
						beforeCollection.get("APP_RGST_Collection"));

				pageCollection.put("Address_Custom_Collection",
						beforeCollection.get("Address_Custom_Collection"));

				request.put("radioGroup_HOME", homeSelection);
				request.put("radioGroup_MAIL", mailSelection);

				return;
			}

			// store if user selects system suggested address
			final Address_Custom_Collection addrCustomColl = (Address_Custom_Collection) beforeCollection
					.get("Address_Custom_Collection");
			final APP_RGST_Collection rgstColl = (APP_RGST_Collection) beforeCollection
					.get("APP_RGST_Collection");
			final Address_Custom_Cargo custCargo = addrCustomColl.getCargo(0);
			final APP_RGST_Cargo rgstCargo = rgstColl.getCargo(0);
			boolean persist = false;
			if ("SYSTEM".equals(homeSelection)) {
				rgstCargo.setHshl_l1_adr(custCargo.getHshl_l1_adr());
				rgstCargo.setHshl_l2_adr(custCargo.getHshl_l2_adr());
				rgstCargo.setHshl_sta_adr(custCargo.getHshl_sta_adr());
				rgstCargo.setHshl_city_adr(custCargo.getHshl_city_adr());
				final String hshlZipAdr = custCargo.getHshl_zip_adr();
				final String[] zip = hshlZipAdr.split("-");
				rgstCargo.setHshl_zip_adr(zip[0]);
				rgstCargo.setHshlAddrZip4(zip[1]);
				rgstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				persist = true;
			}

			if ("SYSTEM".equals(mailSelection)) {
				rgstCargo.setAlt_st_adr(custCargo.getAlt_st_adr());
				rgstCargo.setAlt_l2_adr(custCargo.getAlt_l2_adr());
				rgstCargo.setAlt_sta_adr(custCargo.getAlt_sta_adr());
				rgstCargo.setAlt_city_adr(custCargo.getAlt_city_adr());
				final String altZipAdr = custCargo.getAlt_zip_adr();
				final String[] zip = altZipAdr.split("-");
				rgstCargo.setAlt_zip_adr(zip[0]);
				rgstCargo.setAltAddrZip4(zip[1]);
				rgstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				persist = true;
			}

			if (persist) {
				rgstColl.persist(FwConstants.DAO);
			}

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in
			 * this block
			 */

			driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
					"ARAVD", driverArray, appNum);


		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeAddressValidationDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeAddressValidationDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeAddressValidationDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeAddressValidationDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoContactDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load preg end details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadPregEndDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.loadPregEndDetails() - START");
		try {
			final Map request = txnBean.getRequest();
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();

			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String currentPageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);

			SortedSet pregnancyProfile = null;
			SortedSet pregnancyCategoryProfile = null;
			SortedSet pregnancyRmcProfile = null;

			final short[] responseType = new short[] { IRMCResponseProfileManager.PREG_CHG_STAT_SW };
			final String[] catType = new String[] { AppConstants.PREGNANCY_ENDED };
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageId, driverArray);
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final PregnancyBO pregnancyBo = new PregnancyBO();

			boolean rmcAppType = true;
			if (appType != null
					&& !appType
					.equalsIgnoreCase(new String(rmcApplicationType))) {
				rmcAppType = false;
			}

			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			APP_IN_PREG_Collection appInPregCollection = (APP_IN_PREG_Collection) pageCollection
					.get(APP_IN_PREG_COLLECTION_KEY);
			APP_IN_CHILD_INFO_Collection appInChildInfoCollection = (APP_IN_CHILD_INFO_Collection) pageCollection
					.get("APP_IN_CHILD_INFO_Collection");

			if (currentPageId != null && !currentPageId.equals(previousPageId)) {
				pregnancyProfile = new TreeSet(
						new CategorySequenceDetailsComparator());
				if (categorySelectionProfile != null) {
					if(categorySelectionProfile.size() == 0){
					categorySelectionProfile = categorySelectionProfileManager
							.loadCategoryChangeSelectionProfile(appNumber,"HC");
					if(categorySelectionProfile.size() == 0){
						categorySelectionProfile = categorySelectionProfileManager
								.loadCategoryChangeSelectionProfile(appNumber,"HS");
					}
					pregnancyCategoryProfile = createPageProfile(
							categorySelectionProfile, catType);
					pregnancyProfile.addAll(pregnancyCategoryProfile);	
					}else{
						pregnancyCategoryProfile = createPageProfile(
								categorySelectionProfile, catType);
						pregnancyProfile.addAll(pregnancyCategoryProfile);	
					}
					
				} else {
					pregnancyRmcProfile = createPageProfile(
							pregnancyRmcProfile, rmcInPrflColl, responseType);
					pregnancyProfile.addAll(pregnancyRmcProfile);
				}

//				if (pageStatus != FwConstants.DRIVER_REQUIRED) {
//					final APP_IN_PREG_Collection newPregColl = pregnancyBo
//							.getPregnancyList(appNumber);
//					if (newPregColl != null && !newPregColl.isEmpty()) {
//						APP_IN_PREG_Cargo appInPregCargo = null;
//						final int newPregCollSize = newPregColl.size();
//						String categType = FwConstants.EMPTY_STRING;
//						for (int i = 0; i < newPregCollSize; i++) {
//							appInPregCargo = newPregColl.getCargo(i);
//							if (!AppConstants.RMC_NEW_RECORD_IND
//									.equals(appInPregCargo.getSrc_app_ind())) {
//								categType = AppConstants.PREGNANCY_ENDED;
//							}
//							categorySelectionProfileManager
//							.insertExistingSequenceDetail(
//									pregnancyProfile, null, null,
//									Short.parseShort(appInPregCargo
//											.getIndv_seq_num()), 0,
//											categType);
//						}
//					}
//				}

//				if (pageStatus != FwConstants.DRIVER_REQUIRED) {
//					final APP_IN_CHILD_INFO_Collection newChildInfoColl = pregnancyBo
//							.getPregnancynameList(appNumber);
//					if (newChildInfoColl != null && !newChildInfoColl.isEmpty()) {
//						APP_IN_CHILD_INFO_Cargo appInChildInfoCargo = null;
//						final int newChildInfoCollSize = newChildInfoColl
//								.size();
//						String categType = FwConstants.EMPTY_STRING;
//						for (int i = 0; i < newChildInfoCollSize; i++) {
//							appInChildInfoCargo = newChildInfoColl.getCargo(i);
//							categType = AppConstants.PREGNANCY_ENDED;
//							categorySelectionProfileManager
//							.insertExistingSequenceDetail(
//									pregnancyProfile,
//									null,
//									null,
//									Short.parseShort(appInChildInfoCargo
//											.getIndv_seq_num()), 0,
//											categType);
//						}
//					}
//				}

				if (pageStatus == FwConstants.DRIVER_REQUIRED
						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(pregnancyProfile);
				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE) {
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(pregnancyProfile);
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				pregnancyProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			final IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								pregnancyProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Long.parseLong(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					categorySelectionProfileManager.makeSequenceDetailRequired(
							pregnancyProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Long.parseLong(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean.getSeqNum()),
											indivSeqBean.getType());
					if (categorySeqDetail2 != null) {
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (!rmcAppType) {
							final RMB_RQST_Collection rmbRqstCol = (RMB_RQST_Collection) session
									.get(AppConstants.RMB_RQST_COLLECTION);
							rmbRqstCol.getCargo(0);
						}
						if (AppConstants.PREGNANCY_ENDED.equals(indivSeqBean
								.getType())) {
							boolean endRowExists = false;
							if (categorySelectionProfileManager != null) {
								final Iterator iter = categorySelectionProfile
										.iterator();
								CategorySequenceDetail catSeqDetail = null;
								while (iter.hasNext()) {
									catSeqDetail = (CategorySequenceDetail) iter
											.next();
									if (catSeqDetail != null) {
										if (catSeqDetail
												.getIndividualSequence() == Short
												.parseShort(indivSeqBean
														.getIndivSeqNum())
														&& AppConstants.PREGNANCY_ENDED
														.equals(catSeqDetail
																.getCategoryType()
																.trim())
																&& AppConstants.RMC_CAT_HO_COMP_PRFL
														.equals(catSeqDetail
																		.getChangeSelectionCategoryCd())) {
											endRowExists = true;
											break;
										}
									}
								}
							}

							if (endRowExists) {
								categorySelectionProfileManager
								.removeSequenceDetail(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												(short) 0,
												AppConstants.PREGNANCY_ENDED);
							}

							categorySelectionProfileManager
							.insertSequenceDetail(
									categorySelectionProfile,
									appNumber,
									AppConstants.RMC_CAT_HO_COMP_PRFL,
									Short.parseShort(indivSeqBean
											.getIndivSeqNum()),
											AppConstants.PREGNANCY_ENDED);
							categorySelectionProfileManager
							.makeSequenceDetailRequired(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType(), (short) 1);

							SortedSet pregEndSortedSet = null;
							final String[] catTypePregEnd = { AppConstants.PREGNANCY_ENDED };
							pregEndSortedSet = createPageProfile(
									categorySelectionProfile, catTypePregEnd);
							pregnancyProfile.addAll(pregEndSortedSet);
							categorySelectionProfileManager
							.getNextSequenceDetail(pregnancyProfile);
						}
					} else {
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								pregnancyProfile,
								null,
								null,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										indivSeqBean.getType());
						categorySelectionProfileManager
						.makeSequenceDetailRequired(pregnancyProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile, appNumber,
								AppConstants.RMC_CAT_HO_COMP_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
			}

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(pregnancyProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(pregnancyProfile);
			}

			final String indvSeqNum = categorySeqDetail.getIndividualSequence()
					+ FwConstants.EMPTY_STRING;

			final char seqStatus = categorySelectionProfileManager
					.getSequenceDetailStatus(pregnancyProfile,
							categorySeqDetail.getIndividualSequence(), 0l,
							AppConstants.PREGNANCY_ENDED);

			if (ICategorySelectionProfileManager.STATUS_COMPLETE == seqStatus
					|| pageStatus == FwConstants.DRIVER_COMPLETE
					|| ICategorySelectionProfileManager.STATUS_VISIT_AGAIN == seqStatus
					|| ICategorySelectionProfileManager.STATUS_REQUIRED == seqStatus) {
				appInPregCollection = pregnancyBo.getPregnancyEndList(
						appNumber, indvSeqNum);
				appInChildInfoCollection = pregnancyBo
						.getPregnancyEndChildNameList(appNumber, indvSeqNum);
			}

			if (appInPregCollection == null || appInPregCollection.isEmpty()) {
				appInPregCollection = new APP_IN_PREG_Collection();
			}

			if (appInChildInfoCollection == null
					|| appInChildInfoCollection.isEmpty()) {
				appInChildInfoCollection = new APP_IN_CHILD_INFO_Collection();
				final APP_IN_CHILD_INFO_Cargo newChildCargo = new APP_IN_CHILD_INFO_Cargo();
				newChildCargo.setChild_fst_nam(FwConstants.EMPTY_STRING);
				newChildCargo.setChild_last_nam(FwConstants.EMPTY_STRING);
				newChildCargo.setSex_ind(FwConstants.EMPTY_STRING);
				appInChildInfoCollection.addCargo(newChildCargo);
			}

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);

			pageCollection.put(APP_IN_PREG_COLLECTION_KEY, appInPregCollection);
			pageCollection.put("APP_IN_CHILD_INFO_Collection",
					appInChildInfoCollection);
			pageCollection.put("CATEGORY_PREG_TYPE",
					AppConstants.PREGNANCY_ENDED);
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					pregnancyProfile);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNum));
			final INDIVIDUAL_Custom_Collection indivCustCol = peopleHandler
					.getRelevantIndividuals();
			pageCollection.put("PEOPLE_377", indivCustCol);

			txnBean.setPageCollection(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadPregEndDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPregEndDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadPregEndDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPregEndDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadPregEndDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store preg end details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storePregEndDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.storePregEndDetails() - START");
		try {

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			APP_IN_PREG_Collection beforeAppInPregCollection = null;
			APP_IN_PREG_Collection appInPregCollection = null;

			APP_IN_PREG_Cargo beforeAppInPregCargo = null;

			APP_IN_CHILD_INFO_Collection beforeAppInChildInfoCollection = null;
			APP_IN_CHILD_INFO_Collection appInChildInfoCollection = null;

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final SortedSet pregnancyProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			beforeColl.get(AppConstants.FIRST_NAME);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(pregnancyProfile);
			final long catSeqNum = categorySeqDetailBean.getCategorySequence();
			final String catType = categorySeqDetailBean.getCategoryType();
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			short[] programKey = (short[]) session.get(FwConstants.RMC_PROGRAM_KEY);
			boolean isWCOnly = false;
			if (programKey != null) {
				if (programKey[FwConstants.FMA_INDEX] == 0
					&& programKey[FwConstants.FS_INDEX] == 0
					&& programKey[FwConstants.TANF_INDEX] == 0
					&& programKey[FwConstants.CC_INDEX] == 0
					&& programKey[FwConstants.WIC_INDEX] == 1
					) {
					isWCOnly = true;
				}
			}

			if (beforeColl.containsKey(APP_IN_PREG_COLLECTION_KEY)) {
				beforeAppInPregCollection = (APP_IN_PREG_Collection) beforeColl
						.get(APP_IN_PREG_COLLECTION_KEY);
			}

			if (beforeAppInPregCollection != null
					&& !beforeAppInPregCollection.isEmpty()) {
				beforeAppInPregCargo = beforeAppInPregCollection.getCargo(0);
			}

			if (beforeColl.containsKey("APP_IN_CHILD_INFO_Collection")) {
				beforeAppInChildInfoCollection = (APP_IN_CHILD_INFO_Collection) beforeColl
						.get("APP_IN_CHILD_INFO_Collection");
			}

			if (pageCollection.containsKey(APP_IN_PREG_COLLECTION_KEY)) {
				appInPregCollection = (APP_IN_PREG_Collection) pageCollection
						.get(APP_IN_PREG_COLLECTION_KEY);
			}

			appInChildInfoCollection = new APP_IN_CHILD_INFO_Collection();

			APP_IN_PREG_Cargo appInPregCargo = new APP_IN_PREG_Cargo();
			if (appInPregCollection != null && !appInPregCollection.isEmpty()) {
				appInPregCargo = appInPregCollection.getCargo(0);
				int txtFldCount = 1;
				try {
					txtFldCount = Integer.parseInt((String) request
							.get("txtFldCount"));
				} catch (final Exception e) {
					txtFldCount = 1;
					rmcHouseHoldInfoEJBBean.exceptionManagerLog(e, getClass().getName(), "storePregEndDetails");
				}
				if (appInPregCargo != null) {
					for (int i = 0; i < txtFldCount; i++) {
						final APP_IN_CHILD_INFO_Cargo childCargo = new APP_IN_CHILD_INFO_Cargo();
						childCargo.setApp_num(appNumber);
						childCargo.setIndv_seq_num(indvSeqNum
								+ FwConstants.EMPTY_STRING);
						childCargo.setSeq_num(i + FwConstants.EMPTY_STRING);
						childCargo
						.setChild_fst_nam((String) request
								.get("childFstNam_" + i) == null ? FwConstants.EMPTY_STRING
										: (String) request.get("childFstNam_"
												+ i));
						childCargo
						.setChild_last_nam((String) request
								.get("childLastNam_" + i) == null ? FwConstants.EMPTY_STRING
										: (String) request.get("childLastNam_"
												+ i));
						childCargo.setSex_ind((String) request.get("sexInd_"
								+ i) == null ? FwConstants.EMPTY_STRING
										: (String) request.get("sexInd_" + i));
						appInChildInfoCollection.addCargo(childCargo);
					}
				}
			}

			final char seqStatus = categorySelectionProfileManager
					.getSequenceDetailStatus(pregnancyProfile, indvSeqNum, 0l,
							AppConstants.PREGNANCY_ENDED);

			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			final PregnancyBO pregnancyBo = new PregnancyBO();
			if (ICategorySelectionProfileManager.STATUS_COMPLETE == seqStatus
					|| pageStatus == FwConstants.DRIVER_COMPLETE
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
				final APP_IN_CHILD_INFO_Collection appInChildInfoColl = new APP_IN_CHILD_INFO_Collection();
				for (int i = 0; i < beforeAppInChildInfoCollection.size(); i++) {
					final APP_IN_CHILD_INFO_Cargo tempChildCargo = (APP_IN_CHILD_INFO_Cargo) beforeAppInChildInfoCollection
							.get(i);
					tempChildCargo.setRowAction(FwConstants.ROWACTION_DELETE);
					tempChildCargo.setApp_num(appNumber);
					tempChildCargo.setIndv_seq_num(indvSeqNum
							+ FwConstants.EMPTY_STRING);
					tempChildCargo.setSeq_num(i + FwConstants.EMPTY_STRING);
					tempChildCargo
					.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
					appInChildInfoColl.addCargo(tempChildCargo);
				}
				pregnancyBo.storePregnancynameDetails(appInChildInfoColl);
			}


			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			ARHPDValidator arhpdValidator = null;
			arhpdValidator = new ARHPDValidator();
			if (backToMyAccess == null) {
				FwMessageList errorMessageList = null;
				boolean validateCount = false;
				errorMessageList = arhpdValidator
						.validatePregnancyEndIndDetails(appInPregCargo,
								peopleHandler,indvSeqNum);
				if (errorMessageList != null && errorMessageList.hasMessages()) {
					request.put(FwConstants.MESSAGE_LIST,
							arhpdValidator.getMessageList());
					pageCollection.put(AppConstants.FIRST_NAME,
							beforeColl.get(AppConstants.FIRST_NAME));
					pageCollection.put("CATEGORY_PREG_TYPE", catType);
					pageCollection.put("CATEGORY_STATUS",
							beforeColl.get("CATEGORY_STATUS"));
					pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
							pregnancyProfile);
					pageCollection.put("APP_IN_CHILD_INFO_Collection",
							appInChildInfoCollection);
					pageCollection.put(APP_IN_PREG_COLLECTION_KEY,
							appInPregCollection);
					session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
					txnBean.setRequest(request);
					txnBean.setPageCollection(pageCollection);
					return;
				}
				if(!isWCOnly){
				validateCount = arhpdValidator
						.validatePregnancyEndChildCountDetails(appInPregCargo,
								appInChildInfoCollection);
				if (validateCount) {
					request.put(FwConstants.MESSAGE_LIST,
							arhpdValidator.getMessageList());
					pageCollection.put(AppConstants.FIRST_NAME,
							beforeColl.get(AppConstants.FIRST_NAME));
					pageCollection.put("CATEGORY_PREG_TYPE", catType);
					pageCollection.put("CATEGORY_STATUS",
							beforeColl.get("CATEGORY_STATUS"));
					pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
							pregnancyProfile);
					pageCollection.put("APP_IN_CHILD_INFO_Collection",
							appInChildInfoCollection);
					pageCollection.put(APP_IN_PREG_COLLECTION_KEY,
							appInPregCollection);
					//session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
					txnBean.setRequest(request);
					txnBean.setPageCollection(pageCollection);
					if (pageStatus == FwConstants.DRIVER_COMPLETE) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								currentPageID, driverArray, appNumber);
					}
					return;
				}
				errorMessageList = arhpdValidator
						.validatePregnancyEndChildDetails(appInChildInfoCollection);
				if (errorMessageList != null && errorMessageList.hasMessages()) {
					request.put(FwConstants.MESSAGE_LIST,
							arhpdValidator.getMessageList());
					pageCollection.put(AppConstants.FIRST_NAME,
							beforeColl.get(AppConstants.FIRST_NAME));
					pageCollection.put("CATEGORY_PREG_TYPE", catType);
					pageCollection.put("CATEGORY_STATUS",
							beforeColl.get("CATEGORY_STATUS"));
					pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
							pregnancyProfile);
					pageCollection.put("APP_IN_CHILD_INFO_Collection",
							appInChildInfoCollection);
					pageCollection.put(APP_IN_PREG_COLLECTION_KEY,
							appInPregCollection);
					session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
					txnBean.setRequest(request);
					txnBean.setPageCollection(pageCollection);
					return;
				}
			}
			}
			//after validation update the date format
			appInPregCargo.setPreg_due_dt(dateRoutine.convertStringDateFormat1(appInPregCargo.getPreg_due_dt()));
			appInPregCargo.setPreg_dlvry_dt(dateRoutine.convertStringDateFormat1(appInPregCargo.getPreg_dlvry_dt()));
			appInPregCargo.setPreg_term_dt(dateRoutine.convertStringDateFormat1(appInPregCargo.getPreg_term_dt()));
			
			APP_IN_PREG_Collection cwwPregColl = new APP_IN_PREG_Collection();
			if (beforeAppInPregCollection != null
					&& !beforeAppInPregCollection.isEmpty()) {
				appInPregCargo.setApp_num(appNumber);
				appInPregCargo.setIndv_seq_num(indvSeqNum
						+ FwConstants.EMPTY_STRING);
				if (appInPregCargo.getChg_eff_dt() != null
						&& appInPregCargo.getChg_eff_dt().trim().length() != 0
						&& appInPregCargo.getChg_eff_dt().charAt(2) == '/') {
					final StringBuilder dateConverter = new StringBuilder();
					final String sAppDate = appInPregCargo.getChg_eff_dt();
					dateConverter.append(sAppDate.substring(6, 10)).append("-")
					.append(sAppDate.substring(0, 2)).append("-")
					.append(sAppDate.substring(3, 5));
					appInPregCargo.setChg_eff_dt(dateConverter.toString());
				}
				appInPregCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				appInPregCargo.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
				appInPregCargo.setBaby_reside_hshld_ind(beforeAppInPregCargo
						.getBaby_reside_hshld_ind());
				appInPregCargo = (APP_IN_PREG_Cargo) isChanged(
						beforeAppInPregCargo, appInPregCargo);
			} else {
				appInPregCargo.setApp_num(appNumber);
				appInPregCargo.setIndv_seq_num(indvSeqNum
						+ FwConstants.EMPTY_STRING);
				appInPregCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				APP_IN_PREG_Cargo cwwPregCargo = null;
				cwwPregColl = pregnancyBo.loadPregnancyDetails(appNumber,
						AppConstants.CWW_RECORD_IND,
						appInPregCargo.getIndv_seq_num());
				if (cwwPregColl != null && !cwwPregColl.isEmpty()) {
					cwwPregCargo = cwwPregColl.getCargo(0);
				}
				if (AppConstants.PREGNANCY_ENDED.equals(catType)) {
					/*if (cwwPregCargo != null) {
						appInPregCargo.setFetus_ct(cwwPregCargo.getFetus_ct());
						appInPregCargo.setConception_dt(cwwPregCargo
								.getConception_dt());
						appInPregCargo.setPreg_due_dt(cwwPregCargo
								.getPreg_due_dt());
					}*/
					appInPregCargo
					.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
				}
				if (appInPregCargo.getChg_eff_dt() != null
						&& appInPregCargo.getChg_eff_dt().trim().length() != 0
						&& appInPregCargo.getChg_eff_dt().charAt(2) == '/') {
					final StringBuilder dateConverter = new StringBuilder();
					final String sAppDate = appInPregCargo.getChg_eff_dt();
					dateConverter.append(sAppDate.substring(6, 10)).append("-")
					.append(sAppDate.substring(0, 2)).append("-")
					.append(sAppDate.substring(3, 5));
					appInPregCargo.setChg_eff_dt(dateConverter.toString());
				}
				categorySelectionProfileManager.updateSequence(
						pregnancyProfile, null,
						categorySeqDetailBean.getIndividualSequence(),
						catSeqNum, categorySeqDetailBean.getCategoryType());
			}

			APP_IN_PREG_Collection storedPregColl = new APP_IN_PREG_Collection();
			storedPregColl.addCargo(appInPregCargo);
			if ((ICategorySelectionProfileManager.STATUS_COMPLETE == seqStatus || ICategorySelectionProfileManager.STATUS_VISIT_AGAIN == seqStatus)
					&& (pageStatus == FwConstants.DRIVER_COMPLETE || pageStatus == FwConstants.DRIVER_VISIT_AGAIN)) {
				appInPregCollection.remove(0);
				appInPregCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				appInPregCollection.addCargo(appInPregCargo);
				pregnancyBo.storePregnancyDetails(appInPregCollection);
			} else {
				appInPregCollection.remove(0);
				if (null != beforeAppInPregCargo
						&& appInPregCargo.getIndv_seq_num().equals(
								beforeAppInPregCargo.getIndv_seq_num())) {
					appInPregCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				} else {
					appInPregCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				}
				appInPregCollection.addCargo(appInPregCargo);
				pregnancyBo.storePregnancyDetails(appInPregCollection);
			}
						

			final APP_IN_CHILD_INFO_Collection tempChildColl = new APP_IN_CHILD_INFO_Collection();

			for (int i = 0; i < appInChildInfoCollection.size(); i++) {
				final APP_IN_CHILD_INFO_Cargo appInChildInfoCargo = (APP_IN_CHILD_INFO_Cargo) appInChildInfoCollection
						.get(i);
				final APP_IN_CHILD_INFO_Cargo tmpInChildInfoCargo = new APP_IN_CHILD_INFO_Cargo();
				tmpInChildInfoCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				tmpInChildInfoCargo.setApp_num(appNumber);
				tmpInChildInfoCargo.setIndv_seq_num(indvSeqNum
						+ FwConstants.EMPTY_STRING);
				tmpInChildInfoCargo
				.setSeq_num(appInChildInfoCargo.getSeq_num());
				tmpInChildInfoCargo
				.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
				tmpInChildInfoCargo.setChild_fst_nam(appInChildInfoCargo
						.getChild_fst_nam());
				tmpInChildInfoCargo.setChild_last_nam(appInChildInfoCargo
						.getChild_last_nam());
				tmpInChildInfoCargo
				.setSex_ind(appInChildInfoCargo.getSex_ind());
				final APP_IN_CHILD_INFO_Collection cwwChildInfoColl = pregnancyBo
						.loadPregnancynameDetails(appNumber, indvSeqNum
								+ FwConstants.EMPTY_STRING,
								AppConstants.CWW_RECORD_IND,
								appInChildInfoCargo.getSeq_num());
				if (cwwChildInfoColl != null && !cwwChildInfoColl.isEmpty()) {
					APP_IN_CHILD_INFO_Cargo cwwChildInfoCargo = new APP_IN_CHILD_INFO_Cargo();
					cwwChildInfoCargo = cwwChildInfoColl.getCargo(0);
					if (cwwChildInfoCargo != null) {
						final String childfstname = cwwChildInfoCargo
								.getChild_fst_nam();
						final String childlastname = cwwChildInfoCargo
								.getChild_last_nam();
						if (childfstname != null && childlastname != null) {
							tmpInChildInfoCargo.setChild_fst_nam(childfstname);
							tmpInChildInfoCargo
							.setChild_last_nam(childlastname);
						}
					}
				}
				tempChildColl.addCargo(tmpInChildInfoCargo);
			}

			appInChildInfoCollection = null;
			appInChildInfoCollection = tempChildColl;

			pregnancyBo.storePregnancynameDetails(appInChildInfoCollection);

			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.PREGNANCY,
							rmcInPrflCargo, true);
				}
			}
			session.put(FwConstants.RMC_DRIVER, driverArray);
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			categorySelectionProfileManager.makeSequenceDetailComplete(
					pregnancyProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());

			if (categorySelectionProfileManager
					.areAllSequencesComplete(pregnancyProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
				session.put(FwConstants.RMC_DRIVER, driverArray);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(pregnancyProfile);
				appInChildInfoCollection = null;
				storedPregColl = null;
			}

			pageCollection.put("APP_IN_CHILD_INFO_Collection",
					appInChildInfoCollection);
			pageCollection.put(APP_IN_PREG_COLLECTION_KEY, storedPregColl);

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					pregnancyProfile);
			txnBean.setPageCollection(pageCollection);
			txnBean.setRequest(request);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storePregEndDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePregEndDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storePregEndDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePregEndDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storePregEndDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load moved out.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadMovedOut(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.loadMovedOut() - START");
		try {
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			final Map request = txnBean.getRequest();

			final String currentPageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			peopleHandler.getInHomeIndividuals();
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageId, driverArray);

			componentManager.getComponents(currentPageId, txnBean);
			
			//show individuals who are on the case(in WP or only CW records)
			INDIVIDUAL_Custom_Collection indvCustomColl = new INDIVIDUAL_Custom_Collection();
			INDIVIDUAL_Custom_Collection filIndvCustomColl = new INDIVIDUAL_Custom_Collection();
			indvCustomColl.setResults(peopleHandler.getAllIndividuals().cloneResults());
			MovedInBO movedInBo = new MovedInBO();
			APP_INDV_Collection indvColl = movedInBo.loadMovedInDetails(appNum);
			APP_INDV_Collection cwIndvColl = splitCollection(indvColl, AppConstants.CWW_RECORD_IND);
			
			for(Object o: indvCustomColl) {
				INDIVIDUAL_Custom_Cargo indvCustCargo = (INDIVIDUAL_Custom_Cargo) o;
				
				for(Object p: cwIndvColl) {
					APP_INDV_Cargo indvCargo = (APP_INDV_Cargo) p;
					if(indvCustCargo.getIndv_seq_num().equalsIgnoreCase(indvCargo.getIndv_seq_num())) {
						filIndvCustomColl.add(indvCustCargo);
						break;
					}
				}
				
			}
			pageCollection.put("PEOPLE_20055", filIndvCustomColl);
			
			createAndLoadARMOVResponseMapsToPageCollection(rmcInPrflColl,
					pageCollection, peopleHandler, true, driverStatus);

			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadMovedOut");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadMovedOut");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadMovedOut", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadMovedOut");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadMovedOut() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store moved out.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeMovedOut(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.storeMovedOut() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final Map noOneCheckedMap = (Map) beforeColl
					.get(AppConstants.NO_ONE_CHECKED_MAP);
			final NO_ONE_Collection noOneCollection = (NO_ONE_Collection) pageCollection
					.get("NO_ONE_Collection");
			final RMC_IN_PRFL_Collection rmcInPrflSessColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection rmcInPrflPageColl = (RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection");
			final int numofPplInHome = peopleHandler.getNumberOfIndividuals();
			final RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
					.get(AppConstants.RMC_RQST);
			final boolean movedInFlag = rmcRqstCargo == null
					|| FwConstants.NO.equalsIgnoreCase(rmcRqstCargo
							.getPrsn_add_stat_sw()) ? false : true;

			for (int i = 0; i < rmcInPrflPageColl.size(); i++) {
				final RMC_IN_PRFL_Cargo cargo = rmcInPrflPageColl.getCargo(i);
				if (cargo.getMoved_out_of_home_resp() == null) {
					cargo.setMoved_out_of_home_resp(FwConstants.NO);
				}
			}

			final ARMOVValidator movedOutBO = new ARMOVValidator();
			FwMessageList errorMessageList = null;
			errorMessageList = movedOutBO.validateMovedOut(rmcInPrflPageColl,
					noOneCollection, noOneCheckedMap, numofPplInHome,
					movedInFlag);
			if (errorMessageList != null && movedOutBO.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST, errorMessageList);
				for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
					final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
							.getCargo(i);
					final RMC_IN_PRFL_Cargo pageCollCargo = rmcResponseProfileManager
							.getProfile(rmcInPrflPageColl,
									sessionCargo.getIndv_seq_num());
					if (pageCollCargo == null) {
						sessionCargo.setMoved_out_of_home_resp(FwConstants.NO);
					} else {
						sessionCargo.setMoved_out_of_home_resp(pageCollCargo
								.getMoved_out_of_home_resp());
					}
				}
				componentManager.getComponents(currentPageID, txnBean);
				createAndLoadARMOVResponseMapsToPageCollection(
						rmcInPrflSessColl, pageCollection, peopleHandler, true,
						driverStatus);
				if (noOneCollection != null && !noOneCollection.isEmpty()) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED + "20055",
							FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED + "20055",
							FwConstants.NO);
				}
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				txnBean.setRequest(request);
				txnBean.setPageCollection(pageCollection);
				return;
			}

			final short[] questionsArrayForIndv = new short[1];
			questionsArrayForIndv[0] = IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP;

			String[] indivResponseArrayForIndv = null;
			final Map indivResponseMapForIndv = new HashMap();

			final RMC_RESPONSE_Custom_Collection rmcRespCustomColl = new RMC_RESPONSE_Custom_Collection();

//			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
//				indivResponseArrayForIndv = new String[1];
//				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
//						.getCargo(i);
//				final RMC_IN_PRFL_Cargo pageCollCargo = rmcResponseProfileManager
//						.getProfile(rmcInPrflPageColl,
//								sessionCargo.getIndv_seq_num());
//				if (pageCollCargo == null) {
//					sessionCargo.setMoved_out_of_home_resp(FwConstants.NO);
//				} else {
//					sessionCargo.setMoved_out_of_home_resp(pageCollCargo
//							.getMoved_out_of_home_resp());
//					final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
//					rmcRespCustomCargo.setIndvSeqNum(sessionCargo
//							.getIndv_seq_num());
//					rmcRespCustomCargo
//					.setCategoryType(AppConstants.LEFT_THE_HOME);
//					rmcRespCustomCargo.setSeqNum(String.valueOf(i));
//					rmcRespCustomCargo
//					.setChangeSelectionCategoryCd(AppConstants.LEFT_THE_HOME);
//					rmcRespCustomColl.addCargo(rmcRespCustomCargo);
//				}
//				indivResponseArrayForIndv[0] = sessionCargo
//						.getMoved_out_of_home_resp();
//				indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
//						indivResponseArrayForIndv);
//			}

//			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
//				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
//						.getCargo(i);
//				rmcResponseProfileManager.persist(appNum, sessionCargo
//						.getIndv_seq_num(), questionsArrayForIndv,
//						(String[]) indivResponseMapForIndv.get(sessionCargo
//								.getIndv_seq_num()));
//			}
			
			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
						.getCargo(i);
				for (int j = 0; j < rmcInPrflPageColl.size(); j++) {
					final RMC_IN_PRFL_Cargo pageCargo = rmcInPrflPageColl.getCargo(j);
					if (sessionCargo.getIndv_seq_num().equals(
							pageCargo.getIndv_seq_num())) {

						if (!sessionCargo
								.getMoved_out_of_home_resp()
								.equalsIgnoreCase(
										String.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))) {
							rmcResponseProfileManager
							.translateProfileResponses(
									pageCargo
									.getMoved_out_of_home_resp(),
									sessionCargo
									.getMoved_out_of_home_resp(),
									driverStatus,
									IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP,
									sessionCargo);
							
							
							final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
							rmcRespCustomCargo.setIndvSeqNum(sessionCargo
									.getIndv_seq_num());
							rmcRespCustomCargo
							.setCategoryType(AppConstants.LEFT_THE_HOME);
							rmcRespCustomCargo.setSeqNum(String.valueOf(i));
							rmcRespCustomCargo
							.setChangeSelectionCategoryCd(AppConstants.LEFT_THE_HOME);
							rmcRespCustomColl.addCargo(rmcRespCustomCargo);
							
						}
						
						indivResponseArrayForIndv = new String[1];
						indivResponseArrayForIndv[0] = sessionCargo
								.getMoved_out_of_home_resp();
						indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
								indivResponseArrayForIndv);
					}
				}
			}
			
			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
						.getCargo(i);
				
				if(indivResponseMapForIndv.containsKey(sessionCargo.getIndv_seq_num())) {
					rmcResponseProfileManager.persist(appNum, sessionCargo
							.getIndv_seq_num(), questionsArrayForIndv,
							(String[]) indivResponseMapForIndv.get(sessionCargo
									.getIndv_seq_num()));
				}
			}

			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			if (categorySelectionProfile == null
					|| categorySelectionProfile.isEmpty()) {
				categorySelectionProfile = categorySelectionProfileManager
						.buildSelectionProfile(rmcRespCustomColl, appNum,
								AppConstants.LEFT_THE_HOME);
			} else {
				categorySelectionProfileManager.rebuildSelectionProfile(
						categorySelectionProfile, rmcRespCustomColl, appNum,
						AppConstants.LEFT_THE_HOME);
			}

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
			final Map catTypes = new HashMap();
			catTypes.put(AppConstants.LEFT_THE_HOME, AppConstants.LEFT_THE_HOME);
			if (noOneCollection != null && !noOneCollection.isEmpty()) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMO", driverArray, appNum);
			} else if (driverStatus != FwConstants.DRIVER_COMPLETE) {

				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO",
						driverArray, appNum);
			} else if (!categorySelectionProfileManager.areAllSequencesComplete(categorySelectionProfile, catTypes)){
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO",
						driverArray, appNum);
			}

			driverManager.makeComplete(FwConstants.RMC_DRIVER, currentPageID,
					driverArray, appNum);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeMovedOut");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeMovedOut");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeMovedOut", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeMovedOut");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeMovedOut() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load help with application.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHelpWithApplication(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHelpWithApplication() - START");
		try {
			log(ILog.INFO,
					"HousingExpenseEJBBean::loadHelpWithApplication:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			APP_FILE_HELP_Cargo helpCargo = null;
			final APP_FILE_HELP_Collection helpColl = new APP_FILE_HELP_Collection();
			if (pageStatus == FwConstants.DRIVER_COMPLETE
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
				final HelpWithApplicationBO helpBO = new HelpWithApplicationBO();
				helpCargo = helpBO.loadHelpWithApplication(appNumber);
				helpColl.addCargo(helpCargo);
				pageCollection.put("APP_FILE_HELP_Collection", helpColl);
			}
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
			txnBean.setPageCollection(pageCollection);
			log(ILog.INFO, "HousingExpenseEJBBean::loadHelpWithApplication:End");
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHelpWithApplication");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHelpWithApplication");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHelpWithApplication", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHelpWithApplication");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHelpWithApplication() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store help with application.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHelpWithApplication(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHelpWithApplication() - START");

		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			peopleHandler.getRelevantIndividuals();
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, pageId,
					driverArray);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);

			APP_FILE_HELP_Collection appHelpBeforeColl = null;
			APP_FILE_HELP_Collection appHelpColl = null;
			APP_FILE_HELP_Cargo appHelpCargo = null;
			APP_FILE_HELP_Cargo appHelpBeforeCargo = null;

			FwMessageList validateInfo = null;

			if (beforeColl.containsKey("APP_FILE_HELP_Collection")) {
				appHelpBeforeColl = (APP_FILE_HELP_Collection) beforeColl
						.get("APP_FILE_HELP_Collection");
			}
			if (pageCollection.containsKey("APP_FILE_HELP_Collection")) {
				appHelpColl = (APP_FILE_HELP_Collection) pageCollection
						.get("APP_FILE_HELP_Collection");
			}

			final CompleteTheApplicationBO completeTheAppBo = new CompleteTheApplicationBO();
			final ARCTAValidator completeTheApplicationValidatorObj = new ARCTAValidator();

			if (appHelpColl != null && !appHelpColl.isEmpty()) {
				appHelpCargo = appHelpColl.getCargo(0);
				// Now calling the validate method
				validateInfo = completeTheApplicationValidatorObj
						.validateCompleteTheApplication(appHelpCargo);
				if (validateInfo != null && validateInfo.hasMessages()) {
					final String reqWarningMsgs = (String) request
							.get(FwConstants.WARNING_MSG_DETAILS);
					if (!checkForWarningMesgs(reqWarningMsgs,
							completeTheAppBo.getMessageList())) {
						request.put(FwConstants.MESSAGE_LIST, validateInfo);
						pageCollection.put("APP_FILE_HELP_Collection",
								appHelpColl);
						return;
					}
				}
				appHelpCargo.setApp_num(appNum);
				// added by EDSP-CP Team
				if (appHelpCargo.getHelp_indv_ind() != null) {
					appHelpCargo.setHelp_individual_cd(completeTheAppBo
							.getFilingRepresentativeCode(appHelpCargo
									.getHelp_indv_ind()));
				}

				String agencyNumberEntered = null;
				if (appHelpCargo.getAgcy_num() != null) {
					agencyNumberEntered = appHelpCargo.getAgcy_num().trim();
				}
				if (agencyNumberEntered == null
						|| FwConstants.EMPTY_STRING.equals(agencyNumberEntered)) {
					appHelpCargo.setAgcy_num(FwConstants.ZERO);
				}

				// Checking the Before Collection is Null or Not
				if (appHelpBeforeColl != null) {
					appHelpBeforeCargo = appHelpBeforeColl.getCargo(0);

					appHelpCargo = (APP_FILE_HELP_Cargo) isChanged(
							appHelpBeforeCargo, appHelpCargo);
					if (appHelpCargo.isDirty()) {
						appHelpCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						completeTheAppBo
						.storeCompleteTheApplication(appHelpColl);
						completeTheAppBo.checkContactInfo(appHelpCargo,
								appHelpBeforeCargo);
					}
				} else {
					appHelpCargo.setRowAction(FwConstants.ROWACTION_INSERT);
					completeTheAppBo.storeCompleteTheApplication(appHelpColl);
				}
			}

			// check selected option for driver flow only on click of next
			String checkOptionStr = null;
			if (appHelpCargo != null && appHelpCargo.getHelp_indv_ind() != null) {
				checkOptionStr = appHelpCargo.getHelp_indv_ind().trim();
			}

			if (FwConstants.ONE.equals(checkOptionStr)
					|| "4".equals(checkOptionStr)) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARCON", driverArray, appNum);
			} else {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARCON",
						driverArray, appNum);
			}

			session.put(FwConstants.HELP_INDIVIDUAL_INDEX, checkOptionStr);

			if (checkOptionStr != null) {				
					final String[] requiredPages = { "ARARP", "ARFIN" };
					driverManager.makeRequired(FwConstants.RMC_DRIVER, 
							requiredPages, driverArray, appNum);				
			}

			txnBean.setPageCollection(pageCollection);
			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARCTA",
					driverArray, appNum);
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHelpWithApplication");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHelpWithApplication");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHelpWithApplication", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHelpWithApplication");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHelpWithApplication() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load contact information.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadContactInformation(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadContactInformation() - START");
		try {
			log(ILog.INFO,
					"HousingExpenseEJBBean::loadContactInformation:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);

			/* Added by Niroshan Rajamuni Dewayalage | 08/17/2015 */
			/* ----- START ----- */
			String optionSelected = null;
			String optionType = null;
			APP_AR_LG_CNTC_Collection lgColl = null;
			final APP_FILE_HELP_Collection helpColl = new APP_FILE_HELP_Collection();
			APP_FILE_HELP_Cargo helpCargo = null;
			final ContactInformationBO objBO = new ContactInformationBO();

			final HelpWithApplicationBO helpBO = new HelpWithApplicationBO();
			helpCargo = helpBO.loadHelpWithApplication(appNumber);

			optionSelected = helpCargo.getHelp_indv_ind();

			if (FwConstants.ONE.equals(optionSelected)) {
				optionType = "FF";
			} else if ("2".equals(optionSelected)) {
				optionType = "SPAV";
			} else if ("3".equals(optionSelected)) {
				optionType = "FR";
			} else if ("4".equals(optionSelected)) {
				optionType = "LG";
			} else if ("5".equals(optionSelected)) {
				optionType = "POA";
			}

			pageCollection.put("INFO_TYPE", optionType);
			helpColl.addCargo(helpCargo);
			pageCollection.put("APP_FILE_HELP_Collection", helpColl);

			if (driverStatus == FwConstants.DRIVER_COMPLETE
					|| driverStatus == FwConstants.DRIVER_VISIT_AGAIN) {
				lgColl = objBO.getLGContactInfo(appNumber);
				pageCollection.put("APP_AR_LG_CNTC_Collection", lgColl);

				if (!FwConstants.ONE.equals(optionSelected)) {
					lgColl = objBO.getLGContactInfo(appNumber);
					pageCollection.put("APP_AR_LG_CNTC_Collection", lgColl);
				}
			}
			txnBean.setPageCollection(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);

			// to deal with Program Key in session - at this stage Program Key
			// Array contais Zero values.
			// make any one value in the array to 1 and set it back to original
			// one after calling getComponents()
			final short[] orgProgramKeyArray = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			final int size = 5;
			final short[] tempProgramKeyArray = new short[size];
			tempProgramKeyArray[0] = 1;
			session.put(FwConstants.RMC_PROGRAM_KEY, tempProgramKeyArray);
			request.get(FwConstants.CURRENT_PAGE_ID);
			componentManager.getComponents(
					(String) request.get(FwConstants.CURRENT_PAGE_ID), txnBean);
			session.put(FwConstants.RMC_PROGRAM_KEY, orgProgramKeyArray);
			/* ----- END ----- */

			log(ILog.INFO, "HousingExpenseEJBBean::loadContactInformation:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadContactInformation");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadContactInformation");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadContactInformation", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadContactInformation");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadContactInformation() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store contact information.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeContactInformation(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeContactInformation() - START");
		try {
			String appNumber = FwConstants.EMPTY_STRING;
			boolean appARLGPersistFlag = false;
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			FwMessageList validateInfo = null;
			String optSelected = (String) pageCollection.get("INFO_TYPE");

			APP_AR_LG_CNTC_Collection appLGColl = null;
			APP_AR_LG_CNTC_Cargo appLGCargo = null;

			APP_AR_LG_CNTC_Collection appLGBeforeColl = null;
			APP_AR_LG_CNTC_Cargo appLGBeforeCargo = null;

			final Map beforeCollection = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final ContactInformationBO contInfoBO = new ContactInformationBO();
			final ARCONValidator conValidatorObj = new ARCONValidator();
			optSelected = (String) beforeCollection.get("INFO_TYPE");

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			peopleHandler.getRelevantIndividuals();

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			final List componentList = (ArrayList) beforeCollection
					.get(FwConstants.PAGE_COMPONENT_LIST);

			if (componentList != null && componentList.contains("365")) {
			}

			if (beforeCollection.containsKey("APP_AR_LG_CNTC_Collection")) {
				appLGBeforeColl = (APP_AR_LG_CNTC_Collection) beforeCollection
						.get("APP_AR_LG_CNTC_Collection");
			}
			if (pageCollection.containsKey("APP_AR_LG_CNTC_Collection")) {
				appLGColl = (APP_AR_LG_CNTC_Collection) pageCollection
						.get("APP_AR_LG_CNTC_Collection");

				if (appLGColl != null && !appLGColl.isEmpty()) {
					appLGCargo = appLGColl.getCargo(0);

					boolean isAddress = false;
					if (appLGCargo.getL1_adr() != null
							&& !FwConstants.EMPTY_STRING.equals(appLGCargo
									.getL1_adr().trim())) {
						isAddress = true;
					}
					if (isAddress) {
						appLGCargo.setRec_cplt_ind(FwConstants.ONE);
					} else {
						appLGCargo.setRec_cplt_ind(FwConstants.ZERO);
					}
					appLGCargo.setApp_num(appNumber);
				}

				final Map httpSessionMap = (Map) session
						.get(FwConstants.HTTP_SESSION);
				final String language = (String) httpSessionMap
						.get(AppConstants.LANGUAGE);
				validateInfo = conValidatorObj.validateLGContactInfo(
						appLGCargo, language);

				if (validateInfo != null && validateInfo.hasMessages()) {
					request.put(FwConstants.MESSAGE_LIST, validateInfo);
					pageCollection.put("APP_AR_LG_CNTC_Collection", appLGColl);
					pageCollection.put("INFO_TYPE", optSelected);
					pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
							beforeCollection
							.get(FwConstants.PAGE_COMPONENT_LIST));
					return;
				}

				if (appLGBeforeColl != null && !appLGBeforeColl.isEmpty()) {
					appLGBeforeCargo = appLGBeforeColl.getCargo(0);

					appLGCargo = (APP_AR_LG_CNTC_Cargo) isChanged(
							appLGBeforeCargo, appLGCargo);
				}

				if (appLGCargo.isDirty()) {
					appLGCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					appARLGPersistFlag = true;
				} else if (appLGBeforeCargo == null) {
					appLGCargo.setRowAction(FwConstants.ROWACTION_INSERT);
					appARLGPersistFlag = true;
				}

				if (appLGCargo.getAgency_name() == null
						|| appLGCargo.getAgency_name().trim().length() == 0) {
					appLGCargo.setAgency_name(FwConstants.SPACE);
				}

				if (appLGCargo.getCon_name() == null
						|| appLGCargo.getCon_name().trim().length() == 0) {
					appLGCargo.setCon_name(FwConstants.SPACE);
				}

				if (appLGCargo.getL1_adr() == null
						|| appLGCargo.getL1_adr().trim().length() == 0) {
					appLGCargo.setL1_adr(FwConstants.SPACE);
				}

				if (appLGCargo.getL2_adr() == null
						|| appLGCargo.getL2_adr().trim().length() == 0) {
					appLGCargo.setL2_adr(FwConstants.SPACE);
				}

				if (appLGCargo.getSta_adr() == null
						|| appLGCargo.getSta_adr().trim().length() == 0) {
					appLGCargo.setSta_adr(FwConstants.SPACE);
				}

				if (appLGCargo.getCity_adr() == null
						|| appLGCargo.getCity_adr().trim().length() == 0) {
					appLGCargo.setCity_adr(FwConstants.SPACE);
				}

				if (appLGCargo.getZip_adr() == null
						|| appLGCargo.getZip_adr().trim().length() == 0) {
					appLGCargo.setZip_adr(FwConstants.SPACE);
				}

				if (appLGCargo.getPhn_num() == null
						|| appLGCargo.getPhn_num().trim().length() == 0) {
					appLGCargo.setPhn_num(FwConstants.SPACE);
				}

				if (appLGCargo.getAuth_rep_seq_num() == null
						|| appLGCargo.getAuth_rep_seq_num().trim().length() == 0) {
					appLGCargo.setAuth_rep_seq_num(FwConstants.ONE);
				}

				if (appLGCargo.getSrc_app_ind() == null
						|| appLGCargo.getSrc_app_ind().trim().length() == 0) {
					appLGCargo.setSrc_app_ind("AB");
				}
			}

			appLGColl = new APP_AR_LG_CNTC_Collection();
			appLGColl.addCargo(appLGCargo);
			if (appARLGPersistFlag) {
				contInfoBO.storeContactInfo(appLGColl);
			}

			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);
			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARCON",
					driverArray, appNumber);

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeContactInformation");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeContactInformation");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeContactInformation", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeContactInformation");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeContactInformation() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load program selection.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadProgramSelection(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.loadProgramSelection() - START");
		try {
			log(ILog.INFO, "HousingExpenseEJBBean::loadProgramSelection:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final HouseHoldInfoBO houseHoldInfoBO = new HouseHoldInfoBO();

			final String appNum = (String) session
					.get(AppConstants.APP_NUMBER);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, pageId,
					driverArray);
			APP_PGM_RQST_Collection appPgmRqstColl = (APP_PGM_RQST_Collection) beforeColl
					.get("APP_PGM_RQST_Collection");
			if (null == appPgmRqstColl) {
				appPgmRqstColl = houseHoldInfoBO.loadAppPgmRqstColl(appNum);
			}
			pageCollection.put("APP_PGM_RQST_Collection", appPgmRqstColl);
			beforeColl.put(FwConstants.BEFORE_COLLECTION, pageCollection);
			session.putAll(beforeColl);

			log(ILog.INFO, "HousingExpenseEJBBean::loadProgramSelection:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadProgramSelection");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadProgramSelection");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadProgramSelection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadProgramSelection");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadProgramSelection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store program selection.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeProgramSelection(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeProgramSelection() - START");
		try {

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			peopleHandler.getRelevantIndividuals();

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final ABProgramInformationBO programInfoBo = new ABProgramInformationBO();
			final MovedInBO movedInBo = new MovedInBO();
			final HouseHoldInfoBO houseHoldInfoBO = new HouseHoldInfoBO();
			final APP_PRGM_INDV_Collection appPrgmIndvColl = houseHoldInfoBO
					.loadAppPrgmIndvColl(appNum);
			movedInBo.loadAppIndvColl(appNum);
			final APP_PGM_RQST_Collection appPgmRqstColl = (APP_PGM_RQST_Collection) beforeColl
					.get("APP_PGM_RQST_Collection");
			final APP_PGM_RQST_Collection appPagePgmRqstColl = (APP_PGM_RQST_Collection) pageCollection
					.get("APP_PGM_RQST_Collection");
			appPgmRqstColl.getCargo(0);
			APP_PGM_RQST_Cargo appPagePgmRqstCargo = new APP_PGM_RQST_Cargo();
			if (appPagePgmRqstColl != null && !appPagePgmRqstColl.isEmpty()) {
				appPagePgmRqstCargo = appPagePgmRqstColl.getCargo(0);
				if (appPagePgmRqstCargo.getFs_rqst_ind() == null) {
					appPagePgmRqstCargo.setFs_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getCc_rqst_ind() == null) {
					appPagePgmRqstCargo.setCc_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getFpw_rqst_ind() == null) {
					appPagePgmRqstCargo.setFpw_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getFma_rqst_ind() == null) {
					appPagePgmRqstCargo.setFma_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getFpw_rqst_ind() == null) {
					appPagePgmRqstCargo.setFpw_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getCooling_assistance_rqst_ind() == null) {
					appPagePgmRqstCargo
					.setCooling_assistance_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getFuel_assistance_rqst_ind() == null) {
					appPagePgmRqstCargo
					.setFuel_assistance_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getNoSNAP_rqst_ind() == null) {
					appPagePgmRqstCargo.setNoSNAP_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getTanf_rqst_ind() == null) {
					appPagePgmRqstCargo.setTanf_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getCrisis_assistance_rqst_ind() == null) {
					appPagePgmRqstCargo
					.setCrisis_assistance_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getWic_rqst_ind() == null) {
					appPagePgmRqstCargo.setWic_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getEbd_rqst_ind() == null) {
					appPagePgmRqstCargo.setEbd_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getHc_rqst_ind() == null) {
					appPagePgmRqstCargo.setHc_rqst_ind(FwConstants.ZERO);
				}
				if (appPagePgmRqstCargo.getSer_rqst_ind() == null) {
					appPagePgmRqstCargo.setSer_rqst_ind(FwConstants.ZERO);
				}
				// Magi Logic
				final ABHouseholdMembersSummaryBO hmSummarybo = new ABHouseholdMembersSummaryBO();
				final APP_INDV_Collection tempColl = hmSummarybo
						.loadHouseholdMembers(appNum);
				int age = 0;
				boolean fullMedicaid = false;
				for (int j = 0; j < tempColl.size(); j++) {
					final APP_INDV_Cargo tempCargo = (APP_INDV_Cargo) tempColl
							.get(j);
					age = AgeUtil.calculateAge(tempCargo.getBrth_dt());
					if ("1".equalsIgnoreCase(appPagePgmRqstCargo.getFma_rqst_ind())
							&& (FwConstants.YES
									.equals(tempCargo.getDisabled_resp()) || (age >= 65))) {
						fullMedicaid = true;
					}
				}
				
				if (fullMedicaid) {
					appPagePgmRqstCargo.setMagi_rqst_ind(FwConstants.ONE);
				}else{
					appPagePgmRqstCargo.setMagi_rqst_ind(FwConstants.ZERO);	
				}
				if (appPagePgmRqstCargo.getPeach_rqst_ind() == null) {
					appPagePgmRqstCargo.setPeach_rqst_ind(FwConstants.ZERO);
				}
				appPagePgmRqstCargo.setApp_num(appNum);
				appPagePgmRqstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				programInfoBo.updateProgram(appPagePgmRqstColl);

				final String currentPageID = (String) request
						.get(FwConstants.CURRENT_PAGE_ID);
				final int currentPageStatus = driverManager.getAFBStatus(
						FwConstants.RMC_DRIVER, currentPageID, driverArray);
				final APP_PRGM_INDV_Collection persistPrgmIndvColl = new APP_PRGM_INDV_Collection();
				//find CW records
				final APP_PRGM_INDV_Collection cwPrgmIndvColl = new APP_PRGM_INDV_Collection();
				final Map value = new HashMap();
				final FwDataCriteria[] criteria = new FwDataCriteria[2];

				criteria[0] = new FwDataCriteria();
				criteria[0].setColumn_name(AppConstants.APP_NUM);
				criteria[0].setColumn_value(appNum);
				criteria[1] = new FwDataCriteria();
				criteria[1].setColumn_name("SRC_APP_IND");
				criteria[1].setColumn_value("CW");
				final FwDataSortOrder[] sortAll = new FwDataSortOrder[1];
				sortAll[0] = new FwDataSortOrder();
				sortAll[0].setColumnName("INDV_SEQ_NUM");
				sortAll[0].setAscOrder();
				value.put(FwConstants.ORDER_BY, sortAll);

				value.put(FwConstants.CRITERIA, criteria);

				final APP_PRGM_INDV_Cargo[] cargoArray = (APP_PRGM_INDV_Cargo[]) cwPrgmIndvColl.select(FwConstants.DAO,
						value);
				cwPrgmIndvColl.setResults(cargoArray);
				if (currentPageStatus != FwConstants.DRIVER_COMPLETE) {
					if (appPrgmIndvColl != null && !appPrgmIndvColl.isEmpty()) {
						String indValue = null;
						APP_PRGM_INDV_Cargo prgmCargo = null;
						APP_PRGM_INDV_Cargo cwprgmCargo = null;
						for (int i = 0; i < appPrgmIndvColl.size(); i++) {

							prgmCargo = appPrgmIndvColl.getCargo(i);
							cwprgmCargo=cwPrgmIndvColl.getCargo(Integer.valueOf(prgmCargo.getIndv_seq_num())-1);
							prgmCargo.setDirty(false);

							indValue = appPagePgmRqstCargo.getCc_rqst_ind();

								if (AppConstants.ONE.equals(indValue)&&AppConstants.YES.equals(cwprgmCargo.getCc_ind())) {
									prgmCargo.setCc_ind(AppConstants.YES);
								} else if (AppConstants.ZERO.equals(indValue)) {
									prgmCargo.setCc_ind(AppConstants.NO);
								}
								prgmCargo.setDirty(true);

							indValue = appPagePgmRqstCargo.getFma_rqst_ind();
								if (AppConstants.ONE.equals(indValue)&&AppConstants.YES.equals(cwprgmCargo.getMa_ind())) {
									prgmCargo.setMa_ind(AppConstants.YES);
								} else if (AppConstants.ZERO.equals(indValue)) {
									prgmCargo.setMa_ind(AppConstants.NO);
								}
								prgmCargo.setDirty(true);

							indValue = appPagePgmRqstCargo.getTanf_rqst_ind();
								if (AppConstants.ONE.equals(indValue)&&AppConstants.YES.equals(cwprgmCargo.getTa_ind())) {
									prgmCargo.setTa_ind(AppConstants.YES);
								} else if (AppConstants.ZERO.equals(indValue)) {
									prgmCargo.setTa_ind(AppConstants.NO);
								}
								prgmCargo.setDirty(true);

							indValue = appPagePgmRqstCargo.getWic_rqst_ind();
								if (AppConstants.ONE.equals(indValue)&&AppConstants.YES.equals(cwprgmCargo.getWc_ind())) {
									prgmCargo.setWc_ind(AppConstants.YES);
								} else if (AppConstants.ZERO.equals(indValue)) {
									prgmCargo.setWc_ind(AppConstants.NO);
								}
								prgmCargo.setDirty(true);

							indValue = appPagePgmRqstCargo.getFs_rqst_ind();
								if (AppConstants.ONE.equals(indValue)&&AppConstants.YES.equals(cwprgmCargo.getFs_ind())) {
									prgmCargo.setFs_ind(AppConstants.YES);
								} else if (AppConstants.ZERO.equals(indValue)) {
									prgmCargo.setFs_ind(AppConstants.NO);
								}
								prgmCargo.setDirty(true);

							prgmCargo
							.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
							prgmCargo
							.setRowAction(FwConstants.ROWACTION_INSERT);
							if (prgmCargo.isDirty()) {
								persistPrgmIndvColl.addCargo(prgmCargo);
							}
						}
					}
					if (!persistPrgmIndvColl.isEmpty()) {
						houseHoldInfoBO
						.storeAppPrgmIndvDetails(persistPrgmIndvColl);
					}

				}

			}

			beforeColl.put("APP_PGM_RQST_Collection", appPagePgmRqstColl);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);
			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARAFP",
					driverArray, appNum);

			// Reload RMC_PROGRAM_KEY
			final IProgramManager programManager = FwProgramManager
					.getInstance();
			final Map pgmKey = programManager.loadProgramKey(appNum);
			final short[] programKeyArray = (short[]) pgmKey
					.get(AppConstants.ZERO);
			session.put(FwConstants.RMC_PROGRAM_KEY, programKeyArray);
			
			if (programKeyArray[0] == 1&&programKeyArray[2] == 0&&programKeyArray[9] == 0&&programKeyArray[8] == 0&&programKeyArray[14] == 0){
				final String[] notRequiredPages = {"ARXHU","ARXHS"};
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						notRequiredPages, driverArray, appNum);
			}else{
				final String[] notRequiredPages = {"ARXHU","ARXHS"};
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						notRequiredPages, driverArray, appNum);
			}
			
			/*if (programKeyArray[0] == 0){
				final String[] notRequiredPages = { "ARHPA" };
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						notRequiredPages, driverArray, appNum);
			}*/
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeProgramSelection");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeProgramSelection");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeProgramSelection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeProgramSelection");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeProgramSelection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load program information.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadProgramInformation(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadProgramInformation() - START");
		try {
			log(ILog.INFO,
					"HousingExpenseEJBBean::loadProgramInformation:Start");
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			final Map httpSessionMap = (Map) session
					.get(FwConstants.HTTP_SESSION);
			httpSessionMap.get(FwConstants.SECURED_SESSION);
			httpSessionMap.remove(AppConstants.MENU_ITEM_FINISH_ENABLED);
			session.put(FwConstants.HTTP_SESSION, httpSessionMap);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final APP_PGM_RQST_Collection appPgmRqstCollection = (APP_PGM_RQST_Collection) beforeColl
					.get("APP_PGM_RQST_Collection");
			final HouseHoldInfoBO houseHoldInfoBO = new HouseHoldInfoBO();
			if(appPgmRqstCollection!=null)
			{
			pageCollection.put("APP_PGM_RQST_Collection", appPgmRqstCollection);
			}
			else
				pageCollection.put("APP_PGM_RQST_Collection", houseHoldInfoBO.loadAppPgmRqstColl(appNum));
			session.put(FwConstants.BEFORE_COLLECTION,
					txnBean.getPageCollection());

			log(ILog.INFO, "HousingExpenseEJBBean::loadProgramInformation:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadProgramInformation");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadProgramInformation");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadProgramInformation", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadProgramInformation");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadProgramInformation() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store program information.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeProgramInformation(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeProgramInformation() - START");
		try {

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			if(peopleHandler!=null) {
			peopleHandler.getRelevantIndividuals();
			}
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final APP_PGM_RQST_Collection appPgmRqstCollection = (APP_PGM_RQST_Collection) beforeColl
					.get("APP_PGM_RQST_Collection");
			pageCollection.put("APP_PGM_RQST_Collection", appPgmRqstCollection);
			session.put(FwConstants.BEFORE_COLLECTION,
					txnBean.getPageCollection());
			if(peopleHandler!=null) {
			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);
			}
			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARMAA",
					driverArray, appNum);

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeProgramInformation");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeProgramInformation");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeProgramInformation", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeProgramInformation");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeProgramInformation() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load people next details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadPeopleNextDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMovedInDetails() - START");

		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			APP_INDV_Collection rmcIndvColl;
			String pageMode = null;
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			if (appType != null
					&& !appType
					.equalsIgnoreCase(new String(rmcApplicationType))) {
			}

			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			APP_INDV_Collection appIndvColl = null;

			ReferenceTableManager.getInstance();
			final Map immiTypeMap = new HashMap();
			immiTypeMap.put(AppConstants.CITIZEN_INFO,
					AppConstants.CITIZEN_INFO);
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final Map peopleType = new HashMap<String, String>();
			peopleType
			.put(AppConstants.CITIZEN_INFO, AppConstants.CITIZEN_INFO);

			if (pageStatus == FwConstants.DRIVER_REQUIRED
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, peopleType)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			} else if (pageStatus == FwConstants.DRIVER_COMPLETE
					&& !currentPageID.equals(previousPageId)
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, peopleType)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final MovedInBO movedInBO = new MovedInBO();
			
			 IndivTypeSeqBean indivSeqBean = null;

			if(beforeColl!=null && beforeColl.containsKey(FwConstants.DETAIL_KEY_BEAN)){
				indivSeqBean = (IndivTypeSeqBean) beforeColl
						.get(FwConstants.DETAIL_KEY_BEAN);

			}
			
			int indvSeqNumber = 1;
			SortedSet citizenProfile = null;
			final short[] responseType = new short[] { IRMCResponseProfileManager.CITIZENSHIP_INFO };
			if (!previousPageId.equals(currentPageID)) {

				citizenProfile = createPageProfile(categorySelectionProfile,
						rmcInPrflColl, responseType);
				if (pageStatus != FwConstants.DRIVER_REQUIRED && pageStatus != FwConstants.DRIVER_ADD_NEW) {
					final APP_INDV_Collection rnIndvColl = movedInBO
							.getIndvDetails(appNumber,
									AppConstants.RMC_NEW_RECORD_IND);
					if (rnIndvColl != null && !rnIndvColl.isEmpty()) {
						APP_INDV_Cargo rnIndvCargo = null;
						final int newEmplCollSize = rnIndvColl.size();
						for (int i = 0; i < newEmplCollSize; i++) {
							rnIndvCargo = rnIndvColl.getCargo(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									citizenProfile, null, null,
									Short.parseShort(rnIndvCargo
											.getIndv_seq_num()), 0,
											AppConstants.CITIZEN_INFO);
						}
					}
				}

				if (pageStatus == FwConstants.DRIVER_REQUIRED
						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(citizenProfile);
				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE) {
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(citizenProfile);
				}
				session.remove(FwConstants.BEFORE_COLLECTION);

			} else {
				citizenProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			/*final IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) beforeColl
					.get(FwConstants.DETAIL_KEY_BEAN);*/
			if (indivSeqBean != null) {

				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								citizenProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Long.parseLong(indivSeqBean.getSeqNum()),
								AppConstants.CITIZEN_INFO);
				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(citizenProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO, Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							citizenProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Long.parseLong(indivSeqBean.getSeqNum()),
							AppConstants.CITIZEN_INFO);
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean.getSeqNum()),
											AppConstants.CITIZEN_INFO);
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != Short
								.parseShort(indivSeqBean.getUserEndInd())) {
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean
													.getSeqNum()), AppConstants.CITIZEN_INFO, Short
													.parseShort(indivSeqBean
															.getUserEndInd()));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
					}
				} else {
					if (FwConstants.ONE.equals(indivSeqBean.getSeqNum())) {

						RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
						if (rmcInPrflColl != null) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl,
											indivSeqBean.getIndivSeqNum());
						} else {
							rmcInPrflColl = new RMC_IN_PRFL_Collection();
						}
						if (rmcInPrflCargo == null) {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setApp_num(appNumber);
							rmcInPrflCargo.setIndv_seq_num(indivSeqBean
									.getIndivSeqNum());
							rmcResponseProfileManager
							.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflColl.addCargo(rmcInPrflCargo);
						}
						// now we need to make required the employment
						if (AppConstants.CITIZEN_INFO.equals(indivSeqBean
								.getType()) || AppConstants.PERSONAL_INFO.equals(indivSeqBean
										.getType())) {
							rmcResponseProfileManager
							.makeAddNew(
									IRMCResponseProfileManager.CITIZENSHIP_INFO,
									rmcInPrflCargo, true);
						}
						
						/*
						 * As per the Login/Logout fix the we persist this record with not null changeSelCatCode . 
						 * This record persisted in loadHouseHoldInfoMovedInDetails method , just setting the changeSelCatCode
						 * */
						categorySelectionProfileManager
						.insertSequenceDetail(citizenProfile, null,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL, Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										AppConstants.CITIZEN_INFO);
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(citizenProfile,
								null,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO, Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(citizenProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile, appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO, Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
					}
				}
			}

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					citizenProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(citizenProfile);

			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(citizenProfile);
			}

			categorySeqDetail.getCategoryType();
			Long.toString(categorySeqDetail.getCategorySequence());
			final String indvSeqNum = Short.toString(categorySeqDetail
					.getIndividualSequence());
			Short.toString(categorySeqDetail.getUserEndSelectionInd());

			appIndvColl = movedInBO.loadMovedInDetails(appNumber, indvSeqNum);

			APP_INDV_Cargo appIndvCargo = null;

			APP_INDV_Cargo cWIndvCargo = movedInBO.splitIndvColl(appIndvColl,
					AppConstants.CWW_RECORD_IND);
			final APP_INDV_Cargo rmIndvCargo = movedInBO.splitIndvColl(
					appIndvColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			final APP_INDV_Cargo rnIndvCargo = movedInBO.splitIndvColl(
					appIndvColl, AppConstants.RMC_NEW_RECORD_IND);

			boolean addBefColl = true;
			if (cWIndvCargo != null || rmIndvCargo != null) {
				pageMode = "show";

				if (rmIndvCargo != null) {
					pageCollection.put("FRS_APP_INDV", rmIndvCargo);
				} else {
					pageCollection.put("FRS_APP_INDV", cWIndvCargo);
				}
				pageCollection.put("SEC_APP_INDV", cWIndvCargo);
			} else {
				pageMode = "hide";

				if (rnIndvCargo != null) {
					pageCollection.put("FRS_APP_INDV", rnIndvCargo);
				} else {
					cWIndvCargo = new APP_INDV_Cargo();
					pageCollection.put("FRS_APP_INDV", cWIndvCargo);
					addBefColl = false;
				}
			}

			pageCollection.put("PAGE_MODE", pageMode);

			// building before collection for store method
			final APP_INDV_Collection befColl = new APP_INDV_Collection();
			if (rmIndvCargo != null) {
				befColl.addCargo(rmIndvCargo);
			} else if (rnIndvCargo != null) {
				befColl.addCargo(rnIndvCargo);
			}
			if (cWIndvCargo != null) {
				befColl.addCargo(cWIndvCargo);
			}
			if (addBefColl) {
				pageCollection.put("APP_INDV_Before_Collection", befColl);
			} else {
				beforeColl.remove("APP_INDV_Before_Collection");
			}

			// old code
			appIndvCargo = (APP_INDV_Cargo) pageCollection.get("FRS_APP_INDV");
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			peopleHandler.getIndividual(indvSeqNum).setBrth_dt(
					appIndvCargo.getBrth_dt());
			final INDIVIDUAL_Custom_Collection indivCustCol = peopleHandler
					.getInHomeIndividuals();
			boolean isFemOver18 = false;

			if ("0".equals(indvSeqNum)) {
				indvSeqNumber = rmcInPrflColl.size();
				rmcIndvColl = movedInBO.loadImmigrationDetails(appNumber,
						indvSeqNumber);
				pageCollection.put("APP_INDV_Collection", rmcIndvColl);
				pageCollection.put(AppConstants.FIRST_NAME, peopleHandler
						.getFirstName(String.valueOf(indvSeqNumber)));
				final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
						.getIndividual(String.valueOf(indvSeqNumber));
				final String dob = indvCargo.getBrth_dt();
				final int age = AgeUtil.calculateAge(dob.substring(0, 10));
				final String sexInd = indvCargo.getSex_ind();
				if (age > 18 && "F".equals(sexInd)) {
					isFemOver18 = true;
				}
				pageCollection.put("FEM_OVER_18", isFemOver18);
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						indvSeqNumber);
				beforeColl.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						indvSeqNumber);
			} else {
				categorySeqDetail.getCategoryType();
				Long.toString(categorySeqDetail.getCategorySequence());
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(indvSeqNum));
				rmcIndvColl = movedInBO.loadImmigrationDetails(appNumber,
						Integer.parseInt(indvSeqNum));
				pageCollection.put("APP_INDV_Collection", rmcIndvColl);
				final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
						.getIndividual(indvSeqNum);

				final String dob = indvCargo.getBrth_dt();
				final int age = AgeUtil.calculateAge(dob.substring(0, 10));
				final String sexInd = indvCargo.getSex_ind();
				if (age > 18 && "F".equals(sexInd)) {
					isFemOver18 = true;
				}
				pageCollection.put("FEM_OVER_18", isFemOver18);
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						indvSeqNum);
				beforeColl.put(AppConstants.INDV_SEQUENCE_NUMBERS, indvSeqNum);
			}

			rmcIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");
			isFemOver18 = (Boolean) pageCollection.get("FEM_OVER_18");

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					citizenProfile);
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
			componentManager.getComponents(currentPageID, txnBean);
			INDIVIDUAL_Custom_Collection indvCustColl = null;
			indvCustColl = peopleHandler.getSortedIndividualsByIndvSeqNum();
			pageCollection.put("INDIVIDUAL_Custom_Collection", indvCustColl);
			pageCollection.put("INDIVIDUAL_Collection", indivCustCol);
			pageCollection.put("FEM_OVER_18", isFemOver18);
			pageCollection.put("APP_INDV_Collection", rmcIndvColl);

			pageCollection.put("PAGE_MODE", pageMode);
			
			//WIC clinic details start
			ABRegistrationBO registrationBo = new ABRegistrationBO();
			pageCollection.put(AppConstants.WIC_CLINIC_INFO, registrationBo.loadWICClncInfo());
			if(rnIndvCargo != null ){
				pageCollection.put(AppConstants.WIC_CLNC_NAME, registrationBo.loadWICClncName(rnIndvCargo.getWic_clnc_cd()));
			}else{
				pageCollection.put(AppConstants.WIC_CLNC_NAME, registrationBo.loadWICClncName(cWIndvCargo.getWic_clnc_cd()));
			}
			
			//WIC clinic details end
			
			if (session.get(FwConstants.BEFORE_COLLECTION) != null) {

				((Map) session.get(FwConstants.BEFORE_COLLECTION))
				.putAll(pageCollection);

			} else {
				beforeColl.putAll(pageCollection);
				session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			}
			session.putAll(session);
			txnBean.setPageCollection(pageCollection);
			txnBean.setSession(session);

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadPeopleNextDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPeopleNextDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadPeopleNextDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPeopleNextDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadPeopleNextDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store people next details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storePeopleNextDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException { // store
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storePeopleNextDetails() - START");
		final Map session = txnBean.getSession();
		final Map pageCollection = txnBean.getPageCollection();
		final Map request = txnBean.getRequest();
		String currentPageID = null;
		String addnewPerson = FwConstants.EMPTY_STRING;
		boolean isFemOver18 = false;
		try {

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			currentPageID = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, currentPageID,
					driverArray);
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final Map beforePageColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final SortedSet citizenProfile = (SortedSet) beforePageColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			final String pageMode = (String) beforePageColl.get("PAGE_MODE");
			beforePageColl.get(AppConstants.FIRST_NAME);
			final RMC_IN_PRFL_Collection rmcInPrflCollSession = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final APP_INDV_Collection rmcIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");
			final APP_INDV_Collection indvPersistColl = new APP_INDV_Collection();
			APP_INDV_Cargo appIndvBeforeCargo = null;
			APP_INDV_Cargo rmcIndvCargo = rmcIndvColl.getCargo(0);
			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);
			addnewPerson = (String) beforePageColl
					.get("RMB_ADD_INDIVIDUAL_MODE");
			isFemOver18 = (Boolean) beforePageColl.get("FEM_OVER_18");
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			if (appType != null
					&& !appType
					.equalsIgnoreCase(new String(rmcApplicationType))) {
			}

			APP_INDV_Collection appIndvBeforeColl = null;
			if (beforePageColl != null) {
				appIndvBeforeColl = (APP_INDV_Collection) beforePageColl
						.get("APP_INDV_Before_Collection");
			}

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(citizenProfile);
			final String indvSeqNum = String.valueOf(categorySeqDetailBean
					.getIndividualSequence());
			final MovedInBO movedInBO = new MovedInBO();

			beforePageColl.get("APP_INDV_Collection");
			String recordInd = null;

			boolean citizenDtlsUpdate = false;
			boolean disabilityInd = false;

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			if (backToMyAccess != null) {
				if (checkBackToMyAccessSelected(request)) {
					request.get(FwConstants.WARNING_MSG_DETAILS);
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					return;
				}
			}

			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			final ARHMIValidator movedInValidator = new ARHMIValidator();
			HouseHoldInfoBO houseHoldInfoBO = new HouseHoldInfoBO();

			if (rmcIndvColl != null && !rmcIndvColl.isEmpty()) {
				rmcIndvCargo = rmcIndvColl.getCargo(0);
				rmcIndvCargo.setApp_num(appNumber);
				rmcIndvCargo.setIndv_seq_num(indvSeqNum);

				rmcIndvColl.getCargo(0).setIndv_seq_num(indvSeqNum);
				
				boolean maIndvFlag = houseHoldInfoBO.loadIndvMAProgFlag(appNumber, indvSeqNum);
				boolean fsIndvFlag = houseHoldInfoBO.loadIndvMAProgFlag(appNumber, indvSeqNum);
				boolean tanfIndvFlag = houseHoldInfoBO.loadIndvMAProgFlag(appNumber, indvSeqNum);
				if (backToMyAccess == null) {
					movedInValidator.validateImmigrationDetails(rmcIndvColl,
							programKey, peopleHandler,maIndvFlag,fsIndvFlag,tanfIndvFlag);
				}
			}

			if (checkBackToMyAccessSelected(request)
					|| movedInValidator.hasMessages()) {
				if (backToMyAccess == null) {

					request.put(FwConstants.MESSAGE_LIST,
							movedInValidator.getMessageList());

				}
				pageCollection.put("INDIVIDUAL_Collection",
						beforePageColl.get("INDIVIDUAL_Collection"));
				pageCollection.put("INDIVIDUAL_Custom_Collection",
						beforePageColl.get("INDIVIDUAL_Custom_Collection"));
				pageCollection.put("APP_INDV_Collection", rmcIndvColl);
				pageCollection.put(AppConstants.FIRST_NAME,
						beforePageColl.get(AppConstants.FIRST_NAME));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforePageColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection
				.put("PAGE_MODE", beforePageColl.get("PAGE_MODE"));
				pageCollection.put("FEM_OVER_18", isFemOver18);
				pageCollection.put("FRS_APP_INDV", rmcIndvCargo);
				pageCollection.put("RMB_ADD_INDIVIDUAL_MODE", addnewPerson);

				if (beforePageColl.containsKey("SEC_APP_INDV")) {
					pageCollection.put("SEC_APP_INDV",
							beforePageColl.get("SEC_APP_INDV"));
				}
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforePageColl.get(FwConstants.PAGE_COMPONENT_LIST));
				return;
			}

			APP_INDV_Cargo beforeCargo = new APP_INDV_Cargo();
			if (appIndvBeforeColl != null) {
				beforeCargo = appIndvBeforeColl.getCargo(0);
				if (beforeCargo.getApp_num() == null) {
					appIndvBeforeColl = null;
				}
			}

			// real data from page + copy others from before cargo
			if (appIndvBeforeColl != null) {
				appIndvBeforeCargo = appIndvBeforeColl.getCargo(0);
			}
			
			if (rmcIndvCargo != null && FwConstants.YES.equals(rmcIndvCargo.getDisabled_resp())) {
				
				if(appIndvBeforeCargo == null || !rmcIndvCargo.getDisabled_resp().equals(appIndvBeforeCargo.getDisabled_resp())){
					disabilityInd = true;
				}
			}

			// if not new record //this will also make isDirty true if there are
			// changes to be updated
			if (appIndvBeforeCargo != null) {
				rmcIndvCargo = updateCitWithPageCollection(appIndvBeforeCargo,
						rmcIndvCargo);
			}

			String sourceAppInd = null;
			if (pageMode != null) {
				if ("show".equals(pageMode)) {
					sourceAppInd = AppConstants.RMC_MODIFIED_RECORD_IND;
				} else {
					sourceAppInd = AppConstants.RMC_NEW_RECORD_IND;
				}
			}
			//update new wic clinic info
			houseHoldInfoBO.updateWICClncInfo(rmcIndvCargo,movedInBO.loadPeopleDetails(appNumber, indvSeqNum, AppConstants.CWW_RECORD_IND));

			// we always update existing record on this page either RM or RN
			recordInd = FwConstants.ROWACTION_INSERT;
			//PeopleInyour home2 logic has changed it's not always update
			APP_INDV_Collection existingCollection = movedInBO.loadPeopleDetails(appNumber, indvSeqNum, sourceAppInd);
			if(existingCollection!=null && !existingCollection.isEmpty()) {
			recordInd = FwConstants.ROWACTION_UPDATE;
			}
			rmcIndvCargo.setSrc_app_ind(sourceAppInd);
			rmcIndvCargo.setRowAction(recordInd);

			if (rmcIndvCargo.isDirty()) {
				citizenDtlsUpdate = true;
			}
			rmcIndvCargo.setRec_cplt_ind(movedInBO
					.completenessImmiCheck(rmcIndvCargo));
			indvPersistColl.addCargo(rmcIndvCargo);

			if (citizenDtlsUpdate) {
				movedInBO.storeCitizenshipDetails(indvPersistColl);
				peopleHandler.updateIndividual(rmcIndvCargo);
			}

			//reqInd is indicator to decide if we have complete the response profile or not
			boolean reqInd=false;
			
			// now i need to update the rmc_in_prfl
			RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
			short respTyp=rmcResponseProfileManager
					.getResponseByType(
							IRMCResponseProfileManager.CITIZENSHIP_INFO,
							categorySeqDetailBean
							.getCategoryType());

				rmcInPrflCargo = rmcResponseProfileManager.getProfile(
						rmcInPrflCollSession, String
						.valueOf(categorySeqDetailBean
								.getIndividualSequence()));
				if (rmcInPrflCargo != null && (rmcResponseProfileManager.getProfileResponse(
						rmcInPrflCargo, respTyp).charAt(0) == IRMCResponseProfileManager.STATUS_REQUIRED || rmcResponseProfileManager.getProfileResponse(
								rmcInPrflCargo, respTyp).charAt(0) == IRMCResponseProfileManager.STATUS_ADD_NEW)) {
					reqInd=true;
					rmcResponseProfileManager
					.makeComplete(
							rmcResponseProfileManager
							.getResponseByType(
									IRMCResponseProfileManager.CITIZENSHIP_INFO,
									categorySeqDetailBean
									.getCategoryType()),
									rmcInPrflCargo, true);
				}
			
			// Mark complete job sequence using common methods
			//if the profile response was not 'R' or if we came from gatepost then don't persist else persist
			if(!reqInd || categorySeqDetailBean.getChangeSelectionCategoryCd()==null)
			{
			categorySelectionProfileManager.makeSequenceDetailComplete(
					citizenProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			}else{
			categorySelectionProfileManager.makeSequenceDetailComplete(
						citizenProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(citizenProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(citizenProfile);
			}
			
			/** Start: citizenship declaration verification indicator*/
			APP_INDV_Collection indvCollection = (APP_INDV_Collection) beforePageColl
					.get("APP_INDV_Collection");
			APP_INDV_Cargo indvCargo=indvCollection.getCargo(0);
			if (indvCargo != null
					&& rmcIndvCargo.getUs_ctzn_sw() != null
					&& !rmcIndvCargo.getUs_ctzn_sw().equals(
							indvCargo.getUs_ctzn_sw())) {
				if (indvCollection != null && !indvCollection.isEmpty()) {
					int age = AgeUtil.calculateAge(rmcIndvCargo.getBrth_dt());
					if (age < 19 && programKey[0] == 1) {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARDOC", driverArray, appNumber);
					}
				}
			}
			/** END: citizenship declaration verification indicator*/
			RMC_IN_PRFL_Collection rmcInPrflSessionColl = null;
			if(disabilityInd){
				if(session.get(AppConstants.RMC_IN_PRFL_MASTER) != null){
					rmcInPrflSessionColl = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					RMC_IN_PRFL_Cargo newCargo;
					RMC_IN_PRFL_Collection newCollection = new RMC_IN_PRFL_Collection();
					for (int i = 0; i < rmcInPrflSessionColl.size(); i++) {
						newCargo = rmcInPrflSessionColl.getCargo(i);
						if (indvSeqNum.equals(newCargo.getIndv_seq_num())) {
							newCargo.setDabl_resp("R");
							newCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							newCollection.addCargo(newCargo);
							newCollection.persist(FwConstants.DAO);
							
						}
					}
				}
				
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHDD",
						driverArray, appNumber);
			}
            /*MAGI LOGIC STARTS*/
			
			final ABHouseholdMembersSummaryBO  aSummaryBO= new ABHouseholdMembersSummaryBO();
			Boolean medFlag = aSummaryBO.loadMedicaidProgram(appNumber);
			if(medFlag){
				final APP_INDV_Collection tempColl = aSummaryBO.loadHouseholdMembers(appNumber);
				int ageMagi = 0;
				boolean fullMedicaid = false;
				for (int j = 0; j < tempColl.size(); j++) {
					final APP_INDV_Cargo tempCargo = (APP_INDV_Cargo) tempColl
							.get(j);
					ageMagi = AgeUtil.calculateAge(tempCargo.getBrth_dt());
					if ((FwConstants.YES
									.equals(tempCargo.getDisabled_resp()) || (ageMagi >= 65))) {
						fullMedicaid = true;
						break;
					}
				}
				if(fullMedicaid){
					aSummaryBO.updateMagiProgram(appNumber);
					short[] pgmKey = (short[]) session.get(FwConstants.RMC_PROGRAM_KEY);
					pgmKey[FwConstants.MAGI_INDEX] = Short.valueOf(FwConstants.ONE);
					session.put(FwConstants.RMC_PROGRAM_KEY, pgmKey);
				}
			}
			
			
			
			/*MAGI LOGIC ENDS*/ 
			pageCollection.put("FEM_OVER_18", isFemOver18);
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					citizenProfile);
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
			pageCollection.put("APP_INDV_Collection", rmcIndvColl);
			pageCollection.put("RMB_ADD_INDIVIDUAL_MODE", addnewPerson);
			beforePageColl.put("RMB_ADD_INDIVIDUAL_MODE", addnewPerson);
			beforePageColl.put(AppConstants.INDV_SEQUENCE_NUMBERS, indvSeqNum);
			beforePageColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforePageColl);
			session.putAll(session);
			txnBean.setPageCollection(pageCollection);
			txnBean.setSession(session);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storePeopleNextDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePeopleNextDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storePeopleNextDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePeopleNextDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storePeopleNextDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load other health ins details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadOtherHealthInsDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadOtherHealthInsDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadOtherHealthInsDetails");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();

		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String seqNum = null;
		String pageMode = null;
		final APP_IN_OTHR_HLTH_INS_Cargo otherHealthInsuranceCargo = null;
		APP_IN_OTHR_HLTH_INS_Collection loadOthrHealthInsDetails = null;

		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final MedicareBO medicareBO = new MedicareBO();

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			categorySelectionProfile.toArray();

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.OTHR_HLTH_INS_INFORMATION,
					AppConstants.OTHR_HLTH_INS_INFORMATION);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber);
			} else if (currentPageStatus == FwConstants.DRIVER_COMPLETE
					&& !pageId.equals(previousPageId)
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.OTHR_HLTH_INS_INFORMATION);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			final short[] responseType = new short[] { IRMCResponseProfileManager.OTHR_HLTH_INS_RESP };
			SortedSet hlthInsDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.OTHR_HLTH_INS_INFORMATION;
			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) beforeColl
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (!pageId.equals(previousPageId)) {
				hlthInsDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
					final APP_IN_OTHR_HLTH_INS_Collection medColl = medicareBO
							.loadOthrHealthInsDetails(appNumber);
					final APP_IN_OTHR_HLTH_INS_Collection newmedColl = medicareBO
							.splitOthrHlthInsColl(medColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newmedColl != null && !newmedColl.isEmpty()) {
						APP_IN_OTHR_HLTH_INS_Cargo appInMedCargo = null;
						final int newMedCollSize = newmedColl.size();
						rnRecordFound = true;

						for (int i = 0; i < newMedCollSize; i++) {
							appInMedCargo = newmedColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									hlthInsDetailsProfile, null, null,
									Short.parseShort(appInMedCargo
											.getIndv_seq_num()),
											Short.parseShort(appInMedCargo
													.getSeq_num()), categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(hlthInsDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(hlthInsDetailsProfile);
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				
				hlthInsDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}
			
			
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("Othr_Hlth_Ins_IndSeqBean");
			} else if (indivSeqBean == null
					&& HEALTH_INSURANCE_SCREEN_ID.equals(previousPageId)) {

				/*
				 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
				 * javadoc
				 */
				/**
				 * // loadOthrHealthInsDetails =
				 * medicareBO.loadOthrHealthInsDetails(appNumber); // //Look for
				 * the 1st record that is not completed as they are sorted //
				 * for (Object otherHealthInsuranceObject :
				 * loadOthrHealthInsDetails) { // otherHealthInsuranceCargo =
				 * (APP_IN_OTHR_HLTH_INS_Cargo) otherHealthInsuranceObject; //
				 * if(otherHealthInsuranceCargo.getRec_cplt_ind() == null){ //
				 * indivSeqBean = new
				 * IndivTypeSeqBean(otherHealthInsuranceCargo.
				 * getIndv_seq_num(),AppConstants
				 * .ADD_OTHR_HEALTH_INS,otherHealthInsuranceCargo.getSeq_num());
				 * // loadOthrHealthInsDetails = new
				 * APP_IN_OTHR_HLTH_INS_Collection(); //
				 * loadOthrHealthInsDetails.add(otherHealthInsuranceCargo); //
				 * break; // } // // // }
				 *
				 */
			}

			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								hlthInsDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.OTHR_HLTH_INS_INFORMATION);

				if (categorySeqDetail1 != null) {
					  if (categorySeqDetail1.getUserEndSelectionInd() != Short
	                            .parseShort(indivSeqBean.getUserEndInd())) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.updateUserEndSelInd(hlthInsDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.OTHR_HLTH_INS_INFORMATION,
												Short.parseShort(userEndIndicator));
					}

					categorySelectionProfileManager.makeSequenceDetailRequired(
							hlthInsDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.OTHR_HLTH_INS_INFORMATION);

					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.OTHR_HLTH_INS_INFORMATION);

					if (categorySeqDetail2 != null) {
						  if (categorySeqDetail2.getUserEndSelectionInd() != Short
		                            .parseShort(indivSeqBean.getUserEndInd())) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}

							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber,
									Short.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.OTHR_HLTH_INS_INFORMATION,
													Short.parseShort(userEndIndicator));
						}

						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.OTHR_HLTH_INS_INFORMATION);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.OTHR_HLTH_INS_INFORMATION
								.equals(indivSeqBean.getType())) {
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}

							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}

							rmcResponseProfileManager
							.makeAddNew(
									IRMCResponseProfileManager.OTHR_HLTH_INS_RESP,
									rmcInPrflCargo, true);

							CategorySequenceDetail catseqDet = null;
							if (!hlthInsDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												hlthInsDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.OTHR_HLTH_INS_INFORMATION);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										hlthInsDetailsProfile,
										null,
										null,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.OTHR_HLTH_INS_INFORMATION);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean sErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;
									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.OTHR_HLTH_INS_INFORMATION
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												sErowExists = true;
												break;
											}
										}

									}
								}

								if (sErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.OTHR_HLTH_INS_INFORMATION);
								}

								categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.OTHR_HLTH_INS_INFORMATION);
								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.OTHR_HLTH_INS_INFORMATION);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.OTHR_HLTH_INS_INFORMATION };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!hlthInsDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													hlthInsDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.OTHR_HLTH_INS_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											hlthInsDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.OTHR_HLTH_INS_INFORMATION);
									hlthInsDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									hlthInsDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!hlthInsDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													hlthInsDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.OTHR_HLTH_INS_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											hlthInsDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.OTHR_HLTH_INS_INFORMATION);
									categorySelectionProfileManager
									.insertSequenceDetail(
											hlthInsDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.OTHR_HLTH_INS_INFORMATION);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											hlthInsDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.OTHR_HLTH_INS_INFORMATION);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								hlthInsDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.OTHR_HLTH_INS_INFORMATION, Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								hlthInsDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),AppConstants.OTHR_HLTH_INS_INFORMATION);

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.OTHR_HLTH_INS_INFORMATION, Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.OTHR_HLTH_INS_INFORMATION);
					}
				}

				session.put("Othr_Hlth_Ins_IndSeqBean", indivSeqBean);
			} else if (otherHealthInsuranceCargo != null) {
				// hlthInsDetailsProfile
			}
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					hlthInsDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(hlthInsDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(hlthInsDetailsProfile);
			}

			categorySeqDetail.getCategoryType();
			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());
			seqNum = Long.toString(categorySeqDetail.getCategorySequence());

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			if (loadOthrHealthInsDetails == null) {
				loadOthrHealthInsDetails = medicareBO.loadOthrHlthInsDetails(
						appNumber, indvSeqNumber, seqNum);
			}

			pageCollection.put(APP_IN_OTHR_HLTH_INS_COLLECTION_KEY,
					loadOthrHealthInsDetails);

			APP_IN_OTHR_HLTH_INS_Cargo cwwInMedCargo = medicareBO
					.splitOthrHlthInssColl(loadOthrHealthInsDetails,
							AppConstants.CWW_RECORD_IND);

			if (cwwInMedCargo == null) {
				cwwInMedCargo = new APP_IN_OTHR_HLTH_INS_Cargo();
			}

			pageCollection.put("SEC_MEDCR",
					medicareBO.settingDefaultValuesOthrHlthIns(cwwInMedCargo));

			APP_IN_OTHR_HLTH_INS_Cargo rmcInMedCargo = medicareBO
					.splitOthrHlthInssColl(loadOthrHealthInsDetails,
							AppConstants.RMC_MODIFIED_RECORD_IND);
			if (rmcInMedCargo != null) {
				pageCollection.put("FST_MEDCR", medicareBO
						.settingDefaultValuesOthrHlthIns(rmcInMedCargo));

			} else {
				rmcInMedCargo = medicareBO.splitOthrHlthInssColl(
						loadOthrHealthInsDetails,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcInMedCargo != null) {
					pageCollection.put("FST_MEDCR", medicareBO
							.settingDefaultValuesOthrHlthIns(rmcInMedCargo));
				} else {

					rmcInMedCargo = medicareBO.splitOthrHlthInssColl(
							loadOthrHealthInsDetails,
							AppConstants.RMC_NEW_RECORD_IND);
					if (rmcInMedCargo != null) {
						pageCollection
						.put("FST_MEDCR",
								medicareBO
								.settingDefaultValuesOthrHlthIns(rmcInMedCargo));
					} else {
						pageCollection
						.put("FST_MEDCR",
								medicareBO
								.settingDefaultValuesOthrHlthIns(cwwInMedCargo));

					}
				}

			}

			String srcAppInd = FwConstants.EMPTY_STRING;
			APP_IN_HLTH_INS_BNFTS_Collection lodaHealthInsDetails=medicareBO.loadHlthInsDetails(appNumber,indvSeqNumber,seqNum);
			
			if (lodaHealthInsDetails != null
					&& !lodaHealthInsDetails.isEmpty()) {
				final APP_IN_HLTH_INS_BNFTS_Cargo appInMedCargo = lodaHealthInsDetails
						.getResult(0);
				srcAppInd = appInMedCargo.getSrc_app_ind();
			}
			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}
			else if (!("C".equals(pageMode) || "E".equals(pageMode))) {
				pageMode = FwConstants.NO;
			}

			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadOtherHealthInsDetails");
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadOtherHealthInsDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadOtherHealthInsDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadOtherHealthInsDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadOtherHealthInsDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadOtherHealthInsDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store other health ins details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeOtherHealthInsDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeOtherHealthInsDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeHealthInsDetails");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;

		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateInfo = null;
		final APP_IN_OTHR_HLTH_INS_Cargo appInMedBeforeCargo = null;

		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);


			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection

			final SortedSet inMedProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final APP_IN_OTHR_HLTH_INS_Collection appInMedCollection = (APP_IN_OTHR_HLTH_INS_Collection) pageCollection
					.get(APP_IN_OTHR_HLTH_INS_COLLECTION_KEY);
			APP_IN_OTHR_HLTH_INS_Cargo appInMedicareCargo = appInMedCollection
					.getResult(0);

			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inMedProfile);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();

			final MedicareBO medicareBO = new MedicareBO();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			validateInfo = medicareBO.validateOtherHealthDetails(
					appInMedCollection, appInMedicareCargo,
					(String) beforeColl.get("PAGE_MODE"));

			if (checkBackToMyAccessSelected(request)
					|| validateInfo.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							medicareBO.getMessageList());
				}
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put(APP_IN_OTHR_HLTH_INS_COLLECTION_KEY,
						appInMedCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection.put("PEOPLE_362", beforeColl.get("PEOPLE_362"));

				if (beforeColl.containsKey("SEC_MEDCR")) {
					pageCollection
					.put("SEC_MEDCR", beforeColl.get("SEC_MEDCR"));
				}
				pageCollection.put("FST_MEDCR", appInMedicareCargo);
				return;

			}

			appInMedicareCargo.setApp_num(appNumber);
			appInMedicareCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			final APP_IN_OTHR_HLTH_INS_Collection beforeAppInMedColl = (APP_IN_OTHR_HLTH_INS_Collection) beforeColl
					.get(APP_IN_OTHR_HLTH_INS_COLLECTION_KEY);
			APP_IN_HLTH_INS_BNFTS_Collection beforeAppInHLTHColl = (APP_IN_HLTH_INS_BNFTS_Collection) beforeColl
					.get(APP_IN_HLTH_INS_BNFTS_COLLECTION_KEY);
			APP_IN_OTHR_HLTH_INS_Cargo beforeInMedCargo = null;

			String sourceAppIndicator = null;
			String recordInd = null;

			boolean inMedicareDetailsUpdate = false;

			if (beforeAppInMedColl != null && !beforeAppInMedColl.isEmpty()) {
				final int size = beforeAppInMedColl.size();

				if (size > 1) {
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInMedCargo = medicareBO.splitOthrHlthInssColl(
							beforeAppInMedColl, sourceAppIndicator);
				} else {
					// now we are checking this record is CW or RN
					// If it's not RN it will be fetched as beforeRecord
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
					beforeInMedCargo = medicareBO.splitOthrHlthInssColl(
							beforeAppInMedColl, sourceAppIndicator, true);
					if (beforeInMedCargo != null) {

						if (userEndInd == 1) {
							sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;

						} else if (beforeInMedCargo.getSrc_app_ind() != null
								&& !AppConstants.RMC_NEW_RECORD_IND
								.equals(beforeInMedCargo
										.getSrc_app_ind())) {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						} else {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						}
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInMedCargo = medicareBO.splitOthrHlthInssColl(
								beforeAppInMedColl, sourceAppIndicator);
					}
				}

				// check dirty
				appInMedicareCargo = (APP_IN_OTHR_HLTH_INS_Cargo) isChanged(
						beforeInMedCargo, appInMedicareCargo);
				appInMedicareCargo.setEcp_id(beforeInMedCargo.getEcp_id());
				appInMedicareCargo.setSrc_app_ind(sourceAppIndicator);
				appInMedicareCargo.setRowAction(recordInd);

				if (appInMedicareCargo.isDirty()) {
					appInMedicareCargo.setHlth_ins_seq_number(beforeInMedCargo
							.getHlth_ins_seq_number());
					appInMedicareCargo
					.setSeq_num(beforeInMedCargo.getSeq_num());
					appInMedicareCargo.setRec_cplt_ind(FwConstants.ONE);

					inMedicareDetailsUpdate = true;
				}
			} else {
				int seqNum=0;
				if(null == beforeAppInHLTHColl)
				{
					seqNum = medicareBO.getMaxOthrHlthInsSeqNumber(appNumber,
	                        String.valueOf(indvSeqNum))+1;
					beforeAppInHLTHColl= new APP_IN_HLTH_INS_BNFTS_Collection();
					beforeAppInHLTHColl=medicareBO.loadHlthInsDetails(appNumber, String.valueOf(indvSeqNum), String.valueOf(seqNum));
				}
				// if there is no before collection means this is new record
				if(AppConstants.RMC_NEW_RECORD_IND.equals(beforeAppInHLTHColl.getCargo().getSrc_app_ind())){
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				}else{
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
				}
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				appInMedicareCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;
				
				appInMedicareCargo.setRowAction(recordInd);
				appInMedicareCargo.setRec_cplt_ind(FwConstants.ONE);
				if(0==seqNum)
				{
				seqNum = medicareBO.getMaxOthrHlthInsSeqNumber(appNumber,
	                        String.valueOf(indvSeqNum))+1;
				}
                appInMedicareCargo.setSeq_num(String.valueOf(seqNum));

				appInMedicareCargo.setHlth_ins_seq_number(beforeAppInHLTHColl.getCargo().getSeq_num());
				inMedicareDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inMedProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						seqNum, categorySeqDetailBean.getCategoryType());
				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						seqNum, categorySeqDetailBean.getCategoryType());

			}
			// now we need to check the flags
			if (inMedicareDetailsUpdate) {
				 if (FwConstants.ROWACTION_INSERT.equals(appInMedicareCargo
	                        .getRowAction())) {
					 if(null==appInMedicareCargo.getHlth_ins_seq_number()){
						 appInMedicareCargo.setHlth_ins_seq_number(String.valueOf(medicareBO.getMaxOthrHlthInsuranceSeqNumber(appNumber,
			                        String.valueOf(indvSeqNum))+1));
					 }
					 medicareBO.insertExistingDetails(appInMedCollection);
	                } else {
	                	medicareBO.storeOthrHlthInsDetails(appInMedCollection);
	                }
			}

			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.OTHR_HLTH_INS_RESP,
							rmcInPrflCargo, true);
				}
			}
			
			
			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inMedProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			boolean loopingQuestion = false;
			int othrMaxNum = medicareBO.getMaxOthrHlthInsSeqNumber(appNumber, String.valueOf(indvSeqNum));
			int healthMaxNum = medicareBO.getMaxHlthInsSeqNumber(appNumber, String.valueOf(indvSeqNum));
			
			if (othrMaxNum<healthMaxNum) {
				loopingQuestion = true;

				categorySelectionProfileManager.insertSequenceDetail(
						inMedProfile, null, null,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategoryType());
				driverManager.makeRequired(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
				// Make required the RMB Asset Summary page
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						ADDITIONAL_INFORMATION_SUMMARY_PAGE_ID, driverArray,
						appNumber);

			}

			if (!loopingQuestion
					&& categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager
					.makeComplete(
							rmcResponseProfileManager
							.getResponseByType(
									IRMCResponseProfileManager.HEALTHCARE_COVERAGE,
									categorySeqDetailBean
									.getCategoryType()),
									rmcInPrflCargo, true);
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.HLTH_INS_RESP,
							rmcInPrflCargo, true);
				}
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(inMedProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inMedProfile);
			}
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeOtherHealthInsDetails");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeOtherHealthInsDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeOtherHealthInsDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeOtherHealthInsDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeOtherHealthInsDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeOtherHealthInsDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load health ins details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException
	 */
	public void loadHealthInsDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.loadHealthInsDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadHealthInsDetails");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();

		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String seqNum = null;
		String pageMode = null;

		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final MedicareBO medicareBO = new MedicareBO();
			final HealthCareCoverageBO healthCvrgBO = new HealthCareCoverageBO();

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			categorySelectionProfile.toArray();

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.HEALTHINS_INFORMATION,
					AppConstants.HEALTHINS_INFORMATION);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.HLTH_INS_RESP };
			SortedSet hlthInsDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.HEALTHINS_INFORMATION;

			if (!pageId.equals(previousPageId)) {
				hlthInsDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
					final APP_IN_HLTH_INS_BNFTS_Collection medColl = medicareBO
							.loadHlthInsDetails(appNumber);
					final APP_IN_HLTH_INS_BNFTS_Collection newmedColl = medicareBO
							.splitHlthInsColl(medColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newmedColl != null && !newmedColl.isEmpty()) {
						APP_IN_HLTH_INS_BNFTS_Cargo appInMedCargo = null;
						final int newMedCollSize = newmedColl.size();
						rnRecordFound = true;

						for (int i = 0; i < newMedCollSize; i++) {
							appInMedCargo = newmedColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									hlthInsDetailsProfile, null, null,
									Short.parseShort(appInMedCargo
											.getIndv_seq_num()),
											Short.parseShort(appInMedCargo
													.getSeq_num()), categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(hlthInsDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(hlthInsDetailsProfile);
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				hlthInsDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("HlthIns_IndSeqBean");
			}

			if (indivSeqBean != null  && (indivSeqBean.getType().equals(AppConstants.HEALTHINS_INFORMATION) || indivSeqBean.getType().equals(AppConstants.ADD_HEALTHNIS))) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								hlthInsDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.HEALTHINS_INFORMATION);

				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.updateUserEndSelInd(hlthInsDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.HEALTHINS_INFORMATION,
												Short.parseShort(userEndIndicator));
					}

					categorySelectionProfileManager.makeSequenceDetailRequired(
							hlthInsDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.HEALTHINS_INFORMATION);

					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.HEALTHINS_INFORMATION);

					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}

							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.HEALTHINS_INFORMATION,
													Short.parseShort(userEndIndicator));
						}

						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.HEALTHINS_INFORMATION);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
							if (null == beforeColl) {
								beforeColl = (Map) session
										.get(FwConstants.BEFORE_COLLECTION);
							}
							if (null == beforeColl) {
								beforeColl = new HashMap();
							}
							beforeColl.put("ADD_HLTH_INS_BNFTS",
									FwConstants.YES);
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}

							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}

							rmcResponseProfileManager.makeAddNew(
									IRMCResponseProfileManager.HLTH_INS_RESP,
									rmcInPrflCargo, true);

							CategorySequenceDetail catseqDet = null;
							if (!hlthInsDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												hlthInsDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.HEALTHINS_INFORMATION);
							}

							if (catseqDet == null) {
								Boolean flag = healthCvrgBO.getRmcChgSelPrfl(appNumber, indvSeqNumber,FwConstants.ZERO, AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL, AppConstants.HEALTHINS_INFORMATION);
								if(flag){
								categorySelectionProfileManager
								.insertSequenceDetail(
										hlthInsDetailsProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.HEALTHINS_INFORMATION);
								}
								
							}
						}else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								hlthInsDetailsProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								hlthInsDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}

				session.put("HlthIns_IndSeqBean", indivSeqBean);
			}
			if (null != indivSeqBean
					&& StringUtils.isNotEmpty(indivSeqBean.getType())
					&& AppConstants.ADD_HEALTHNIS
					.equals(indivSeqBean.getType())) {
				if (null == beforeColl) {
					beforeColl = (Map) session
							.get(FwConstants.BEFORE_COLLECTION);
				}
				if (null == beforeColl) {
					beforeColl = new HashMap();
				}
				beforeColl.put("ADD_HLTH_INS_BNFTS", FwConstants.YES);
			}

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					hlthInsDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(hlthInsDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(hlthInsDetailsProfile);
			}
			
			char typeStatus = 'N';
			String showLoopingQuestionFlag = FwConstants.YES;
			APP_IN_HLTH_INS_BNFTS_Collection appInMedColl =new APP_IN_HLTH_INS_BNFTS_Collection();
			if(categorySeqDetail!=null) {
			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());
			seqNum = Long.toString(categorySeqDetail.getCategorySequence());
			typeStatus = categorySeqDetail.getStatus();
			appInMedColl = medicareBO
					.loadHlthInsDetails(appNumber, indvSeqNumber, seqNum);
			}
			
			


			pageCollection
			.put("APP_IN_HLTH_INS_BNFTS_Collection", appInMedColl);
			
			if (typeStatus == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
					|| typeStatus == IRMCResponseProfileManager.STATUS_COMPLETE||!appInMedColl.isEmpty()) {
				showLoopingQuestionFlag = FwConstants.NO;

			}
			pageCollection.put("showLoopingQuestion", showLoopingQuestionFlag);
			APP_IN_HLTH_INS_BNFTS_Cargo cwwInMedCargo = medicareBO
					.splitHlthInssColl(appInMedColl,
							AppConstants.CWW_RECORD_IND);

			if (cwwInMedCargo == null) {
				cwwInMedCargo = new APP_IN_HLTH_INS_BNFTS_Cargo();
			}

			pageCollection.put("SEC_MEDCR",
					medicareBO.settingDefaultValuesHlthIns(cwwInMedCargo));

			APP_IN_HLTH_INS_BNFTS_Cargo rmcInMedCargo = medicareBO
					.splitHlthInssColl(appInMedColl,
							AppConstants.RMC_MODIFIED_RECORD_IND);
			if (rmcInMedCargo != null) {
				pageCollection.put("FST_MEDCR",
						medicareBO.settingDefaultValuesHlthIns(rmcInMedCargo));

			} else {
				rmcInMedCargo = medicareBO.splitHlthInssColl(appInMedColl,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcInMedCargo != null) {
					pageCollection.put("FST_MEDCR", medicareBO
							.settingDefaultValuesHlthIns(rmcInMedCargo));
				} else {

					rmcInMedCargo = medicareBO.splitHlthInssColl(appInMedColl,
							AppConstants.RMC_NEW_RECORD_IND);
					if (rmcInMedCargo != null) {
						pageCollection.put("FST_MEDCR", medicareBO
								.settingDefaultValuesHlthIns(rmcInMedCargo));
					} else {
						pageCollection.put("FST_MEDCR", medicareBO
								.settingDefaultValuesHlthIns(cwwInMedCargo));

					}
				}

			}
			if (null != indivSeqBean
					&& StringUtils.isNotEmpty(indivSeqBean.getType())
					&& AppConstants.ADD_HEALTHNIS
					.equals(indivSeqBean.getType())) {
				pageCollection.put("FST_MEDCR",
						medicareBO.settingDefaultValuesHlthIns(cwwInMedCargo));
			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (appInMedColl != null && !appInMedColl.isEmpty()) {
				final APP_IN_HLTH_INS_BNFTS_Cargo appInMedCargo = appInMedColl
						.getResult(0);
				srcAppInd = appInMedCargo.getSrc_app_ind();
			}
			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail!=null && categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3,3 lines Commented Code in
			 * this block
			 */
			if (categorySeqDetail!=null && categorySeqDetail.getUserEndSelectionInd() == 1) {
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd())) {
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equals(pageMode) || "E".equals(pageMode))) {
				pageMode = FwConstants.NO;
			}

			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);
			createAndLoadARHINResponseMapsToPageCollection(rmcInPrflColl,
					pageCollection, peopleHandler, true, currentPageStatus,
					indvSeqNumber);

			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);

			final Map<String, String> coverageMap = new HashMap<String, String>();
			if (appInMedColl != null && !appInMedColl.isEmpty()) {
				final APP_IN_HLTH_INS_BNFTS_Cargo appInMedCargo = appInMedColl
						.getResult(0);
				srcAppInd = appInMedCargo.getSrc_app_ind();
				if (appInMedCargo.getSeq_num() != null) {
					final CP_APP_IN_MED_INS_CVRG_Collection coverageCollection = healthCvrgBO
							.loadHealthCarePolicyCoverageIndv((String) session
									.get(AppConstants.APP_NUMBER),
									appInMedCargo.getIndv_seq_num(),
									appInMedCargo.getSeq_num());

					final INDIVIDUAL_Custom_Collection householdIndivs = peopleHandler
							.sortIndividuals(peopleHandler
									.getInHomeIndividuals());
					if (householdIndivs != null && !householdIndivs.isEmpty()) {
						for (int i = 0; i < householdIndivs.size(); i++) {
							final INDIVIDUAL_Custom_Cargo custCargo = householdIndivs
									.getResult(i);
							coverageMap.put(custCargo.getIndv_seq_num(),
									FwConstants.SPACE);
							if (coverageCollection != null
									&& !coverageCollection.isEmpty()) {
								for (int j = 0; j < coverageCollection.size(); j++) {
									final CP_APP_IN_MED_INS_CVRG_Cargo cvrgCargo = coverageCollection
											.getCargo(j);
									if (!"RE"
											.equals(cvrgCargo.getSrc_app_ind())
											&& custCargo
											.getIndv_seq_num()
											.equals(cvrgCargo
													.getCovered_indv_seq_num())) {
										if (cvrgCargo.getSrc_app_ind() != null
												&& AppConstants.CWW_RECORD_IND
												.equals(cvrgCargo
														.getSrc_app_ind())) {
											final CP_APP_IN_MED_INS_CVRG_Collection rECargos = healthCvrgBO
													.splitMedCvrgCargo(
															coverageCollection,
															AppConstants.RMC_END_RECORD_IND);
											final CP_APP_IN_MED_INS_CVRG_Cargo matchingCargo = healthCvrgBO
													.getMatchingCargo(rECargos,
															cvrgCargo, true);
											if (matchingCargo != null) {
												continue;
											}
										}
										coverageMap.remove(cvrgCargo
												.getCovered_indv_seq_num());
										coverageMap.put(
												custCargo.getIndv_seq_num(),
												"R");
									}
								}
								pageCollection.put(COVERAGE_COLLECTION_KEY,
										coverageCollection);
							}
						}
						pageCollection.put(
								RESP_MAP_HOUSEHOLD_INDIV_COVERED_KEY,
								coverageMap);
					}

				}
			}
			pageCollection.put(RESP_MAP_HOUSEHOLD_INDIV_COVERED_KEY,
					coverageMap);

			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadHealthInsDetails");
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHealthInsDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHealthInsDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHealthInsDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHealthInsDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHealthInsDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store health ins details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHealthInsDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHealthInsDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeHealthInsDetails");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;

		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateInfo = null;
		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);


			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection

			final SortedSet inMedProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final APP_IN_HLTH_INS_BNFTS_Collection appInMedCollection = (APP_IN_HLTH_INS_BNFTS_Collection) pageCollection
					.get("APP_IN_HLTH_INS_BNFTS_Collection");
			APP_IN_HLTH_INS_BNFTS_Cargo healthInsuranceCargo = appInMedCollection
					.getResult(0);

			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inMedProfile);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();

			final MedicareBO medicareBO = new MedicareBO();
			final HealthCareCoverageBO healthCareBO = new HealthCareCoverageBO();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			final char status = categorySeqDetailBean.getStatus();
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code in
			 * this block
			 */

			final CP_APP_IN_MED_INS_CVRG_Collection coverageBeforeCollection = (CP_APP_IN_MED_INS_CVRG_Collection) beforeColl
					.get(COVERAGE_COLLECTION_KEY);
			final CP_APP_IN_MED_INS_CVRG_Collection coverageCollection = (CP_APP_IN_MED_INS_CVRG_Collection) pageCollection
					.get(COVERAGE_COLLECTION_KEY);
			String outsideflag=null;
			final String showLoopingQuestion = (String) beforeColl
					.get("showLoopingQuestion");
			healthInsuranceCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
			if (userEndInd == 1) {
				validateInfo = medicareBO
						.validateRemoveHealthDetails(healthInsuranceCargo);
			} else {
				validateInfo = medicareBO.validateHealthDetails(
						appInMedCollection, healthInsuranceCargo,
						(String) beforeColl.get("PAGE_MODE"),
						showLoopingQuestion, coverageCollection);
			}

			if (checkBackToMyAccessSelected(request)
					|| validateInfo.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							medicareBO.getMessageList());
				}
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("APP_IN_HLTH_INS_BNFTS_Collection",
						appInMedCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection.put(PEOPLE_HOUSEHOLD_INDIV_COVERED_KEY,
						beforeColl.get(PEOPLE_HOUSEHOLD_INDIV_COVERED_KEY));
				pageCollection.put(COVERAGE_COLLECTION_KEY,
						coverageBeforeCollection);
				pageCollection.put(RESP_MAP_HOUSEHOLD_INDIV_COVERED_KEY,
						beforeColl.get(RESP_MAP_HOUSEHOLD_INDIV_COVERED_KEY));
				if (beforeColl.containsKey("SEC_MEDCR")) {
					pageCollection
					.put("SEC_MEDCR", beforeColl.get("SEC_MEDCR"));
				}
				pageCollection.put("FST_MEDCR", healthInsuranceCargo);

				if (request.get("loopingQuestion") != null) {
					request.put("loopingQuestion",
							request.get("loopingQuestion"));
				}
				pageCollection.put("showLoopingQuestion",
						beforeColl.get("showLoopingQuestion"));

				return;

			}

			healthInsuranceCargo.setApp_num(appNumber);
			healthInsuranceCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
			healthInsuranceCargo.setSeq_num(healthInsuranceCargo.getSeq_num());

			final APP_IN_HLTH_INS_BNFTS_Collection beforeAppInMedColl = (APP_IN_HLTH_INS_BNFTS_Collection) beforeColl
					.get("APP_IN_HLTH_INS_BNFTS_Collection");
			APP_IN_HLTH_INS_BNFTS_Cargo beforeInMedCargo = null;

			if (beforeAppInMedColl != null && !beforeAppInMedColl.isEmpty()
					&& healthInsuranceCargo.getSeq_num() == null) {
				healthInsuranceCargo.setSeq_num(beforeAppInMedColl.getResult(0)
						.getSeq_num());
			}

			String sourceAppIndicator = null;
			String recordInd = null;
			String ecpId = null;
			String addRecordIndicator = FwConstants.EMPTY_STRING;
			boolean inMedicareDetailsUpdate = false;

			if (beforeAppInMedColl != null && !beforeAppInMedColl.isEmpty()) {
				final int size = beforeAppInMedColl.size();

				if (size > 1) {
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInMedCargo = medicareBO.splitHlthInssColl(
							beforeAppInMedColl, sourceAppIndicator);
					if (beforeInMedCargo == null) {
						sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInMedCargo = medicareBO.splitHlthInssColl(
								beforeAppInMedColl, sourceAppIndicator);
					}
				} else {
					// now we are checking this record is CW or RN
					// It returns null if it equals RMC_NEW_RECORD_IND
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
					beforeInMedCargo = medicareBO.splitHlthInssColl(
							beforeAppInMedColl, sourceAppIndicator, true);
					if (beforeInMedCargo != null) {

						if (userEndInd == 1) {
							sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
							healthInsuranceCargo
							.setHlth_cvrg_type(beforeInMedCargo
									.getHlth_cvrg_type());

						} else if (beforeInMedCargo.getSrc_app_ind() != null
								&& !AppConstants.RMC_NEW_RECORD_IND
								.equals(beforeInMedCargo
										.getSrc_app_ind())) {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						} else {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						}

						ecpId = beforeInMedCargo.getEcp_id();

					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInMedCargo = medicareBO.splitHlthInssColl(
								beforeAppInMedColl, sourceAppIndicator);
					}
				}

				// check dirty
				healthInsuranceCargo = (APP_IN_HLTH_INS_BNFTS_Cargo) isChanged(
						beforeInMedCargo, healthInsuranceCargo);

				healthInsuranceCargo.setSrc_app_ind(sourceAppIndicator);
				healthInsuranceCargo.setRowAction(recordInd);
				healthInsuranceCargo.setEcp_id(ecpId);

				if (healthInsuranceCargo.isDirty()) {
					inMedicareDetailsUpdate = true;
				}
			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				healthInsuranceCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				healthInsuranceCargo.setRowAction(recordInd);

				final int nextSequenceNo = medicareBO.getMaxHlthInsSeqNumber(
						appNumber, String.valueOf(indvSeqNum)) + 1;

				inMedicareDetailsUpdate = true;
				addRecordIndicator = FwConstants.YES;
				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inMedProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) nextSequenceNo,
						categorySeqDetailBean.getCategoryType());
				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());
				if(null!=categorySeqDetailBean.getChangeSelectionCategoryCd()) {
					categorySelectionProfileManager.persistSequence(appNumber, categorySeqDetailBean.getChangeSelectionCategoryCd(), String.valueOf(categorySeqDetailBean.getIndividualSequence()), String.valueOf((short) nextSequenceNo), categorySeqDetailBean.getCategoryType(), "0");
				}

			}
			
			if (null != beforeColl.get("ADD_HLTH_INS_BNFTS")) {
				addRecordIndicator = (String) beforeColl
						.get("ADD_HLTH_INS_BNFTS");
			}
			if (StringUtils.isNotEmpty(addRecordIndicator)
					&& FwConstants.YES.equalsIgnoreCase(addRecordIndicator)) {
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				healthInsuranceCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;
				healthInsuranceCargo.setRowAction(recordInd);
				inMedicareDetailsUpdate = true;
			}
			// now we need to check the flags
			if (inMedicareDetailsUpdate) {
				medicareBO.storeHlthInsDetails(appInMedCollection);

			}

			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.HLTH_INS_RESP,
							rmcInPrflCargo, true);
				}
			}

			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inMedProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(inMedProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inMedProfile);
			}

			final ABHouseholdMembersSummaryBO hmSummarybo = new ABHouseholdMembersSummaryBO();
			hmSummarybo.loadHouseholdMembers((String) session
					.get(AppConstants.APP_NUMBER));
			medicareBO.getIndividualsOtherHealthInfo((String) session
					.get(AppConstants.APP_NUMBER));
			// Other Health insurance Screen will come for all health insurance
			// screens except the end screen
			boolean scheduleAROHI = true;
			if (userEndInd == 1 || status == 'C') {
				scheduleAROHI = false;
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
			 * javadoc
			 */
			/**
			 * // for (int i = 0; i < individuals.length; i++) { //
			 * APP_IN_HLTH_INS_BNFTS_Cargo tempCargo =
			 * (APP_IN_HLTH_INS_BNFTS_Cargo) individuals[i]; // if
			 * ("OT".equals(tempCargo.getHlth_cvrg_type()) &&
			 * (isOtherHealthCareNeeded == false)) { //
			 * medicareBO.eraseOtherHealth(tempCargo.getApp_num(),
			 * tempCargo.getIndv_seq_num()); // } // if
			 * ("OT".equals(tempCargo.getHlth_cvrg_type()) ||
			 * (isOtherHealthCareNeeded)) { // scheduleAROHI = true; // } // //
			 * }
			 *
			 */
			APP_IN_OTHR_HLTH_INS_Collection otherHealthInsuranceCollection = new APP_IN_OTHR_HLTH_INS_Collection();
			APP_IN_OTHR_HLTH_INS_Cargo otherHealthInsuranceCargo = null;
			if (scheduleAROHI) {

				/*if (FwConstants.ROWACTION_INSERT.equals(healthInsuranceCargo
						.getRowAction())
						&& healthInsuranceCargo.getSrc_app_ind() != null
						&& AppConstants.RMC_NEW_RECORD_IND
						.equals(healthInsuranceCargo.getSrc_app_ind())) {
					otherHealthInsuranceCargo = medicareBO
							.createOtherHealthInsuranceCargo(appInMedCollection);
					otherHealthInsuranceCollection
					.add(otherHealthInsuranceCargo);
					medicareBO
					.storeOthrHlthInsDetails(otherHealthInsuranceCollection);

					categorySelectionProfileManager
					.insertSequenceDetail(categorySelectionProfile,
							appNumber, "OB", categorySeqDetailBean
							.getIndividualSequence(), Short
							.valueOf(otherHealthInsuranceCargo
									.getSeq_num()),
									AppConstants.OTHR_HEALTH_INS_INFORMATION,
									(short) 0);
					
				} else {
					otherHealthInsuranceCollection = medicareBO
							.loadOthrHlthInsDetails(appNumber,
									healthInsuranceCargo.getIndv_seq_num(),
									null, healthInsuranceCargo.getSeq_num());
					if (otherHealthInsuranceCollection != null
							&& !otherHealthInsuranceCollection.isEmpty()) {
						otherHealthInsuranceCargo = (APP_IN_OTHR_HLTH_INS_Cargo) otherHealthInsuranceCollection
								.get(0);
						categorySelectionProfileManager.insertSequenceDetail(
								categorySelectionProfile, appNumber, "OB",
								categorySeqDetailBean.getIndividualSequence(),
								Short.valueOf(otherHealthInsuranceCargo
										.getSeq_num()),
										AppConstants.OTHR_HLTH_INS_INFORMATION,
										(short) 0);
					}
				}*/
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "AROHI",
						driverArray,
						(String) session.get(AppConstants.APP_NUMBER));

			} else {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code
				 * in this block
				 */
			}
			if (StringUtils.isNotEmpty(addRecordIndicator)
					&& FwConstants.YES.equalsIgnoreCase(addRecordIndicator)) {
				beforeColl.put("ADD_HLTH_INS_BNFTS", FwConstants.EMPTY_STRING);
				if (scheduleAROHI) {
					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();

					if (otherHealthInsuranceCargo != null) {

						indivSeqBean.setSeqNum(otherHealthInsuranceCargo
								.getSeq_num());
					} else {
						indivSeqBean.setSeqNum(FwConstants.ZERO);
					}

					indivSeqBean.setIndivSeqNum(String.valueOf(indvSeqNum));
					indivSeqBean.setType(AppConstants.OTHR_HLTH_INS_INFORMATION);
					indivSeqBean.setUserEndInd(FwConstants.ZERO);
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN,
							indivSeqBean);
					String seqNum;
					otherHealthInsuranceCargo = medicareBO
							.createOtherHealthInsuranceCargo(appInMedCollection);
					if(otherHealthInsuranceCargo != null){
						seqNum = otherHealthInsuranceCargo
								.getHlth_ins_seq_number();
					} else {
						seqNum = FwConstants.ZERO;
					}
					
					categorySelectionProfileManager.insertSequenceDetail(
							categorySelectionProfile, appNumber, "OB",
							categorySeqDetailBean.getIndividualSequence(),
							Short.valueOf(seqNum),
									AppConstants.OTHR_HLTH_INS_INFORMATION,
									(short) 0);
				}
			}

			// Save the covered people
			final CP_APP_IN_MED_INS_CVRG_Collection coveragePersistCollection = prepareHealthInsuranceCoverage(
					coverageBeforeCollection, healthCareBO, coverageCollection,
					healthInsuranceCargo);

			// Does LoopingQuestion flag is YES

			boolean loopingQuestion = false;

			if (request.get("loopingQuestion") != null
					&& FwConstants.YES.equals(request.get("loopingQuestion"))) {
				loopingQuestion = true;

				categorySelectionProfileManager.insertSequenceDetail(
						inMedProfile, null, null,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategoryType());
				driverManager.makeRequired(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
				// Make required the RMB Asset Summary page
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						ADDITIONAL_INFORMATION_SUMMARY_PAGE_ID, driverArray,
						appNumber);

			}

			if (!loopingQuestion
					&& categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager
					.makeComplete(
							rmcResponseProfileManager
							.getResponseByType(
									IRMCResponseProfileManager.HEALTHCARE_COVERAGE,
									categorySeqDetailBean
									.getCategoryType()),
									rmcInPrflCargo, true);
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.HLTH_INS_RESP,
							rmcInPrflCargo, true);
				}
			}
			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inMedProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(inMedProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
				// //Make required the RMB Asset Summary page
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						HOUSEHOLD_INFO_SUMMARY_PAGE_ID, driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inMedProfile);
			}

			driverManager.makeComplete(FwConstants.RMC_DRIVER,
					HOUSEHOLD_INFO_GATEPOST_ID, driverArray, appNumber);

			beforeColl.get("PAGE_MODE");
			beforeColl.putAll(pageCollection);
			healthCareBO
			.storeHealthInsuranceCoverage(coveragePersistCollection);

			if (request.get("loopingQuestion") != null) {
				request.remove("loopingQuestion");
			}

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeHealthInsDetails");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHealthInsDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHealthInsDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHealthInsDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHealthInsDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoContactDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Prepare health insurance coverage.
	 *
	 * @param coverageBeforeCollectionOriginal the coverage before collection original
	 * @param healthCareBO the health care bo
	 * @param coverageCollection the coverage collection
	 * @param healthInsuranceCargo the health insurance cargo
	 * @return the c p_ ap p_ i n_ me d_ in s_ cvr g_ collection
	 */
	private CP_APP_IN_MED_INS_CVRG_Collection prepareHealthInsuranceCoverage(
			final CP_APP_IN_MED_INS_CVRG_Collection coverageBeforeCollectionOriginal,
			final HealthCareCoverageBO healthCareBO,
			final CP_APP_IN_MED_INS_CVRG_Collection coverageCollection,
			final APP_IN_HLTH_INS_BNFTS_Cargo healthInsuranceCargo) {
		CP_APP_IN_MED_INS_CVRG_Collection coveragePersistCollection = new CP_APP_IN_MED_INS_CVRG_Collection();
		CP_APP_IN_MED_INS_CVRG_Cargo coverageBeforeCargo = null;
		CP_APP_IN_MED_INS_CVRG_Cargo coverageCargo = null;
		CP_APP_IN_MED_INS_CVRG_Cargo coverageBeforeCWCargo = null;
		CP_APP_IN_MED_INS_CVRG_Collection coverageBeforeCollection = null;
		final String appNumber = healthInsuranceCargo.getApp_num();
		final String indvSeqNum = healthInsuranceCargo.getIndv_seq_num();
		final String plcySeqNum = healthInsuranceCargo.getSeq_num();
		if (coverageBeforeCollectionOriginal != null) {

			if (!coverageBeforeCollectionOriginal.isEmpty()) {
				coverageBeforeCollection = healthCareBO
						.splitMedCvrgCargoModifiedRecord(coverageBeforeCollectionOriginal);
			} else {
				coverageBeforeCollection = coverageBeforeCollectionOriginal;
			}
			for (final Iterator iterator = coverageBeforeCollection.iterator(); iterator
					.hasNext();) {
				coverageBeforeCargo = (CP_APP_IN_MED_INS_CVRG_Cargo) iterator
						.next();

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 4 lines Commented Code
				 * in this block
				 */

				// Set page cargos Individual Seq Numbers from the owner
				for (final Object coverageObject : coverageCollection) {
					coverageCargo = (CP_APP_IN_MED_INS_CVRG_Cargo) coverageObject;
					coverageCargo.setIndv_seq_num(healthInsuranceCargo
							.getIndv_seq_num());
					coverageCargo.setPlcy_seq_num(healthInsuranceCargo
							.getSeq_num());

				}

				if (coverageBeforeCargo.getSrc_app_ind() != null
						&& "RE".equalsIgnoreCase(coverageBeforeCargo
								.getSrc_app_ind())
								&& healthCareBO.isSameHealthCoverageOwner(
										healthInsuranceCargo,
										coverageBeforeCargo.getIndv_seq_num(),
										coverageBeforeCargo.getPlcy_seq_num())) {
					coverageBeforeCWCargo = healthCareBO.getCWMedCvrgCargo(
							coverageCollection,
							coverageBeforeCargo.getCovered_indv_seq_num());
					if (coverageBeforeCWCargo == null) {
						coverageCargo = null;
					} else {
						coverageCargo = healthCareBO.getMatchingCargo(
								coverageCollection, coverageBeforeCWCargo);
					}
					if (coverageCargo != null) {
						coverageBeforeCargo
						.setRowAction(FwConstants.ROWACTION_UPDATE);
						coverageBeforeCargo
						.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
						coveragePersistCollection.add(coverageBeforeCargo);
					}

				} else if (healthCareBO.isSameHealthCoverageOwner(
						healthInsuranceCargo,
						coverageBeforeCargo.getIndv_seq_num(),
						coverageBeforeCargo.getPlcy_seq_num())) {
					coverageCargo = healthCareBO.getMatchingCargo(
							coverageCollection, coverageBeforeCargo);
					if (coverageCargo == null
							&& !"RE".equalsIgnoreCase(coverageBeforeCargo
									.getSrc_app_ind())) {
						final CP_APP_IN_MED_INS_CVRG_Collection cWRecords = healthCareBO
								.splitMedCvrgCargo(
										coverageBeforeCollectionOriginal,
										AppConstants.CWW_RECORD_IND);
						final CP_APP_IN_MED_INS_CVRG_Cargo matchingCargo = healthCareBO
								.getMatchingCargo(cWRecords,
										coverageBeforeCargo, true);
						if (matchingCargo != null) {
							healthCareBO.setDefaultValues(matchingCargo,
									appNumber, indvSeqNum, plcySeqNum);
							coverageBeforeCargo
							.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
							coverageBeforeCargo
							.setRowAction(FwConstants.ROWACTION_INSERT);
							coveragePersistCollection.add(coverageBeforeCargo);

						} else {
							coverageBeforeCargo
							.setRowAction(FwConstants.ROWACTION_DELETE);
							coveragePersistCollection.add(coverageBeforeCargo);
						}

					} else if (coverageBeforeCargo.getSrc_app_ind() != null
							&& !"RN".equalsIgnoreCase(coverageBeforeCargo
									.getSrc_app_ind())) {
						healthCareBO.setDefaultValues(coverageCargo, appNumber,
								indvSeqNum, plcySeqNum);
						coverageCargo = (CP_APP_IN_MED_INS_CVRG_Cargo) isChanged(
								coverageBeforeCargo, coverageCargo);
						coverageCargo.setSrc_app_ind(coverageBeforeCargo
								.getSrc_app_ind());

						if (coverageCargo.isDirty()
								&& !AppConstants.CWW_RECORD_IND
								.equals(coverageCargo.getSrc_app_ind())) {
							coverageCargo
							.setRowAction(FwConstants.ROWACTION_UPDATE);
							coveragePersistCollection.add(coverageCargo);
						} else if (coverageCargo.isDirty()) {
							coverageCargo
							.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
							coverageCargo
							.setRowAction(FwConstants.ROWACTION_INSERT);
							coveragePersistCollection.add(coverageCargo);
						}
					} else {

						healthCareBO.setDefaultValues(coverageCargo, appNumber,
								indvSeqNum, plcySeqNum);
						coverageCargo = (CP_APP_IN_MED_INS_CVRG_Cargo) isChanged(
								coverageBeforeCargo, coverageCargo);
						coverageCargo.setSrc_app_ind(coverageBeforeCargo
								.getSrc_app_ind());

						if (coverageCargo.isDirty()) {
							coverageCargo
							.setRowAction(FwConstants.ROWACTION_INSERT);
							coveragePersistCollection.add(coverageCargo);
						}
					}
				}
			}
		} else {

			coveragePersistCollection = coverageCollection;
			for (final Object presistanceCoverageObject : coveragePersistCollection) {
				final CP_APP_IN_MED_INS_CVRG_Cargo presistanceCoverageCargo = (CP_APP_IN_MED_INS_CVRG_Cargo) presistanceCoverageObject;
				healthCareBO.setDefaultValues(presistanceCoverageCargo,
						appNumber, indvSeqNum, plcySeqNum);
				presistanceCoverageCargo
				.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				presistanceCoverageCargo
				.setRowAction(FwConstants.ROWACTION_INSERT);
			}
			return coveragePersistCollection;
		}
		if (coverageCollection != null) {
			final int coverageCollectionSize = coverageCollection.size();
			for (int i = 0; i < coverageCollectionSize; i++) {
				coverageCargo = coverageCollection.getCargo(i);
				coverageBeforeCargo = healthCareBO.getMatchingCargo(
						coverageBeforeCollection, coverageCargo, true);

				if (coverageBeforeCargo == null
						|| coverageBeforeCargo.getRowAction() == null
						&& healthCareBO.getMatchingCargo(
								coveragePersistCollection, coverageCargo) == null
								&& ((CP_APP_IN_MED_INS_CVRG_Cargo) isChanged(
										coverageBeforeCargo, coverageCargo)).isDirty()) {
					healthCareBO.setDefaultValues(coverageCargo, appNumber,
							indvSeqNum, plcySeqNum);
					coverageCargo
					.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
					coverageCargo.setRowAction(FwConstants.ROWACTION_INSERT);
					coveragePersistCollection.add(coverageCargo);
				}
			}
		}
		return coveragePersistCollection;
	}

	/**
	 * Load medicare abd details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadMedicareABDDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadMedicareABDDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadMedicareABDDetails:Start");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();

		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String pageMode = null;

		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final MedicareBO medicareBO = new MedicareBO();

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			categorySelectionProfile.toArray();

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.MEDICARE_INFORMATION,
					AppConstants.MEDICARE_INFORMATION);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.RECEIVE_MEDICARE };
			SortedSet medicareDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.MEDICARE_INFORMATION;

			if (!pageId.equals(previousPageId)) {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1,2 lines Commented
				 * Code in this block
				 */

				medicareDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {

					final APP_IN_MEDCR_Collection medColl = medicareBO
							.loadMedicareDetails(appNumber);
					final APP_IN_MEDCR_Collection newmedColl = medicareBO
							.splitMediCareColl(medColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newmedColl != null && !newmedColl.isEmpty()) {
						APP_IN_MEDCR_Cargo appInMedCargo = null;
						final int newMedCollSize = newmedColl.size();
						rnRecordFound = true;

						for (int i = 0; i < newMedCollSize; i++) {
							appInMedCargo = newmedColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									medicareDetailsProfile, null, null,
									Short.parseShort(appInMedCargo
											.getIndv_seq_num()),
											(short) 0, categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(medicareDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(medicareDetailsProfile);
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				medicareDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("Medicare_IndSeqBean");
			}

			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								medicareDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.MEDICARE_INFORMATION);

				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.updateUserEndSelInd(medicareDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.MEDICARE_INFORMATION,
												Short.parseShort(userEndIndicator));
					}

					categorySelectionProfileManager.makeSequenceDetailRequired(
							medicareDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.MEDICARE_INFORMATION);

					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.MEDICARE_INFORMATION);

					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}

							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.MEDICARE_INFORMATION,
													Short.parseShort(userEndIndicator));
						}

						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.MEDICARE_INFORMATION);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.MEDICARE_INFORMATION.equals(indivSeqBean
								.getType())) {
							// first we are checking rnc in profile exists in
							// the sess
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}

							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}

							rmcResponseProfileManager
							.makeAddNew(
									IRMCResponseProfileManager.RECEIVE_MEDICARE,
									rmcInPrflCargo, true);

							CategorySequenceDetail catseqDet = null;
							if (!medicareDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												medicareDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.MEDICARE_INFORMATION);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										medicareDetailsProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.MEDICARE_INFORMATION);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean sErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;
									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.MEDICARE_INFORMATION
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												sErowExists = true;
												break;
											}
										}

									}
								}

								if (sErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.MEDICARE_INFORMATION);
								}

								categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.MEDICARE_INFORMATION);
								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.MEDICARE_INFORMATION);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.MEDICARE_INFORMATION };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!medicareDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													medicareDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.MEDICARE_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											medicareDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.MEDICARE_INFORMATION);
									medicareDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									medicareDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!medicareDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													medicareDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.MEDICARE_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											medicareDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.MEDICARE_INFORMATION);
									categorySelectionProfileManager
									.insertSequenceDetail(
											medicareDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.MEDICARE_INFORMATION);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											medicareDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.MEDICARE_INFORMATION);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								medicareDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								medicareDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}

				session.put("Medicare_IndSeqBean", indivSeqBean);
			}

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					medicareDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(medicareDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(medicareDetailsProfile);
			}

			categorySeqDetail.getCategoryType();

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final APP_IN_MEDCR_Collection appInMedColl = medicareBO
					.loadMedicareDetails(appNumber, indvSeqNumber);

			pageCollection.put("APP_IN_MEDCR_Collection", appInMedColl);

			APP_IN_MEDCR_Cargo cwwInMedCargo = medicareBO.splitMedColl(
					appInMedColl, AppConstants.CWW_RECORD_IND);

			if (cwwInMedCargo == null) {
				cwwInMedCargo = new APP_IN_MEDCR_Cargo();
			}

			pageCollection.put("SEC_MEDCR",
					medicareBO.settingDefaultValues(cwwInMedCargo));

			APP_IN_MEDCR_Cargo rmcInMedCargo = medicareBO.splitMedColl(
					appInMedColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			if (rmcInMedCargo != null) {
				pageCollection.put("FST_MEDCR",
						medicareBO.settingDefaultValues(rmcInMedCargo));

			} else {
				rmcInMedCargo = medicareBO.splitMedColl(appInMedColl,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcInMedCargo != null) {
					pageCollection.put("FST_MEDCR",
							medicareBO.settingDefaultValues(rmcInMedCargo));
				} else {

					rmcInMedCargo = medicareBO.splitMedColl(appInMedColl,
							AppConstants.RMC_NEW_RECORD_IND);
					if (rmcInMedCargo != null) {
						pageCollection.put("FST_MEDCR",
								medicareBO.settingDefaultValues(rmcInMedCargo));
					} else {
						pageCollection.put("FST_MEDCR",
								medicareBO.settingDefaultValues(cwwInMedCargo));

					}
				}

			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (appInMedColl != null && !appInMedColl.isEmpty()) {
				final APP_IN_MEDCR_Cargo appInMedCargo = appInMedColl
						.getResult(0);
				srcAppInd = appInMedCargo.getSrc_app_ind();
			}
			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}

			if (categorySeqDetail.getUserEndSelectionInd() == 1)
			/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 3,3 lines Commented Code in
				 * this block
				 */
			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd()))

				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equals(pageMode) || "E".equals(pageMode))) {
				pageMode = FwConstants.NO;
			}

			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadMedicareABDDetails:End");
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadMedicareABDDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadMedicareABDDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadMedicareABDDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadMedicareABDDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadMedicareABDDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store medicare abd details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeMedicareABDDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeMedicareABDDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeMedicareABDDetails:Start");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;

		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateInfo = null;

		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);


			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection

			final SortedSet inMedProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final APP_IN_MEDCR_Collection appInMedCollection = (APP_IN_MEDCR_Collection) pageCollection
					.get("APP_IN_MEDCR_Collection");
			APP_IN_MEDCR_Cargo appInMedicareCargo = appInMedCollection
					.getResult(0);

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 4,3 lines Commented Code in
			 * this block
			 */

			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inMedProfile);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();

			final MedicareBO medicareBO = new MedicareBO();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			validateInfo = medicareBO.validateMedicareDetails(
					appInMedCollection, appInMedicareCargo,
					(String) beforeColl.get("PAGE_MODE"));

			if (checkBackToMyAccessSelected(request)
					|| validateInfo.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							medicareBO.getMessageList());
				}
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("APP_IN_MEDCR_Collection",
						appInMedCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection.put("PEOPLE_362", beforeColl.get("PEOPLE_362"));

				if (beforeColl.containsKey("SEC_MEDCR")) {
					pageCollection
					.put("SEC_MEDCR", beforeColl.get("SEC_MEDCR"));
				}
				pageCollection.put("FST_MEDCR", appInMedicareCargo);
				return;

			}

			appInMedicareCargo.setApp_num(appNumber);
			appInMedicareCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
			appInMedicareCargo.setSeq_num(appInMedicareCargo.getSeq_num());
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in
			 * this block
			 */

			final String partBPremAmt = appInMedicareCargo.getPartb_prem_amt();
			final String partAPremAmt = appInMedicareCargo.getParta_prem_amt();

			if (appInMedicareCargo.getParta_prem_ind() == null) {
				if (partAPremAmt != null
						&& FwConstants.EMPTY_STRING.equals(partAPremAmt.trim())) {
					appInMedicareCargo.setParta_prem_amt(FwConstants.ZERO);
					appInMedicareCargo.setParta_prem_ind("2");
				} else {
					appInMedicareCargo.setParta_prem_ind(FwConstants.ZERO);
				}
			} else {
				if (partAPremAmt != null
						&& FwConstants.EMPTY_STRING.equals(partAPremAmt.trim())) {
					appInMedicareCargo.setParta_prem_amt("-1");
				}
			}

			if (appInMedicareCargo.getPartb_prem_ind() == null) {
				if (partBPremAmt != null
						&& FwConstants.EMPTY_STRING.equals(partBPremAmt.trim())) {
					appInMedicareCargo.setPartb_prem_amt(FwConstants.ZERO);
					appInMedicareCargo.setPartb_prem_ind("2");
				} else {
					appInMedicareCargo.setPartb_prem_ind(FwConstants.ZERO);
				}
			} else {
				if (partBPremAmt != null
						&& FwConstants.EMPTY_STRING.equals(partBPremAmt.trim())) {
					appInMedicareCargo.setPartb_prem_amt("-1");
				}
			}

			if (appInMedicareCargo.getParta_ettl_resp() == null) {
				appInMedicareCargo.setParta_ettl_resp(FwConstants.SPACE);
			}
			if (appInMedicareCargo.getPartb_ettl_resp() == null) {
				appInMedicareCargo.setPartb_ettl_resp(FwConstants.SPACE);
			}

			if (appInMedicareCargo.getParta_beg_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appInMedicareCargo
							.getParta_beg_dt())) {
				appInMedicareCargo.setParta_beg_dt(AppConstants.HIGH_DATE);
			} else {
				appInMedicareCargo.setParta_beg_dt(displayFormatter
						.getYYYYMMDDDate(appInMedicareCargo.getParta_beg_dt()));
			}

			if (appInMedicareCargo.getPartb_beg_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appInMedicareCargo
							.getPartb_beg_dt())) {
				appInMedicareCargo.setPartb_beg_dt(AppConstants.HIGH_DATE);
			} else {
				appInMedicareCargo.setPartb_beg_dt(displayFormatter
						.getYYYYMMDDDate(appInMedicareCargo.getPartb_beg_dt()));
			}

			if (appInMedicareCargo.getParta_end_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appInMedicareCargo
							.getParta_end_dt())) {
				appInMedicareCargo.setParta_end_dt(AppConstants.HIGH_DATE);
			} else {
				appInMedicareCargo.setParta_end_dt(displayFormatter
						.getYYYYMMDDDate(appInMedicareCargo.getParta_end_dt()));
			}

			if (appInMedicareCargo.getPartb_end_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appInMedicareCargo
							.getPartb_end_dt())) {
				appInMedicareCargo.setPartb_end_dt(AppConstants.HIGH_DATE);
			} else {
				appInMedicareCargo.setPartb_end_dt(displayFormatter
						.getYYYYMMDDDate(appInMedicareCargo.getPartb_end_dt()));
			}

			final APP_IN_MEDCR_Collection beforeAppInMedColl = (APP_IN_MEDCR_Collection) beforeColl
					.get("APP_IN_MEDCR_Collection");
			APP_IN_MEDCR_Cargo beforeInMedCargo = null;

			String sourceAppIndicator = null;
			String recordInd = null;

			boolean inMedicareDetailsUpdate = false;

			if (beforeAppInMedColl != null && !beforeAppInMedColl.isEmpty()) {
				final int size = beforeAppInMedColl.size();

				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInMedCargo = medicareBO.splitMedColl(
							beforeAppInMedColl, sourceAppIndicator);
				} else {
					// now we are checking this record is CW or RN
					sourceAppIndicator = AppConstants.CWW_RECORD_IND;
					beforeInMedCargo = medicareBO.splitMedColl(
							beforeAppInMedColl, sourceAppIndicator);
					if (beforeInMedCargo != null) {

						if (userEndInd == 1) {
							sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;

						} else {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						}
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInMedCargo = medicareBO.splitMedColl(
								beforeAppInMedColl, sourceAppIndicator);
					}
				}

				// check dirty
				appInMedicareCargo = (APP_IN_MEDCR_Cargo) isChanged(
						beforeInMedCargo, appInMedicareCargo);

				appInMedicareCargo.setSrc_app_ind(sourceAppIndicator);
				appInMedicareCargo.setRowAction(recordInd);

				if (appInMedicareCargo.isDirty()) {
					inMedicareDetailsUpdate = true;
				}
			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				appInMedicareCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInMedicareCargo.setRowAction(recordInd);

				inMedicareDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inMedProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());
				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}
			// now we need to check the flags
			if (inMedicareDetailsUpdate) {
				medicareBO.storeMedicareDetails(appInMedCollection);

			}

			// now i need to update the rmc_in_prfl
			//reqInd is indicator to decide if we have complete the response profile or not
				boolean reqInd=false;
				short respTyp=IRMCResponseProfileManager.RECEIVE_MEDICARE;
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null && rmcResponseProfileManager.getProfileResponse(
						rmcInPrflCargo, respTyp).charAt(0) == IRMCResponseProfileManager.STATUS_REQUIRED) {
					reqInd=true;
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.RECEIVE_MEDICARE,
							rmcInPrflCargo, true);
				}
			

			// Mark complete job sequence using common methods
				//if the profile response was not 'R' or if we came from gatepost then don't persist else persist
			if(!reqInd || categorySeqDetailBean.getChangeSelectionCategoryCd()==null)
			{
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inMedProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			}else
			{
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inMedProfile, appNumber,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			}	
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(inMedProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inMedProfile);
			}
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeMedicareABDDetails:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeMedicareABDDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeMedicareABDDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeMedicareABDDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeMedicareABDDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoContactDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load Hospital Stay.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void loadHospitalStayDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHospitalStayDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadHospitalStayDetails");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String pageMode = null;

		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final ABHouseHoldMemberBO householdBO = new ABHouseHoldMemberBO();

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.HOSPITAL_STAY,
					AppConstants.HOSPITAL_STAY);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {

				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			final short[] responseType = new short[] { IRMCResponseProfileManager.HOSPITAL_STAY_RESP };
			SortedSet hospStayDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.HOSPITAL_STAY;

			if (!pageId.equals(previousPageId)) {
				hospStayDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);

				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented
					 * Code in this block
					 */

					pageCollection.get(FwConstants.DETAIL_KEY_BEAN);

					final CP_APP_IN_CARE_PROV_Collection hospStayColl = householdBO
							.loadAppInCreProvDetls(appNumber);
					final CP_APP_IN_CARE_PROV_Collection newHospStayColl = householdBO
							.splitAppInCreProvColl(hospStayColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newHospStayColl != null && !newHospStayColl.isEmpty()) {

						CP_APP_IN_CARE_PROV_Cargo appInHospStayCargo = null;
						final int newHospStayCollSize = newHospStayColl.size();
						rnRecordFound = true;

						for (int i = 0; i < newHospStayCollSize; i++) {

							appInHospStayCargo = newHospStayColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									hospStayDetailsProfile, null, null,
									Short.parseShort(appInHospStayCargo
											.getIndv_seq_num()),
											(short) 0, categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(hospStayDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the
					// detailR
					// bean
					if (hospStayDetailsProfile != null
							&& !hospStayDetailsProfile.isEmpty()) {
						categorySelectionProfileManager
						.setCurrentRecordIndToLast(hospStayDetailsProfile);
					}
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				hospStayDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("Hospital_IndSeqBean");
			}

			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								hospStayDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.HOSPITAL_STAY);

				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(
								hospStayDetailsProfile,
								appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										AppConstants.HOSPITAL_STAY, Short
										.parseShort(indivSeqBean
												.getUserEndInd()));
					}
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.updateUserEndSelInd(hospStayDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.HOSPITAL_STAY, Short
												.parseShort(userEndIndicator));
					}

					categorySelectionProfileManager.makeSequenceDetailRequired(
							hospStayDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.HOSPITAL_STAY);

					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.HOSPITAL_STAY);

					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}

							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.HOSPITAL_STAY,
													Short.parseShort(userEndIndicator));
						}

						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.HOSPITAL_STAY);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.ADD_HOSPITAL.equals(indivSeqBean
								.getType())) {
							// first we are checking rnc in profile exists in
							// the ses
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}

							rmcResponseProfileManager
							.makeAddNew(
									IRMCResponseProfileManager.HOSPITAL_STAY_RESP,
									rmcInPrflCargo, true);
							CategorySequenceDetail catseqDet = null;

							if (!hospStayDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												hospStayDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.HOSPITAL_STAY);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										hospStayDetailsProfile, null,
										null,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.HOSPITAL_STAY);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean sErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;

									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.HOSPITAL_STAY
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												sErowExists = true;
												break;
											}
										}

									}
								}
								if (sErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.HOSPITAL_STAY);
								}
								categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.HOSPITAL_STAY);
								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.HOSPITAL_STAY);

								SortedSet hospStayAddSortedSet = null;
								final String[] catTypeHospStayAdd = { AppConstants.HOSPITAL_STAY };
								hospStayAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypeHospStayAdd);
								CategorySequenceDetail catseqDet = null;

								if (!hospStayDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													hospStayDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.HOSPITAL_STAY);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											hospStayDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.HOSPITAL_STAY);
									hospStayDetailsProfile
									.addAll(hospStayAddSortedSet);
								} else {
									hospStayDetailsProfile
									.addAll(hospStayAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!hospStayDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													hospStayDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.HOSPITAL_STAY);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											hospStayDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.HOSPITAL_STAY);
									categorySelectionProfileManager
									.insertSequenceDetail(
											hospStayDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.HOSPITAL_STAY);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											hospStayDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.HOSPITAL_STAY);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								hospStayDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));

						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								hospStayDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));

						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put("Hospital_IndSeqBean", indivSeqBean);
			}

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					hospStayDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(hospStayDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(hospStayDetailsProfile);
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final String careType = "HS";
			final CP_APP_IN_CARE_PROV_Collection hospColl = householdBO
					.loadAppInCreProvDetails(appNumber, indvSeqNumber, careType);

			pageCollection.put("CP_APP_IN_CARE_PROV_Collection", hospColl);
			CP_APP_IN_CARE_PROV_Cargo cwwInHosCargo = householdBO.splithosColl(
					hospColl, AppConstants.CWW_RECORD_IND);

			if (cwwInHosCargo == null) {
				cwwInHosCargo = new CP_APP_IN_CARE_PROV_Cargo();
			}
			pageCollection.put("SEC_HOSP",
					householdBO.settingDefaultValues(cwwInHosCargo));

			CP_APP_IN_CARE_PROV_Cargo rmcInHosCargo = householdBO.splithosColl(
					hospColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			if (rmcInHosCargo != null) {
				pageCollection.put("FST_HOSP",
						householdBO.settingDefaultValues(rmcInHosCargo));

			} else {
				rmcInHosCargo = householdBO.splithosColl(hospColl,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcInHosCargo != null) {
					pageCollection.put("FST_HOSP",
							householdBO.settingDefaultValues(rmcInHosCargo));
				} else {

					rmcInHosCargo = householdBO.splithosColl(hospColl,
							AppConstants.RMC_NEW_RECORD_IND);
					if (rmcInHosCargo != null) {
						pageCollection
						.put("FST_HOSP", householdBO
								.settingDefaultValues(rmcInHosCargo));
					} else {
						pageCollection
						.put("FST_HOSP", householdBO
								.settingDefaultValues(cwwInHosCargo));

					}
				}

			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (hospColl != null && !hospColl.isEmpty()) {
				final CP_APP_IN_CARE_PROV_Cargo appInhosCargo = hospColl
						.getResult(0);
				srcAppInd = appInhosCargo.getSrc_app_ind();
			}
			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}
			if (categorySeqDetail.getUserEndSelectionInd() == 1 || "RE".equalsIgnoreCase(srcAppInd))

			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd())) // categorySeqDetail.getUserEndSelectionInd()==
				// 1)
				// userEndInd.equals(FwConstants.ONE)
				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equals(pageMode) || "E".equals(pageMode))) {
				pageMode = FwConstants.NO;
			}
			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);

			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);

			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}
			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadHospitalStayDetails");
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHospitalStayDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHospitalStayDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHospitalStayDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHospitalStayDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHospitalStayDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store Hospital Stay.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storeHospitalStayDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHospitalStayDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeHospitalStayDetails");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateInfo = null;
		try {
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final SortedSet innurProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final CP_APP_IN_CARE_PROV_Collection appInCreProvColl = (CP_APP_IN_CARE_PROV_Collection) pageCollection
					.get("CP_APP_IN_CARE_PROV_Collection");
			CP_APP_IN_CARE_PROV_Cargo appInHospStayCargo = appInCreProvColl
					.getResult(0);

			beforeColl.get(AppConstants.FIRST_NAME);
			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(innurProfile);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();
			final ABHouseHoldMemberBO householdBO = new ABHouseHoldMemberBO();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			validateInfo = householdBO.validateHospitalDetails(
					appInCreProvColl, (String) beforeColl.get("PAGE_MODE"));

			if (checkBackToMyAccessSelected(request)
					|| validateInfo.hasMessages()) {

				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							householdBO.getMessageList());
				}

				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CP_APP_IN_CARE_PROV_Collection",
						appInCreProvColl);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection.put("PEOPLE_362", beforeColl.get("PEOPLE_362"));

				if (beforeColl.containsKey("SEC_HOSP")) {
					pageCollection.put("SEC_HOSP", beforeColl.get("SEC_HOSP"));
				}
				pageCollection.put("FST_HOSP", appInHospStayCargo);
				return;

			}
			appInHospStayCargo.setApp_num(appNumber);
			appInHospStayCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			appInHospStayCargo.setSeq_num(appInCreProvColl.getCargo(0)
					.getSeq_num());
			appInHospStayCargo.setCare_type_cd("HS");

			final CP_APP_IN_CARE_PROV_Collection beforeAppInCreProvColl = (CP_APP_IN_CARE_PROV_Collection) beforeColl
					.get("CP_APP_IN_CARE_PROV_Collection");
			CP_APP_IN_CARE_PROV_Cargo beforeAppInHospStaypCargo = null;

			if (appInHospStayCargo.getEnd_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appInHospStayCargo
							.getEnd_dt())) {
				// check commented code in history
			} else {
				appInHospStayCargo.setEnd_dt(displayFormatter
						.getYYYYMMDDDate(appInHospStayCargo.getEnd_dt()));
			}

			String sourceAppIndicator = null;
			String recordInd = null;

			boolean isHospStayDetlsUpdate = false;
			if (beforeAppInCreProvColl != null
					&& !beforeAppInCreProvColl.isEmpty()) {
				final int size = beforeAppInCreProvColl.size();
				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					sourceAppIndicator = beforeAppInCreProvColl.getCargo(1).getSrc_app_ind();
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeAppInHospStaypCargo = householdBO.splithosColl(
							beforeAppInCreProvColl, sourceAppIndicator);
				} else {
					// now we are checking this record is CW or RN
					sourceAppIndicator = AppConstants.CWW_RECORD_IND;
					beforeAppInHospStaypCargo = householdBO.splithosColl(
							beforeAppInCreProvColl, sourceAppIndicator);
					if (beforeAppInHospStaypCargo != null) {

						if (userEndInd == 1) {
							sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;

						} else {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						}
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeAppInHospStaypCargo = householdBO.splithosColl(
								beforeAppInCreProvColl, sourceAppIndicator);
					}
				}
				// check dirty

				appInHospStayCargo.setEcp_id(beforeAppInHospStaypCargo
						.getEcp_id());
				appInHospStayCargo.setSrc_app_ind(sourceAppIndicator);
				appInHospStayCargo.setRowAction(recordInd);
				appInHospStayCargo.setSeq_num(beforeAppInHospStaypCargo.getSeq_num());
				
				Map changedAtrributes = appInHospStayCargo.compareAttributes(beforeAppInHospStaypCargo);

				if (!changedAtrributes.isEmpty()) {
					isHospStayDetlsUpdate = true;
				}

			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				appInHospStayCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInHospStayCargo.setRowAction(recordInd);

				isHospStayDetlsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(innurProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());
				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}
			// now we need to check the flags
			if (isHospStayDetlsUpdate) {
				householdBO.storeAppInCareDetails(appInCreProvColl);
			}
			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.HOSPITAL_STAY_RESP,
							rmcInPrflCargo, true);
				}
			}
			categorySelectionProfileManager.makeSequenceDetailComplete(
					innurProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());

			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			if (categorySelectionProfileManager
					.areAllSequencesComplete(innurProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(innurProfile);
			}
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeHospitalStayDetails");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHospitalStayDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHospitalStayDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHospitalStayDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHospitalStayDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHospitalStayDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load hospice care details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHospiceCareDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHospiceCareDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadHospiceCareDetails:Start");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();

		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String pageMode = null;

		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final ABHouseHoldMemberBO householdBO = new ABHouseHoldMemberBO();

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.HOSPICE_INFORMATION,
					AppConstants.HOSPICE_INFORMATION);
			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
						AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			final short[] responseType = new short[] { IRMCResponseProfileManager.HOUS_PICE };
			SortedSet hospiceDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.HOSPICE_INFORMATION;

			if (!pageId.equals(previousPageId)) {
				hospiceDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented
					 * Code in this block
					 */

					pageCollection.get(FwConstants.DETAIL_KEY_BEAN);

					final CP_APP_IN_CARE_PROV_Collection hosColl = householdBO
							.loadHospDetails(appNumber);
					final CP_APP_IN_CARE_PROV_Collection newhosColl = householdBO
							.splitHospiceColl(hosColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newhosColl != null && !newhosColl.isEmpty()) {
						CP_APP_IN_CARE_PROV_Cargo appInHosCargo = null;
						final int newMHosCollSize = newhosColl.size();
						rnRecordFound = true;
						for (int i = 0; i < newMHosCollSize; i++) {
							appInHosCargo = newhosColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									hospiceDetailsProfile, null, null,
									Short.parseShort(appInHosCargo
											.getIndv_seq_num()),
											(short) 0, categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(hospiceDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					if (hospiceDetailsProfile != null
							&& !hospiceDetailsProfile.isEmpty()) {
						categorySelectionProfileManager
						.setCurrentRecordIndToLast(hospiceDetailsProfile);
					}

				}
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				hospiceDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}
			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection.get(FwConstants.DETAIL_KEY_BEAN);
			if ((indivSeqBean == null) && (currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) && !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session.get("Hospice_IndSeqBean");
			}
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(hospiceDetailsProfile, Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()), AppConstants.HOSPICE_INFORMATION);

				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(
								hospiceDetailsProfile,
								appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										AppConstants.HOSPICE_INFORMATION, Short
										.parseShort(indivSeqBean
												.getUserEndInd()));
					}
					if ((categorySeqDetail1.getUserEndSelectionInd() != 1) && !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}
						categorySelectionProfileManager.updateUserEndSelInd(hospiceDetailsProfile, appNumber,
								Short.parseShort(indivSeqBean.getIndivSeqNum()), Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.HOSPICE_INFORMATION, Short.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(hospiceDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()), Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.HOSPICE_INFORMATION);
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager.getCategorySequenceDetail(
							categorySelectionProfile, Short.parseShort(indivSeqBean.getIndivSeqNum()), Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.HOSPICE_INFORMATION);
					if (categorySeqDetail2 != null) {
						if ((categorySeqDetail2.getUserEndSelectionInd() != 1) && !rnRecordFound) {
							String userEndIndicator = indivSeqBean.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}
							categorySelectionProfileManager.updateUserEndSelInd(categorySelectionProfile, appNumber,
									Short.parseShort(indivSeqBean.getIndivSeqNum()), Short.parseShort(indivSeqBean.getSeqNum()),
									AppConstants.HOSPICE_INFORMATION, Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager.makeSequenceDetailRequired(categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean.getIndivSeqNum()), Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.HOSPICE_INFORMATION);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.ADD_HOSPICE.equals(indivSeqBean
								.getType())) {
							// first we are checking rnc in profile exists in
							// the sess
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}

							rmcResponseProfileManager.makeAddNew(
									IRMCResponseProfileManager.HOUS_PICE,
									rmcInPrflCargo, true);
							CategorySequenceDetail catseqDet = null;
							if (!hospiceDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												hospiceDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.HOSPICE_INFORMATION);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										hospiceDetailsProfile,
										null,
										null,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.HOSPICE_INFORMATION);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND.equals(indivSeqBean.getType())) {
								boolean SErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile.iterator();
									CategorySequenceDetail catSeqDetail = null;

									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter.next();
										if (catSeqDetail != null) {
											if ((catSeqDetail.getIndividualSequence() == Short.parseShort(indivSeqBean.getIndivSeqNum()))
													&& AppConstants.HOSPICE_INFORMATION
															.equals(catSeqDetail.getCategoryType().trim())
													&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail.getChangeSelectionCategoryCd())) {
												SErowExists = true;
												break;
											}
										}

									}
								}
								if (SErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.HOSPICE_INFORMATION);
								}
								categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.HOSPICE_INFORMATION);
								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.HOSPICE_INFORMATION);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.HOSPICE_INFORMATION };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!hospiceDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													hospiceDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.HOSPICE_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											hospiceDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.HOSPICE_INFORMATION);
									hospiceDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									hospiceDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!hospiceDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													hospiceDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.HOSPICE_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											hospiceDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.HOSPICE_INFORMATION);
									categorySelectionProfileManager
									.insertSequenceDetail(
											hospiceDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.HOSPICE_INFORMATION);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											hospiceDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.HOSPICE_INFORMATION);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager.insertExistingSequenceDetail(hospiceDetailsProfile, null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL, Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()), indivSeqBean.getType(), Short.parseShort(userEndInd));
						categorySelectionProfileManager.makeSequenceDetailRequired(hospiceDetailsProfile, null,
								Short.parseShort(indivSeqBean.getIndivSeqNum()), Short.parseShort(indivSeqBean.getSeqNum()), indivSeqBean.getType());

						categorySelectionProfileManager.insertExistingSequenceDetail(categorySelectionProfile, appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL, Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()), indivSeqBean.getType(), Short.parseShort(userEndInd));
						categorySelectionProfileManager.makeSequenceDetailRequired(categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean.getIndivSeqNum()), Short.parseShort(indivSeqBean.getSeqNum()), indivSeqBean.getType());
					}
				}
				session.put("Hospice_IndSeqBean", indivSeqBean);
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					hospiceDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(hospiceDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(hospiceDetailsProfile);
			}
			categorySeqDetail.getCategoryType();
			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final CP_APP_IN_CARE_PROV_Collection hospiceColl = householdBO
					.loadHospicecareDetails(appNumber, indvSeqNumber);

			pageCollection.put("CP_APP_IN_CARE_PROV_Collection", hospiceColl);
			CP_APP_IN_CARE_PROV_Cargo cwwInHosCargo = householdBO.splithosColl(
					hospiceColl, AppConstants.CWW_RECORD_IND);

			if (cwwInHosCargo == null) {
				cwwInHosCargo = new CP_APP_IN_CARE_PROV_Cargo();
			}

			pageCollection.put("SEC_HOSC",
					householdBO.settingDefaultValues(cwwInHosCargo));

			CP_APP_IN_CARE_PROV_Cargo rmcInHosCargo = householdBO.splithosColl(
					hospiceColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
			 * javadoc
			 */
			/**
			 * if (rmcInHosCargo != null) { pageCollection.put("FST_HOSC",
			 * householdBO.settingDefaultValues(rmcInHosCargo));
			 * inHospiceDetailsChanged = true; } else { rmcInHosCargo =
			 * householdBO.splithosColl(hospiceColl,
			 * AppConstants.RMC_MODIFIED_RECORD_IND); if (rmcInHosCargo != null)
			 * { pageCollection.put("FST_HOSC",
			 * householdBO.settingDefaultValues(rmcInHosCargo));
			 * inHospiceDetailsChanged = true; } else {
			 * pageCollection.put("FST_HOSC",
			 * householdBO.settingDefaultValues(rmcInHosCargo)); }
			 *
			 * }
			 */
			if (rmcInHosCargo != null) {
				pageCollection.put("FST_HOSC",
						householdBO.settingDefaultValues(rmcInHosCargo));

			} else {
				rmcInHosCargo = householdBO.splithosColl(hospiceColl,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcInHosCargo != null) {
					pageCollection.put("FST_HOSC",
							householdBO.settingDefaultValues(rmcInHosCargo));
				} else {

					rmcInHosCargo = householdBO.splithosColl(hospiceColl,
							AppConstants.RMC_NEW_RECORD_IND);
					if (rmcInHosCargo != null) {
						pageCollection
						.put("FST_HOSC", householdBO
								.settingDefaultValues(rmcInHosCargo));
					} else {
						pageCollection
						.put("FST_HOSC", householdBO
								.settingDefaultValues(cwwInHosCargo));

					}
				}

			}
			String srcAppInd = FwConstants.EMPTY_STRING;

			if (hospiceColl != null && !hospiceColl.isEmpty()) {
				final CP_APP_IN_CARE_PROV_Cargo appInhosCargo = hospiceColl
						.getResult(0);
				srcAppInd = appInhosCargo.getSrc_app_ind();
			}
			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}
			if(rmcInHosCargo!=null && "RE".equalsIgnoreCase(rmcInHosCargo.getSrc_app_ind())){
				pageMode = "E";
			}
			if (categorySeqDetail.getUserEndSelectionInd() == 1 || "RE".equalsIgnoreCase(srcAppInd))

			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd())) // categorySeqDetail.getUserEndSelectionInd()==
				// 1)
				// userEndInd.equals(FwConstants.ONE)
				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equals(pageMode) || "E".equals(pageMode))) {
				pageMode = FwConstants.NO;
			}
			pageCollection.put("PAGE_MODE", pageMode);
			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);

			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);

			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}
			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadHospiceCareDetails");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHospiceCareDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHospiceCareDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHospiceCareDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHospiceCareDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHospiceCareDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store hospice care details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHospiceCareDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHospiceCareDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeHospiceCareDetails:Start");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateInfo = null;
		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);

			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection

			final SortedSet inhosProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final CP_APP_IN_CARE_PROV_Collection appInhosCollection = (CP_APP_IN_CARE_PROV_Collection) pageCollection
					.get("CP_APP_IN_CARE_PROV_Collection");
			CP_APP_IN_CARE_PROV_Cargo appInHospiceCargo = appInhosCollection
					.getResult(0);
			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inhosProfile);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();

			final ABHouseHoldMemberBO householdBO = new ABHouseHoldMemberBO();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			validateInfo = householdBO.validateHospDetails(appInhosCollection,
					(String) beforeColl.get("PAGE_MODE"));
			if (checkBackToMyAccessSelected(request)
					|| validateInfo.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							householdBO.getMessageList());
				}

				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CP_APP_IN_CARE_PROV_Collection",
						appInhosCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				if (beforeColl.containsKey("SEC_HOSC")) {
					pageCollection.put("SEC_HOSC", beforeColl.get("SEC_HOSC"));
				}
				pageCollection.put("FST_HOSC", appInHospiceCargo);
				return;

			}

			appInHospiceCargo.setApp_num(appNumber);
			appInHospiceCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
			appInHospiceCargo.setCare_type_cd("HP");
			appInHospiceCargo.setSeq_num(appInhosCollection.getCargo(0)
					.getSeq_num());
			householdBO.completenessCheck(appInHospiceCargo,
					beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
			if (appInHospiceCargo.getCare_prov_org_nam() == null) {
				appInHospiceCargo.setCare_prov_org_nam(FwConstants.SPACE);
			}

			final CP_APP_IN_CARE_PROV_Collection beforeAppInHosColl = (CP_APP_IN_CARE_PROV_Collection) beforeColl
					.get("CP_APP_IN_CARE_PROV_Collection");
			CP_APP_IN_CARE_PROV_Cargo beforeInhosCargo = null;

			if (appInHospiceCargo.getEnd_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appInHospiceCargo
							.getEnd_dt())) {
				appInHospiceCargo.setEnd_dt(AppConstants.HIGH_DATE);
			} else {
				appInHospiceCargo.setEnd_dt(displayFormatter
						.getYYYYMMDDDate(appInHospiceCargo.getEnd_dt()));
			}

			String sourceAppIndicator = null;
			String recordInd = null;

			boolean inHospiceDetailsUpdate = false;

			if (beforeAppInHosColl != null && !beforeAppInHosColl.isEmpty()) {
				final int size = beforeAppInHosColl.size();
				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					
					sourceAppIndicator = beforeAppInHosColl.getCargo(1).getSrc_app_ind();
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInhosCargo = householdBO.splithosColl(
							beforeAppInHosColl, sourceAppIndicator);
				} else {
					// now we are checking this record is CW or RN
					sourceAppIndicator = AppConstants.CWW_RECORD_IND;
					beforeInhosCargo = householdBO.splithosColl(
							beforeAppInHosColl, sourceAppIndicator);
					if (beforeInhosCargo != null) {
						if (userEndInd == 1) {
							sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;

						} else {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						}
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInhosCargo = householdBO.splithosColl(
								beforeAppInHosColl, sourceAppIndicator);
					}
				}

				// check dirty

				appInHospiceCargo.setEcp_id(beforeInhosCargo.getEcp_id());
				appInHospiceCargo.setSrc_app_ind(sourceAppIndicator);
				appInHospiceCargo.setRowAction(recordInd);
				appInHospiceCargo.setSeq_num(beforeInhosCargo.getSeq_num());

				Map changedAtrributes = appInHospiceCargo.compareAttributes(beforeInhosCargo);
				
				if (!changedAtrributes.isEmpty()) {
					inHospiceDetailsUpdate = true;
				}

			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				appInHospiceCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInHospiceCargo.setRowAction(recordInd);

				inHospiceDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inhosProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());
				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}
			// now we need to check the flags
			if (inHospiceDetailsUpdate) {
				householdBO.storeHospiceCare(appInhosCollection);

			}
			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.HOUS_PICE,
							rmcInPrflCargo, true);
				}
			}

			categorySelectionProfileManager.makeSequenceDetailComplete(
					inhosProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(inhosProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inhosProfile);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeHospiceCareDetails:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHospiceCareDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHospiceCareDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHospiceCareDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHospiceCareDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHospiceCareDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load nursing home care details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadNursingHomeCareDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadNursingHomeCareDetails() - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::loadNursingHomeCareDetails:Start");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String pageMode = null;

		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final ABHouseHoldMemberBO householdBO = new ABHouseHoldMemberBO();
			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.NURSING_INFORMATION,
					AppConstants.NURSING_INFORMATION);
			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
			}
			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			final short[] responseType = new short[] { IRMCResponseProfileManager.MED_TYPE_NURSING_RESP };
			SortedSet nursingDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.NURSING_INFORMATION;
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2,1,2 lines Commented Code
			 * in this block
			 */

			if (!pageId.equals(previousPageId)) {
				// just for details page testing(remove when the gate post is
				// implemented)

				nursingDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {

					pageCollection.get(FwConstants.DETAIL_KEY_BEAN);

					final CP_APP_IN_CARE_PROV_Collection nurColl = householdBO
							.loadNurDetails(appNumber);
					final CP_APP_IN_CARE_PROV_Collection newnurColl = householdBO
							.splitHospiceColl(nurColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newnurColl != null && !newnurColl.isEmpty()) {
						CP_APP_IN_CARE_PROV_Cargo appInnurCargo = null;
						final int newnurCollSize = newnurColl.size();
						rnRecordFound = true;
						for (int i = 0; i < newnurCollSize; i++) {
							appInnurCargo = newnurColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									nursingDetailsProfile, null, null,
									Short.parseShort(appInnurCargo
											.getIndv_seq_num()),
											(short) 0, categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(nursingDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the
					// detailR
					// bean
					if (nursingDetailsProfile != null
							&& !nursingDetailsProfile.isEmpty()) {
						categorySelectionProfileManager
						.setCurrentRecordIndToLast(nursingDetailsProfile);
					}
				}
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				nursingDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}
			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("Nursing_IndSeqBean");
			}
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								nursingDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.NURSING_INFORMATION);

				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(
								nursingDetailsProfile,
								appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										AppConstants.NURSING_INFORMATION, Short
										.parseShort(indivSeqBean
												.getUserEndInd()));
					}
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.updateUserEndSelInd(nursingDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.NURSING_INFORMATION, Short
												.parseShort(userEndIndicator));
					}

					categorySelectionProfileManager.makeSequenceDetailRequired(
							nursingDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.NURSING_INFORMATION);
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.NURSING_INFORMATION);
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.NURSING_INFORMATION,
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.NURSING_INFORMATION);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.ADD_NURSING.equals(indivSeqBean
								.getType())) {
							// first we are checking rnc in profile exists in
							// the ses
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}

							rmcResponseProfileManager
							.makeAddNew(
									IRMCResponseProfileManager.MED_TYPE_NURSING_RESP,
									rmcInPrflCargo, true);
							CategorySequenceDetail catseqDet = null;
							if (!nursingDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												nursingDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.NURSING_INFORMATION);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										nursingDetailsProfile,
										null,
										null,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.NURSING_INFORMATION);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean sErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;

									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.NURSING_INFORMATION
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												sErowExists = true;
												break;
											}
										}

									}
								}
								if (sErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.NURSING_INFORMATION);
								}
								categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.NURSING_INFORMATION);
								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.NURSING_INFORMATION);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.NURSING_INFORMATION };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!nursingDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													nursingDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.NURSING_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											nursingDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.NURSING_INFORMATION);
									nursingDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									nursingDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!nursingDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													nursingDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.NURSING_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											nursingDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.NURSING_INFORMATION);
									categorySelectionProfileManager
									.insertSequenceDetail(
											nursingDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.NURSING_INFORMATION);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											nursingDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.NURSING_INFORMATION);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								nursingDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								nursingDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put("Nursing_IndSeqBean", indivSeqBean);
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					nursingDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(nursingDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(nursingDetailsProfile);
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final CP_APP_IN_CARE_PROV_Collection nursingColl = householdBO
					.loadNursingcareDetails(appNumber, indvSeqNumber);

			pageCollection.put("CP_APP_IN_CARE_PROV_Collection", nursingColl);
			CP_APP_IN_CARE_PROV_Cargo cwwInHosCargo = householdBO.splithosColl(
					nursingColl, AppConstants.CWW_RECORD_IND);

			if (cwwInHosCargo == null) {
				cwwInHosCargo = new CP_APP_IN_CARE_PROV_Cargo();
			}
			pageCollection.put("SEC_NURS",
					householdBO.settingDefaultValues(cwwInHosCargo));

			CP_APP_IN_CARE_PROV_Cargo rmcInHosCargo = householdBO.splithosColl(
					nursingColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			if (rmcInHosCargo != null) {
				pageCollection.put("FST_NURS",
						householdBO.settingDefaultValues(rmcInHosCargo));

			} else {
				rmcInHosCargo = householdBO.splithosColl(nursingColl,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcInHosCargo != null) {
					pageCollection.put("FST_NURS",
							householdBO.settingDefaultValues(rmcInHosCargo));
				} else {

					rmcInHosCargo = householdBO.splithosColl(nursingColl,
							AppConstants.RMC_NEW_RECORD_IND);
					if (rmcInHosCargo != null) {
						pageCollection
						.put("FST_NURS", householdBO
								.settingDefaultValues(rmcInHosCargo));
					} else {
						pageCollection
						.put("FST_NURS", householdBO
								.settingDefaultValues(cwwInHosCargo));

					}
				}

			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (nursingColl != null && !nursingColl.isEmpty()) {
				final CP_APP_IN_CARE_PROV_Cargo appInhosCargo = nursingColl
						.getResult(0);
				srcAppInd = appInhosCargo.getSrc_app_ind();
			}
			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}
			if(rmcInHosCargo!=null && "RE".equalsIgnoreCase(rmcInHosCargo.getSrc_app_ind())){
				pageMode = "E";
			}
			if (categorySeqDetail.getUserEndSelectionInd() == 1 || "RE".equalsIgnoreCase(srcAppInd))

			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd())) // categorySeqDetail.getUserEndSelectionInd()==
				// 1)
				// userEndInd.equals(FwConstants.ONE)
				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equals(pageMode) || "E".equals(pageMode))) {
				pageMode = FwConstants.NO;
			}
			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);

			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);

			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}
			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadNursingHomeCareDetails");
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadNursingHomeCareDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadNursingHomeCareDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadNursingHomeCareDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadNursingHomeCareDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadNursingHomeCareDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store nursing home care details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeNursingHomeCareDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeNursingHomeCareDetails() - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::storeNursingHomeCareDetails:Start");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateInfo = null;
		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection

			final SortedSet innurProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final CP_APP_IN_CARE_PROV_Collection appInnurCollection = (CP_APP_IN_CARE_PROV_Collection) pageCollection
					.get("CP_APP_IN_CARE_PROV_Collection");
			CP_APP_IN_CARE_PROV_Cargo appInNursingCargo = appInnurCollection
					.getResult(0);
			beforeColl.get(AppConstants.FIRST_NAME);
			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(innurProfile);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();
			final ABHouseHoldMemberBO householdBO = new ABHouseHoldMemberBO();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			
			// Need Partner Type Code to filter Validation Messages & questions which are only needed for LTC Providers
			final String partnerTypeCd = (null != session.get(FwConstants.PARTNER_TYPE_CD)) ? session.get(FwConstants.PARTNER_TYPE_CD).toString() : null;
			boolean isLTP = false;
			if (partnerTypeCd != null && partnerTypeCd.equalsIgnoreCase(FwConstants.LTP_AGENCY_TYPE)) {
				isLTP = true;
			}
			
			validateInfo = householdBO.validateNursDetails(appInnurCollection,
					(String) beforeColl.get("PAGE_MODE"), isLTP, peopleHandler, indvSeqNum);
			if (checkBackToMyAccessSelected(request)
					|| validateInfo.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							householdBO.getMessageList());
				}
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CP_APP_IN_CARE_PROV_Collection",
						appInnurCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection.put("PEOPLE_362", beforeColl.get("PEOPLE_362"));

				if (beforeColl.containsKey("SEC_NURS")) {
					pageCollection.put("SEC_NURS", beforeColl.get("SEC_NURS"));
				}
				pageCollection.put("FST_NURS", appInNursingCargo);
				return;

			}
			appInNursingCargo.setApp_num(appNumber);
			appInNursingCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			appInNursingCargo.setSeq_num(appInnurCollection.getCargo(0)
					.getSeq_num());
			appInNursingCargo.setCare_type_cd("NH");

			final CP_APP_IN_CARE_PROV_Collection beforeAppInNurColl = (CP_APP_IN_CARE_PROV_Collection) beforeColl
					.get("CP_APP_IN_CARE_PROV_Collection");
			CP_APP_IN_CARE_PROV_Cargo beforeInNurCargo = null;

			if (appInNursingCargo.getEnd_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appInNursingCargo
							.getEnd_dt())) {
				// check history for commented code
			} else {
				appInNursingCargo.setEnd_dt(displayFormatter
						.getYYYYMMDDDate(appInNursingCargo.getEnd_dt()));
			}

			String sourceAppIndicator = null;
			String recordInd = null;

			boolean inNursingDetailsUpdate = false;
			if (beforeAppInNurColl != null && !beforeAppInNurColl.isEmpty()) {
				final int size = beforeAppInNurColl.size();
				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					sourceAppIndicator = beforeAppInNurColl.getCargo(0).getSrc_app_ind();
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInNurCargo = householdBO.splithosColl(
							beforeAppInNurColl, sourceAppIndicator);
				} else {
					// now we are checking this record is CW or RN
					sourceAppIndicator = AppConstants.CWW_RECORD_IND;
					beforeInNurCargo = householdBO.splithosColl(
							beforeAppInNurColl, sourceAppIndicator);
					if (beforeInNurCargo != null) {
						if (userEndInd == 1) {
							sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;

						} else {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						}
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInNurCargo = householdBO.splithosColl(
								beforeAppInNurColl, sourceAppIndicator);
					}
				}
				
				
				if (AppConstants.RMC_END_RECORD_IND.equals(sourceAppIndicator)) {
					appInNursingCargo.setCare_prov_org_nam(beforeInNurCargo.getCare_prov_org_nam());
					appInNursingCargo.setNur_prvd_id(beforeInNurCargo.getNur_prvd_id());
					appInNursingCargo.setNur_loc_met(beforeInNurCargo.getNur_loc_met());
					appInNursingCargo.setNur_admitted_from(beforeInNurCargo.getNur_admitted_from());
					appInNursingCargo.setNur_adm_dt(beforeInNurCargo.getNur_adm_dt());
					appInNursingCargo.setNur_hosp_adm_dt(beforeInNurCargo.getNur_hosp_adm_dt());
					appInNursingCargo.setNur_rcv_hspc_nurh(beforeInNurCargo.getNur_rcv_hspc_nurh());
					appInNursingCargo.setNur_hspc_prvd_nm(beforeInNurCargo.getNur_hspc_prvd_nm());
				}
				
				appInNursingCargo.setEcp_id(beforeInNurCargo.getEcp_id());
				appInNursingCargo.setSrc_app_ind(sourceAppIndicator);
				appInNursingCargo.setSeq_num(beforeInNurCargo.getSeq_num());
				appInNursingCargo.setRowAction(recordInd);
								
				Map changedAtrributes = appInNursingCargo.compareAttributes(beforeInNurCargo);
				
				if(!changedAtrributes.isEmpty()){
					inNursingDetailsUpdate = true;
				}

			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				appInNursingCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInNursingCargo.setRowAction(recordInd);

				inNursingDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(innurProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());
				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}
			// now we need to check the flags
			if (inNursingDetailsUpdate) {
				householdBO.storeNursingHomeCare(appInnurCollection);
			}
			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.MED_TYPE_NURSING_RESP,
							rmcInPrflCargo, true);
				}
			}
			categorySelectionProfileManager.makeSequenceDetailComplete(
					innurProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			if (categorySelectionProfileManager
					.areAllSequencesComplete(innurProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(innurProfile);
			}
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeNursingHomeCareDetails:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeNursingHomeCareDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeNursingHomeCareDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeNursingHomeCareDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeNursingHomeCareDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeNursingHomeCareDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load out of state details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadOutOfStateDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadOutOfStateDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadOutOfStateDetails:Start");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();

		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String pageMode = null;
		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final OutOfStateBenefitsBO outBO = new OutOfStateBenefitsBO();
			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.OUTOFSTATE_INFORMATION,
					AppConstants.OUTOFSTATE_INFORMATION);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.OUTSTATE_BNFTS };
			SortedSet outofstateDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.OUTOFSTATE_INFORMATION;

			if (!pageId.equals(previousPageId)) {
				outofstateDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {

					final ABHouseHoldMemberBO aBHouseHoldMemberBO = new ABHouseHoldMemberBO();
					final APP_IN_OUT_ST_BNFT_Collection outColl = aBHouseHoldMemberBO
							.loadOutStateDetailsWithAppNum(appNumber);

					final APP_IN_OUT_ST_BNFT_Collection newoutColl = outBO
							.splitOutOfStateColl(outColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newoutColl != null && !newoutColl.isEmpty()) {
						APP_IN_OUT_ST_BNFT_Cargo appInOutCargo = null;
						final int newOutCollSize = newoutColl.size();
						rnRecordFound = true;

						for (int i = 0; i < newOutCollSize; i++) {
							appInOutCargo = newoutColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									outofstateDetailsProfile, null,
									null,
									Short.parseShort(appInOutCargo
											.getIndv_seq_num()),
											(short) 0, categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(outofstateDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(outofstateDetailsProfile);
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				outofstateDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("OutofState_IndSeqBean");
			}

			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								outofstateDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.OUTOFSTATE_INFORMATION);

				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.updateUserEndSelInd(outofstateDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.OUTOFSTATE_INFORMATION,
												Short.parseShort(userEndIndicator));
					}

					categorySelectionProfileManager.makeSequenceDetailRequired(
							outofstateDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.OUTOFSTATE_INFORMATION);

					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.OUTOFSTATE_INFORMATION);

					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}

							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber,
									Short.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.OUTOFSTATE_INFORMATION,
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.OUTOFSTATE_INFORMATION);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.OUTOFSTATE_INFORMATION.equals(indivSeqBean
								.getType())) {
							// first we are checking rnc in profile exists in
							// the sess
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}

							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}

							rmcResponseProfileManager.makeAddNew(
									IRMCResponseProfileManager.OUTSTATE_BNFTS,
									rmcInPrflCargo, true);

							CategorySequenceDetail catseqDet = null;
							if (!outofstateDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												outofstateDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.OUTOFSTATE_INFORMATION);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										outofstateDetailsProfile,
										appNumber,
										 AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.OUTOFSTATE_INFORMATION);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean sErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;
									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.OUTOFSTATE_INFORMATION
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												sErowExists = true;
												break;
											}
										}

									}
								}

								if (sErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.OUTOFSTATE_INFORMATION);
									categorySelectionProfileManager
									.insertExistingSequenceDetail(
											categorySelectionProfile,
											null,
											AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													0,
													AppConstants.OUTOFSTATE_INFORMATION);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											categorySelectionProfile,
											appNumber,
											AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.OUTOFSTATE_INFORMATION);
								}

								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.OUTOFSTATE_INFORMATION);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.OUTOFSTATE_INFORMATION };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!outofstateDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													outofstateDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.OUTOFSTATE_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											outofstateDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.OUTOFSTATE_INFORMATION);
									outofstateDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									outofstateDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!outofstateDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													outofstateDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.OUTOFSTATE_INFORMATION);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											outofstateDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.OUTOFSTATE_INFORMATION);
									categorySelectionProfileManager
									.insertSequenceDetail(
											outofstateDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.OUTOFSTATE_INFORMATION);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											outofstateDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.OUTOFSTATE_INFORMATION);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								outofstateDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								outofstateDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}

				session.put("OutofState_IndSeqBean", indivSeqBean);
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					outofstateDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(outofstateDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(outofstateDetailsProfile);
			}

			categorySeqDetail.getCategoryType();

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());
			final APP_IN_OUT_ST_BNFT_Collection appInoutColl = outBO
					.loadOutDetails(appNumber, indvSeqNumber);
			APP_IN_OUT_ST_BNFT_Cargo fstCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			APP_IN_OUT_ST_BNFT_Cargo secCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			for (int z = 0; z < appInoutColl.size(); z++) {
				final APP_IN_OUT_ST_BNFT_Cargo tempCargo = appInoutColl
						.getCargo(z);
				if ("AC".equals(tempCargo.getFb_curr_rcv_out_of_st_bnft_ind())) {
					fstCargo = tempCargo;
				} else if ("AC".equals(tempCargo
						.getFma_curr_rcv_out_of_st_bnft_ind())) {
					secCargo = tempCargo;
				} else if ("AC".equals(tempCargo
						.getTanf_curr_rcv_out_of_st_bnft_ind())) {
				}
			}
			pageCollection.put("APP_IN_OUT_ST_BNFT_Collection", appInoutColl);

			APP_IN_OUT_ST_BNFT_Cargo cwwInMedCargo = outBO.splitOutOfColl(
					appInoutColl, AppConstants.CWW_RECORD_IND);

			if (cwwInMedCargo == null) {
				cwwInMedCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			}

			pageCollection.put("SEC_OUTS", secCargo);

			APP_IN_OUT_ST_BNFT_Cargo rmcInOutCargo = outBO.splitOutOfColl(
					appInoutColl, AppConstants.RMC_MODIFIED_RECORD_IND);

			outBO.loadOutDetails(appNumber, indvSeqNumber);
			final APP_IN_OUT_ST_BNFT_Collection appInFsColl = outBO
					.loadOutOfStateDetails(appNumber, indvSeqNumber,
							AppConstants.FS);
			final APP_IN_OUT_ST_BNFT_Collection appInMaColl = outBO
					.loadOutOfStateDetails(appNumber, indvSeqNumber,
							AppConstants.MA);
			final APP_IN_OUT_ST_BNFT_Collection appInTfColl = outBO
					.loadOutOfStateDetails(appNumber, indvSeqNumber,
							AppConstants.TF);

			APP_IN_OUT_ST_BNFT_Cargo cwFsCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			APP_IN_OUT_ST_BNFT_Cargo cwMaCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			APP_IN_OUT_ST_BNFT_Cargo cwTfCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			APP_IN_OUT_ST_BNFT_Cargo fstFsCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			APP_IN_OUT_ST_BNFT_Cargo fstMaCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			APP_IN_OUT_ST_BNFT_Cargo fstTfCargo = new APP_IN_OUT_ST_BNFT_Cargo();

			if (appInFsColl != null) {
				cwFsCargo = outBO.splitOutOfColl(appInFsColl,
						AppConstants.CWW_RECORD_IND);
				if (cwFsCargo != null) {
					fstFsCargo = outBO.splitOutOfColl(appInFsColl,
							AppConstants.RMC_MODIFIED_RECORD_IND);
				} else {
					fstFsCargo = outBO.splitOutOfColl(appInFsColl,
							AppConstants.RMC_NEW_RECORD_IND);
				}
				if (fstFsCargo == null && cwFsCargo != null) {
					final Object o = cwFsCargo.clone();
					fstFsCargo = (APP_IN_OUT_ST_BNFT_Cargo) o;
				}

			}
			if (appInMaColl != null) {
				cwMaCargo = outBO.splitOutOfColl(appInMaColl,
						AppConstants.CWW_RECORD_IND);
				if (cwMaCargo != null) {
					fstMaCargo = outBO.splitOutOfColl(appInMaColl,
							AppConstants.RMC_MODIFIED_RECORD_IND);
				} else {
					fstMaCargo = outBO.splitOutOfColl(appInMaColl,
							AppConstants.RMC_NEW_RECORD_IND);
				}
				if (fstMaCargo == null && cwMaCargo != null) {
					final Object o = cwMaCargo.clone();
					fstMaCargo = (APP_IN_OUT_ST_BNFT_Cargo) o;
				}
			}
			if (appInTfColl != null) {
				cwTfCargo = outBO.splitOutOfColl(appInTfColl,
						AppConstants.CWW_RECORD_IND);
				if (cwTfCargo != null) {
					fstTfCargo = outBO.splitOutOfColl(appInTfColl,
							AppConstants.RMC_MODIFIED_RECORD_IND);
				} else {
					fstTfCargo = outBO.splitOutOfColl(appInTfColl,
							AppConstants.RMC_NEW_RECORD_IND);
				}
				if (fstTfCargo == null && cwTfCargo != null) {
					final Object o = cwTfCargo.clone();
					fstTfCargo = (APP_IN_OUT_ST_BNFT_Cargo) o;
				}
			}

			// CW cargoes to display on screen right for change mode
			pageCollection.put("SEC_FS", cwFsCargo);
			pageCollection.put("SEC_MA", cwMaCargo);
			pageCollection.put("SEC_TF", cwTfCargo);
			//
			if (fstFsCargo == null) {
				fstFsCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			}
			if (fstMaCargo == null) {
				fstMaCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			}
			if (fstTfCargo == null) {
				fstTfCargo = new APP_IN_OUT_ST_BNFT_Cargo();
			}
			pageCollection.put("FST_FS", fstFsCargo);
			pageCollection.put("FST_MA", fstMaCargo);
			pageCollection.put("FST_TF", fstTfCargo);

			boolean isChangeRecord = false;

			if (cwFsCargo != null || cwMaCargo != null || cwTfCargo != null) {
				isChangeRecord = true;
			}

			if (rmcInOutCargo != null) {
				pageCollection.put("FST_OUTS",
						outBO.settingDefaultValues(rmcInOutCargo));

			} else {
				rmcInOutCargo = outBO.splitOutOfColl(appInoutColl,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcInOutCargo != null) {
					pageCollection.put("FST_OUTS",
							outBO.settingDefaultValues(rmcInOutCargo));
				} else {

					rmcInOutCargo = outBO.splitOutOfColl(appInoutColl,
							AppConstants.RMC_NEW_RECORD_IND);
					if (rmcInOutCargo != null) {
						pageCollection.put("FST_OUTS",
								outBO.settingDefaultValues(rmcInOutCargo));
					} else {
						pageCollection.put("FST_OUTS",
								outBO.settingDefaultValues(cwwInMedCargo));

					}
				}

			}
			pageCollection.put("FST_OUTS", fstCargo);
			if (appInoutColl != null && !appInoutColl.isEmpty()) {
				final APP_IN_OUT_ST_BNFT_Cargo appInOutCargo = appInoutColl
						.getResult(0);
				appInOutCargo.getSrc_app_ind();
			}

			if (isChangeRecord) {
				pageMode = "C";
			} else {
				pageMode = FwConstants.NO;
			}

			pageCollection.put("PAGE_MODE", pageMode);
			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadOutOfStateDetails:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadOutOfStateDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadOutOfStateDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadOutOfStateDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadOutOfStateDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadOutOfStateDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store out of state details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeOutOfStateDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeOutOfStateDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeOutOfStateDetails:Start");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;

		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateInfo = null;
		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection

			final SortedSet inOutProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final APP_IN_OUT_ST_BNFT_Collection appInoutCollection = (APP_IN_OUT_ST_BNFT_Collection) pageCollection
					.get("APP_IN_OUT_ST_BNFT_Collection");
			APP_IN_OUT_ST_BNFT_Cargo appInOutOfstateCargo = appInoutCollection
					.getResult(0);
			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inOutProfile);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();
			final OutOfStateBenefitsBO outBO = new OutOfStateBenefitsBO();
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			validateInfo = outBO.validateOutofStateDetails(
					appInOutOfstateCargo, peopleHandler, indvSeqNum,
					(String) beforeColl.get("PAGE_MODE"));

			if (checkBackToMyAccessSelected(request)
					|| validateInfo.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							outBO.getMessageList());
				}

				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("APP_IN_OUT_ST_BNFT_Collection",
						appInoutCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection.put("PEOPLE_362", beforeColl.get("PEOPLE_362"));
				if (beforeColl.containsKey("SEC_OUTS")) {
					pageCollection.put("SEC_OUTS", beforeColl.get("SEC_OUTS"));
				}
				if (beforeColl.containsKey("SEC_FS")) {
					pageCollection.put("SEC_FS", beforeColl.get("SEC_FS"));
				}
				if (beforeColl.containsKey("SEC_MA")) {
					pageCollection.put("SEC_MA", beforeColl.get("SEC_MA"));
				}
				if (beforeColl.containsKey("SEC_TF")) {
					pageCollection.put("SEC_TF", beforeColl.get("SEC_TF"));
				}
				pageCollection.put("FST_OUTS", appInOutOfstateCargo);
				final APP_IN_OUT_ST_BNFT_Cargo fstFs = (APP_IN_OUT_ST_BNFT_Cargo) beforeColl
						.get("FST_FS");
				final APP_IN_OUT_ST_BNFT_Cargo fstMa = (APP_IN_OUT_ST_BNFT_Cargo) beforeColl
						.get("FST_MA");
				final APP_IN_OUT_ST_BNFT_Cargo fstTf = (APP_IN_OUT_ST_BNFT_Cargo) beforeColl
						.get("FST_TF");
				if (appInOutOfstateCargo != null) {
					if (appInOutOfstateCargo
							.getFb_curr_rcv_out_of_st_bnft_ind() != null) {
						fstFs.setFb_curr_rcv_out_of_st_bnft_ind(appInOutOfstateCargo
								.getFb_curr_rcv_out_of_st_bnft_ind());
					}
					if (appInOutOfstateCargo.getFb_out_of_st_bnft_sta_cd() != null) {
						fstFs.setFb_out_of_st_bnft_sta_cd(appInOutOfstateCargo
								.getFb_out_of_st_bnft_sta_cd());
					}
					if (appInOutOfstateCargo.getFb_rcv_out_of_st_bnft_date() != null) {
						fstFs.setFb_rcv_out_of_st_bnft_date(appInOutOfstateCargo
								.getFb_rcv_out_of_st_bnft_date());
					}
					if (appInOutOfstateCargo
							.getFma_curr_rcv_out_of_st_bnft_ind() != null) {
						fstMa.setFma_curr_rcv_out_of_st_bnft_ind(appInOutOfstateCargo
								.getFma_curr_rcv_out_of_st_bnft_ind());
					}
					if (appInOutOfstateCargo.getFma_out_of_st_bnft_sta_cd() != null) {
						fstMa.setFma_out_of_st_bnft_sta_cd(appInOutOfstateCargo
								.getFma_out_of_st_bnft_sta_cd());
					}
					if (appInOutOfstateCargo.getFma_rcv_out_of_st_bnft_date() != null) {
						fstMa.setFma_rcv_out_of_st_bnft_date(appInOutOfstateCargo
								.getFma_rcv_out_of_st_bnft_date());
					}
					if (appInOutOfstateCargo
							.getTanf_curr_rcv_out_of_st_bnft_ind() != null) {
						fstTf.setTanf_curr_rcv_out_of_st_bnft_ind(appInOutOfstateCargo
								.getTanf_curr_rcv_out_of_st_bnft_ind());
					}
					if (appInOutOfstateCargo.getTanf_out_of_st_bnft_sta_cd() != null) {
						fstTf.setTanf_out_of_st_bnft_sta_cd(appInOutOfstateCargo
								.getTanf_out_of_st_bnft_sta_cd());
					}
					if (appInOutOfstateCargo.getTanf_rcv_out_of_st_bnft_date() != null) {
						fstTf.setTanf_rcv_out_of_st_bnft_date(appInOutOfstateCargo
								.getTanf_rcv_out_of_st_bnft_date());
					}

				}
				pageCollection.put("FST_FS", fstFs);
				pageCollection.put("FST_MA", fstMa);
				pageCollection.put("FST_TF", fstTf);
				return;

			}

			appInOutOfstateCargo.setApp_num(appNumber);
			appInOutOfstateCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			if (appInOutOfstateCargo.getFb_rcv_out_of_st_bnft_date() != null
					&& !FwConstants.EMPTY_STRING.equals(appInOutOfstateCargo
							.getFb_rcv_out_of_st_bnft_date())) {

				appInOutOfstateCargo
				.setFb_rcv_out_of_st_bnft_date(displayFormatter
						.getYYYYMMDDDate(appInOutOfstateCargo
								.getFb_rcv_out_of_st_bnft_date()));
			}

			if (appInOutOfstateCargo.getFma_rcv_out_of_st_bnft_date() != null
					&& !FwConstants.EMPTY_STRING.equals(appInOutOfstateCargo
							.getFma_rcv_out_of_st_bnft_date())) {

				appInOutOfstateCargo
				.setFma_rcv_out_of_st_bnft_date(displayFormatter
						.getYYYYMMDDDate(appInOutOfstateCargo
								.getFma_rcv_out_of_st_bnft_date()));
			}

			if (appInOutOfstateCargo.getTanf_rcv_out_of_st_bnft_date() != null
					&& !FwConstants.EMPTY_STRING.equals(appInOutOfstateCargo
							.getTanf_rcv_out_of_st_bnft_date())) {

				appInOutOfstateCargo
				.setTanf_rcv_out_of_st_bnft_date(displayFormatter
						.getYYYYMMDDDate(appInOutOfstateCargo
								.getTanf_rcv_out_of_st_bnft_date()));
			}

			if (appInOutOfstateCargo.getFb_end_date() != null
					&& !FwConstants.EMPTY_STRING.equals(appInOutOfstateCargo
							.getFb_end_date())) {

				appInOutOfstateCargo
				.setFb_end_date(displayFormatter
						.getYYYYMMDDDate(appInOutOfstateCargo
								.getFb_end_date()));
			}

			if (appInOutOfstateCargo.getFma_end_date() != null
					&& !FwConstants.EMPTY_STRING.equals(appInOutOfstateCargo
							.getFma_end_date())) {

				appInOutOfstateCargo
				.setFma_end_date(displayFormatter
						.getYYYYMMDDDate(appInOutOfstateCargo
								.getFma_end_date()));
			}

			if (appInOutOfstateCargo.getTanf_end_date() != null
					&& !FwConstants.EMPTY_STRING.equals(appInOutOfstateCargo
							.getTanf_end_date())) {

				appInOutOfstateCargo.setTanf_end_date(displayFormatter
						.getYYYYMMDDDate(appInOutOfstateCargo
								.getTanf_end_date()));
			}

			final APP_IN_OUT_ST_BNFT_Collection beforeAppInoutColl = (APP_IN_OUT_ST_BNFT_Collection) beforeColl
					.get("APP_IN_OUT_ST_BNFT_Collection");
			APP_IN_OUT_ST_BNFT_Cargo beforeInOutCargo = null;

			String sourceAppIndicator = null;
			String recordInd = null;

			if (beforeAppInoutColl != null && !beforeAppInoutColl.isEmpty()) {
				final int size = beforeAppInoutColl.size();
				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInOutCargo = outBO.splitOutOfColl(beforeAppInoutColl,
							sourceAppIndicator);
				} else {
					// now we are checking this record is CW or RN
					sourceAppIndicator = AppConstants.CWW_RECORD_IND;
					beforeInOutCargo = outBO.splitOutOfColl(beforeAppInoutColl,
							sourceAppIndicator);
					if (beforeInOutCargo != null) {

						if (userEndInd == 1) {
							sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;

						} else {
							sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
							recordInd = FwConstants.ROWACTION_INSERT;
						}
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInOutCargo = outBO.splitOutOfColl(
								beforeAppInoutColl, sourceAppIndicator);
					}
				}
				// check dirty
				appInOutOfstateCargo = (APP_IN_OUT_ST_BNFT_Cargo) isChanged(
						beforeInOutCargo, appInOutOfstateCargo);

				appInOutOfstateCargo.setSrc_app_ind(sourceAppIndicator);
				appInOutOfstateCargo.setRowAction(recordInd);

				if (appInOutOfstateCargo.isDirty()) {
				}
			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				appInOutOfstateCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInOutOfstateCargo.setRowAction(recordInd);

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inOutProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());
				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}

			// new three cargo logic trials start

			final APP_IN_OUT_ST_BNFT_Collection appInFsColl = outBO
					.loadOutOfStateDetails(appNumber,
							String.valueOf(indvSeqNum), AppConstants.FS);
			final APP_IN_OUT_ST_BNFT_Collection appInMaColl = outBO
					.loadOutOfStateDetails(appNumber,
							String.valueOf(indvSeqNum), AppConstants.MA);
			final APP_IN_OUT_ST_BNFT_Collection appInTfColl = outBO
					.loadOutOfStateDetails(appNumber,
							String.valueOf(indvSeqNum), AppConstants.TF);
			final APP_IN_OUT_ST_BNFT_Collection persistanceCollection = new APP_IN_OUT_ST_BNFT_Collection();
			final String fsState = appInOutOfstateCargo
					.getFb_out_of_st_bnft_sta_cd();
			boolean cargoChanged = false;
			if (fsState != null && !fsState.isEmpty()
					&& !AppConstants.SEL.equals(fsState)) {
				final APP_IN_OUT_ST_BNFT_Cargo fsCargo = new APP_IN_OUT_ST_BNFT_Cargo();
				fsCargo.setApp_num(appNumber);
				fsCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
				fsCargo.setFb_out_of_st_bnft_sta_cd(fsState);
				fsCargo.setFb_curr_rcv_out_of_st_bnft_ind(appInOutOfstateCargo
						.getFb_curr_rcv_out_of_st_bnft_ind());
				fsCargo.setFb_rcv_out_of_st_bnft_date(appInOutOfstateCargo
						.getFb_rcv_out_of_st_bnft_date());
				fsCargo.setChg_dt(appInOutOfstateCargo.getChg_dt());

				if (appInFsColl == null || appInFsColl.isEmpty()) {
					cargoChanged = true;
					fsCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
					fsCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				} else {
					cargoChanged = detRowActnAndSrcAppInd(appInFsColl, fsCargo);
				}
				if (cargoChanged) {
					persistanceCollection.addCargo(fsCargo);
				}

			}

			cargoChanged = false;
			final String maState = appInOutOfstateCargo
					.getFma_out_of_st_bnft_sta_cd();
			if (maState != null && !maState.isEmpty()
					&& !AppConstants.SEL.equals(maState)) {
				final APP_IN_OUT_ST_BNFT_Cargo maCargo = new APP_IN_OUT_ST_BNFT_Cargo();
				maCargo.setApp_num(appNumber);
				maCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
				maCargo.setFma_out_of_st_bnft_sta_cd(maState);
				maCargo.setFma_curr_rcv_out_of_st_bnft_ind(appInOutOfstateCargo
						.getFma_curr_rcv_out_of_st_bnft_ind());
				maCargo.setFma_rcv_out_of_st_bnft_date(appInOutOfstateCargo
						.getFma_rcv_out_of_st_bnft_date());
				maCargo.setChg_dt(appInOutOfstateCargo.getChg_dt());

				if (appInMaColl == null || appInMaColl.isEmpty()) {
					cargoChanged = true;
					maCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
					maCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				} else {
					cargoChanged = detRowActnAndSrcAppInd(appInMaColl, maCargo);
				}

				if (cargoChanged) {
					persistanceCollection.addCargo(maCargo);
				}
			}
			cargoChanged = false;
			final String tfState = appInOutOfstateCargo
					.getTanf_out_of_st_bnft_sta_cd();
			if (tfState != null && !tfState.isEmpty()
					&& !AppConstants.SEL.equals(tfState)) {
				final APP_IN_OUT_ST_BNFT_Cargo tfCargo = new APP_IN_OUT_ST_BNFT_Cargo();
				tfCargo.setApp_num(appNumber);
				tfCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
				tfCargo.setTanf_out_of_st_bnft_sta_cd(tfState);
				tfCargo.setTanf_curr_rcv_out_of_st_bnft_ind(appInOutOfstateCargo
						.getTanf_curr_rcv_out_of_st_bnft_ind());
				tfCargo.setTanf_rcv_out_of_st_bnft_date(appInOutOfstateCargo
						.getTanf_rcv_out_of_st_bnft_date());
				tfCargo.setChg_dt(appInOutOfstateCargo.getChg_dt());

				if (appInTfColl == null || appInTfColl.isEmpty()) {
					cargoChanged = true;
					tfCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
					tfCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				} else {
					cargoChanged = detRowActnAndSrcAppInd(appInTfColl, tfCargo);
				}
				if (cargoChanged) {
					persistanceCollection.addCargo(tfCargo);
				}
			}

			if (null!=persistanceCollection && !persistanceCollection.isEmpty()) {
				persistanceCollection.persist(FwConstants.DAO);
			}
			// new three cargo logic ends

			// now i need to update the rmc_in_prfl
			/*reqInd is indicator to decide if we have complete the response profile or not
			 *  
			 * */
				short respTyp=IRMCResponseProfileManager.OUTSTATE_BNFTS;
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				boolean reqInd=false;
				if (rmcInPrflCargo != null && rmcResponseProfileManager.getProfileResponse(
						rmcInPrflCargo, respTyp).charAt(0) == IRMCResponseProfileManager.STATUS_REQUIRED) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.OUTSTATE_BNFTS,
							rmcInPrflCargo, true);
				}
			
			// Mark complete job sequence using common methods
			//if the profile response was not 'R' or if we came from gatepost then don't persist else persist
			if(!reqInd || categorySeqDetailBean.getChangeSelectionCategoryCd()==null)
			{
				categorySelectionProfileManager.makeSequenceDetailComplete(
					inOutProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			}else
			{
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inOutProfile, appNumber,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			}		
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(inOutProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inOutProfile);
			}
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeOutOfStateDetails");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeOutOfStateDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeOutOfStateDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeOutOfStateDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeOutOfStateDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeOutOfStateDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoContactDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoContactDetails() - START");
		try {
			log(ILog.INFO,
					"HousingExpenseEJBBean::loadHouseHoldInfoContactDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			APP_RGST_Collection appRgstColl;
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, pageId,
					driverArray);
			final ContactInfoBO arContactInfoBO = new ContactInfoBO();
			final ContactInfoBO contactInfoDetailsBO = new ContactInfoBO();
			appRgstColl = contactInfoDetailsBO
					.loadContactInfoDetails(appNumber);
			pageCollection.put("APP_RGST_Collection", appRgstColl);

			APP_INDV_Collection appIndvColl;
			final APP_INDV_Collection appIndvPrimColl = new APP_INDV_Collection();
			final APP_INDV_Collection appIndvPrimRMColl = new APP_INDV_Collection();
			final APP_INDV_Collection appIndvPrimCWColl = new APP_INDV_Collection();
			appIndvColl = contactInfoDetailsBO.loadIndvInfoDetails(appNumber);
			pageCollection.put("APP_INDV_Collection", appIndvColl);
			ABRegistrationBO registrationBo = new ABRegistrationBO();
			pageCollection.put(AppConstants.WIC_CLINIC_INFO, registrationBo.loadWICClncInfo());
			
			pageCollection.put(AppConstants.WIC_CLNC_NAME, registrationBo.loadWICClncName(appRgstColl.getCargo(0).getWIC_CLNC_CD()));
			for (int i = 0; i < appIndvColl.size(); i++) {
				final APP_INDV_Cargo cargo = appIndvColl.getCargo(i);
				if (AppConstants.PRIMARY_INDV_SEQ.equals(cargo
						.getIndv_seq_num())) {
					appIndvPrimColl.addCargo(cargo);
				}
			}
			if (appIndvPrimColl.size() > 1) {
				for (int i = 0; i < appIndvPrimColl.size(); i++) {
					final APP_INDV_Cargo cargo = appIndvColl.getCargo(i);
					if (AppConstants.RMC_MODIFIED_RECORD_IND.equals(cargo
							.getSrc_app_ind())) {
						appIndvPrimRMColl.addCargo(cargo);
					}
					if (AppConstants.CWW_RECORD_IND.equals(cargo
							.getSrc_app_ind())) {
						appIndvPrimCWColl.addCargo(cargo);
					}
				}
			}
			String birthDateVal = FwConstants.EMPTY_STRING;
			if (!appIndvPrimRMColl.isEmpty()) {
				if (appIndvPrimRMColl
						.getCargo(0)
						.getBrth_dt()
						.equalsIgnoreCase(
								appIndvPrimCWColl.getCargo(0).getBrth_dt())) {
					birthDateVal = AppConstants.ON_FILE;
				} else {
					birthDateVal = appIndvPrimRMColl.getCargo(0).getBrth_dt();
				}
			} else {
				birthDateVal = AppConstants.ON_FILE;
			}
			pageCollection.put("BIRTH_DATE_VAL", birthDateVal);
			pageCollection.put("APP_INDV_Collection", appIndvPrimColl);

			APP_IN_INST_Collection appInstColl;
			appInstColl = contactInfoDetailsBO.loadSLAInfoDetails(appNumber);
			pageCollection.put("APP_IN_INST_Collection", appInstColl);

			APP_IN_SPS_IMPOV_Collection appInSPSColl;
			appInSPSColl = contactInfoDetailsBO.loadSPSInfoDetails(appNumber);
			pageCollection.put("APP_IN_SPS_IMPOV_Collection", appInSPSColl);
			boolean extractiomMsgSet = false;
			FwMessageList newMsgList = null;

			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			if (beforeColl != null) {
				final FwMessageList msgList = (FwMessageList) beforeColl
						.get("CONTACT_INFO_MSG");
				if (msgList != null) {
					for (int z = 0; z < msgList.getMessageListSize(); z++) {
						final FwMessage fwMesg = msgList.getMessageAtIndex(z);
						if ("30073".equals(fwMesg.getMessageCode())) {
							newMsgList = new FwMessageList();
							newMsgList.addMessageToList(fwMesg);
							extractiomMsgSet = true;
							break;
						}
					}
				}
				if (extractiomMsgSet) {
					request.put(FwConstants.MESSAGE_LIST, newMsgList);
					pageCollection.put("CONTACT_INFO_MSG",
							beforeColl.get("CONTACT_INFO_MSG"));
				}
			}
			APP_RGST_Cargo cwwRegistrationCargo = contactInfoDetailsBO
					.splitContactInfoColl(appRgstColl,
							AppConstants.CWW_RECORD_IND);
			APP_INDV_Cargo cwwIndvCargo = contactInfoDetailsBO
					.splitIndvInfoColl(appIndvColl, AppConstants.CWW_RECORD_IND);
			final APP_IN_INST_Cargo cwwInInstCargo = contactInfoDetailsBO
					.splitInstInfoColl(appInstColl, AppConstants.CWW_RECORD_IND);
			final APP_IN_SPS_IMPOV_Cargo cwwInSPSCargo = contactInfoDetailsBO
					.splitSPSInfoColl(appInSPSColl, AppConstants.CWW_RECORD_IND);
			String cntyNum = FwConstants.EMPTY_STRING;
			String lang = FwConstants.EMPTY_STRING;
			if (cwwRegistrationCargo == null) {
				cwwRegistrationCargo = new APP_RGST_Cargo();
			} else {
				if (cwwRegistrationCargo.getCnty_num() != null) {
					cntyNum = cwwRegistrationCargo.getCnty_num();
				}
				if (cwwRegistrationCargo.getLang_cd() != null) {
					lang = cwwRegistrationCargo.getLang_cd();

				}
			}

			if (cwwIndvCargo == null) {
				cwwIndvCargo = new APP_INDV_Cargo();
			} else {
				if (cwwIndvCargo.getRes_ga_ind() != null) {
					cwwIndvCargo.getRes_ga_ind();
				}
			}

			pageCollection.put("SEC_CONTACT_DETAIL", contactInfoDetailsBO
					.settingDefaultValues(cwwRegistrationCargo));
			pageCollection.put("SEC_INDV_DETAIL",
					contactInfoDetailsBO.settingDefaultValues(cwwIndvCargo));
			pageCollection.put("SEC_INST_DETAIL",
					contactInfoDetailsBO.settingDefaultValues(cwwInInstCargo));
			pageCollection.put("SEC_SPS_DETAIL",
					contactInfoDetailsBO.settingDefaultValues(cwwInSPSCargo));

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 4,2 lines Commented Code in
			 * this block
			 */

			APP_RGST_Cargo registrationCargo = null;
			registrationCargo = contactInfoDetailsBO.splitContactInfoColl(
					appRgstColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			APP_INDV_Cargo indvCargo = null;
			indvCargo = contactInfoDetailsBO.splitIndvInfoColl(appIndvColl,
					AppConstants.RMC_MODIFIED_RECORD_IND);
			APP_IN_INST_Cargo instCargo = null;
			instCargo = contactInfoDetailsBO.splitInstInfoColl(appInstColl,
					AppConstants.RMC_MODIFIED_RECORD_IND);
			APP_IN_SPS_IMPOV_Cargo spsCargo = null;
			spsCargo = contactInfoDetailsBO.splitSPSInfoColl(appInSPSColl,
					AppConstants.RMC_MODIFIED_RECORD_IND);

			if (registrationCargo != null) {
				pageCollection
				.put("FST_CONTACT_DETAIL", arContactInfoBO
						.settingDefaultValues(registrationCargo));
			} else {
				pageCollection.put("FST_CONTACT_DETAIL", arContactInfoBO
						.settingDefaultValues(cwwRegistrationCargo));
			}
			if (indvCargo != null) {
				pageCollection.put("FST_INDV_DETAIL",
						arContactInfoBO.settingDefaultValues(indvCargo));
			} else {
				pageCollection.put("FST_INDV_DETAIL",
						arContactInfoBO.settingDefaultValues(cwwIndvCargo));
			}
			if (instCargo != null) {
				pageCollection.put("FST_INST_DETAIL",
						arContactInfoBO.settingDefaultValues(instCargo));
			} else {
				pageCollection.put("FST_INST_DETAIL",
						arContactInfoBO.settingDefaultValues(cwwInInstCargo));
			}
			if (spsCargo != null) {
				pageCollection.put("FST_SPS_DETAIL",
						arContactInfoBO.settingDefaultValues(spsCargo));
			} else {
				pageCollection.put("FST_SPS_DETAIL",
						arContactInfoBO.settingDefaultValues(cwwInSPSCargo));
			}


			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			/* run component manager */
			componentManager.getComponents("ARACD", txnBean);
			session.put("countyNum", cntyNum);
			session.put("langCd", lang);
			// Add the page collection to before collection
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);

			log(ILog.INFO,
					"HousingExpenseEJBBean::loadHouseHoldInfoContactDetails:End");

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoContactDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoContactDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoContactDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoContactDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoContactDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoContactDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoContactDetails() - START");
		try {

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeCollection = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final ARACDValidator aracdValidator = new ARACDValidator();
			PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
//			peopleHandler.getRelevantIndividuals();
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get appNumber
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			APP_INDV_Collection appIndvColl = null;
			APP_INDV_Cargo appIndvCargo = null;
			APP_RGST_Collection appRgstColl = null;
			APP_RGST_Cargo appRgstCargo = null;
			APP_IN_INST_Collection appInInstColl = null;
			APP_IN_INST_Cargo appInInstCargo = null;
			APP_IN_SPS_IMPOV_Collection appInSPSColl = null;
			APP_IN_SPS_IMPOV_Cargo appInSPSCargo = null;
			APP_RGST_Cargo appBefRgstCargo = new APP_RGST_Cargo();
			APP_RGST_Cargo appBefRgstCargoNoChange = new APP_RGST_Cargo();
			APP_INDV_Cargo appBefIndvCargo = new APP_INDV_Cargo();
			APP_INDV_Cargo appBefIndvCargoNoChange = new APP_INDV_Cargo();
			APP_IN_INST_Cargo appBefInstCargo = new APP_IN_INST_Cargo();
			APP_IN_INST_Cargo appBefInstCargoNoChange = new APP_IN_INST_Cargo();
			APP_IN_SPS_IMPOV_Cargo appBefInSPSCargo = new APP_IN_SPS_IMPOV_Cargo();
			APP_IN_SPS_IMPOV_Cargo appBefInSPSCargoNoChange = new APP_IN_SPS_IMPOV_Cargo();
			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			// before RGST
			final APP_RGST_Collection appRgstBeforeColl = (APP_RGST_Collection) beforeCollection
					.get("APP_RGST_Collection");
			if (appRgstBeforeColl != null && appRgstBeforeColl.size() > 1) {
				appBefRgstCargo = appRgstBeforeColl.getCargo(1);
				appBefRgstCargoNoChange = (APP_RGST_Cargo) appBefRgstCargo
						.clone();
			} else if (appRgstBeforeColl != null
					&& !appRgstBeforeColl.isEmpty()) {
				appBefRgstCargo = appRgstBeforeColl.getCargo(0);
				appBefRgstCargoNoChange = (APP_RGST_Cargo) appBefRgstCargo
						.clone();
			}
			// before INDV
			final APP_INDV_Collection appIndvBeforeColl = (APP_INDV_Collection) beforeCollection
					.get("APP_INDV_Collection");
			if (appIndvBeforeColl != null && appIndvBeforeColl.size() > 1) {
				appBefIndvCargo = appIndvBeforeColl.getCargo(1);
				appBefIndvCargoNoChange = (APP_INDV_Cargo) appBefIndvCargo
						.clone();
			} else if (appIndvBeforeColl != null
					&& !appIndvBeforeColl.isEmpty()) {
				appBefIndvCargo = appIndvBeforeColl.getCargo(0);
				appBefIndvCargoNoChange = (APP_INDV_Cargo) appBefIndvCargo
						.clone();
			}
			// before INST
			final APP_IN_INST_Collection appInInstBeforeColl = (APP_IN_INST_Collection) beforeCollection
					.get("APP_IN_INST_Collection");
			if (appInInstBeforeColl != null && !appInInstBeforeColl.isEmpty()) {
				appBefInstCargo = appInInstBeforeColl.getCargo(0);
				appBefInstCargoNoChange = (APP_IN_INST_Cargo) appBefInstCargo
						.clone();
			}
			// before SPS IMPOV
			final APP_IN_SPS_IMPOV_Collection appInSPSBeforeColl = (APP_IN_SPS_IMPOV_Collection) beforeCollection
					.get("APP_IN_SPS_IMPOV_Collection");
			if (appInSPSBeforeColl != null && !appInSPSBeforeColl.isEmpty()) {
				appBefInSPSCargo = appInSPSBeforeColl.getCargo(0);
				appBefInSPSCargoNoChange = (APP_IN_SPS_IMPOV_Cargo) appBefInSPSCargo
						.clone();
			}

			boolean changes = false;
			boolean gaChanges = false;
			appIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");
			appRgstColl = (APP_RGST_Collection) pageCollection
					.get("APP_RGST_Collection");
			appInInstColl = (APP_IN_INST_Collection) pageCollection
					.get("APP_IN_INST_Collection");
			appInSPSColl = (APP_IN_SPS_IMPOV_Collection) pageCollection
					.get("APP_IN_SPS_IMPOV_Collection");
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);

			// here i am getting the before collections

			if (appIndvColl != null && !appIndvColl.isEmpty()) {
				appIndvCargo = appIndvColl.getCargo(0);
			}
			if (appRgstColl != null && !appRgstColl.isEmpty()) {
				appRgstCargo = appRgstColl.getCargo(0);
			}

			if (appInInstColl != null && !appInInstColl.isEmpty()) {
				appInInstCargo = appInInstColl.getCargo(0);
			}
			if (appInSPSColl != null && !appInSPSColl.isEmpty()) {
				appInSPSCargo = appInSPSColl.getCargo(0);
			}
			/** removing default drop down values from page cargo.*/
			if(appRgstCargo!=null){
				if("SEL".equalsIgnoreCase(appRgstCargo.getPast_state_cd())){
					appRgstCargo.setPast_state_cd(null);
				}
				if("000".equalsIgnoreCase(appRgstCargo.getPref_cont_time_cd())){
					appRgstCargo.setPref_cont_time_cd(null);
				}
				if("000".equalsIgnoreCase(appRgstCargo.getPref_cont_method_cd())){
					appRgstCargo.setPref_cont_method_cd(null);
				}
				if("000".equalsIgnoreCase(appRgstCargo.getPref_deaf_cont_method_cd())){
					appRgstCargo.setPref_deaf_cont_method_cd(null);
				}
			}
			/** start: mailing address change indicator.*/
			try {
				final RMC_RQST_Collection rmcRqstCollection = new RMC_RQST_Collection();
				RMC_RQST_Cargo cargo = new RMC_RQST_Cargo();
				cargo.setApp_num(appBefRgstCargo.getApp_num());
				rmcRqstCollection.add(cargo);
				AbstractCargo[] cargos=null;
				String appType="";
				cargos = (RMC_RQST_Cargo[]) rmcRqstCollection
						.select(FwConstants.DAO, "findByAppNum");
				if (cargos != null && cargos.length > 0) {
					appType = "RMC";
				} else {
					RMB_RQST_Collection collection = new RMB_RQST_Collection();
					RMB_RQST_Cargo rmbCargo = new RMB_RQST_Cargo();
					rmbCargo.setApp_num(appBefRgstCargo.getApp_num());
					collection.add(rmbCargo);
					cargos = (RMB_RQST_Cargo[]) collection.select(
							FwConstants.DAO, "findByAppNum");
					if (cargos != null && cargos.length > 0) {
						appType = "RMB";
					}
				}
				if ("RMC".equals(appType)) {
					if (cargos != null && cargos.length > 0) {
						cargo = (RMC_RQST_Cargo) cargos[0];
						String addressStatus = mailingAddressInd(
								appBefRgstCargo, appRgstCargo);
						if ("New".equals(addressStatus)) {
							cargo.setMailAddrAddInd(FwConstants.YES);
						} else {
							cargo.setMailAddrAddInd(FwConstants.NO);
						}
						if ("Changed".equals(addressStatus)) {
							cargo.setMailAddrChgInd(FwConstants.YES);
						} else {
							cargo.setMailAddrChgInd(FwConstants.NO);
						}
						rmcRqstCollection.clear();
						cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						rmcRqstCollection.add(cargo);
						rmcRqstCollection.persist(FwConstants.DAO);
					}
				} else if ("RMB".equals(appType)) {
					RMB_RQST_Collection collection = (RMB_RQST_Collection) session
							.get(AppConstants.RMB_RQST_COLLECTION);
					if(collection==null){
						collection=new RMB_RQST_Collection();
						session
						.put(AppConstants.RMB_RQST_COLLECTION,collection);
					}
					if (cargos != null && cargos.length > 0) {
						RMB_RQST_Cargo rmbCargo = (RMB_RQST_Cargo) cargos[0];
						String addressStatus = mailingAddressInd(
								appBefRgstCargo, appRgstCargo);
						if ("New".equals(addressStatus)) {
							rmbCargo.setMailAddrAddInd(FwConstants.YES);
						} else {
							rmbCargo.setMailAddrAddInd(FwConstants.NO);
						}
						if ("Changed".equals(addressStatus)) {
							rmbCargo.setMailAddrChgInd(FwConstants.YES);
						} else {
							rmbCargo.setMailAddrChgInd(FwConstants.NO);
						}
						collection.clear();
						rmbCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						collection.add(rmbCargo);
						collection.persist(FwConstants.DAO);
					}
				}
			} catch (Exception e) {
				rmcHouseHoldInfoEJBBean.exceptionManagerLog(e, getClass().getName(), "storeHouseHoldInfoContactDetails");
			}
			/** end: mailing address change indicator.*/
			if (appBefRgstCargo != null && appRgstCargo != null) {
				if (!appBefRgstCargo.getHshl_l1_adr().trim()
						.equals(appRgstCargo.getHshl_l1_adr().trim())
						|| !appBefRgstCargo.getHshl_l2_adr().trim()
						.equals(appRgstCargo.getHshl_l2_adr().trim())
						|| !appBefRgstCargo.getHshl_city_adr().trim()
						.equals(appRgstCargo.getHshl_city_adr().trim())
						|| !appBefRgstCargo.getHshl_sta_adr().trim()
						.equals(appRgstCargo.getHshl_sta_adr().trim())
						|| !appBefRgstCargo.getHshl_zip_adr().trim()
						.equals(appRgstCargo.getHshl_zip_adr().trim())
						|| !appBefRgstCargo.getCnty_num().trim()
						.equals(appRgstCargo.getCnty_num().trim())) {
					changes = true;
				}
			}

			if (appBefIndvCargo != null && appIndvCargo != null
					&& null != appBefIndvCargo.getRes_ga_ind()
					&& null != appIndvCargo.getRes_ga_ind()) {
				if (!appBefIndvCargo.getRes_ga_ind().trim()
						.equals(appIndvCargo.getRes_ga_ind().trim())) {
					gaChanges = true;
				}
			}
			
			if(appIndvCargo!=null && null != appIndvCargo.getLiving_arrangement_cd()){
				if (appBefIndvCargo != null && null != appBefIndvCargo.getLiving_arrangement_cd() && !appBefIndvCargo.getLiving_arrangement_cd().trim()
						.equals(appIndvCargo.getLiving_arrangement_cd().trim())) {
					appBefIndvCargo.setLiving_arrangement_cd(appIndvCargo.getLiving_arrangement_cd());
					appRgstCargo.setLiving_arrangement_cd(appIndvCargo.getLiving_arrangement_cd());
				}
				appRgstCargo.setLiving_arrangement_cd(appIndvCargo.getLiving_arrangement_cd());
			}

			boolean rmcFlag = false;
			if (session != null
					&& session.get(FwConstants.ACCESS_APPLICATION_TYPE) != null
					&& session.get(FwConstants.ACCESS_APPLICATION_TYPE).equals(
							String.valueOf(FwConstants.RMC_APP_TYPE))) {
				rmcFlag = true;
				appRgstCargo.setLang_cd(appBefRgstCargo.getLang_cd());
			}

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			if (backToMyAccess == null) {
				// Justin: WR 17727 - if birth date is "ON_FILE" get the real
				// birth date from before cargo before we validate
				if (appIndvCargo.getBrth_dt() != null
						&& AppConstants.ON_FILE.equals(appIndvCargo
								.getBrth_dt())
								&& appBefIndvCargo.getBrth_dt() != null) {
					final String birthDateYYYYMMDD = appBefIndvCargo
							.getBrth_dt();
					final String[] tempDate = birthDateYYYYMMDD
							.split(FwConstants.SPACE);
					final String[] birthDateTokens = tempDate[0].split("-");
					final String birthdateMMDDYYYY = birthDateTokens[1] + "/"
							+ birthDateTokens[2] + "/" + birthDateTokens[0];
					appIndvCargo.setBrth_dt(birthdateMMDDYYYY);
				}
				if (rmcFlag) {
					aracdValidator.validateRMCRegistrationInformation(
							appRgstCargo, appIndvCargo, appInInstCargo,
							appInSPSCargo);
				} else {
					boolean contactInfochange = false;
					APP_RGST_Cargo cloneCargo = (APP_RGST_Cargo) appBefRgstCargo.clone();
					
					if(cloneCargo.getAlt_st_adr()== null)
                        cloneCargo.setAlt_st_adr("");
                    if(cloneCargo.getAlt_l2_adr()== null)
                        cloneCargo.setAlt_l2_adr("");
                    if(cloneCargo.getAlt_city_adr()== null)
                        cloneCargo.setAlt_city_adr("");
					if(cloneCargo.getAlt_sta_adr()== null)
					    cloneCargo.setAlt_sta_adr("SEL");
					if(cloneCargo.getAlt_zip_adr()== null)
                        cloneCargo.setAlt_zip_adr("");
					if(cloneCargo.getAltAddrZip4()== null)
                        cloneCargo.setAltAddrZip4("");
					
					Map chgMap = appRgstCargo.compareAttributes(cloneCargo);
					//Ignore fields
					chgMap.remove("rec_cplt_ind");
					chgMap.remove("hshl_indv_ct");
					chgMap.remove("days_at_address_num");
					chgMap.remove("ebt_card_resp");
					chgMap.remove("appTyp");
					chgMap.remove("src_app_ind");
					chgMap.remove("msg_phn_num");
					chgMap.remove("chg_eff_dt");
					chgMap.remove("lang_cd");
					chgMap.remove("home_addr_chg_begin_dt");
					chgMap.remove("app_num");
					chgMap.remove("pref_cntc_ind");
					chgMap.remove("mail_addr_chg_begin_dt");
					chgMap.remove("chg_dt");
					
					if(chgMap != null && !chgMap.isEmpty())
						 contactInfochange = true;
					String aabType = session.get(FwConstants.AAB_APP_TYPE) != null? (String)session.get(FwConstants.AAB_APP_TYPE) : "" ;
					
					aracdValidator.validateRegistrationInformation(
							appRgstCargo, appIndvCargo, appInInstCargo,
							appInSPSCargo,contactInfochange,programKey,aabType);
				}
			}

			if (checkBackToMyAccessSelected(request)
					|| aracdValidator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				if (!checkForWarningMesgs(reqWarningMsgs,
						aracdValidator.getMessageList())) {
					if (backToMyAccess == null) {
						request.put(FwConstants.MESSAGE_LIST,
								aracdValidator.getMessageList());
					}
					if (appRgstBeforeColl != null
							&& !appRgstBeforeColl.isEmpty()) {
						appBefRgstCargo = appRgstBeforeColl.getCargo(0);
					}
					if (appIndvBeforeColl != null
							&& !appIndvBeforeColl.isEmpty()) {
						appBefIndvCargo = appIndvBeforeColl.getCargo(0);
					}
					pageCollection.put("APP_INDV_Collection", appIndvColl);
					pageCollection.put("APP_RGST_Collection", appRgstColl);
					pageCollection.put("SEC_CONTACT_DETAIL", appBefRgstCargo);
					pageCollection.put("SEC_INDV_DETAIL", appBefIndvCargo);
					// EDSP Starts
					pageCollection.put("APP_IN_INST_Collection", appInInstColl);
					pageCollection.put("APP_IN_SPS_IMPOV_Collection",
							appInSPSColl);
					pageCollection.put("BIRTH_DATE_VAL",
							beforeCollection.get("BIRTH_DATE_VAL"));
					// EDSP Ends
					pageCollection.put(AppConstants.WIC_CLINIC_INFO, beforeCollection.get(AppConstants.WIC_CLINIC_INFO));
					pageCollection.put(AppConstants.WIC_CLNC_NAME, beforeCollection.get(AppConstants.WIC_CLNC_NAME));
					txnBean.setRequest(request);
					txnBean.setPageCollection(pageCollection);
					return;
				}
			}

			appBefRgstCargo.setLang_cd(appRgstCargo.getLang_cd());
			appBefRgstCargo.setCnty_num(appRgstCargo.getCnty_num());

			appBefRgstCargo.setHshl_l1_adr(appRgstCargo.getHshl_l1_adr());
			appBefRgstCargo.setHshl_l2_adr(appRgstCargo.getHshl_l2_adr());
			appBefRgstCargo.setHshl_city_adr(appRgstCargo.getHshl_city_adr());
			if (FwConstants.DEFAULT_DROPDOWN_SEL.equalsIgnoreCase(appRgstCargo
					.getHshl_sta_adr())) {
				appBefRgstCargo.setHshl_sta_adr(FwConstants.SPACE);
			} else {
				appBefRgstCargo.setHshl_sta_adr(appRgstCargo.getHshl_sta_adr());
			}
			appBefRgstCargo.setHshl_zip_adr(appRgstCargo.getHshl_zip_adr());
			appBefRgstCargo.setHshlAddrZip4(appRgstCargo.getHshlAddrZip4());
			appBefRgstCargo.setAlt_st_adr(appRgstCargo.getAlt_st_adr());
			appBefRgstCargo.setAlt_l2_adr(appRgstCargo.getAlt_l2_adr());
			appBefRgstCargo.setAlt_city_adr(appRgstCargo.getAlt_city_adr());
			appBefRgstCargo.setAlt_sta_adr(appRgstCargo.getAlt_sta_adr());
			if (appRgstCargo.getAlt_zip_adr() != null
					&& FwConstants.EMPTY_STRING.equals(appRgstCargo
							.getAlt_zip_adr())) {
				appRgstCargo.setAlt_zip_adr(null);
			}
			appBefRgstCargo.setAlt_zip_adr(appRgstCargo.getAlt_zip_adr());
			appBefRgstCargo.setAltAddrZip4(appRgstCargo.getAltAddrZip4());
			appBefRgstCargo.setHshl_home_phn_num(appRgstCargo
					.getHshl_home_phn_num());
			appBefRgstCargo.setHshl_work_phn_num(appRgstCargo
					.getHshl_work_phn_num());
			appBefRgstCargo.setWork_phn_extn_num(appRgstCargo
					.getWork_phn_extn_num());
			appBefRgstCargo.setHshl_cell_phn_num(appRgstCargo
					.getHshl_cell_phn_num());
			appBefRgstCargo.setHshl_email_adr(appRgstCargo.getHshl_email_adr());
			appBefRgstCargo.setPref_cont_method_cd(appRgstCargo
					.getPref_cont_method_cd());
			appBefRgstCargo.setLiving_arrangement_cd(appRgstCargo
					.getLiving_arrangement_cd());
			appBefRgstCargo.setPast_state_cd(appRgstCargo.getPast_state_cd());
			appBefRgstCargo.setPast_county_cd(appRgstCargo.getPast_county_cd());
			appBefRgstCargo.setHshl_past_addr_ind(appRgstCargo
					.getHshl_past_addr_ind());
			appBefRgstCargo.setPref_deaf_cont_method_cd(appRgstCargo
					.getPref_deaf_cont_method_cd());
			appBefRgstCargo.setPref_cont_time_cd(appRgstCargo
					.getPref_cont_time_cd());
			appBefRgstCargo.setChg_dt(appRgstCargo.getChg_dt());
			appBefRgstCargo.setWIC_CLNC_CNTY(appRgstCargo.getWIC_CLNC_CNTY());
			appBefRgstCargo.setWIC_CLNC_CD(appRgstCargo.getWIC_CLNC_CD());
			if(appRgstCargo.getWic_dsclsr() != null)
			    appBefRgstCargo.setWic_dsclsr(appRgstCargo.getWic_dsclsr());

			if (appRgstCargo.getHome_addr_chg_begin_dt() == null
					|| FwConstants.EMPTY_STRING.equals(appRgstCargo
							.getHome_addr_chg_begin_dt())) {
				/*appBefRgstCargo.setHome_addr_chg_begin_dt("9999-12-31");*/
			} else {
				appBefRgstCargo.setHome_addr_chg_begin_dt(displayFormatter
						.getYYYYMMDDDate(appRgstCargo
								.getHome_addr_chg_begin_dt()));
			}

			if (gaChanges) {
				appBefIndvCargo.setRes_ga_ind(appIndvCargo.getRes_ga_ind());
			}

			if (!rmcFlag) {
				appBefInstCargo.setOrig_inst_dt(appInInstCargo
						.getOrig_inst_dt());
				appBefInstCargo.setInstitution_county_city_name(appInInstCargo
						.getInstitution_county_city_name());
				if (appInInstCargo.getBefore_moving_spcl_arrgment_cd() != null
						&& FwConstants.DEFAULT_DROPDOWN_SEL
						.equals(appInInstCargo
								.getBefore_moving_spcl_arrgment_cd())) {
					appBefInstCargo
					.setBefore_moving_spcl_arrgment_cd(FwConstants.EMPTY_STRING);
				} else {
					appBefInstCargo
					.setBefore_moving_spcl_arrgment_cd(appInInstCargo
							.getBefore_moving_spcl_arrgment_cd());
				}
				if (appInInstCargo.getPlaced_by_gov_agency_ind() != null
						&& FwConstants.EMPTY_STRING.equals(appInInstCargo
								.getPlaced_by_gov_agency_ind())) {
					appBefInstCargo
					.setPlaced_by_gov_agency_ind(FwConstants.EMPTY_STRING);
				} else {
					appBefInstCargo.setPlaced_by_gov_agency_ind(appInInstCargo
							.getPlaced_by_gov_agency_ind());
				}

				if (appBefIndvCargo.getIndv_seq_num() != null) {
					appBefInSPSCargo.setIndv_seq_num(appBefIndvCargo
							.getIndv_seq_num());
				} else {
					appBefInSPSCargo.setIndv_seq_num(FwConstants.ONE);
				}
				appBefInSPSCargo.setApp_num(appBefIndvCargo.getApp_num());
				if (appInSPSCargo.getSpouse_out_of_home_ind() != null
						&& FwConstants.YES.equalsIgnoreCase(appInSPSCargo
								.getSpouse_out_of_home_ind())) {
					appBefInSPSCargo.setSpouse_out_of_home_ind(appInSPSCargo
							.getSpouse_out_of_home_ind());
					appBefInSPSCargo.setSpouse_name(appInSPSCargo
							.getSpouse_name());
					appBefInSPSCargo.setSps_l1_adr(appInSPSCargo
							.getSps_l1_adr());
					appBefInSPSCargo.setSps_city_adr(appInSPSCargo
							.getSps_city_adr());
					appBefInSPSCargo.setSps_sta_adr(appInSPSCargo
							.getSps_sta_adr());
					appBefInSPSCargo.setSps_zip_adr(appInSPSCargo
							.getSps_zip_adr());
				} else {
					appBefInSPSCargo.setSpouse_out_of_home_ind(appInSPSCargo
							.getSpouse_out_of_home_ind());
					appBefInSPSCargo.setSpouse_name(null);
					appBefInSPSCargo.setSps_l1_adr(null);
					appBefInSPSCargo.setSps_city_adr(null);
					appBefInSPSCargo.setSps_sta_adr(null);
					appBefInSPSCargo.setSps_zip_adr(null);
				}

			}

			final ContactInfoBO contactInfoDetailsBO = new ContactInfoBO();

			if(appBefRgstCargoNoChange!=null){
				if(appBefRgstCargoNoChange.getLang_cd()!=null){
					if(appBefRgstCargoNoChange.getLang_cd().equals(AppConstants.EMPTY_STRING) || "SEL".equalsIgnoreCase(appBefRgstCargoNoChange.getLang_cd())){
						appBefRgstCargoNoChange.setLang_cd(null);
					}
				}
			}
			/* PERSIST APP_RGST */
			if (appRgstBeforeColl != null && appRgstBeforeColl.size() > 1) {
				/* RM UPDATE */
				final Map rgstComparisonMap = appBefRgstCargoNoChange
						.compareAttributes(appBefRgstCargo);
				if (!rgstComparisonMap.isEmpty()) {
					appBefRgstCargo.setDirty(true);
				} else {
					appBefRgstCargo.setDirty(false);
				}
				if (appBefRgstCargo.isDirty()) {
					final APP_RGST_Collection appRgstBefColl = new APP_RGST_Collection();
					appBefRgstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					appBefRgstCargo.setSrc_app_ind("RM");
					appRgstBefColl.addCargo(appBefRgstCargo);
					contactInfoDetailsBO
					.storeContactInformation(appRgstBefColl);
				}
			} else if (appRgstBeforeColl != null
					&& !appRgstBeforeColl.isEmpty()) {
				/* RM INSERT */
				final Map rgstComparisonMap = appBefRgstCargoNoChange
						.compareAttributes(appBefRgstCargo);
				if (!rgstComparisonMap.isEmpty()) {
					appBefRgstCargo.setDirty(true);
				} else {
					appBefRgstCargo.setDirty(false);
				}
				if (appBefRgstCargo.isDirty()) {
					final APP_RGST_Collection appRgstBefColl = new APP_RGST_Collection();
					appBefRgstCargo.setRowAction(FwConstants.ROWACTION_INSERT);
					appBefRgstCargo.setSrc_app_ind("RM");
					appRgstBefColl.addCargo(appBefRgstCargo);
					contactInfoDetailsBO
					.storeContactInformation(appRgstBefColl);
				}
			}

			/* PERSIST APP_INDV */
			if (appIndvBeforeColl != null && appIndvBeforeColl.size() > 1) {
				/* RM UPDATE */
				final Map indvComparisonMap = appBefIndvCargoNoChange
						.compareAttributes(appBefIndvCargo);
				if (!indvComparisonMap.isEmpty()) {
					appBefIndvCargo.setDirty(true);
				} else {
					appBefIndvCargo.setDirty(false);
				}
				if (appBefIndvCargo.isDirty()) {
					final APP_INDV_Collection appIndvBefColl = new APP_INDV_Collection();
					appBefIndvCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					appBefIndvCargo.setSrc_app_ind("RM");
					appIndvBefColl.addCargo(appBefIndvCargo);
					contactInfoDetailsBO.storeIndvInformation(appIndvBefColl);
				}
			} else if (appIndvBeforeColl != null
					&& !appIndvBeforeColl.isEmpty()) {
				/* RM INSERT */
				final Map rgstComparisonMap = appBefIndvCargoNoChange
						.compareAttributes(appBefIndvCargo);
				if (!rgstComparisonMap.isEmpty()
						&& null != appBefIndvCargo.getFst_nam()) {
					appBefIndvCargo.setDirty(true);
				} else {
					appBefIndvCargo.setDirty(false);
				}
				if (appBefIndvCargo.isDirty()) {
					final APP_INDV_Collection appIndvBefColl = new APP_INDV_Collection();
					appBefIndvCargo.setRowAction(FwConstants.ROWACTION_INSERT);
					appBefIndvCargo.setSrc_app_ind("RM");
					appIndvBefColl.addCargo(appBefIndvCargo);
					contactInfoDetailsBO.storeIndvInformation(appIndvBefColl);
				}
			}
			if (!rmcFlag) {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
				 * javadoc
				 */
				/**
				 * if (appIndvBeforeColl != null && appIndvBeforeColl.size() >
				 * 1) { // RM UPDATE Map indvComparisonMap =
				 * appBefIndvCargoNoChange .compareAttributes(appBefIndvCargo);
				 * if (indvComparisonMap.size() > 0) {
				 * appBefIndvCargo.setDirty(true); } else {
				 * appBefIndvCargo.setDirty(false); } if
				 * (appBefIndvCargo.isDirty()) { APP_INDV_Collection
				 * appIndvBefColl = new APP_INDV_Collection(); appBefIndvCargo
				 * .setRowAction(FwConstants.ROWACTION_UPDATE);
				 * appBefIndvCargo.setSrc_app_ind("RM");
				 * appIndvBefColl.addCargo(appBefIndvCargo);
				 * contactInfoDetailsBO .storeIndvInformation(appIndvBefColl); }
				 * } else if (appIndvBeforeColl != null &&
				 * appIndvBeforeColl.size() > 0) { // RM INSERT Map
				 * indvComparisonMap = appBefIndvCargoNoChange
				 * .compareAttributes(appBefIndvCargo); if
				 * (indvComparisonMap.size() > 0) {
				 * appBefIndvCargo.setDirty(true); } else {
				 * appBefIndvCargo.setDirty(false); } if
				 * (appBefIndvCargo.isDirty()) { APP_INDV_Collection
				 * appIndvBefColl = new APP_INDV_Collection(); appBefIndvCargo
				 * .setRowAction(FwConstants.ROWACTION_INSERT);
				 * appBefIndvCargo.setSrc_app_ind("RM");
				 * appIndvBefColl.addCargo(appBefIndvCargo);
				 * contactInfoDetailsBO .storeIndvInformation(appIndvBefColl); }
				 * }
				 */
				/* PERSIST APP_IN_INST */
				if (appInInstBeforeColl != null
						&& appInInstBeforeColl.size() > 1) {
					if (appInInstBeforeColl.size() > 1) {
						/* RM UPDATE */
						final Map instComparisonMap = appBefInstCargoNoChange
								.compareAttributes(appBefInstCargo);
						if (!instComparisonMap.isEmpty()) {
							appBefInstCargo.setDirty(true);
						} else {
							appBefInstCargo.setDirty(false);
						}
						if (appBefInstCargo.isDirty()) {
							final APP_IN_INST_Collection appInInstBefColl = new APP_IN_INST_Collection();
							appBefInstCargo
							.setRowAction(FwConstants.ROWACTION_UPDATE);
							appBefInstCargo.setSrc_app_ind("RM");
							appInInstBefColl.addCargo(appBefInstCargo);
							contactInfoDetailsBO
							.storeInstInformation(appInInstBefColl);
						}
					} else if (appInInstBeforeColl != null
							&& !appInInstBeforeColl.isEmpty()) {
						/* RM INSERT */
						final Map instComparisonMap = appBefInstCargoNoChange
								.compareAttributes(appBefInstCargo);
						if (!instComparisonMap.isEmpty()) {
							appBefInstCargo.setDirty(true);
						} else {
							appBefInstCargo.setDirty(false);
						}
						if (appBefInstCargo.isDirty()) {
							final APP_IN_INST_Collection appInInstBefColl = new APP_IN_INST_Collection();
							appBefInstCargo
							.setRowAction(FwConstants.ROWACTION_INSERT);
							appBefInstCargo.setSrc_app_ind("RM");
							appInInstBefColl.addCargo(appBefInstCargo);
							contactInfoDetailsBO
							.storeInstInformation(appInInstBefColl);
						}
					}
				}
				/* PERSIST APP_IN_SPS */
				final APP_IN_SPS_IMPOV_Collection newSpsColl = new APP_IN_SPS_IMPOV_Collection();
				if (appInSPSBeforeColl != null && !appInSPSBeforeColl.isEmpty()) {
					final Map spsComparisonMap = appBefInSPSCargoNoChange
							.compareAttributes(appBefInSPSCargo);
					if (!spsComparisonMap.isEmpty()) {
						appBefInSPSCargo.setDirty(true);
					} else {
						appBefInSPSCargo.setDirty(false);
					}
					if (appInSPSBeforeColl.size() > 1
							&& appBefInSPSCargo.isDirty()) {
						/* RM UPDATE */
						appBefInSPSCargo
						.setRowAction(FwConstants.ROWACTION_UPDATE);
						appBefInSPSCargo
						.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
						newSpsColl.addCargo(appBefInSPSCargo);
						contactInfoDetailsBO.storeSPSInformation(newSpsColl);
					} else if (!appInSPSBeforeColl.isEmpty()
							&& appBefInSPSCargo.isDirty()) {
						/* RM UPDATE */
						appBefInSPSCargo
						.setRowAction(FwConstants.ROWACTION_INSERT);
						appBefInSPSCargo
						.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
						newSpsColl.addCargo(appBefInSPSCargo);
						contactInfoDetailsBO.storeSPSInformation(newSpsColl);
					}
				} else if (appInSPSCargo != null
						&& appInSPSCargo.getSpouse_out_of_home_ind() != null) {
					appBefInSPSCargo.setRowAction(FwConstants.ROWACTION_INSERT);
					appBefInSPSCargo
					.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
					newSpsColl.addCargo(appBefInSPSCargo);
					contactInfoDetailsBO.storeSPSInformation(newSpsColl);
				}
			}

			/* Extraction changes starts */
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			if (beforeColl != null) {
				pageCollection.put("CONTACT_INFO_MSG",
						beforeColl.get("CONTACT_INFO_MSG"));
			}
			/* Extraction changes ends */
			session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);
			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARACD",
					driverArray, appNum);

			boolean scheduleARXHU = false;
			/* If the cases are FS, FS RR, and EBD MA PCR # 30532 */
			if (programKey[FwConstants.FSRR_INDEX] == 1
					|| programKey[FwConstants.EBDMA_INDEX] == 1) {
				scheduleARXHU = true;
			}
			if (changes && scheduleARXHU) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARXHU",
						driverArray, appNum);
			}
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			/* schedule for address validation */
			if (!"HML"
					.equalsIgnoreCase(appRgstCargo.getLiving_arrangement_cd())) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARAVD",
						driverArray, appNum);
			} else {
				if (StringUtils.isNotBlank(appRgstCargo.getHshl_l1_adr())
						&& StringUtils.isNotBlank(appRgstCargo
								.getHshl_sta_adr())
								&& StringUtils.isNotBlank(appRgstCargo
										.getHshl_city_adr())
										&& StringUtils.isNotBlank(appRgstCargo
												.getHshl_zip_adr())
												|| StringUtils.isNotBlank(appRgstCargo.getAlt_st_adr())
												&& StringUtils.isNotBlank(appRgstCargo
														.getAlt_city_adr())
														&& StringUtils
														.isNotBlank(appRgstCargo.getAlt_sta_adr())
														&& StringUtils
														.isNotBlank(appRgstCargo.getAlt_zip_adr())) {

					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARAVD",
							driverArray, appNum);
				} else {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARAVD", driverArray,
							appNum);
				}
			}
			
			final ChangingValidation cv = new ChangingValidation();
			cv.setDemographicsChgInd(txnBean);
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoContactDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoContactDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoContactDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoContactDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoContactDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	private String mailingAddressInd(APP_RGST_Cargo beforeCargo,
			APP_RGST_Cargo cargo) {
		if (beforeCargo == null || cargo == null) {
			return "";
		}
		String status = "";
		if ((beforeCargo.getAlt_st_adr() == null || FwConstants.EMPTY_STRING
				.equals(beforeCargo.getAlt_st_adr().trim()))
				&& (beforeCargo.getAlt_l2_adr() == null || FwConstants.EMPTY_STRING
						.equals(beforeCargo.getAlt_l2_adr()))
				&& (beforeCargo.getAlt_city_adr() == null || FwConstants.EMPTY_STRING
						.equals(beforeCargo.getAlt_city_adr().trim()))
				&& (beforeCargo.getAlt_sta_adr() == null || FwConstants.EMPTY_STRING
						.equals(beforeCargo.getAlt_sta_adr().trim()))
				&& (beforeCargo.getAlt_zip_adr() == null || FwConstants.EMPTY_STRING
						.equals(beforeCargo.getAlt_sta_adr().trim()))) {
			if ((cargo.getAlt_st_adr() != null && !FwConstants.EMPTY_STRING
					.equals(cargo.getAlt_st_adr().trim()))
					|| (cargo.getAlt_l2_adr() != null && !FwConstants.EMPTY_STRING
							.equals(cargo.getAlt_l2_adr()))
					|| (cargo.getAlt_city_adr() != null && !FwConstants.EMPTY_STRING
							.equals(cargo.getAlt_city_adr().trim()))
					|| (cargo.getAlt_sta_adr() != null && !FwConstants.EMPTY_STRING
							.equals(cargo.getAlt_sta_adr().trim()) && !"SEL".equalsIgnoreCase(cargo.getAlt_sta_adr()))
					|| (cargo.getAlt_zip_adr() != null && !FwConstants.EMPTY_STRING
							.equals(cargo.getAlt_zip_adr().trim()))) {
				status = "New";
			}
		} else if ((beforeCargo.getAlt_st_adr() != null && !beforeCargo
				.getAlt_st_adr().equals(cargo.getAlt_st_adr().trim()))
				|| (beforeCargo.getAlt_l2_adr() != null && !beforeCargo
						.getAlt_l2_adr().equals(cargo.getAlt_l2_adr()))
				|| (beforeCargo.getAlt_city_adr() != null && !beforeCargo
						.getAlt_city_adr().equals(cargo.getAlt_city_adr().trim()))
				|| (beforeCargo.getAlt_sta_adr() != null && !beforeCargo
						.getAlt_sta_adr().equals(cargo.getAlt_sta_adr().trim()))
				|| (beforeCargo.getAlt_zip_adr() != null && !beforeCargo
						.getAlt_zip_adr().equals(cargo.getAlt_zip_adr().trim()))) {
			status = "Changed";
		}
		return status;
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldCompIndvSelection(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldCompIndvSelection() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadHouseholdCompIndvSelection:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			if (peopleHandler == null) {
				peopleHandler = new PeopleHandler();
				peopleHandler.loadPeopleHandler(appNum);
				session.put(AppConstants.INDIV_MASTER_HANDLER, peopleHandler);
			}
			componentManager.getComponents("ARHIS", txnBean);
			final Map pageCollection = txnBean.getPageCollection();
			RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl = (RMC_RESPONSE_Custom_Collection) session
					.get("RMC_RESPONSE_Custom_Collection");
			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			if (appType != null
					&& !appType
					.equalsIgnoreCase(new String(rmcApplicationType))) {
			}

			if (null == rmcRspnseCustomColl) {
				rmcRspnseCustomColl = new RMC_RESPONSE_Custom_Collection();
			}
			NO_ONE_Collection noOneColl = (NO_ONE_Collection) pageCollection
					.get("NO_ONE_Collection");
			if (null == noOneColl) {
				noOneColl = new NO_ONE_Collection(); // Added by Srividhya
			}

			RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
					.get(AppConstants.RMC_RQST);
			if (rmcRqstCargo == null) {
				RMC_RQST_Collection rmcColl = (RMC_RQST_Collection) session
						.get("RMC_RQST_Collection");
				final ABHouseHoldMemberBO householdBO = new ABHouseHoldMemberBO();

				if (rmcColl != null) {
					rmcRqstCargo = rmcColl.getCargo(0);
				} else {
					rmcColl = householdBO.loadRMC(appNum);
					rmcRqstCargo = rmcColl.getCargo(0);

				}
				session.put("RMC_RQST_Collection", rmcColl);
			}

			final PregnancyBO pregnancyBO = new PregnancyBO();
			final APP_IN_PREG_Collection appInPregColl = pregnancyBO
					.loadPregnancyDetails(appNum);
			pageCollection.put(APP_IN_PREG_COLLECTION_KEY, appInPregColl);

			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Cargo rmcInCargo = rmcInPrflColl.getCargo(0);
			componentManager.getComponents(
					(String) request.get(FwConstants.CURRENT_PAGE_ID), txnBean);
			createandLoadARHISResponseMapsToPageCollection(rmcInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler, true,
					driverStatus, txnBean);
			pageCollection.put("RMC_Rqst_Cargo", rmcRqstCargo);
			session.put(AppConstants.RMC_RQST, rmcRqstCargo);

			pageCollection.put("RMC_IN_PRFL_Cargo", rmcInCargo);
			pageCollection.put("HOUSEHOLD_COMP_INDV_SEL_RESP_COLL_BEFORE",
					rmcRspnseCustomColl);
			pageCollection.put("NO_ONE_Collection", noOneColl);
			pageCollection.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
			txnBean.setPageCollection(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION,
					txnBean.getPageCollection());

			log(ILog.INFO,
					"HousingExpenseEJBBean::getHousingExpenseQuestions:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseholdCompIndvSelection");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldCompIndvSelection");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseholdCompIndvSelection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldCompIndvSelection");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldCompIndvSelection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldCompIndvSelection(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldCompIndvSelection() - START");

		try {

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final Map noOneCheckedMap = (Map) beforeColl
					.get(AppConstants.NO_ONE_CHECKED_MAP);
			final NO_ONE_Collection noOneCollection = (NO_ONE_Collection) pageCollection
					.get("NO_ONE_Collection");
			final RMC_IN_PRFL_Collection rmcInPrflSessColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection rmcInPrflPageColl = (RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection");
			final RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
					.get(AppConstants.RMC_RQST);
			final INDIVIDUAL_Custom_Collection peoplePE = (INDIVIDUAL_Custom_Collection) beforeColl
					.get("PEOPLE_PE");
			final int peoplePeSize = peoplePE.size();
			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			boolean rmcAppType = true;
			if (appType != null
					&& !appType
					.equalsIgnoreCase(new String(rmcApplicationType))) {
				rmcAppType = false;
			}

			boolean noOneCollPI = false;
			boolean noOneColl601 = false;
			boolean noOneCollAC = false;
			boolean noOneCollBP = false;
			boolean noOneCollUB = false;
			boolean noOneCollPE = false;

			NO_ONE_Cargo noOneCargo = new NO_ONE_Cargo();

			for (int i = 0; i < rmcInPrflPageColl.size(); i++) {
				final RMC_IN_PRFL_Cargo cargo = rmcInPrflPageColl.getCargo(i);
				if (cargo.getRlt_chg_stat_sw() == null) {
					cargo.setRlt_chg_stat_sw(FwConstants.NO);
				}
				if (cargo.getPrsn_info_stat_sw() == null) {
					cargo.setPrsn_info_stat_sw(FwConstants.NO);
				}
				if (cargo.getAble_to_conceive_resp() == null) {
					cargo.setAble_to_conceive_resp(FwConstants.NO);
				}
				if (cargo.getPreg_add_stat_sw() == null) {
					cargo.setPreg_add_stat_sw(FwConstants.NO);
				}
				if (cargo.getUnderweight_birth_resp() == null) {
					cargo.setUnderweight_birth_resp(FwConstants.NO);
				}
				if (cargo.getPreg_chg_stat_sw() == null) {
					cargo.setPreg_chg_stat_sw(FwConstants.NO);
				}
			}

			if (noOneCollection != null && !noOneCollection.isEmpty()) {
				for (int a = 0; a < noOneCollection.size(); a++) {
					noOneCargo = noOneCollection.getResult(a);
					if ("AbleToConceive".equals(noOneCargo.getNo_one_name())) {
						noOneCollAC = true;
					}
					if ("BecamePregnant".equals(noOneCargo.getNo_one_name())) {
						noOneCollBP = true;
					}
					if ("UnderWeightBirth".equals(noOneCargo.getNo_one_name())) {
						noOneCollUB = true;
					}
					if ("PregnancyEnded".equals(noOneCargo.getNo_one_name())) {
						noOneCollPE = true;
					}
					if ("PERSONAL".equals(noOneCargo.getNo_one_name())) {
						noOneCollPI = true;
					}
					if ("RELATION".equals(noOneCargo.getNo_one_name())) {
						noOneColl601 = true;
					}

				}
			}

			/*final String pregEndFlag = (String) session
					.get("SKIP_PREG_END_VAL");
			if (AppConstants.TRUE.equalsIgnoreCase(pregEndFlag)) {
				noOneCollPE = true;
			}*/

			final ARHISValidator validator = new ARHISValidator();
			FwMessageList errorMessageList = null;
			errorMessageList = validator.validateChanges(rmcInPrflPageColl,
					noOneCollection, noOneCheckedMap, rmcAppType, noOneCollPI,
					noOneColl601, noOneCollAC, noOneCollBP, noOneCollUB,
					noOneCollPE, rmcRqstCargo, beforeColl);
			if (errorMessageList != null && validator.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST, errorMessageList);
				for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
					final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
							.getCargo(i);
					final RMC_IN_PRFL_Cargo pageCollCargo = rmcResponseProfileManager
							.getProfile(rmcInPrflPageColl,
									sessionCargo.getIndv_seq_num());
					if (pageCollCargo == null) {
						sessionCargo.setPrsn_info_stat_sw(FwConstants.NO);
						sessionCargo.setRlt_chg_stat_sw(FwConstants.NO);
						sessionCargo.setAble_to_conceive_resp(FwConstants.NO);
						sessionCargo.setPreg_add_stat_sw(FwConstants.NO);
						sessionCargo.setUnderweight_birth_resp(FwConstants.NO);
						sessionCargo.setPreg_chg_stat_sw(FwConstants.NO);
					} else {
						if (null != pageCollCargo.getPrsn_info_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getPrsn_info_stat_sw())) {
							sessionCargo.setPrsn_info_stat_sw(pageCollCargo
									.getPrsn_info_stat_sw());
						} else {
							sessionCargo.setPrsn_info_stat_sw(FwConstants.NO);
						}
						if (null != pageCollCargo.getRlt_chg_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getRlt_chg_stat_sw())) {
							sessionCargo.setRlt_chg_stat_sw(pageCollCargo
									.getRlt_chg_stat_sw());
						} else {
							sessionCargo.setRlt_chg_stat_sw(FwConstants.NO);
						}
						if (null != pageCollCargo.getAble_to_conceive_resp()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getAble_to_conceive_resp())) {
							sessionCargo.setAble_to_conceive_resp(pageCollCargo
									.getAble_to_conceive_resp());
						} else {
							sessionCargo
							.setAble_to_conceive_resp(FwConstants.NO);
						}
						if (null != pageCollCargo.getPreg_add_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getPreg_add_stat_sw())) {
							sessionCargo.setPreg_add_stat_sw(pageCollCargo
									.getPreg_add_stat_sw());
						} else {
							sessionCargo.setPreg_add_stat_sw(FwConstants.NO);
						}
						if (null != pageCollCargo.getUnderweight_birth_resp()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getUnderweight_birth_resp())) {
							sessionCargo
							.setUnderweight_birth_resp(pageCollCargo
									.getUnderweight_birth_resp());
						} else {
							sessionCargo
							.setUnderweight_birth_resp(FwConstants.NO);
						}
						if (null != pageCollCargo.getPreg_chg_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getPreg_chg_stat_sw())) {
							sessionCargo.setPreg_chg_stat_sw(pageCollCargo
									.getPreg_chg_stat_sw());
						} else {
							sessionCargo.setPreg_chg_stat_sw(FwConstants.NO);
						}
					}
				}
				pageCollection.put(APP_IN_PREG_COLLECTION_KEY, beforeColl.get(APP_IN_PREG_COLLECTION_KEY));
				componentManager.getComponents(currentPageID, txnBean);
				final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl = (RMC_RESPONSE_Custom_Collection) pageCollection
						.get("RMC_RESPONSE_Custom_Collection");
				createandLoadARHISResponseMapsToPageCollection(
						rmcInPrflSessColl, rmcRspnseCustomColl, pageCollection,
						peopleHandler, true, driverStatus, txnBean);
				if (noOneCollPI) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.PERSONAL_INFO, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.PERSONAL_INFO, FwConstants.NO);
				}
				if (noOneColl601) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.RLT_CHG, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.RLT_CHG, FwConstants.NO);
				}
				if (noOneCollAC) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.ABLE_TO_CONCEIVE, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.ABLE_TO_CONCEIVE, FwConstants.NO);
				}
				if (noOneCollBP) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.BECAME_PREGNANT, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.BECAME_PREGNANT, FwConstants.NO);
				}
				if (noOneCollUB) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.UNDERWEIGHT_BIRTH, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.UNDERWEIGHT_BIRTH, FwConstants.NO);
				}
				if (noOneCollPE) {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.PREGNANCY_ENDED, FwConstants.YES);
				} else {
					noOneCheckedMap.put(AppConstants.NO_ONE_CHECKED
							+ AppConstants.PREGNANCY_ENDED, FwConstants.NO);
				}
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				txnBean.setRequest(request);
				txnBean.setPageCollection(pageCollection);
				pageCollection.put("HOUSEHOLD_COMP_INDV_SEL_RESP_COLL_BEFORE",
						rmcRspnseCustomColl);
				pageCollection.put("RMC_RESPONSE_Custom_Collection",
						rmcRspnseCustomColl);
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
				return;
			}
			final int numQuestions = 6;
			final short[] questionsArrayForIndv = new short[numQuestions];
			questionsArrayForIndv[0] = IRMCResponseProfileManager.PRSN_INFO_STAT_SW;
			questionsArrayForIndv[1] = IRMCResponseProfileManager.RLT_CHG_STAT_SW;
			questionsArrayForIndv[2] = IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP;
			questionsArrayForIndv[3] = IRMCResponseProfileManager.PREG_ADD_STAT_SW;
			questionsArrayForIndv[4] = IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP;
			questionsArrayForIndv[5] = IRMCResponseProfileManager.PREG_CHG_STAT_SW;
			
			final Map indivResponseMapForIndv = new HashMap();
			final RMC_RESPONSE_Custom_Collection rmcRespCustomColl = new RMC_RESPONSE_Custom_Collection();
			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				String[] indivResponseArrayForIndv = new String[] { FwConstants.NO,
						FwConstants.NO, FwConstants.NO, FwConstants.NO,
						FwConstants.NO, FwConstants.NO };
				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
						.getCargo(i);
				final RMC_IN_PRFL_Cargo pageCollCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflPageColl,
								sessionCargo.getIndv_seq_num());
				if (rmcRqstCargo.getChange_in_personal_info() != null&&FwConstants.YES.equals(rmcRqstCargo.getChange_in_personal_info())) {
					if (pageCollCargo == null) {
						sessionCargo.setPrsn_info_stat_sw(FwConstants.NO);
					} else {
						if (null != pageCollCargo.getPrsn_info_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getPrsn_info_stat_sw())) {
							sessionCargo.setPrsn_info_stat_sw(pageCollCargo
									.getPrsn_info_stat_sw());
							if (FwConstants.YES.equals(pageCollCargo
									.getPrsn_info_stat_sw())) {
								/* personal info */
								final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
								rmcRespCustomCargo.setIndvSeqNum(sessionCargo
										.getIndv_seq_num());
								rmcRespCustomCargo
								.setCategoryType(AppConstants.PERSONAL_INFO);
								rmcRespCustomCargo.setSeqNum(FwConstants.ZERO);
								rmcRespCustomCargo
								.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
								rmcRespCustomColl.addCargo(rmcRespCustomCargo);

								/* immigration status */
								final RMC_RESPONSE_Custom_Cargo rmcRespImCustomCargo = new RMC_RESPONSE_Custom_Cargo();
								rmcRespImCustomCargo.setIndvSeqNum(sessionCargo
										.getIndv_seq_num());
								rmcRespImCustomCargo
								.setCategoryType(AppConstants.CITIZEN_INFO);
								rmcRespImCustomCargo.setSeqNum(FwConstants.ZERO);
								rmcRespImCustomCargo
								.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
								rmcRespCustomColl
								.addCargo(rmcRespImCustomCargo);
							}
						} else {
							sessionCargo.setPrsn_info_stat_sw(FwConstants.NO);
						}

					}
					indivResponseArrayForIndv[0] = sessionCargo
							.getPrsn_info_stat_sw();
					indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
							indivResponseArrayForIndv);
				}
				if (rmcRqstCargo.getRlt_stat_sw() != null
						&& FwConstants.YES
						.equals(rmcRqstCargo.getRlt_stat_sw())) {
					if (pageCollCargo == null) {
						sessionCargo.setRlt_chg_stat_sw(FwConstants.NO);
					} else {
						if (null != pageCollCargo.getRlt_chg_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getRlt_chg_stat_sw())) {
							sessionCargo.setRlt_chg_stat_sw(pageCollCargo
									.getRlt_chg_stat_sw());
							if (FwConstants.YES.equals(pageCollCargo
									.getRlt_chg_stat_sw())) {
								final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
								rmcRespCustomCargo.setIndvSeqNum(sessionCargo
										.getIndv_seq_num());
								rmcRespCustomCargo
								.setCategoryType(AppConstants.RLT_CHG);
								rmcRespCustomCargo.setSeqNum(i
										+ FwConstants.EMPTY_STRING);
								rmcRespCustomCargo
								.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HO_COMP_PRFL);
								rmcRespCustomColl.addCargo(rmcRespCustomCargo);
							}
						} else {
							sessionCargo.setRlt_chg_stat_sw(FwConstants.NO);
						}

					}
					indivResponseArrayForIndv[1] = sessionCargo
							.getRlt_chg_stat_sw();
					indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
							indivResponseArrayForIndv);
				}
				if (rmcRqstCargo.getPreg_chg_stat_sw() != null
						&& FwConstants.YES.equals(rmcRqstCargo
								.getPreg_chg_stat_sw())) {
					if (pageCollCargo == null) {
						sessionCargo.setAble_to_conceive_resp(FwConstants.NO);
					} else {
						if (null != pageCollCargo.getAble_to_conceive_resp()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getAble_to_conceive_resp())) {
							sessionCargo.setAble_to_conceive_resp(pageCollCargo
									.getAble_to_conceive_resp());
							if (FwConstants.YES.equals(pageCollCargo
									.getAble_to_conceive_resp())) {
								final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
								rmcRespCustomCargo.setIndvSeqNum(sessionCargo
										.getIndv_seq_num());
								rmcRespCustomCargo
								.setCategoryType(AppConstants.ABLE_TO_CONCEIVE);
								rmcRespCustomCargo.setSeqNum(i
										+ FwConstants.EMPTY_STRING);
								rmcRespCustomCargo
								.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HO_COMP_PRFL);
								rmcRespCustomColl.addCargo(rmcRespCustomCargo);
							}
						} else {
							sessionCargo
							.setAble_to_conceive_resp(FwConstants.NO);
						}

					}
					indivResponseArrayForIndv[2] = sessionCargo
							.getAble_to_conceive_resp();
					indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
							indivResponseArrayForIndv);
					if (pageCollCargo == null) {
						sessionCargo.setPreg_add_stat_sw(FwConstants.NO);
					} else {
						if (null != pageCollCargo.getPreg_add_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getPreg_add_stat_sw())
										&& !AppConstants.NO.equals(pageCollCargo
												.getPreg_add_stat_sw())) {
							sessionCargo.setPreg_add_stat_sw(pageCollCargo
									.getPreg_add_stat_sw());
							if (FwConstants.YES.equals(pageCollCargo
									.getPreg_add_stat_sw())) {
								final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
								rmcRespCustomCargo.setIndvSeqNum(sessionCargo
										.getIndv_seq_num());
								rmcRespCustomCargo
								.setCategoryType(AppConstants.BECAME_PREGNANT);
								rmcRespCustomCargo.setSeqNum(i
										+ FwConstants.EMPTY_STRING);
								rmcRespCustomCargo
								.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HO_COMP_PRFL);
								rmcRespCustomColl.addCargo(rmcRespCustomCargo);
							}
						} else {
							sessionCargo.setPreg_add_stat_sw(FwConstants.NO);
						}

					}
					indivResponseArrayForIndv[3] = sessionCargo
							.getPreg_add_stat_sw();
					indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
							indivResponseArrayForIndv);
					if (pageCollCargo == null) {
						sessionCargo.setUnderweight_birth_resp(FwConstants.NO);
					} else {
						if (null != pageCollCargo.getUnderweight_birth_resp()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getUnderweight_birth_resp())) {
							sessionCargo
							.setUnderweight_birth_resp(pageCollCargo
									.getUnderweight_birth_resp());
							if (FwConstants.YES.equals(pageCollCargo
									.getUnderweight_birth_resp())) {
								final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
								rmcRespCustomCargo.setIndvSeqNum(sessionCargo
										.getIndv_seq_num());
								rmcRespCustomCargo
								.setCategoryType(AppConstants.UNDERWEIGHT_BIRTH);
								rmcRespCustomCargo.setSeqNum(i
										+ FwConstants.EMPTY_STRING);
								rmcRespCustomCargo
								.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HO_COMP_PRFL);
								rmcRespCustomColl.addCargo(rmcRespCustomCargo);
							}
						} else {
							sessionCargo
							.setUnderweight_birth_resp(FwConstants.NO);
						}

					}
					indivResponseArrayForIndv[4] = sessionCargo
							.getUnderweight_birth_resp();
					indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
							indivResponseArrayForIndv);
					if (pageCollCargo == null) {
						sessionCargo.setPreg_chg_stat_sw(FwConstants.NO);
					} else {
						if (null != pageCollCargo.getPreg_chg_stat_sw()
								&& !"null".equalsIgnoreCase(pageCollCargo
										.getPreg_chg_stat_sw())) {
							sessionCargo.setPreg_chg_stat_sw(pageCollCargo
									.getPreg_chg_stat_sw());
							if (FwConstants.YES.equals(pageCollCargo
									.getPreg_chg_stat_sw())) {
								final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
								rmcRespCustomCargo.setIndvSeqNum(sessionCargo
										.getIndv_seq_num());
								rmcRespCustomCargo
								.setCategoryType(AppConstants.PREGNANCY_ENDED);
								rmcRespCustomCargo.setSeqNum(i
										+ FwConstants.EMPTY_STRING);
								rmcRespCustomCargo
								.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HO_COMP_PRFL);
								rmcRespCustomColl.addCargo(rmcRespCustomCargo);
							}
						} else {
							sessionCargo.setPreg_chg_stat_sw(FwConstants.NO);
						}

					}
					indivResponseArrayForIndv[5] = sessionCargo
							.getPreg_chg_stat_sw();
					indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
							indivResponseArrayForIndv);
				}
			}

			for (int i = 0; i < rmcInPrflPageColl.size(); i++) {
				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflPageColl
						.getCargo(i);
				rmcResponseProfileManager.persist(appNum, sessionCargo
						.getIndv_seq_num(), questionsArrayForIndv,
						(String[]) indivResponseMapForIndv.get(sessionCargo
								.getIndv_seq_num()));
			}

			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			if (categorySelectionProfile == null
					|| categorySelectionProfile.isEmpty()) {
				categorySelectionProfile = categorySelectionProfileManager
						.buildSelectionProfile(rmcRespCustomColl, appNum,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			} else {
				categorySelectionProfileManager.rebuildSelectionProfile(
						categorySelectionProfile, rmcRespCustomColl, appNum,
						AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			}

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
			if (rmcAppType) {
				final String[] requiredPages = { "ARHMI", "ARHMX" };
				if (rmcRqstCargo.getChange_in_personal_info() != null
						&& FwConstants.YES.equals(rmcRqstCargo
								.getChange_in_personal_info())) {					
					if (noOneCollPI && rmcRqstCargo.getPrsn_add_stat_sw()!=null && rmcRqstCargo.getPrsn_add_stat_sw().equals(AppConstants.NO)) {

						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, requiredPages,
								driverArray, appNum);
					} else {
					    Map seq = new HashMap<>();
					    seq.put("PI", AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
					    if(!categorySelectionProfileManager.areAllSequencesComplete(categorySelectionProfile, seq))
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								requiredPages, driverArray, appNum);
					}
				}
				if (rmcRqstCargo.getRlt_stat_sw() != null
						&& FwConstants.YES
						.equals(rmcRqstCargo.getRlt_stat_sw())) {
					if (noOneColl601) {
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, "ARHRL", driverArray,
								appNum);
					} else {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARHRL", driverArray, appNum);
					}
				}
				final INDIVIDUAL_Custom_Collection peopleBP = (INDIVIDUAL_Custom_Collection) beforeColl
						.get("PEOPLE_BP");
				if (rmcRqstCargo.getPreg_chg_stat_sw() != null
						&& FwConstants.YES.equals(rmcRqstCargo
								.getPreg_chg_stat_sw())) {
					if (noOneCollBP || peopleBP.size() < 1) {
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, "ARHPD", driverArray,
								appNum);
					} else {
						driverManager.makeRequired(FwConstants.RMC_DRIVER,
								"ARHPD", driverArray, appNum);
					}
					if (peoplePeSize > 0) {
						if (noOneCollPE) {
							driverManager.makeAbsoluteNotRequired(
									FwConstants.RMC_DRIVER, "ARSUM",
									driverArray, appNum);
						} else {
							if (driverStatus == FwConstants.DRIVER_REQUIRED){
							driverManager.makeRequired(FwConstants.RMC_DRIVER,
									"ARSUM", driverArray, appNum);
							}
							
						}
					}
				}
			}
			if (rmcRqstCargo!=null&&rmcAppType&&"N".equalsIgnoreCase(rmcRqstCargo.getPrsn_add_stat_sw())&&"N".equalsIgnoreCase(rmcRqstCargo.getChange_in_personal_info())) {
				final String[] requiredPages = { "ARHMI", "ARHMX" };
				driverManager.makeAbsoluteNotRequired(
						FwConstants.RMC_DRIVER, requiredPages,
						driverArray, appNum);
			}
			session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflSessColl);
			pageCollection.put("RMC_IN_PRFL_Collection", rmcInPrflPageColl);
			pageCollection.put("HOUSEHOLD_COMP_INDV_SEL_RESP_COLL_BEFORE",
					rmcRespCustomColl);
			session.put("RMC_RESPONSE_Custom_Collection", rmcRespCustomColl);
			driverManager.makeComplete(FwConstants.RMC_DRIVER, currentPageID,
					driverArray, appNum);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseholdCompIndvSelection");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldCompIndvSelection");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseholdCompIndvSelection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldCompIndvSelection");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldCompIndvSelection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load house hold info moved in details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoMovedInDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMovedInDetails() - START");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String appNumber = null;
		Map beforeColl = null;
		MovedInBO movedInBO = null;
		RMC_IN_PRFL_Collection rmcInPrflColl = null;
		APP_INDV_Collection appIndvColl = null;
		PeopleHandler peopleHandler = null;
		INDIVIDUAL_Custom_Collection indvCustColl = null;
		String pageId = null;
		int pageStatus = 0;
		int[] driverArray = null;
		short[] programKeyArray = null;

		CategorySequenceDetail categorySeqDetail = null;
		try {
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageStatus = driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
					pageId, driverArray);
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			movedInBO = new MovedInBO();
			final ABProgramInformationBO abProgramInformationBO = new ABProgramInformationBO();
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// RMB: get app Type, determine application contxt as rmc or rmb
			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			boolean rmcAppType = true;
			if (appType != null
					&& !appType
					.equalsIgnoreCase(new String(rmcApplicationType))) {
				rmcAppType = false;
			}

			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			final short[] responseType = new short[] { IRMCResponseProfileManager.PRSN_INFO_STAT_SW };
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map peopleType = new HashMap<String, String>();
			peopleType.put(AppConstants.PERSONAL_INFO,
					AppConstants.PERSONAL_INFO);

			if (pageStatus == FwConstants.DRIVER_REQUIRED
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, peopleType)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			} else if (pageStatus == FwConstants.DRIVER_COMPLETE
					&& !pageId.equals(previousPageId)
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, peopleType)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			}

			SortedSet moveInHomeProfile = null;

			if (!pageId.equals(previousPageId)) {

				moveInHomeProfile = createPageProfile(categorySelectionProfile,
						rmcInPrflColl, responseType);

				if (pageStatus != FwConstants.DRIVER_REQUIRED) {
					final APP_INDV_Collection indvColl =  movedInBO.getIndvDetails(appNumber,null);
					final APP_INDV_Collection rnIndvColl =	movedInBO.splitIndvCollDetails(indvColl,AppConstants.RMC_NEW_RECORD_IND);
					if (rnIndvColl != null && !rnIndvColl.isEmpty()) {
						APP_INDV_Cargo rnIndvCargo = null;
						final int newEmplCollSize = rnIndvColl.size();
						for (int i = 0; i < newEmplCollSize; i++) {
							rnIndvCargo = rnIndvColl.getCargo(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									moveInHomeProfile, null, null,
									Short.parseShort(rnIndvCargo
											.getIndv_seq_num()), 0,
											AppConstants.PERSONAL_INFO);
						}
					}
				}

				if (pageStatus == FwConstants.DRIVER_REQUIRED
						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(moveInHomeProfile);
				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE
						&& pageCollection.get(FwConstants.DETAIL_KEY_BEAN) == null
						&& !moveInHomeProfile.isEmpty()) {
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(moveInHomeProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);

			} else {

				moveInHomeProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			final IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean != null) {

				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								moveInHomeProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Long.parseLong(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(
								moveInHomeProfile,
								appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										indivSeqBean.getType(), Short
										.parseShort(indivSeqBean
												.getUserEndInd()));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							moveInHomeProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Long.parseLong(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean.getSeqNum()),
											indivSeqBean.getType());
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != Short
								.parseShort(indivSeqBean.getUserEndInd())) {
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType(), Short
													.parseShort(indivSeqBean
															.getUserEndInd()));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				} else {
					if (FwConstants.ONE.equals(indivSeqBean.getSeqNum())) {

						RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
						if (rmcInPrflColl != null) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl,
											indivSeqBean.getIndivSeqNum());
						} else {
							rmcInPrflColl = new RMC_IN_PRFL_Collection();
						}
						if (rmcInPrflCargo == null) {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setApp_num(appNumber);
							rmcInPrflCargo.setIndv_seq_num(indivSeqBean
									.getIndivSeqNum());
							rmcResponseProfileManager
							.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflColl.addCargo(rmcInPrflCargo);
						}
						// now we need to make required the employment
						if (AppConstants.PERSONAL_INFO.equals(indivSeqBean
								.getType())) {
							rmcResponseProfileManager
							.makeAddNew(
									IRMCResponseProfileManager.PRSN_INFO_STAT_SW,
									rmcInPrflCargo, true);
						}
						categorySelectionProfileManager
						.insertSequenceDetail(moveInHomeProfile, null,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										indivSeqBean.getType());
						categorySelectionProfileManager
						.insertSequenceDetail(moveInHomeProfile, appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL, Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										AppConstants.CITIZEN_INFO);
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								moveInHomeProfile, null,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(moveInHomeProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile, appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
							categorySelectionProfileManager
						.insertExistingSequenceDetail(
								moveInHomeProfile, null,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO, Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(moveInHomeProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile, appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO, Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
					}
				}

				/*// doing the same for people 2
				final CategorySequenceDetail categorySeqDetail3 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								moveInHomeProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Long.parseLong(indivSeqBean.getSeqNum()),
								AppConstants.CITIZEN_INFO);
				if (categorySeqDetail3 != null) {
					if (categorySeqDetail3.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(
								moveInHomeProfile,
								appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										AppConstants.CITIZEN_INFO, Short
										.parseShort(indivSeqBean
												.getUserEndInd()));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							moveInHomeProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Long.parseLong(indivSeqBean.getSeqNum()),
							AppConstants.CITIZEN_INFO);
					final CategorySequenceDetail categorySeqDetail4 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean.getSeqNum()),
											AppConstants.CITIZEN_INFO);
					if (categorySeqDetail4 != null) {
						if (categorySeqDetail4.getUserEndSelectionInd() != Short
								.parseShort(indivSeqBean.getUserEndInd())) {
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean
													.getSeqNum()),
													AppConstants.CITIZEN_INFO, Short
													.parseShort(indivSeqBean
															.getUserEndInd()));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {

						RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
						if (rmcInPrflColl != null) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl,
											indivSeqBean.getIndivSeqNum());
						} else {
							rmcInPrflColl = new RMC_IN_PRFL_Collection();
						}
						if (rmcInPrflCargo == null) {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setApp_num(appNumber);
							rmcInPrflCargo.setIndv_seq_num(indivSeqBean
									.getIndivSeqNum());
							rmcResponseProfileManager
							.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflColl.addCargo(rmcInPrflCargo);
						}
						// now we need to make required the employment

						rmcResponseProfileManager.makeAddNew(
								IRMCResponseProfileManager.CITIZENSHIP_INFO,
								rmcInPrflCargo, true);

						categorySelectionProfileManager
						.insertSequenceDetail(moveInHomeProfile, null,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										AppConstants.CITIZEN_INFO);
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								moveInHomeProfile, null,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO, Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(moveInHomeProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile, appNumber,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												AppConstants.CITIZEN_INFO);
					}
				}*/
			}

			// prgram display for each individual
			final APP_PGM_RQST_Collection programCollection = abProgramInformationBO
					.loadRmbProgramInformation(appNumber);
			final APP_PGM_RQST_Cargo programCargo = programCollection
					.getCargo(0);
			pageCollection.put("APP_PGM_RQST_Cargo", programCargo);

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					moveInHomeProfile);
			categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(moveInHomeProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(moveInHomeProfile);
			}

			categorySeqDetail.getCategoryType();
			Long.toString(categorySeqDetail.getCategorySequence());
			final String indvSeqNum = Short.toString(categorySeqDetail
					.getIndividualSequence());
			Short.toString(categorySeqDetail.getUserEndSelectionInd());

			final HouseHoldInfoBO houseHoldInfoBO = new HouseHoldInfoBO();
			final APP_PRGM_INDV_Collection appPrgmIndvColl = houseHoldInfoBO
					.loadAppPrgmIndvColl(appNumber, indvSeqNum);
			APP_PRGM_INDV_Cargo cwPrgmCargo = houseHoldInfoBO
					.splitPrgmIndvColl(appPrgmIndvColl,
							AppConstants.CWW_RECORD_IND);
			final APP_PRGM_INDV_Cargo rmPrgmCargo = houseHoldInfoBO
					.splitPrgmIndvColl(appPrgmIndvColl,
							AppConstants.RMC_MODIFIED_RECORD_IND);
			final APP_PRGM_INDV_Cargo rnPrgmCargo = houseHoldInfoBO
					.splitPrgmIndvColl(appPrgmIndvColl,
							AppConstants.RMC_NEW_RECORD_IND);

			boolean addBefPrgmColl = true;
			if (cwPrgmCargo != null || rmPrgmCargo != null) {
				if (rmPrgmCargo != null) {
					pageCollection.put("FRS_PRGM_INDV", rmPrgmCargo);
				} else {
					pageCollection.put("FRS_PRGM_INDV", cwPrgmCargo);
				}
				pageCollection.put("SEC_PRGM_INDV", cwPrgmCargo);
			} else {
				if (rnPrgmCargo != null) {
					pageCollection.put("FRS_PRGM_INDV", rnPrgmCargo);
				} else {
					cwPrgmCargo = new APP_PRGM_INDV_Cargo();
					// copy programs from case level to indv level for new
					// person in household
					if (rmcAppType) {
						programKeyArray = (short[]) programManager
								.loadProgramKey(appNumber)
								.get(FwConstants.ZERO);
						if (programKeyArray[AppConstants.PROGRAM_KEY_MA] == 1) {
							cwPrgmCargo.setMa_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setMa_ind(AppConstants.NO);
						}
						if (programKeyArray[AppConstants.PROGRAM_KEY_SNAP] == 1) {
							cwPrgmCargo.setFs_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setFs_ind(AppConstants.NO);
						}
						if (programKeyArray[AppConstants.PROGRAM_KEY_TANF] == 1) {
							cwPrgmCargo.setTa_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setTa_ind(AppConstants.NO);
						}
						if (programKeyArray[AppConstants.PROGRAM_KEY_CHILD] == 1) {
							cwPrgmCargo.setCc_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setCc_ind(AppConstants.NO);
						}
						if (programKeyArray[AppConstants.PROGRAM_KEY_WIC] == 1) {
							cwPrgmCargo.setWc_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setWc_ind(AppConstants.NO);
						}
					} else {
						if (AppConstants.ONE.equals(programCargo
								.getFma_rqst_ind())) {
							cwPrgmCargo.setMa_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setMa_ind(AppConstants.NO);
						}
						if (AppConstants.ONE.equals(programCargo
								.getFs_rqst_ind())) {
							cwPrgmCargo.setFs_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setFs_ind(AppConstants.NO);
						}
						if (AppConstants.ONE.equals(programCargo
								.getTanf_rqst_ind())) {
							cwPrgmCargo.setTa_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setTa_ind(AppConstants.NO);
						}
						if (AppConstants.ONE.equals(programCargo
								.getCc_rqst_ind())) {
							cwPrgmCargo.setCc_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setCc_ind(AppConstants.NO);
						}
						if (AppConstants.ONE.equals(programCargo
								.getWic_rqst_ind())) {
							cwPrgmCargo.setWc_ind(AppConstants.YES);
						} else {
							cwPrgmCargo.setWc_ind(AppConstants.NO);
						}
					}
					pageCollection.put("FRS_PRGM_INDV", cwPrgmCargo);
					addBefPrgmColl = false;
				}
			}

			appIndvColl = movedInBO.loadMovedInDetails(appNumber, indvSeqNum);
			String pageMode = null;

			// implement frst and sec cargos for jsp
			APP_INDV_Cargo cWIndvCargo = movedInBO.splitIndvColl(appIndvColl,
					AppConstants.CWW_RECORD_IND);
			final APP_INDV_Cargo rmIndvCargo = movedInBO.splitIndvColl(
					appIndvColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			final APP_INDV_Cargo rnIndvCargo = movedInBO.splitIndvColl(
					appIndvColl, AppConstants.RMC_NEW_RECORD_IND);

			boolean addBefColl = true;
			if (cWIndvCargo != null || rmIndvCargo != null) {
				pageMode = "show";

				if (rmIndvCargo != null) {
					pageCollection.put("FRS_APP_INDV", rmIndvCargo);
				} else {
					pageCollection.put("FRS_APP_INDV", cWIndvCargo);
				}
				pageCollection.put("SEC_APP_INDV", cWIndvCargo);
			} else {
				pageMode = "hide";

				if (rnIndvCargo != null) {
					pageCollection.put("FRS_APP_INDV", rnIndvCargo);
				} else {
					cWIndvCargo = new APP_INDV_Cargo();
					cWIndvCargo.setMa_ind(programCargo.getFma_rqst_ind());
					cWIndvCargo.setSnap_ind(programCargo.getFs_rqst_ind());
					cWIndvCargo.setTanf_ind(programCargo.getTanf_rqst_ind());
					cWIndvCargo.setCc_ind(programCargo.getCc_rqst_ind());
					cWIndvCargo.setWic_ind(programCargo.getWic_rqst_ind());
					pageCollection.put("FRS_APP_INDV", cWIndvCargo);
					addBefColl = false;
				}
			}

			pageCollection.put("PAGE_MODE", pageMode);

			final APP_PRGM_INDV_Collection befPrgmColl = new APP_PRGM_INDV_Collection();
			if (rmPrgmCargo != null) {
				befPrgmColl.addCargo(rmPrgmCargo);
			} else if (rnPrgmCargo != null) {
				befPrgmColl.addCargo(rnPrgmCargo);
			}
			if (cwPrgmCargo != null) {
				befPrgmColl.addCargo(cwPrgmCargo);
			}

			if (addBefPrgmColl) {
				pageCollection.put("APP_PRGM_INDV_Before_Collection",
						befPrgmColl);
			} else {
				beforeColl.remove("APP_PRGM_INDV_Before_Collection");
			}

			// building before collection for store method
			final APP_INDV_Collection befColl = new APP_INDV_Collection();
			if (rmIndvCargo != null) {
				befColl.addCargo(rmIndvCargo);
			} else if (rnIndvCargo != null) {
				befColl.addCargo(rnIndvCargo);
			}
			if (cWIndvCargo != null) {
				befColl.addCargo(cWIndvCargo);
			}
			if (addBefColl) {
				pageCollection.put("APP_INDV_Before_Collection", befColl);
				pageCollection.put("APP_INDV_Before_Collection2", befColl);
			} else {
				beforeColl.remove("APP_INDV_Before_Collection");
				beforeColl.remove("APP_INDV_Before_Collection2");
			}

			indvCustColl = peopleHandler.getSortedIndividualsByIndvSeqNum();
			pageCollection.put("INDIVIDUAL_Custom_Collection", indvCustColl);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					String.valueOf(indvSeqNum));
			pageCollection.put("CurrentPageStatus", String.valueOf(pageStatus));

			txnBean.setPageCollection(pageCollection);
			componentManager.getComponents("ARHMI", txnBean);

			beforeColl.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					moveInHomeProfile);
			beforeColl.putAll(pageCollection);
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);

			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoMovedInDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoMovedInDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoMovedInDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoMovedInDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMovedInDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoMovedInDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMovedInDetails() - START");

		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;
		APP_INDV_Collection appIndvColl = null;
		APP_PRGM_INDV_Collection appPrgmColl = null;
		APP_PRGM_INDV_Cargo appPrgmCargo = null;
		APP_PRGM_INDV_Collection appPrgmBefColl = null;
		APP_PRGM_INDV_Cargo appPrgmBefCargo = null;
		APP_INDV_Cargo appIndvCargo = null;
		APP_INDV_Cargo appIndvBeforeCargo = null;
		RMC_IN_PRFL_Collection rmcInPrflColl = null;
		RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
		final RMC_IN_PRFL_Cargo rmcInPrflBeforeCargo = null;
		RMC_IN_PRFL_Collection rmcInPrflSessionColl = null;
		RMC_IN_PRFL_Cargo rmcInPrflSessionCargo = null;
		INDIVIDUAL_Custom_Collection indvCustBeforeColl = null;
		String indvSeqNumber = null;
		final String peopleInYourHome = null;
		final String childOutofYourhome = null;
		PeopleHandler peopleHandler = null;
		MovedInBO movedInBO = null;
		HouseHoldInfoBO houseHoldInfoBO = null;
		int currentPageStatus = 0;
		String pageId = null;
		IndivTypeSeqBean indvSeqBean = null;
		final boolean ccFlag = false;
		final boolean wicFlag = false;
		final boolean eaFlag = false;
		final boolean validatePOBFlag = false;
		final boolean ccFlagOnly = false;
		boolean taxInd = false;
		boolean dependentInd = false;
		boolean maFlag = false;
		

		String pageMode = FwConstants.EMPTY_STRING;
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();			
			final IProgramManager programManager = FwProgramManager
					.getInstance();						
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			
			final Map pgmKey = programManager.loadProgramKey(appNumber);
			final short[] programKeyArray = (short[]) pgmKey
					.get(AppConstants.ZERO);
			
			if (programKeyArray[0] == 1){
				maFlag = true;
			}
			
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			appIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");
			appPrgmColl = (APP_PRGM_INDV_Collection) pageCollection
					.get("APP_PRGM_INDV_Collection");
			rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get("RMC_IN_PRFL_Collection");
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			pageMode = (String) beforeColl.get("PAGE_MODE");
			final boolean rmcAppType = false;
			if (appIndvColl != null && !appIndvColl.isEmpty()) {
				appIndvCargo = appIndvColl.getCargo(0);
			}
			if (appIndvCargo != null
					&& FwConstants.YES.equals(appIndvCargo
							.getTax_joint_file_ind())) {
				taxInd = true;
			}
			if (appIndvCargo != null
					&& FwConstants.YES.equals(appIndvCargo
							.getTax_dp_outside_home_ind())) {
				dependentInd = true;
			}
			
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				rmcInPrflCargo = rmcInPrflColl.getCargo(0);
			}
			if (appPrgmColl != null && !appPrgmColl.isEmpty()) {
				appPrgmCargo = appPrgmColl.getCargo(0);
				normalizeAppPrgmIndv(appPrgmCargo);
			}
			if (session != null
					&& session.get(FwConstants.ACCESS_APPLICATION_TYPE) != null
					&& session.get(FwConstants.ACCESS_APPLICATION_TYPE).equals(
							String.valueOf(FwConstants.RMC_APP_TYPE))) {
			}
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final SortedSet movedInHomeProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(movedInHomeProfile);
			movedInBO = new MovedInBO();
			houseHoldInfoBO = new HouseHoldInfoBO();
			final String realSSN = (String) request.get("realSSN");
			final String maskSSNString = "XXXXX";
			final String maskSSNString2 = "XXXXXXXXX";
			final boolean hasSSNMasked = appIndvCargo.getSsn_num()
					.contains("X") || appIndvCargo.getSsn_num().contains("x") ? true
					: false;
			if (realSSN != null && realSSN.length() == 9
					&& appIndvCargo.getSsn_num() != null
					&& appIndvCargo.getSsn_num().length() == 9 && hasSSNMasked) {
				if (maskSSNString2.equalsIgnoreCase(appIndvCargo.getSsn_num())
						|| appIndvCargo.getSsn_num().indexOf(maskSSNString) == 0) {
					appIndvCargo.setSsn_num(realSSN);
				}
			}
			if (beforeColl != null) {
				indvSeqNumber = (String) beforeColl
						.get(AppConstants.INDV_SEQUENCE_NUMBERS);

				indvCustBeforeColl = (INDIVIDUAL_Custom_Collection) beforeColl
						.get("INDIVIDUAL_Custom_Collection");
				indvSeqBean = (IndivTypeSeqBean) beforeColl
						.get("RMB_DETAIL_KEY_BEAN");
				pageMode = (String) beforeColl.get("PAGE_MODE");
				pageCollection.put("SEC_APP_INDV",
						beforeColl.get("SEC_APP_INDV"));
				pageCollection.put("FRS_APP_INDV",
						beforeColl.get("FRS_APP_INDV"));
				pageCollection.put("RMC_CATEGORY_PAGE_PRFL",
						beforeColl.get("RMC_CATEGORY_PAGE_PRFL"));
			}
			final APP_INDV_Collection appIndvBeforeColl = (APP_INDV_Collection) beforeColl
					.get("APP_INDV_Before_Collection");
			appPrgmBefColl = (APP_PRGM_INDV_Collection) beforeColl
					.get("APP_PRGM_INDV_Before_Collection");
			final APP_INDV_Collection appBeforeColl = (APP_INDV_Collection) beforeColl
					.get("APP_INDV_Before_Collection2");

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.get("SEC_APP_INDV");
			final ARHMIValidator movedInValidator = new ARHMIValidator();
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			if (appPrgmBefColl != null) {
				appPrgmBefCargo = appPrgmBefColl.getCargo(0);
			}
			if (appIndvBeforeColl != null) {
				appIndvBeforeCargo = appIndvBeforeColl.getCargo(0);
				String birthDate = appIndvBeforeCargo.getBrth_dt();
				if (birthDate != null  && "show".equalsIgnoreCase(pageMode)) {
					if (!"".equals(birthDate.trim())
							&& birthDate.length() >= 10) {
						birthDate = birthDate.substring(0, 10);
					}
					if (AppConstants.HIGH_DATE.equals(birthDate)) {
						birthDate = "";
					} else if (birthDate.length() >= 10
							&& (birthDate.charAt(4) == '-' || birthDate
									.charAt(4) == '/')) {
						birthDate = DisplayFormatter.getInstance()
								.getMMDDYYYYDate(birthDate);
					}
					appIndvCargo.setBrth_dt(birthDate);
				}
				
				final String ssn = appIndvBeforeCargo.getSsn_num();
				if (!"".equals(ssn) && ssn != null && ssn.length() == 9  && "show".equalsIgnoreCase(pageMode)) {
					appIndvCargo.setSsn_num(appIndvBeforeCargo.getSsn_num());
				}
				
				
			}

			if (backToMyAccess == null) {
				movedInValidator.validateHouseholdMemberDetail(appIndvCargo,
						peopleInYourHome, childOutofYourhome,
						currentPageStatus, indvSeqNumber, appIndvBeforeColl,
						beforeColl, ccFlag, eaFlag, validatePOBFlag,
						ccFlagOnly, wicFlag,txnBean,maFlag);
			}
			if (checkBackToMyAccessSelected(request)
					|| movedInValidator.hasMessages()) {
				if (backToMyAccess == null) {
					final String reqWarningMsgs = (String) request
							.get(FwConstants.WARNING_MSG_DETAILS);
					if (!checkForWarningMesgs(reqWarningMsgs,
							movedInValidator.getMessageList())) {
						request.put(FwConstants.MESSAGE_LIST,
								movedInValidator.getMessageList());
						pageCollection.put("APP_INDV_Collection", appIndvColl);
						pageCollection.put("APP_PRGM_INDV_Collection",
								appPrgmColl);
						pageCollection.put("RMC_IN_PRFL_Collection",
								rmcInPrflColl);
						pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
								indvSeqNumber);
						pageCollection.put("CurrentPageStatus",
								String.valueOf(currentPageStatus));
						pageCollection.put("SEC_APP_INDV",
								beforeColl.get("SEC_APP_INDV"));
						pageCollection.put("FRS_APP_INDV",
								beforeColl.get("FRS_APP_INDV"));
						pageCollection.put("APP_PGM_RQST_Cargo",
								beforeColl.get("APP_PGM_RQST_Cargo"));
						pageCollection.put("PAGE_MODE", pageMode);
						if (indvCustBeforeColl != null) {
							pageCollection.put("INDIVIDUAL_Custom_Collection",
									indvCustBeforeColl);
						}
						pageCollection
								.put(FwConstants.PAGE_COMPONENT_LIST,
										beforeColl
												.get(FwConstants.PAGE_COMPONENT_LIST));
						pageCollection.put("RMC_CATEGORY_PAGE_PRFL",
								beforeColl.get("RMC_CATEGORY_PAGE_PRFL"));
						pageCollection.put("FRS_APP_INDV", appIndvCargo);
						pageCollection.put("FRS_PRGM_INDV", appPrgmCargo);
						pageCollection.put("SEC_PRGM_INDV",
								beforeColl.get("SEC_PRGM_INDV"));
						return;
					}
				} else {
					pageCollection.put("APP_INDV_Collection", appIndvColl);
					pageCollection.put("APP_PRGM_INDV_Collection", appPrgmColl);
					pageCollection.put("RMC_IN_PRFL_Collection", rmcInPrflColl);
					pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
							indvSeqNumber);
					pageCollection.put("CurrentPageStatus",
							String.valueOf(currentPageStatus));
					if (indvCustBeforeColl != null) {
						pageCollection.put("INDIVIDUAL_Custom_Collection",
								indvCustBeforeColl);
					}
					pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
							beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
					pageCollection.put("RMC_CATEGORY_PAGE_PRFL",
							beforeColl.get("RMC_CATEGORY_PAGE_PRFL"));
					return;
				}
			}

			// real data from page + copy others from before cargo
			if (session.get(AppConstants.RMC_IN_PRFL_MASTER) != null) {
				rmcInPrflSessionColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
			}

			// compare and update changed fields only
			if (appIndvCargo.getSuffix_name() != null
					&& !FwConstants.HYPHEN_HYPHEN.equals(appIndvCargo
							.getSuffix_name())) {
				appIndvCargo.setSuffix_name(null);
			}
			if (appIndvCargo.getMid_init() != null
					&& FwConstants.EMPTY_STRING.equals(appIndvCargo
							.getMid_init())) {
				appIndvCargo.setMid_init(null);
			}
			if (appIndvCargo.getMrtl_stat_cd() != null
					&& FwConstants.DEFAULT_DROPDOWN_SEL.equals(appIndvCargo
							.getMrtl_stat_cd())) {
				appIndvCargo.setMrtl_stat_cd(null);
			}
			if (appIndvCargo.getSs_num_app_dt() != null
					&& appIndvCargo.getSs_num_app_dt().trim().length() == 0) {
				appIndvCargo.setSs_num_app_dt(null);
			} else if (appIndvCargo.getSs_num_app_dt() != null
					&& appIndvCargo.getSs_num_app_dt().trim().length() > 0) {
				appIndvCargo.setSs_num_app_dt(displayFormatter
						.getYYYYMMDDDate(appIndvCargo.getSs_num_app_dt()));
			}
			if (appIndvCargo.getAlias_suffix_name() != null
					&& FwConstants.HYPHEN_HYPHEN.equals(appIndvCargo
							.getAlias_suffix_name())) {
				appIndvCargo.setAlias_suffix_name(null);
			}

			// if not new record //this will also make isDirty true if there are
			// changes to be updated
			if (appIndvBeforeCargo != null) {
				appIndvCargo = updateWithPageCollection(appIndvBeforeCargo,
						appIndvCargo);

			}
			if (appPrgmBefCargo != null) {
				appPrgmCargo = updatePrgmIndvWithPageCollection(
						appPrgmBefCargo, appPrgmCargo);
			} else {
				appPrgmCargo.setApp_num(appNumber);
				appPrgmCargo.setIndv_seq_num(indvSeqNumber);
				appPrgmCargo.setDirty(true);
			}

			final StringBuilder dateConverter = new StringBuilder();
			final String sAppDate = appIndvCargo.getBrth_dt();
			dateConverter.append(sAppDate.substring(6, 10)).append("-")
					.append(sAppDate.substring(0, 2)).append("-")
					.append(sAppDate.substring(3, 5));
			appIndvCargo.setBrth_dt(dateConverter.toString());
			if (appIndvBeforeCargo != null
					&& appIndvBeforeCargo.getPrim_prsn_sw() != null) {
				appIndvCargo.setPrim_prsn_sw(appIndvBeforeCargo
						.getPrim_prsn_sw());
			} else {
				appIndvCargo.setPrim_prsn_sw(AppConstants.NO);
			}

			// what is this indicator?
			if (appIndvCargo.getRlvn_ind() == null) {
				if (!rmcAppType) {
					appIndvCargo.setRlvn_ind(FwConstants.ONE);
				} else {
					appIndvCargo.setRlvn_ind(FwConstants.ZERO);
				}
			}

			String prgmRecordInd = null;
			if (appPrgmBefColl != null && !appPrgmBefColl.isEmpty()) {
				if (appPrgmBefColl.size() > 1) {
					prgmRecordInd = FwConstants.ROWACTION_UPDATE;
				} else {
					if (AppConstants.CWW_RECORD_IND.equals(appPrgmBefColl
							.getCargo(0).getSrc_app_ind())) {
						prgmRecordInd = FwConstants.ROWACTION_INSERT;
					} else {
						prgmRecordInd = FwConstants.ROWACTION_UPDATE;
					}
				}
			} else {
				prgmRecordInd = FwConstants.ROWACTION_INSERT;
			}
			appPrgmCargo.setRowAction(prgmRecordInd);

			// determine row action insert/update
			String recordInd = null;
			if (appBeforeColl != null && !appBeforeColl.isEmpty()) {
				if (appBeforeColl.size() > 1) {

					recordInd = FwConstants.ROWACTION_UPDATE;
				} else {
					if (AppConstants.CWW_RECORD_IND.equals(appBeforeColl
							.getCargo(0).getSrc_app_ind())) {
						recordInd = FwConstants.ROWACTION_INSERT;
					} else {
						recordInd = FwConstants.ROWACTION_UPDATE;
					}
				}

			} else {
				recordInd = FwConstants.ROWACTION_INSERT;
			}

			appIndvCargo.setRowAction(recordInd);

			String sourceAppInd = null;
			if (pageMode != null) {
				if ("show".equals(pageMode)) {
					sourceAppInd = AppConstants.RMC_MODIFIED_RECORD_IND;
				} else {
					sourceAppInd = AppConstants.RMC_NEW_RECORD_IND;
				}
			}
			appIndvCargo.setSrc_app_ind(sourceAppInd);
			// program change selection has the same source app indicator
			appPrgmCargo.setSrc_app_ind(sourceAppInd);

			appIndvCargo.setApp_num(appNumber);
			if (appIndvCargo.getIndv_seq_num() == null) {
				appIndvCargo
						.setIndv_seq_num(String.valueOf(categorySeqDetailBean
								.getIndividualSequence()));
			}

			if (appPrgmCargo.getIndv_seq_num() == null) {
				appPrgmCargo.setIndv_seq_num(appIndvCargo.getIndv_seq_num());
			}

			if (appPrgmCargo.isDirty()) {
				final APP_PRGM_INDV_Collection prgmColl = new APP_PRGM_INDV_Collection();
				prgmColl.addCargo(appPrgmCargo);
				houseHoldInfoBO.storeAppPrgmIndvDetails(prgmColl);
			}

			boolean ageGenderChangeFlag = false;
			// when someone moved into household add to people handler
			if (peopleHandler.getIndividual(appIndvCargo.getIndv_seq_num()) == null) {
				peopleHandler.addNewIndividual(appIndvCargo);
				ageGenderChangeFlag = true;
			} else {
				final APP_INDV_Collection appIndvCol = new APP_INDV_Collection();
				if (appIndvCargo.isDirty()
						|| FwConstants.ROWACTION_INSERT.equals(recordInd)) {
					appIndvCol.addCargo(appIndvCargo);
					if (appIndvCargo.isDirty()) {
						movedInBO.storeAppIndvDetails(appIndvCol);
						peopleHandler.updateRMBIndividual(appIndvCargo);
					}
				}
			}

			if (appIndvBeforeCargo != null) {
				if (appIndvCargo.isDirty()) {
					if (!AppConstants.HIGH_DATE.equals(appIndvBeforeCargo
							.getBrth_dt())
							&& !appIndvBeforeCargo.getBrth_dt().equals(
									appIndvCargo.getBrth_dt())) {
						ageGenderChangeFlag = true;
					}
					if (appIndvBeforeCargo.getSex_ind().trim().length() > 0
							&& !appIndvBeforeCargo.getSex_ind().equals(
									appIndvCargo.getSex_ind())) {
						ageGenderChangeFlag = true;
					}

					if (ageGenderChangeFlag
							&& currentPageStatus != FwConstants.DRIVER_REQUIRED) {
						if (rmcInPrflBeforeCargo != null) {
							if (!FwConstants.NO.equals(rmcInPrflBeforeCargo
									.getPreg_resp())) {
								movedInBO.deletePregnancy(indvSeqNumber,
										appNumber,
										AppConstants.RMC_NEW_RECORD_IND);
								final int size = rmcInPrflSessionColl.size();
								for (int i = 0; i < size; i++) {
									rmcInPrflSessionCargo = rmcInPrflSessionColl
											.getCargo(i);
									if (rmcInPrflSessionCargo.getIndv_seq_num()
											.equals(indvSeqNumber)) {
										rmcInPrflSessionCargo
												.setPreg_resp(FwConstants.NO);
									}
								}
							}
							final IndividualAge indvBeforeAge = peopleHandler
									.getIndividualAge(indvSeqNumber);

							if (indvBeforeAge.getYears() < 19) {
								movedInBO.deleteAbsentParent(indvSeqNumber,
										appNumber);
							}
							movedInBO.deleteRelationship(indvSeqNumber,
									appNumber);
							final int indvYears = indvBeforeAge.getYears();
							if (indvYears == 0 || indvYears == 1
									&& indvBeforeAge.getMonths() < 1) {
								movedInBO.deleteNewBorn(indvSeqNumber,
										appNumber);
							}
							if (indvYears < 49) {
								movedInBO.deleteSchoolEnrollment(indvSeqNumber,
										appNumber);
							}
						}
					}

				} else {
					ageGenderChangeFlag = false;
				}

			} else {
				categorySelectionProfileManager.updateSequence(
						movedInHomeProfile, null,
						categorySeqDetailBean.getIndividualSequence(), 0,
						categorySeqDetailBean.getCategoryType());
			}

			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				rmcInPrflCargo = rmcResponseProfileManager.getProfile(
						rmcInPrflSessionColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager
							.makeComplete(
									rmcResponseProfileManager
											.getResponseByType(
													IRMCResponseProfileManager.PRSN_INFO_STAT_SW,
													categorySeqDetailBean
															.getCategoryType()),
									rmcInPrflCargo, true);
				}
			}
			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					movedInHomeProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			final Map catType = new HashMap();
			catType.put(AppConstants.PERSONAL_INFO, AppConstants.PERSONAL_INFO);
			if (categorySelectionProfileManager.areAllSequencesComplete(
					movedInHomeProfile, catType)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
						.getNextSequenceDetail(movedInHomeProfile);
			}

			// schedule pages in other sections
			// school enrollment
			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			final SchoolEnrollmentBO schoolBO = new SchoolEnrollmentBO();
			final List schoolList = schoolBO.findSchoolEnrollmentPeople(
					peopleHandler, programKey);
			if (schoolList != null && !schoolList.isEmpty() && rmcAppType) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHSE",
						driverArray, appNumber);
			} else {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHSE", driverArray, appNumber);
			}

			if (ageGenderChangeFlag && rmcInPrflSessionColl.size()>2) {
				final String[] requiredPages = { "ARHRL" };
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						requiredPages, driverArray, appNumber);

			}

			movedInBO.completenessCheck(appIndvCargo);

			// tax stuff
			final String[] translatedProfileArray = new String[2];
			if (taxInd) {
				if (session.get(AppConstants.RMC_IN_PRFL_MASTER) != null) {
					rmcInPrflSessionColl = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					RMC_IN_PRFL_Cargo newCargo;
					RMC_IN_PRFL_Collection newCollection = new RMC_IN_PRFL_Collection();
					for (int i = 0; i < rmcInPrflSessionColl.size(); i++) {
						newCargo = rmcInPrflSessionColl.getCargo(i);
						if (indvSeqNumber.equals(newCargo.getIndv_seq_num())) {
							newCargo.setTax_info_ind("R");
							newCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							newCollection.addCargo(newCargo);
							newCollection.persist(FwConstants.DAO);
							translatedProfileArray[0] = newCargo
									.getTax_info_ind();
						}
					}
				}

				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARTXI",
						driverArray, appNumber);
			}else{
				ABHouseHoldMemberBO houseHoldBo = new ABHouseHoldMemberBO();
				final APP_INDV_Cargo[] individualsTax = houseHoldBo.getRMBIndividualsTaxInfo(appNumber);
				int taxReturnCounter = 0;
				for (int j = 0; j < individualsTax.length; j++) {
					final APP_INDV_Cargo tempCargo = individualsTax[j];
					if (FwConstants.YES.equals(tempCargo.getTax_joint_file_ind())) {
						taxReturnCounter ++;
					}
				}
				if(taxReturnCounter<1){
					driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER, "ARTXI",
							driverArray, appNumber);
					driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER, "ARTDP",
							driverArray, appNumber);
				}
			}
			if (dependentInd && session.get(AppConstants.RMC_IN_PRFL_MASTER) != null) {
				
					rmcInPrflSessionColl = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					RMC_IN_PRFL_Collection newCollection = new RMC_IN_PRFL_Collection();
					Boolean dependentflag = updateTaxclaimdependantresp(
							rmcInPrflSessionColl, indvSeqNumber,
							translatedProfileArray, newCollection);
					if(dependentflag){
						driverManager.makeRequired(FwConstants.RMC_DRIVER, ARTAX,
								driverArray, appNumber);	
					}
			}
			
			pageCollection.put("PAGE_MODE", pageMode);
			beforeColl.put("PAGE_MODE", pageMode);
			pageCollection.put("APP_INDV_Collection", appIndvColl);
			beforeColl.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					movedInHomeProfile);
			pageCollection.put("RMB_DETAIL_KEY_BEAN", indvSeqBean);
			if(ageGenderChangeFlag)	pageCollection.put("AgeGenderChangeFlag", ageGenderChangeFlag);
			
			beforeColl.putAll(pageCollection);
			session.put(FwConstants.DETAIL_KEY_BEAN, indvSeqBean);

			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			session.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					String.valueOf(indvSeqNumber));
			session.remove(AppConstants.SET_FILING_DATE);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoMovedInDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoMovedInDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoMovedInDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoMovedInDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMovedInDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	private Boolean updateTaxclaimdependantresp(
			RMC_IN_PRFL_Collection rmcInPrflSessionColl, String indvSeqNumber,
			final String[] translatedProfileArray,
			RMC_IN_PRFL_Collection newCollection) {
		RMC_IN_PRFL_Cargo newCargo;
		Boolean dependentflag = false;
		for (int i = 0; i < rmcInPrflSessionColl.size(); i++) {
			newCargo = rmcInPrflSessionColl.getCargo(i);
			if (indvSeqNumber.equals(newCargo.getIndv_seq_num())) {
				newCargo.setTax_claim_dependant_resp("R");
				newCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				newCollection.addCargo(newCargo);
				newCollection.persist(FwConstants.DAO);
				translatedProfileArray[1] = newCargo
						.getTax_claim_dependant_resp();
				dependentflag = true;
			}
		}
		return dependentflag;
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoMovedOutDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMovedOutDetails() - START");

		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoMovedOutDetails:Start");
			// Getting the session
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			Map pageCollection = new HashMap();
			pageCollection = txnBean.getPageCollection();

			// build category selection profile
			final String[] catType = new String[] { AppConstants.LEFT_THE_HOME,
					AppConstants.SOMEONE_DIED };
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			// Get appNumber
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			final Map catTypes = new HashMap();
			catTypes.put(AppConstants.LEFT_THE_HOME, AppConstants.LEFT_THE_HOME);
			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			if(categorySelectionProfile == null||categorySelectionProfileManager.isEmpty(categorySelectionProfile)){
				categorySelectionProfile = categorySelectionProfileManager.loadCategoryChangeSelectionProfile(appNumber);
			}
			
			final LivingArrangementBO livingArrBo = new LivingArrangementBO();
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			SortedSet leftHomeProfile = null;
			if (!currentPageID.equals(previousPageId)) {
				categorySelectionProfile = categorySelectionProfileManager.loadCategoryChangeSelectionProfile(appNumber);
				leftHomeProfile = createPageProfile(categorySelectionProfile,
						catType);

//				if (pageStatus != FwConstants.DRIVER_REQUIRED) {
//
//					final APP_INDV_Collection newIndvColl = livingArrBo
//							.getNewIndvDetails(appNumber);
//					if (newIndvColl != null && !newIndvColl.isEmpty()) {
//						APP_INDV_Cargo indvLiveCargo = null;
//						String cat = null;
//						final int newIndvCollSize = newIndvColl.size();
//						for (int i = 0; i < newIndvCollSize; i++) {
//							indvLiveCargo = newIndvColl.getCargo(i);
//							indvLiveCargo.getLive_arng_typ();
//
//							cat = AppConstants.LEFT_THE_HOME;
//							categorySelectionProfileManager
//							.insertExistingSequenceDetail(
//									leftHomeProfile, null, null,
//									Short.parseShort(indvLiveCargo
//											.getIndv_seq_num()), 0, cat);
//
//						}
//					}
//				}
//				if (pageStatus == FwConstants.DRIVER_REQUIRED
//						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
//					// set the current record indicator to the first one
//					categorySelectionProfileManager
//					.setCurrentRecordIndToFirst(leftHomeProfile);
//				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(leftHomeProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				final Map beforeColl = (Map) session
						.get(FwConstants.BEFORE_COLLECTION);
				leftHomeProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			final IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);

			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								leftHomeProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					String userEndIndicator = indivSeqBean.getUserEndInd();
					if (userEndIndicator == null) {
						userEndIndicator = FwConstants.ZERO;
					}

					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(userEndIndicator)) {
						categorySelectionProfileManager
						.updateUserEndSelInd(leftHomeProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							leftHomeProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != Short
								.parseShort(userEndIndicator)) {
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType(),
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				} else {
					if (FwConstants.ONE.equals(indivSeqBean.getSeqNum())) {
						RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
						if (rmcInPrflColl != null) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl,
											indivSeqBean.getIndivSeqNum());
						} else {
							rmcInPrflColl = new RMC_IN_PRFL_Collection();
						}
						if (rmcInPrflCargo == null) {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setApp_num(appNumber);
							rmcInPrflCargo.setIndv_seq_num(indivSeqBean
									.getIndivSeqNum());
							rmcResponseProfileManager
							.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflColl.addCargo(rmcInPrflCargo);
						}
						final short[] responseArray = new short[] { IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP /*
						 * ,
						 * rmcResponseProfileManager
						 * .
						 * getResponseByType
						 * (
						 * IRMCResponseProfileManager
						 * .
						 * MOVED_OUT_OF_HOME_RESP
						 * ,
						 * indivSeqBean
						 * .
						 * getType
						 * (
						 * )
						 * )
						 */};
						rmcResponseProfileManager.makeAddNew(responseArray,
								rmcInPrflCargo, true);
						categorySelectionProfileManager
						.insertSequenceDetail(leftHomeProfile, null,
								AppConstants.LEFT_THE_HOME, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
						categorySelectionProfileManager
						.insertSequenceDetail(categorySelectionProfile,
								appNumber, AppConstants.LEFT_THE_HOME,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertSequenceDetail(leftHomeProfile, null,
								AppConstants.LEFT_THE_HOME, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(leftHomeProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());

						categorySelectionProfileManager
						.insertSequenceDetail(categorySelectionProfile,
								appNumber, AppConstants.LEFT_THE_HOME,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put("Liquid_Asset_IndSeqBean", indivSeqBean);
				session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
						categorySelectionProfile);
			}

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					leftHomeProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(leftHomeProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(leftHomeProfile);
			}
			final String categoryType = categorySeqDetail.getCategoryType();
			Long.toString(categorySeqDetail.getCategorySequence());
			final String indvSeqNum = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final LivingArrangementBO livingArrBO = new LivingArrangementBO();
			APP_INDV_Collection indvLiveChgColl = new APP_INDV_Collection();
			final APP_INDV_Cargo indvLiveChgCargo = new APP_INDV_Cargo();
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, currentPageID,
					driverArray);

			indvLiveChgColl = livingArrBO.loadIndvLivingArrangementDetails(
					appNumber, indvSeqNum);

			// EDSP

			// EDSP
			if (indvLiveChgColl != null
					&& !indvLiveChgColl.isEmpty()
					&& (pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					|| pageStatus == FwConstants.DRIVER_COMPLETE || pageStatus == FwConstants.DRIVER_REQUIRED)) {
				indvLiveChgColl.size();
				final APP_INDV_Collection indvLiveNewColl = new APP_INDV_Collection();
				APP_INDV_Cargo indvLiveCargo = splitIndvColl(indvLiveChgColl,
						AppConstants.RMC_END_RECORD_IND);
				if (indvLiveCargo != null) {
					indvLiveNewColl.add(indvLiveCargo);
				} else {
					indvLiveCargo = splitIndvColl(indvLiveChgColl,
							AppConstants.CWW_RECORD_IND);
					indvLiveNewColl.add(indvLiveCargo);
				}
				// edsp temp

				indvLiveChgColl = indvLiveNewColl;
			}
			pageCollection.put("APP_INDV_Collection", indvLiveChgColl);
			pageCollection.put("PAGE_STATUS", String.valueOf(pageStatus));
			pageCollection.put("CATEGORY_TYPE", categoryType);
			session.put(AppConstants.APP_NUMBER, appNumber);
			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNum));
			pageCollection.put(AppConstants.BIRTH_DATE,
					peopleHandler.getBirthDt(indvSeqNum));
			pageCollection.put("INDV_SEQ_NUM", indvSeqNum);
			session.put(AppConstants.APP_INDV, indvLiveChgCargo);
			txnBean.setPageCollection(pageCollection);

			// Add the page collection to before collection
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoMovedOutDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoMovedOutDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoMovedOutDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoMovedOutDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMovedOutDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Split indv coll.
	 *
	 * @param indvColl the indv coll
	 * @param recordIndicator the record indicator
	 * @return the AP p_ ind v_ cargo
	 */
	private APP_INDV_Cargo splitIndvColl(final APP_INDV_Collection indvColl,
			final String recordIndicator) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.splitIndvColl() - START");
		try {
			if (indvColl != null && !indvColl.isEmpty()) {
				final int indvCollSize = indvColl.size();
				APP_INDV_Cargo indvCargo = null;
				for (int i = 0; i < indvCollSize; i++) {
					indvCargo = indvColl.getCargo(i);
					if (indvCargo.getSrc_app_ind().equals(recordIndicator)) {
						return indvColl.getCargo(i);
					}
				}

			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.splitIndvColl() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return null;
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("splitIndvColl");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "splitIndvColl");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"splitIndvColl", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "splitIndvColl");
		}
	}
	
	private APP_INDV_Collection splitCollection(APP_INDV_Collection aColl, String srcAppIndicator) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.splitCollection() - START");

		APP_INDV_Collection resultColl = new APP_INDV_Collection();

		for (int i = 0; i < aColl.size(); i++) {
			if (srcAppIndicator.equals(aColl.getCargo(i).getSrc_app_ind())) {
				resultColl.addCargo(aColl.getCargo(i));
			}
		}
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.splitCollection() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
				+ AppConstants.SPACE + AppConstants.MILLISECONDS);
		return resultColl;

	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoMovedOutDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMovedOutDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get App Number
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final LivingArrangementBO livingArrBo = new LivingArrangementBO();

			// build category selection profile
			 SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			
			if(categorySelectionProfile == null){
				categorySelectionProfile = categorySelectionProfileManager.loadCategoryChangeSelectionProfile(appNum) ;
				
			}

			// get the BeforeCollection
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final SortedSet leftTheHomeProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			// get RMC PRFL from session
			final RMC_IN_PRFL_Collection appInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			// EDSP table change

			final APP_INDV_Collection beforeCollIndvLiveChgColl = (APP_INDV_Collection) beforeColl
					.get("APP_INDV_Collection");
			APP_INDV_Cargo indvLiveBeforeCargo = null;

			final APP_INDV_Collection appIndvCollection = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");
			final APP_INDV_Cargo appIndvCargo = appIndvCollection.getCargo(0);

			final Map categoryTypes = new HashMap();
			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(leftTheHomeProfile);
			final long catSeqNum = categorySeqDetailBean.getCategorySequence();
			final String catType = categorySeqDetailBean.getCategoryType();
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			boolean valInd = false;
			// Setting the indv_seq_num of the current individual. Moved here
			// for PCR 31063 as indvseq is null on validation.

			appIndvCargo.setIndv_seq_num(String.valueOf(categorySeqDetailBean
					.getIndividualSequence()));

			categoryTypes.put("CATEGOTY_TYPE", catType);
			final String firstName = (String) beforeColl
					.get(AppConstants.FIRST_NAME);

			final String birDate = (String) beforeColl
					.get(AppConstants.BIRTH_DATE);

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			final MovedOutValidator arhmoVal = new MovedOutValidator();
			if (backToMyAccess == null) {
				arhmoVal.validateARHMO(appIndvCargo, catType, firstName,
						birDate);
			}

			if (checkBackToMyAccessSelected(request) || arhmoVal.hasMessages()) {
				valInd = true;
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							arhmoVal.getMessageList());
				}
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CATEGORY_TYPE", catType);
				pageCollection.put("APP_INDV_Collection", appIndvCollection);
				pageCollection
				.put("PAGE_STATUS", beforeColl.get("PAGE_STATUS"));
				pageCollection.put("Validation_ind", String.valueOf(valInd));
				pageCollection.put("INDV_SEQ_NUM",
						beforeColl.get("INDV_SEQ_NUM"));
				return;

			}
			String livArrngmnt = null;

			if (beforeCollIndvLiveChgColl != null
					&& !beforeCollIndvLiveChgColl.isEmpty()) {
				final int size2 = beforeCollIndvLiveChgColl.size();
				for (int i = 0; i < size2; i++) {
					indvLiveBeforeCargo = beforeCollIndvLiveChgColl.getCargo(i);
					livArrngmnt = indvLiveBeforeCargo.getLive_arng_typ();

					if (appIndvCargo.getIndv_seq_num().equals(
							indvLiveBeforeCargo.getIndv_seq_num())) {

						if (livArrngmnt != null) {
							if (AppConstants.SOMEONE_DIED.equals(catType)
									&& AppConstants.SOMEONE_DIED
									.equals(livArrngmnt)) {
								break;
							}
							if (AppConstants.LEFT_THE_HOME.equals(catType)
									&& !AppConstants.SOMEONE_DIED
									.equals(livArrngmnt)
									&& !AppConstants.DIVORCE_INDICATOR
									.equals(livArrngmnt)
									&& !AppConstants.MARRIAGE_INDICATOR
									.equals(livArrngmnt)) {
								break;
							}
						}
					}
				}

			}

			if (AppConstants.LEFT_THE_HOME.equals(catType)) {

				final APP_INDV_Collection indvUpdtColl = new APP_INDV_Collection();
				APP_INDV_Cargo indvCar = new APP_INDV_Cargo();
				if (AppConstants.RMC_END_RECORD_IND
						.equalsIgnoreCase(indvLiveBeforeCargo.getSrc_app_ind())) {
					indvCar = (APP_INDV_Cargo) indvLiveBeforeCargo.clone();
					indvCar.setRowAction(FwConstants.ROWACTION_UPDATE);
					indvCar.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
					indvCar.setLeft_home_reason_cd(appIndvCargo
							.getLeft_home_reason_cd());
					if (appIndvCargo != null
							&& appIndvCargo.getLeft_home_dt() != null
							&& appIndvCargo.getLeft_home_dt().trim().length() != 0
							&& appIndvCargo.getLeft_home_dt().charAt(2) == '/') {
						final StringBuilder dateConverter = new StringBuilder();
						final String sAppDate = appIndvCargo.getLeft_home_dt();
						dateConverter.append(sAppDate.substring(6, 10))
						.append("-").append(sAppDate.substring(0, 2))
						.append("-").append(sAppDate.substring(3, 5));
						indvCar.setLeft_home_dt(dateConverter.toString());
						indvCar.setChg_dt(sAppDate);
					} else {
						indvCar.setLeft_home_dt(null);
					}
					indvCar.setDt_entry_into_us(null);
					indvUpdtColl.addCargo(indvCar);
					indvCar = (APP_INDV_Cargo) isChanged(indvLiveBeforeCargo,
							indvCar);
					if (indvCar.isDirty()) {
						livingArrBo.storeLivingArrangementDetails(indvUpdtColl);
					}
				} else {
					indvCar = (APP_INDV_Cargo) indvLiveBeforeCargo.clone();
					indvCar.setRowAction(FwConstants.ROWACTION_INSERT);
					indvCar.setLeft_home_reason_cd(appIndvCargo
							.getLeft_home_reason_cd());
					if (appIndvCargo != null
							&& appIndvCargo.getLeft_home_dt() != null
							&& appIndvCargo.getLeft_home_dt().trim().length() != 0
							&& appIndvCargo.getLeft_home_dt().charAt(2) == '/') {
						final StringBuilder dateConverter = new StringBuilder();
						final String sAppDate = appIndvCargo.getLeft_home_dt();
						dateConverter.append(sAppDate.substring(6, 10))
						.append("-").append(sAppDate.substring(0, 2))
						.append("-").append(sAppDate.substring(3, 5));
						indvCar.setLeft_home_dt(dateConverter.toString());
						indvCar.setChg_dt(sAppDate);
					} else {
						indvCar.setLeft_home_dt(null);
					}
					indvCar.setDt_entry_into_us(null);
					indvCar.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
					indvUpdtColl.addCargo(indvCar);

					livingArrBo.storeLivingArrangementDetails(indvUpdtColl);
				}
				categorySelectionProfileManager.updateSequence(
						leftTheHomeProfile, null,
						categorySeqDetailBean.getIndividualSequence(),
						catSeqNum, categorySeqDetailBean.getCategoryType());
			}

			for (int i = 0; i < appInPrflColl.size(); i++) {
				final RMC_IN_PRFL_Cargo rCargo = appInPrflColl.getCargo(i);
				if (appIndvCargo.getIndv_seq_num().equals(
						rCargo.getIndv_seq_num())
						&& rCargo.getHead_of_household_resp() != null
						&& "R".equals(rCargo.getHead_of_household_resp())) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHOH",
							driverArray, appNum);
				}
			}
			
			//reqInd is indicator to decide if we have complete the response profile or not
			boolean reqInd=false;
			short respTyp=IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP;
			if (appInPrflColl != null) {
				final RMC_IN_PRFL_Cargo rmcResCargo = rmcResponseProfileManager
						.getProfile(appInPrflColl, String.valueOf(indvSeqNum));
				if (rmcResCargo != null  && rmcResponseProfileManager.getProfileResponse(
						rmcResCargo, respTyp).charAt(0) == IRMCResponseProfileManager.STATUS_REQUIRED) {
					reqInd=true;
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP, rmcResCargo,
							true);
				}
			}

			session.put(FwConstants.RMC_DRIVER, driverArray);
			// Update People Handler for Moved out / Died person
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			if (indvSeqNum > 0
					&& (AppConstants.LEFT_THE_HOME.equals(catType) || AppConstants.SOMEONE_DIED
							.equals(catType))) {
				peopleHandler.deleteOutOfHomeIndividual(indvSeqNum);
			}
			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					categorySelectionProfile, appNum,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			//if the profile response was not 'R' or if we came from gatepost then don't persist else persist
			if(!reqInd || categorySeqDetailBean.getChangeSelectionCategoryCd()==null)
			{
			categorySelectionProfileManager.makeSequenceDetailComplete(
					leftTheHomeProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			}else{
				categorySelectionProfileManager.makeSequenceDetailComplete(
						leftTheHomeProfile, appNum,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(leftTheHomeProfile)) {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 2,1 lines Commented
				 * Code in this block
				 */

				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNum);
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
						driverArray, appNum);
				// PCR 30899 - Check if there are any individuals in Home and
				// then schedule the Expenses page.
				// Otherwise, in a case where there is only one indv/ target
				// view, if he/she is moved out then onload of expenses page,
				// there are no active members in the application to show
				// expenses page. This was causing a NULLPOINTER.
				final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
						.getInHomeIndividuals();
				final List pinNumList = new ArrayList();
				final int indvCollSize = indvColl.size();
				INDIVIDUAL_Custom_Cargo indivCustCargo = null;
				// Filter pin numbers which are null (new individuals) - PCR
				// 30457
				String pinNumber = null;
				for (int i = 0; i < indvCollSize; i++) {
					indivCustCargo = indvColl.getResult(i);

					pinNumber = indivCustCargo.getIndv_pin_num();

					if (pinNumber != null) {

						pinNumList.add(indivCustCargo.getIndv_pin_num());

					}
				}
				final short[] programKey = (short[]) session
						.get(FwConstants.RMC_PROGRAM_KEY);
				boolean scheduleARXHU = false;
				// If the cases are FS, FS RR, and EBD MA PCR # 30532
				if (programKey[FwConstants.FSRR_INDEX] == 1
						|| programKey[FwConstants.EBDMA_INDEX] == 1) {
					scheduleARXHU = true;
				}
				if (pinNumList != null && !pinNumList.isEmpty()
						&& scheduleARXHU) {
					final String[] pageId = { "ARXHU" };
					driverManager.makeRequired(FwConstants.RMC_DRIVER, pageId,
							driverArray, appNum);
				}
				session.put(FwConstants.RMC_DRIVER, driverArray);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(leftTheHomeProfile);
			}
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoMovedOutDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoMovedOutDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoMovedOutDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoMovedOutDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMovedOutDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");

	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoDeathDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		try {

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoDeathDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoDeathDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoDeathDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoDeathDetails");
		}
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoDeathDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		try {

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoDeathDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoDeathDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoDeathDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoDeathDetails");
		}
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoPregnancyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoPregnancyEndDetails() - START");
		try {
			final Map request = txnBean.getRequest();
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();

			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String currentPageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);

			SortedSet pregnancyProfile = null;
			SortedSet pregnancyCategoryProfile = null;
			SortedSet pregnancyRmcProfile = null;

			final short[] responseType = new short[] { IRMCResponseProfileManager.PREG_ADD_STAT_SW };
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageId, driverArray);
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final PregnancyBO pregnancyBo = new PregnancyBO();

			boolean rmcAppType = true;
			if (appType != null
					&& !appType
					.equalsIgnoreCase(new String(rmcApplicationType))) {
				rmcAppType = false;
			}

			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			APP_IN_PREG_Collection appInPregCollection = (APP_IN_PREG_Collection) pageCollection
					.get(APP_IN_PREG_COLLECTION_KEY);

			if (currentPageId != null && !currentPageId.equals(previousPageId)) {
				pregnancyProfile = new TreeSet(
						new CategorySequenceDetailsComparator());
				if (!categorySelectionProfile.isEmpty()) {
					pregnancyCategoryProfile = createPageProfile(
							categorySelectionProfile, rmcInPrflColl,
							responseType);
					pregnancyProfile.addAll(pregnancyCategoryProfile);
				} else {
					categorySelectionProfile = categorySelectionProfileManager.loadCategoryChangeSelectionProfile(appNumber,
                            "HS");
					pregnancyRmcProfile = createPageProfile(
							categorySelectionProfile, rmcInPrflColl, responseType);
					pregnancyProfile.addAll(pregnancyRmcProfile);
				}

				if (pageStatus == FwConstants.DRIVER_REQUIRED
						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(pregnancyProfile);
				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE) {
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(pregnancyProfile);
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				pregnancyProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			final IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								pregnancyProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Long.parseLong(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					categorySelectionProfileManager.makeSequenceDetailRequired(
							pregnancyProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Long.parseLong(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean.getSeqNum()),
											indivSeqBean.getType());
					if (categorySeqDetail2 != null) {
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (!rmcAppType) {
							final RMB_RQST_Collection rmbRqstCol = (RMB_RQST_Collection) session
									.get(AppConstants.RMB_RQST_COLLECTION);
							rmbRqstCol.getCargo(0);
						}
						if (AppConstants.BECAME_PREGNANT.equals(indivSeqBean
								.getType())) {
							boolean endRowExists = false;
							if (categorySelectionProfileManager != null) {
								final Iterator iter = categorySelectionProfile
										.iterator();
								CategorySequenceDetail catSeqDetail = null;
								while (iter.hasNext()) {
									catSeqDetail = (CategorySequenceDetail) iter
											.next();
									if (catSeqDetail != null) {
										if (catSeqDetail
												.getIndividualSequence() == Short
												.parseShort(indivSeqBean
														.getIndivSeqNum())
														&& AppConstants.BECAME_PREGNANT
														.equals(catSeqDetail
																.getCategoryType()
																.trim())
																&& AppConstants.RMC_CAT_HO_COMP_PRFL
														.equals(catSeqDetail
																		.getChangeSelectionCategoryCd())) {
											endRowExists = true;
											break;
										}
									}
								}
							}

							if (endRowExists) {
								categorySelectionProfileManager
								.removeSequenceDetail(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												(short) 0,
												AppConstants.BECAME_PREGNANT);
							}

							categorySelectionProfileManager
							.insertSequenceDetail(
									categorySelectionProfile,
									appNumber,
									AppConstants.RMC_CAT_HO_COMP_PRFL,
									Short.parseShort(indivSeqBean
											.getIndivSeqNum()),
											AppConstants.BECAME_PREGNANT);
							categorySelectionProfileManager
							.makeSequenceDetailRequired(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType(), (short) 1);

							SortedSet pregEndSortedSet = null;
							final String[] catTypePregEnd = { AppConstants.BECAME_PREGNANT };
							pregEndSortedSet = createPageProfile(
									categorySelectionProfile, catTypePregEnd);
							pregnancyProfile.addAll(pregEndSortedSet);
							categorySelectionProfileManager
							.getNextSequenceDetail(pregnancyProfile);
						}
					} else {
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								pregnancyProfile,
								null,
								null,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										indivSeqBean.getType());
						categorySelectionProfileManager
						.makeSequenceDetailRequired(pregnancyProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile, appNumber,
								AppConstants.RMC_CAT_HO_COMP_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
			}

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(pregnancyProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(pregnancyProfile);
			}

			final String indvSeqNum = categorySeqDetail.getIndividualSequence()
					+ FwConstants.EMPTY_STRING;

			final char seqStatus = categorySelectionProfileManager
					.getSequenceDetailStatus(pregnancyProfile,
							categorySeqDetail.getIndividualSequence(), 0l,
							AppConstants.BECAME_PREGNANT);

			if (ICategorySelectionProfileManager.STATUS_COMPLETE == seqStatus
					|| ICategorySelectionProfileManager.STATUS_VISIT_AGAIN == seqStatus
					|| ICategorySelectionProfileManager.STATUS_NOT_REQUIRED == seqStatus
					|| pageStatus == FwConstants.DRIVER_COMPLETE) {
				appInPregCollection = pregnancyBo.loadPregnancyDetails(
						appNumber, AppConstants.RMC_NEW_RECORD_IND, indvSeqNum);
			} else {
				appInPregCollection = pregnancyBo.loadPregnancyDetails(
						appNumber, AppConstants.CWW_RECORD_IND, indvSeqNum);
			}

			if (appInPregCollection == null || appInPregCollection.isEmpty()) {
				appInPregCollection = new APP_IN_PREG_Collection();
			}

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);

			pageCollection.put(APP_IN_PREG_COLLECTION_KEY, appInPregCollection);
			pageCollection.put("CATEGORY_PREG_TYPE",
					AppConstants.BECAME_PREGNANT);
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					pregnancyProfile);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNum));
			final INDIVIDUAL_Custom_Collection indivCustCol = peopleHandler
					.getRelevantIndividuals();
			pageCollection.put("PEOPLE_377", indivCustCol);

			txnBean.setPageCollection(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoPregnancyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoPregnancyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoPregnancyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoPregnancyDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoPregnancyEndDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoPregnancyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoPregnancyEndDetails() - START");
		try {

			final PregnancyBO pregnancyBo = new PregnancyBO();
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			APP_IN_PREG_Collection beforeAppInPregCollection = null;
			APP_IN_PREG_Collection appInPregCollection = null;

			APP_IN_PREG_Cargo beforeAppInPregCargo = null;

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final SortedSet pregnancyProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			final String firstName = (String) beforeColl
					.get(AppConstants.FIRST_NAME);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(pregnancyProfile);
			final long catSeqNum = categorySeqDetailBean.getCategorySequence();
			final String catType = categorySeqDetailBean.getCategoryType();
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			if (beforeColl.containsKey(APP_IN_PREG_COLLECTION_KEY)) {
				beforeAppInPregCollection = (APP_IN_PREG_Collection) beforeColl
						.get(APP_IN_PREG_COLLECTION_KEY);
			}

			if (beforeAppInPregCollection != null
					&& !beforeAppInPregCollection.isEmpty()) {
				beforeAppInPregCargo = beforeAppInPregCollection.getCargo(0);
			} else {
				beforeAppInPregCollection = pregnancyBo.loadPregnancyDetails(
						appNumber, AppConstants.RMC_MODIFIED_RECORD_IND,
						FwConstants.EMPTY_STRING + indvSeqNum);

				if (beforeAppInPregCollection == null
						|| beforeAppInPregCollection.isEmpty()) {
					beforeAppInPregCollection = pregnancyBo
							.loadPregnancyDetails(appNumber,
									AppConstants.CWW_RECORD_IND,
									FwConstants.EMPTY_STRING + indvSeqNum);
				}
				if (beforeAppInPregCollection == null
						|| beforeAppInPregCollection.isEmpty()) {
					beforeAppInPregCollection = pregnancyBo
							.loadPregnancyDetails(appNumber,
									AppConstants.RMC_NEW_RECORD_IND,
									FwConstants.EMPTY_STRING + indvSeqNum);
				}
				if (beforeAppInPregCollection == null
						|| beforeAppInPregCollection.isEmpty()) {
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 6,1 lines Commented
					 * Code in this block
					 */

					beforeAppInPregCollection = new APP_IN_PREG_Collection();

				}
			}

			if (beforeAppInPregCollection != null
					&& !beforeAppInPregCollection.isEmpty()) {
				beforeAppInPregCargo = beforeAppInPregCollection.getCargo(0);
			}

			if (pageCollection.containsKey(APP_IN_PREG_COLLECTION_KEY)) {
				appInPregCollection = (APP_IN_PREG_Collection) pageCollection
						.get(APP_IN_PREG_COLLECTION_KEY);
			}

			APP_IN_PREG_Cargo appInPregCargo = appInPregCollection.getCargo(0);

			final char seqStatus = categorySelectionProfileManager
					.getSequenceDetailStatus(pregnancyProfile, indvSeqNum, 0l,
							AppConstants.BECAME_PREGNANT);

			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);


			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			final ARHPDValidator arhpdValidator = new ARHPDValidator();
			if (backToMyAccess == null) {
				FwMessageList errorMessageList = null;
				errorMessageList = arhpdValidator
						.validatePregnancyChangeDetails(appInPregCargo,
								peopleHandler, indvSeqNum, firstName);

				// If has an error, user entered data display with error
				// messages in same page
				if (errorMessageList != null && errorMessageList.hasMessages()) {
					request.put(FwConstants.MESSAGE_LIST,
							arhpdValidator.getMessageList());
					pageCollection.put(AppConstants.FIRST_NAME,
							beforeColl.get(AppConstants.FIRST_NAME));
					pageCollection.put("CATEGORY_PREG_TYPE", catType);
					pageCollection.put("CATEGORY_STATUS",
							beforeColl.get("CATEGORY_STATUS"));
					pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
							pregnancyProfile);
					pageCollection.put(APP_IN_PREG_COLLECTION_KEY,
							appInPregCollection);
					session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
					txnBean.setRequest(request);
					txnBean.setPageCollection(pageCollection);
					return;
				}
			}
			if (checkBackToMyAccessSelected(request)
					|| arhpdValidator.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							arhpdValidator.getMessageList());
				}
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CATEGORY_PREG_TYPE", catType);
				pageCollection.put("CATEGORY_STATUS",
						beforeColl.get("CATEGORY_STATUS"));
				pageCollection.put("newBorn", request.get("newBorn"));
				pageCollection.put("New_Born_Looping",
						beforeColl.get("New_Born_Looping"));
				if (beforeAppInPregCollection != null) {
					pageCollection.put(APP_IN_PREG_COLLECTION_KEY,
							beforeAppInPregCollection);
				}
				return;
			}

			APP_IN_PREG_Collection cwwPregColl = new APP_IN_PREG_Collection();
			if (beforeAppInPregCollection != null
					&& !beforeAppInPregCollection.isEmpty()) {
				appInPregCargo.setApp_num(appNumber);
				appInPregCargo.setIndv_seq_num(indvSeqNum
						+ FwConstants.EMPTY_STRING);
				appInPregCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				if (appInPregCargo.getFetus_ct() == null
						|| appInPregCargo.getFetus_ct().trim().length() == 0) {
//					appInPregCargo.setFetus_ct(FwConstants.ZERO);
				}
				if (appInPregCargo.getPreg_due_dt() != null
						&& appInPregCargo.getPreg_due_dt().trim().length() != 0
						&& appInPregCargo.getPreg_due_dt().charAt(2) == '/') {
					final StringBuilder dateConverter = new StringBuilder();
					final String sAppDate = appInPregCargo.getPreg_due_dt();
					dateConverter.append(sAppDate.substring(6, 10)).append("-")
					.append(sAppDate.substring(0, 2)).append("-")
					.append(sAppDate.substring(3, 5));
					appInPregCargo.setPreg_due_dt(dateConverter.toString());
				}
				appInPregCargo = (APP_IN_PREG_Cargo) isChanged(
						beforeAppInPregCargo, appInPregCargo);
			} else {
				appInPregCargo.setApp_num(appNumber);
				appInPregCargo.setIndv_seq_num(indvSeqNum
						+ FwConstants.EMPTY_STRING);
				appInPregCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				APP_IN_PREG_Cargo cwwPregCargo = null;
				cwwPregColl = pregnancyBo.loadPregnancyDetails(appNumber,
						AppConstants.CWW_RECORD_IND,
						appInPregCargo.getIndv_seq_num());
				if (cwwPregColl != null && !cwwPregColl.isEmpty()) {
					cwwPregCargo = cwwPregColl.getCargo(0);
					if (cwwPregCargo != null) {
						appInPregCargo.setConception_dt(cwwPregCargo
								.getConception_dt());
					}
				}
				if (appInPregCargo.getFetus_ct() == null
						|| appInPregCargo.getFetus_ct().trim().length() == 0) {
//					appInPregCargo.setFetus_ct(FwConstants.ONE);
				}
				if (appInPregCargo.getPreg_due_dt() != null
						&& appInPregCargo.getPreg_due_dt().trim().length() != 0
						&& appInPregCargo.getPreg_due_dt().charAt(2) == '/') {
					final StringBuilder dateConverter = new StringBuilder();
					final String sAppDate = appInPregCargo.getPreg_due_dt();
					dateConverter.append(sAppDate.substring(6, 10)).append("-")
					.append(sAppDate.substring(0, 2)).append("-")
					.append(sAppDate.substring(3, 5));
					appInPregCargo.setPreg_due_dt(dateConverter.toString());
				}
				categorySelectionProfileManager.updateSequence(
						pregnancyProfile, null,
						categorySeqDetailBean.getIndividualSequence(),
						catSeqNum, categorySeqDetailBean.getCategoryType());
			}

			if ((ICategorySelectionProfileManager.STATUS_COMPLETE == seqStatus || ICategorySelectionProfileManager.STATUS_VISIT_AGAIN == seqStatus || ICategorySelectionProfileManager.STATUS_NOT_REQUIRED == seqStatus)
					&& (pageStatus == FwConstants.DRIVER_COMPLETE || pageStatus == FwConstants.DRIVER_VISIT_AGAIN)) {
				appInPregCollection.remove(0);
				appInPregCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				appInPregCollection.addCargo(appInPregCargo);
				pregnancyBo.storePregnancyDetails(appInPregCollection);
			} else {
				appInPregCollection.remove(0);
				if (null != beforeAppInPregCargo
						&& appInPregCargo.getIndv_seq_num().equals(
								beforeAppInPregCargo.getIndv_seq_num())) {
					appInPregCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				} else {
					appInPregCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				}
				appInPregCollection.addCargo(appInPregCargo);
				pregnancyBo.storePregnancyDetails(appInPregCollection);
			}

			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.PREGNANCY,
							rmcInPrflCargo, true);
				}
			}
			session.put(FwConstants.RMC_DRIVER, driverArray);
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			categorySelectionProfileManager.makeSequenceDetailComplete(
					pregnancyProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());

			if (categorySelectionProfileManager
					.areAllSequencesComplete(pregnancyProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
				session.put(FwConstants.RMC_DRIVER, driverArray);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(pregnancyProfile);
				appInPregCollection = null;
			}

			pageCollection.put(APP_IN_PREG_COLLECTION_KEY, appInPregCollection);

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					pregnancyProfile);
			txnBean.setPageCollection(pageCollection);
			txnBean.setRequest(request);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoPregnancyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoPregnancyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoPregnancyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoPregnancyDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoPregnancyEndDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoMarriageDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMarriageDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoMarriageDetails:Start");
			// Getting the session
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			Map pageCollection = new HashMap();
			pageCollection = txnBean.getPageCollection();

			// build category selection profile
			final String[] catType = new String[] { AppConstants.GOT_MARRIED,
					AppConstants.GOT_DIVORCED };
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			// Get appNumber
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
					.getAllIndividuals();
			final INDIVIDUAL_Custom_Collection indvCusDivorceColl = new INDIVIDUAL_Custom_Collection();
			INDV_LIVE_CHG_Collection indvLiveChgColl = null;
			final INDV_LIVE_CHG_Cargo indvLiveChgCargo = new INDV_LIVE_CHG_Cargo();
			APP_HSHL_RLT_Collection appHshlRtlColl = new APP_HSHL_RLT_Collection();
			APP_HSHL_RLT_Cargo appHshlRtlCargo = new APP_HSHL_RLT_Cargo();
			boolean loopingQueReq = true;

			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final MaritalBO maritalBo = new MaritalBO();
			final LivingArrangementBO livingArrBO = new LivingArrangementBO();
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			SortedSet marriageProfile = null;
			if (!currentPageID.equals(previousPageId)) {
				marriageProfile = createPageProfile(categorySelectionProfile,
						catType);
				if (pageStatus != FwConstants.DRIVER_REQUIRED) {
					final APP_HSHL_RLT_Collection newRtlColl = maritalBo
							.getNewAppRtlDetails(appNumber);
					final INDV_LIVE_CHG_Collection newIndvColl = livingArrBO
							.getNewIndvLiveDetails(appNumber);
					String currentCatType = null;
					INDV_LIVE_CHG_Cargo newIndvCargo = null;
					if (newRtlColl != null && !newRtlColl.isEmpty()
							&& newIndvColl != null && !newRtlColl.isEmpty()) {
						APP_HSHL_RLT_Cargo newRtlCargo = null;
						final int newRtlCollSize = newRtlColl.size();
						final int newIndvCollSize = newIndvColl.size();
						for (int i = 0; i < newRtlCollSize; i++) {
							newRtlCargo = newRtlColl.getCargo(i);
							final String indvSq = newRtlCargo
									.getSrc_indv_seq_num();
							for (int j = 0; j < newIndvCollSize; j++) {
								newIndvCargo = newIndvColl.getCargo(j);
								if (newIndvCargo.getIndv_seq_num().equals(
										indvSq)) {
									currentCatType = AppConstants.GOT_MARRIED;
									break;
								} else {
									currentCatType = AppConstants.GOT_DIVORCED;
								}
							}
							if (AppConstants.GOT_MARRIED.equals(currentCatType)) {
								categorySelectionProfileManager
								.insertExistingSequenceDetail(
										marriageProfile,
										null,
										null,
										Short.parseShort(newRtlCargo
												.getSrc_indv_seq_num()),
												0, currentCatType);
							} else {
								categorySelectionProfileManager
								.insertExistingSequenceDetail(
										marriageProfile, null, null,
										Short.parseShort(newIndvCargo
												.getIndv_seq_num()), 0,
												currentCatType);
							}
						}
					} else if (newIndvColl != null && !newRtlColl.isEmpty()) {
						final int newIndvCollSize = newIndvColl.size();
						for (int i = 0; i < newIndvCollSize; i++) {
							newIndvCargo = newIndvColl.getCargo(i);
							final String maritalSta = newIndvCargo
									.getMrtl_stat_cd();
							if (AppConstants.MARRIAGE_INDICATOR
									.equals(maritalSta)) {
								currentCatType = AppConstants.GOT_MARRIED;
							} else {
								currentCatType = AppConstants.GOT_DIVORCED;
							}
						}
						categorySelectionProfileManager
						.insertExistingSequenceDetail(marriageProfile,
								null, null, Short
								.parseShort(newIndvCargo
										.getIndv_seq_num()), 0,
										currentCatType);
					}

				}
				if (pageStatus == FwConstants.DRIVER_REQUIRED
						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(marriageProfile);
				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(marriageProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				final Map beforeColl = (Map) session
						.get(FwConstants.BEFORE_COLLECTION);
				marriageProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}
			final IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								marriageProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Long.parseLong(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					categorySelectionProfileManager.makeSequenceDetailRequired(
							marriageProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Long.parseLong(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean.getSeqNum()),
											indivSeqBean.getType());
					if (categorySeqDetail2 != null) {
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						// first we are checking if rmc_in_profile exists in the
						// sess
						final RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
								.get(AppConstants.RMC_RQST);
						if (AppConstants.GOT_MARRIED.equals(indivSeqBean
								.getType())) {
							/*
							 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines
							 * Commented Code in this block
							 */

							categorySelectionProfileManager
							.insertSequenceDetail(
									categorySelectionProfile,
									appNumber,
									AppConstants.RMC_CAT_HO_COMP_PRFL,
									Short.parseShort(indivSeqBean
											.getIndivSeqNum()),
											AppConstants.GOT_MARRIED);
							categorySelectionProfileManager
							.makeSequenceDetailRequired(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());

							SortedSet gotMarriedSortedSet = null;
							final String[] catTypeGotMarried = { AppConstants.GOT_MARRIED };
							gotMarriedSortedSet = createPageProfile(
									categorySelectionProfile, catTypeGotMarried);
							marriageProfile.addAll(gotMarriedSortedSet);
							categorySelectionProfileManager
							.getNextSequenceDetail(marriageProfile);
							if (!AppConstants.YES.equals(rmcRqstCargo
									.getMrrg_stat_sw())) {
								rmcRqstCargo.setMrrg_stat_sw(AppConstants.YES);

							}
						} else if (AppConstants.GOT_DIVORCED
								.equals(indivSeqBean.getType())) {

							categorySelectionProfileManager
							.insertSequenceDetail(
									categorySelectionProfile,
									appNumber,
									AppConstants.RMC_CAT_HO_COMP_PRFL,
									Short.parseShort(indivSeqBean
											.getIndivSeqNum()),
											AppConstants.GOT_DIVORCED);
							categorySelectionProfileManager
							.makeSequenceDetailRequired(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Long.parseLong(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());

							SortedSet gotDivorceSortedSet = null;
							final String[] catTypeGotDivorce = { AppConstants.GOT_DIVORCED };
							gotDivorceSortedSet = createPageProfile(
									categorySelectionProfile, catTypeGotDivorce);
							marriageProfile.addAll(gotDivorceSortedSet);
							categorySelectionProfileManager
							.getNextSequenceDetail(marriageProfile);
							if (!AppConstants.YES.equals(rmcRqstCargo
									.getDvrc_stat_sw())) {
								rmcRqstCargo.setDvrc_stat_sw(AppConstants.YES);

							}
						}

					} else {
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								marriageProfile,
								null,
								null,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										indivSeqBean.getType());
						categorySelectionProfileManager
						.makeSequenceDetailRequired(marriageProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_EMP_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Long.parseLong(indivSeqBean.getSeqNum()),
										indivSeqBean.getType());
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Long
										.parseLong(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					marriageProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(marriageProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(marriageProfile);
			}
			final String categoryType = categorySeqDetail.getCategoryType();
			Long.toString(categorySeqDetail.getCategorySequence());
			final String indvSeqNum = Short.toString(categorySeqDetail
					.getIndividualSequence());
			String.valueOf(categorySeqDetail.getStatus());
			// Find the gender of the person
			final int size = indvColl.size();
			String sexInd = FwConstants.EMPTY_STRING;
			for (int i = 0; i < size; i++) {
				if (indvColl.getResult(i).getIndv_seq_num().equals(indvSeqNum)) {
					sexInd = indvColl.getResult(i).getSex_ind();
				}
			}

			final LivingArrangementBO livingArrBo = new LivingArrangementBO();
			indvLiveChgColl = livingArrBo.loadLivingArrangementDetails(
					appNumber, indvSeqNum);

			final Map responseMap = new HashMap();
			String seqNum = null;

			if (indvLiveChgColl != null
					&& !indvLiveChgColl.isEmpty()
					&& (pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					|| pageStatus == FwConstants.DRIVER_COMPLETE || pageStatus == FwConstants.DRIVER_REQUIRED)) {
				final int size1 = indvLiveChgColl.size();
				final INDV_LIVE_CHG_Collection indvLiveNewColl = new INDV_LIVE_CHG_Collection();
				for (int i = 0; i < size1; i++) {
					final INDV_LIVE_CHG_Cargo indvLiveCargo = indvLiveChgColl
							.getCargo(i);
					if (AppConstants.RMC_NEW_RECORD_IND.equals(indvLiveCargo
							.getSrc_app_ind())) {
						indvLiveNewColl.add(indvLiveCargo);
					}
				}
				indvLiveChgColl = indvLiveNewColl;
			}
			if (indvLiveChgColl != null && !indvLiveChgColl.isEmpty()) {
				if (indvLiveChgColl.getCargo(0) != null) {
					appHshlRtlColl = maritalBo.loadRelations(appNumber,
							indvSeqNum);
				}
			}
			if (appHshlRtlColl != null && !appHshlRtlColl.isEmpty()) {
				appHshlRtlCargo = appHshlRtlColl.getCargo(0);
				if (appHshlRtlCargo.getRef_indv_seq_num().equals(indvSeqNum)) {
					seqNum = appHshlRtlCargo.getSrc_indv_seq_num();
				} else {
					seqNum = appHshlRtlCargo.getRef_indv_seq_num();
				}
			}
			if (seqNum != null) {
				responseMap.put(seqNum, "R");
			} else {
				responseMap.put(FwConstants.SPACE, FwConstants.SPACE);
			}

			// Find the collection for displaying who moved out of the home
			// b'coz of divorce

			// Now filter all the persons who are going to display in the page
			final int size1 = indvColl.size();
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2,1 lines Commented Code in
			 * this block
			 */

			for (int k = 0; k < size1; k++) {

				indvCusDivorceColl.addCargo(indvColl.getResult(k));

			}
			final Map responseMap1 = new HashMap();
			final long catSeqNum = 0;
			String movedOutResp = FwConstants.NO;
			if (indvCusDivorceColl != null && !indvCusDivorceColl.isEmpty()) {
				if (categorySelectionProfile != null) {
					final int size2 = indvCusDivorceColl.size();
					for (int i = 0; i < size2; i++) {
						final String indvSeqNumRef = indvCusDivorceColl
								.getResult(i).getIndv_seq_num();
						movedOutResp = String
								.valueOf(categorySelectionProfileManager.getSequenceDetailStatus(
										categorySelectionProfile,
										Short.parseShort(indvSeqNumRef),
										catSeqNum, AppConstants.LEFT_THE_HOME));
						responseMap1.put(indvSeqNumRef, movedOutResp);
					}
				}
			} else {
				responseMap1.put(FwConstants.EMPTY_STRING,
						FwConstants.EMPTY_STRING);
			}

			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS, indvSeqNum);
			pageCollection.put("INDIVIDUAL_Custom_Collection", indvColl);
			pageCollection.put("Response_Map", responseMap);
			pageCollection.put("CATEGORY_TYPE", categoryType);
			pageCollection.put("APP_HSHL_RLT_Collection", appHshlRtlColl);
			pageCollection.put("INDV_LIVE_CHG_Collection", indvLiveChgColl);
			pageCollection.put("SEQ_NUM", seqNum);
			pageCollection.put("SEX_INDICATOR", sexInd);
			pageCollection.put("INDIVIDUAL_Custom_Divorce_Collection",
					indvCusDivorceColl);
			pageCollection.put("Response_Map_Divorce", responseMap1);
			pageCollection.put("PAGE_STATUS", String.valueOf(pageStatus));
			session.put(AppConstants.APP_NUMBER, appNumber);
			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNum));
			session.put(AppConstants.INDV_LIVE_CHG, indvLiveChgCargo);
			componentManager.getComponents("ARHMA", txnBean);
			txnBean.setPageCollection(pageCollection);
			// Add the page collection to before collection
			if (pageStatus == FwConstants.DRIVER_COMPLETE
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySeqDetail.getStatus() != 'R') {
				loopingQueReq = false;
			} else {
				loopingQueReq = true;
				request.remove("loopingQuestion");
			}
			pageCollection
			.put("LOOPING_QUE_REQ", String.valueOf(loopingQueReq));
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoMarriageDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoMarriageDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoMarriageDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoMarriageDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMarriageDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoMarriageDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMarriageDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get App Number
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final LivingArrangementBO livingArrBo = new LivingArrangementBO();
			final MaritalBO maritalBo = new MaritalBO();

			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final SortedSet marriageProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final INDV_LIVE_CHG_Collection beforeCollIndvLiveChgColl = (INDV_LIVE_CHG_Collection) beforeColl
					.get("INDV_LIVE_CHG_Collection");
			INDV_LIVE_CHG_Cargo indvLiveBeforeCargo = null;

			final INDV_LIVE_CHG_Collection indvLiveChgCollection = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");
			INDV_LIVE_CHG_Cargo indvLiveChgCargo = indvLiveChgCollection
					.getCargo(0);

			final APP_HSHL_RLT_Collection beforeCollAppHshlRltColl = (APP_HSHL_RLT_Collection) beforeColl
					.get("APP_HSHL_RLT_Collection");
			APP_HSHL_RLT_Cargo beforeAppHshlRltCargo = null;

			final APP_HSHL_RLT_Collection appHshlRtlColl = (APP_HSHL_RLT_Collection) pageCollection
					.get("APP_HSHL_RLT_Collection");
			APP_HSHL_RLT_Cargo appHshlRtlCargo = new APP_HSHL_RLT_Cargo();

			final INDIVIDUAL_Custom_Collection beforeIndvCustColl = (INDIVIDUAL_Custom_Collection) beforeColl
					.get("PEOPLE_5053");
			final INDIVIDUAL_Custom_Collection indvCusDivorceColl = (INDIVIDUAL_Custom_Collection) beforeColl
					.get("INDIVIDUAL_Custom_Divorce_Collection");

			final RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
					.get(AppConstants.RMC_RQST);

			RMC_RESPONSE_Custom_Collection rmcRespCustomColl = new RMC_RESPONSE_Custom_Collection();
			rmcRespCustomColl = (RMC_RESPONSE_Custom_Collection) pageCollection
					.get("RMC_RESPONSE_Custom_Collection");
			RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
			if (rmcRespCustomColl != null && !rmcRespCustomColl.isEmpty()) {
				final int collLength = rmcRespCustomColl.size();

				for (int i = 0; i < collLength; i++) {
					rmcRespCustomCargo = rmcRespCustomColl.getCargo(i);
					if (rmcRespCustomCargo.getIndvSeqNum() != null) {
					}
				}
			}
			if (appHshlRtlColl != null && !appHshlRtlColl.isEmpty()) {
				appHshlRtlCargo = appHshlRtlColl.getCargo(0);
			}

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(marriageProfile);
			final long catSeqNum = categorySeqDetailBean.getCategorySequence();
			final String catType = categorySeqDetailBean.getCategoryType();
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			beforeColl.get(FwConstants.PAGE_COMPONENT_LIST);
			final String firstName = (String) beforeColl
					.get(AppConstants.FIRST_NAME);
			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			// validate the page
			boolean valInd = false;
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			final ARHMAValidator arhmaVal = new ARHMAValidator();
			if (backToMyAccess == null) {
				arhmaVal.validateARHMA(indvLiveChgCargo, appHshlRtlCargo,
						catType, beforeIndvCustColl, firstName,
						rmcRespCustomColl);
			}

			if (AppConstants.GOT_DIVORCED.equals(catType)) {
				rmcRespCustomColl.size();
				if (indvLiveChgCargo != null) {
					if (indvLiveChgCargo.getNone() != null) {
						session.put("NoneValue", "R");
					}

				}

			}

			// Setting the indv_seq_num of the current individual. Moved here
			// for PCR 31063 as indvseq is null on validation.
			indvLiveChgCargo.setIndv_seq_num(String
					.valueOf(categorySeqDetailBean.getIndividualSequence()));

			if (session.get("WarningMessageShown") != null
					&& FwConstants.YES.equals(session
							.get("WarningMessageShown"))) {
			}
			if (checkBackToMyAccessSelected(request) || arhmaVal.hasMessages()) {
				valInd = true;
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							arhmaVal.getMessageList());
				}
				session.put("WarningMessageShown", FwConstants.YES);
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CATEGORY_TYPE", catType);
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put("INDIVIDUAL_Custom_Collection",
						pageCollection.get("INDIVIDUAL_Custom_Collection"));
				pageCollection.put("INDV_LIVE_CHG_Collection",
						indvLiveChgCollection);
				pageCollection.put("APP_HSHL_RLT_Collection", appHshlRtlColl);
				pageCollection.put("INDIVIDUAL_Custom_Divorce_Collection",
						beforeColl.get("INDIVIDUAL_Custom_Divorce_Collection"));
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				pageCollection.put("SEX_INDICATOR",
						beforeColl.get("SEX_INDICATOR"));
				pageCollection.put("PAGE_STATUS", String.valueOf(pageStatus));
				pageCollection.put("Validation_ind", String.valueOf(valInd));
				pageCollection.put("loopingQuestion",
						request.get("loopingQuestion"));
				pageCollection.put("LOOPING_QUE_REQ",
						beforeColl.get("LOOPING_QUE_REQ"));
				pageCollection.put("RMC_RESPONSE_Custom_Collection",
						pageCollection.get("RMC_RESPONSE_Custom_Collection"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection
				.put("PEOPLE_5053", beforeColl.get("PEOPLE_5053"));
				pageCollection.put("msgFlag", Boolean.TRUE);
				final Map responseMap = new HashMap();
				String seqNum = null;
				if (appHshlRtlColl != null && !appHshlRtlColl.isEmpty()) {
					appHshlRtlCargo = appHshlRtlColl.getCargo(0);
					if (appHshlRtlCargo.getRef_indv_seq_num() != null
							&& appHshlRtlCargo.getRef_indv_seq_num().equals(
									Short.toString(indvSeqNum))) {
						seqNum = appHshlRtlCargo.getSrc_indv_seq_num();
					} else {
						seqNum = appHshlRtlCargo.getRef_indv_seq_num();
					}
					if (seqNum != null) {
						responseMap.put(seqNum, "R");
					} else {
						responseMap.put(FwConstants.SPACE, FwConstants.SPACE);
					}
				}
				pageCollection.put("Response_Map", responseMap);

				final Map resMap = new HashMap();
				final Map responseMap1 = new HashMap();
				if (rmcRespCustomColl != null && !rmcRespCustomColl.isEmpty()) {
					final int size1 = rmcRespCustomColl.size();

					for (int i = 0; i < size1; i++) {
						final RMC_RESPONSE_Custom_Cargo rmcCargo = rmcRespCustomColl
								.getResult(i);
						resMap.put("INDV_SEQ" + i, rmcCargo.getIndvSeqNum());
					}
				}
				if (indvCusDivorceColl != null && !indvCusDivorceColl.isEmpty()) {
					final int size2 = indvCusDivorceColl.size();
					for (int i = 0; i < size2; i++) {
						final INDIVIDUAL_Custom_Cargo indvCargo = indvCusDivorceColl
								.getResult(i);
						if (resMap.containsValue(indvCargo.getIndv_seq_num())) {
							responseMap1.put(indvCargo.getIndv_seq_num(), "R");
						} else {
							responseMap1.put(FwConstants.SPACE,
									FwConstants.SPACE);
						}
					}
				}
				pageCollection.put("Response_Map_Divorce", responseMap1);
				txnBean.setPageCollection(pageCollection);
				return;

			}

			String recordIndLive = null;
			String recordIndRel1 = null;
			String recordIndRel2 = null;
			String recordIndRel = null;

			final String sexInd = (String) beforeColl.get("SEX_INDICATOR");
			boolean indvLiveDetailsUpdate = false;
			// check the CategorySelectionProfile if the persons selected in the
			// divorce page(RMC_RESPONSE_Custom_Collection)
			// are listed out in profile
			int size1 = 0;
			if (rmcRespCustomColl != null && !rmcRespCustomColl.isEmpty()) {
				size1 = rmcRespCustomColl.size();
				rmcRqstCargo.setPrsn_move_stat_sw(FwConstants.YES);
			}
			// if we found any person in checked in divorce page but not listed
			// in profile than we are going to add the person in the profile
			for (int i = 0; i < size1; i++) {
				rmcRespCustomCargo = rmcRespCustomColl.getCargo(i);
				final String indvSeqNumRes = rmcRespCustomCargo.getIndvSeqNum();
				final CategorySequenceDetail categorySeqDet = categorySelectionProfileManager
						.getCategorySequenceDetail(categorySelectionProfile,
								Short.parseShort(indvSeqNumRes), catSeqNum,
								AppConstants.LEFT_THE_HOME);
				if (categorySeqDet == null) {
					categorySelectionProfileManager.insertSequenceDetail(
							categorySelectionProfile, appNum,
							AppConstants.RMC_CAT_HO_COMP_PRFL,
							Short.parseShort(indvSeqNumRes),
							AppConstants.LEFT_THE_HOME);
					final String[] pageId = { "ARHMO" };
					driverManager.makeRequired(FwConstants.RMC_DRIVER, pageId,
							driverArray, appNum);

				}
			}

			// new logic

			boolean matchFound = false;

			String livArrngmnt = null;
			if (beforeCollIndvLiveChgColl != null
					&& !beforeCollIndvLiveChgColl.isEmpty()) {
				final int size3 = beforeCollIndvLiveChgColl.size();
				for (int i = 0; i < size3; i++) {
					indvLiveBeforeCargo = beforeCollIndvLiveChgColl.getCargo(i);
					livArrngmnt = indvLiveBeforeCargo.getLive_arng_typ();
					if (indvLiveChgCargo.getIndv_seq_num().equals(
							indvLiveBeforeCargo.getIndv_seq_num())) {

						if (livArrngmnt != null) {
							if (AppConstants.GOT_MARRIED.equals(catType)
									&& AppConstants.MARRIAGE_INDICATOR
									.equals(livArrngmnt)) {
								matchFound = true;
								break;
							}
							if (AppConstants.GOT_DIVORCED.equals(catType)
									&& AppConstants.DIVORCE_INDICATOR
									.equals(livArrngmnt)) {
								matchFound = true;
								break;
							}
						}
					}
				}

			}

			if (matchFound) {
				if (beforeCollIndvLiveChgColl != null
						&& !beforeCollIndvLiveChgColl.isEmpty()
						|| beforeCollAppHshlRltColl != null
						&& !beforeCollAppHshlRltColl.isEmpty()) {
					recordIndLive = FwConstants.ROWACTION_UPDATE;
					indvLiveBeforeCargo = beforeCollIndvLiveChgColl.getCargo(0);
					indvLiveChgCargo.setApp_num(appNum);
					indvLiveChgCargo.setSrc_app_ind(indvLiveBeforeCargo
							.getSrc_app_ind());
					indvLiveChgCargo.setUpdt_dt(indvLiveBeforeCargo
							.getUpdt_dt());
					indvLiveChgCargo.setIndv_seq_num(indvLiveBeforeCargo
							.getIndv_seq_num());
					if (AppConstants.GOT_MARRIED.equals(catType)) {
						indvLiveChgCargo
						.setLive_arng_typ(AppConstants.MARRIAGE_INDICATOR);
					} else {
						indvLiveChgCargo
						.setLive_arng_typ(AppConstants.DIVORCE_INDICATOR);
					}
					indvLiveChgCargo.setMove_out_dt(AppConstants.HIGH_DATE);
					if (AppConstants.GOT_MARRIED.equals(catType)) {
						indvLiveChgCargo
						.setMrtl_stat_cd(AppConstants.MARRIAGE_INDICATOR);
					} else {
						indvLiveChgCargo
						.setMrtl_stat_cd(AppConstants.DIVORCE_INDICATOR);
					}
					if (indvLiveChgCargo.getEst_return_dt() == null
							|| !FwConstants.EMPTY_STRING
							.equals(indvLiveChgCargo.getEst_return_dt())) {
						indvLiveChgCargo
						.setEst_return_dt(AppConstants.HIGH_DATE);
					}
					// check dirty
					indvLiveChgCargo = (INDV_LIVE_CHG_Cargo) isChanged(
							indvLiveBeforeCargo, indvLiveChgCargo);
					if (indvLiveChgCargo.isDirty()) {
						indvLiveDetailsUpdate = true;
						indvLiveChgCargo.setRowAction(recordIndLive);
						indvLiveChgCargo
						.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
						indvLiveChgCargo.setChg_eff_dt(indvLiveChgCargo
								.getChg_eff_dt());
						indvLiveChgCargo.setUpdt_dt(String.valueOf(fwDate
								.getDate()));
						livingArrBo
						.storeLivingArrangementDetails(indvLiveChgCollection);
					}
					// if category type is marriage and its in the edit mode
					// than i have to delete the previous record and insert the
					// updated record
					if (!AppConstants.GOT_DIVORCED.equals(catType)) {
						beforeAppHshlRltCargo = beforeCollAppHshlRltColl
								.getCargo(0);
						appHshlRtlCargo.setApp_num(appNum);
						appHshlRtlCargo
						.setSrc_indv_seq_num(beforeAppHshlRltCargo
								.getSrc_indv_seq_num());
						appHshlRtlCargo.setCare_resp(beforeAppHshlRltCargo
								.getCare_resp());
						String date1 = null;
						String date2 = null;
						if (indvLiveDetailsUpdate) {
							appHshlRtlCargo.setChg_eff_dt(indvLiveChgCargo
									.getChg_eff_dt());
							date1 = beforeAppHshlRltCargo.getChg_eff_dt();
							date2 = indvLiveChgCargo.getChg_eff_dt();
							recordIndRel1 = FwConstants.ROWACTION_DELETE;
							recordIndRel2 = FwConstants.ROWACTION_INSERT;
						} else {
							appHshlRtlCargo.setChg_eff_dt(beforeAppHshlRltCargo
									.getChg_eff_dt());
						}
						appHshlRtlCargo.setRec_cplt_ind(beforeAppHshlRltCargo
								.getRec_cplt_ind());
						appHshlRtlCargo.setRlt_cd(beforeAppHshlRltCargo
								.getRlt_cd());
						appHshlRtlCargo.setSrc_app_ind(beforeAppHshlRltCargo
								.getSrc_app_ind());
						if (appHshlRtlCargo.getRef_indv_seq_num() == null) {
							appHshlRtlCargo
							.setRef_indv_seq_num(beforeAppHshlRltCargo
									.getRef_indv_seq_num());
						}
						// check dirty
						appHshlRtlCargo = (APP_HSHL_RLT_Cargo) isChanged(
								beforeAppHshlRltCargo, appHshlRtlCargo);
						if (appHshlRtlCargo.isDirty()) {
							// PCR 30899 - When the selection is changed from
							// 'Someone else not listed here' to someone in
							// home,
							// the rowaction variables and dates were not
							// getting set resulting in NULLPOINTER. Added four
							// lines below to set the reqd values.
							recordIndRel1 = FwConstants.ROWACTION_DELETE;
							recordIndRel2 = FwConstants.ROWACTION_INSERT;
							date1 = beforeAppHshlRltCargo.getChg_eff_dt();
							date2 = indvLiveChgCargo.getChg_eff_dt();
							appHshlRtlCargo.setRowAction(recordIndRel1);
							final String strRefSeqNumFrmPage = appHshlRtlCargo
									.getRef_indv_seq_num();
							appHshlRtlCargo
							.setRef_indv_seq_num(beforeAppHshlRltCargo
									.getRef_indv_seq_num());
							appHshlRtlCargo
							.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
							appHshlRtlCargo.setChg_eff_dt(date1);
							maritalBo.deleteRelationRecord(appHshlRtlColl);

							appHshlRtlCargo.setRowAction(recordIndRel2);
							appHshlRtlCargo.setApp_num(appNum);
							// PCR 30899 - RefSeqNumber was coming from
							// beforeCargo because it was assigned in the delete
							// part above.
							/*
							 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines
							 * Commented Code in this block
							 */

							appHshlRtlCargo
							.setRef_indv_seq_num(strRefSeqNumFrmPage);
							appHshlRtlCargo.setSrc_indv_seq_num(appHshlRtlCargo
									.getSrc_indv_seq_num());
							appHshlRtlCargo
							.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
							appHshlRtlCargo.setChg_eff_dt(date2);
							appHshlRtlCargo.setCare_resp(FwConstants.SPACE);
							appHshlRtlCargo.setRec_cplt_ind(FwConstants.ZERO);
							if (AppConstants.SEX_IND_FEMALE.equals(sexInd)) {
								appHshlRtlCargo.setRlt_cd("HUS");
							} else {
								appHshlRtlCargo.setRlt_cd("WIF");
							}
							if (appHshlRtlColl == null
									|| appHshlRtlColl.isEmpty()) {
								appHshlRtlColl.add(appHshlRtlCargo);
							}
							if (appHshlRtlCargo.getPhy_boe_sep_sw() == null
									|| FwConstants.EMPTY_STRING
									.equals(appHshlRtlCargo
											.getPhy_boe_sep_sw().trim())) {
								appHshlRtlCargo
								.setPhy_boe_sep_sw(FwConstants.SPACE);

							}
							maritalBo.storeMarriageDetails(appHshlRtlColl);
						}
						appHshlRtlColl.add(appHshlRtlCargo);
					}
				}
			} else {

				recordIndLive = FwConstants.ROWACTION_INSERT;
				indvLiveChgCargo.setRowAction(recordIndLive);
				indvLiveChgCargo.setApp_num(appNum);
				indvLiveChgCargo
				.setIndv_seq_num(String.valueOf(categorySeqDetailBean
						.getIndividualSequence()));
				indvLiveChgCargo.setUpdt_dt(String.valueOf(fwDate.getDate()));
				if (AppConstants.GOT_MARRIED.equals(catType)) {
					indvLiveChgCargo
					.setMrtl_stat_cd(AppConstants.MARRIAGE_INDICATOR);
				} else {
					indvLiveChgCargo
					.setMrtl_stat_cd(AppConstants.DIVORCE_INDICATOR);
				}
				indvLiveChgCargo
				.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				indvLiveChgCargo.setMove_out_dt(AppConstants.HIGH_DATE);
				indvLiveChgCargo.setEst_return_dt(AppConstants.HIGH_DATE);
				if (AppConstants.GOT_MARRIED.equals(catType)) {
					indvLiveChgCargo
					.setLive_arng_typ(AppConstants.MARRIAGE_INDICATOR);
				} else {
					indvLiveChgCargo
					.setLive_arng_typ(AppConstants.DIVORCE_INDICATOR);
				}
				indvLiveChgCargo = (INDV_LIVE_CHG_Cargo) isChanged(
						indvLiveBeforeCargo, indvLiveChgCargo);
				if (indvLiveChgCargo.isDirty()) {
					indvLiveDetailsUpdate = true;
				}

				livingArrBo
				.storeLivingArrangementDetails(indvLiveChgCollection);
				if (!AppConstants.GOT_DIVORCED.equals(catType)) {
					recordIndRel = FwConstants.ROWACTION_INSERT;
					appHshlRtlCargo.setRowAction(recordIndRel);
					appHshlRtlCargo.setApp_num(appNum);
					appHshlRtlCargo.setSrc_indv_seq_num(String
							.valueOf(categorySeqDetailBean
									.getIndividualSequence()));
					appHshlRtlCargo.setChg_eff_dt(indvLiveChgCargo
							.getChg_eff_dt());
					appHshlRtlCargo.setCare_resp(FwConstants.SPACE);
					appHshlRtlCargo.setRec_cplt_ind(FwConstants.ZERO);

					if (appHshlRtlCargo.getRef_indv_seq_num() == null) {
						appHshlRtlCargo.setRef_indv_seq_num(FwConstants.ZERO);
					}
					if (AppConstants.SEX_IND_FEMALE.equals(sexInd)) {
						appHshlRtlCargo.setRlt_cd("HUS");
					} else {
						appHshlRtlCargo.setRlt_cd("WIF");
					}
					appHshlRtlCargo
					.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);

					if (appHshlRtlCargo.getPhy_boe_sep_sw() == null
							|| FwConstants.EMPTY_STRING.equals(appHshlRtlCargo
									.getPhy_boe_sep_sw().trim())) {
						appHshlRtlCargo.setPhy_boe_sep_sw(FwConstants.SPACE);

					}
					// check dirty
					appHshlRtlCargo = (APP_HSHL_RLT_Cargo) isChanged(
							beforeAppHshlRltCargo, appHshlRtlCargo);
					if (appHshlRtlCargo.isDirty()) {
					}

					if (appHshlRtlColl == null || appHshlRtlColl.isEmpty()) {
						appHshlRtlColl.add(appHshlRtlCargo);
					}
					maritalBo.storeMarriageDetails(appHshlRtlColl);
				}
				categorySelectionProfileManager.updateSequence(marriageProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						catSeqNum, categorySeqDetailBean.getCategoryType());
			}
			if (request.get("loopingQuestion") != null
					&& FwConstants.YES.equals(request.get("loopingQuestion"))) {
				final String[] pageId = { "ARHMI" };
				rmcRqstCargo.setPrsn_add_stat_sw(FwConstants.YES);
				driverManager.makeRequired(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNum);
			}
			session.put(FwConstants.RMC_DRIVER, driverArray);
			// Mark complete marriage sequence using common methods
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNum,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			categorySelectionProfileManager.makeSequenceDetailComplete(
					marriageProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());

			if (categorySelectionProfileManager
					.areAllSequencesComplete(marriageProfile)) {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 2,2 lines Commented
				 * Code in this block
				 */

				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNum);

				session.put(FwConstants.RMC_DRIVER, driverArray);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(marriageProfile);
			}
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoMarriageDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoMarriageDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoMarriageDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoMarriageDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMarriageDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load caretaker.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadCaretaker(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.loadCaretaker() - START");
		try {
			final Map session = txnBean.getSession();
			
			populateCareTaker(txnBean,false);
			txnBean.setSession(session);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadCaretaker");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadCaretaker");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadCaretaker", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadCaretaker");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadCaretaker() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store caretaker.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeCaretaker(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "HouseHoldInfoEJBBean.storeCaretaker() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String currentPageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			request.get(FwConstants.PREVIOUS_PAGE_ID);
			final int currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageId, driverArray);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			INDIVIDUAL_Custom_Collection childNameColl = new INDIVIDUAL_Custom_Collection();
			new ArrayList<INDIVIDUAL_Custom_Collection>();
			List<APP_HSHL_RLT_Collection> hshlColCareTakerlList = new ArrayList<APP_HSHL_RLT_Collection>();
			List<INDIVIDUAL_Custom_Collection> custCollList = new ArrayList<INDIVIDUAL_Custom_Collection>();
			final ABHouseHoldRelationshipBO houseHoldRelationBo = new ABHouseHoldRelationshipBO();
			if (beforeColl.containsKey("childNameList")) {
				childNameColl = (INDIVIDUAL_Custom_Collection) beforeColl
						.get("childNameList");
			}

			if (beforeColl.containsKey("hshlCollList")) {
				hshlColCareTakerlList = (List<APP_HSHL_RLT_Collection>) beforeColl
						.get("hshlCollList");
			}
			
			if(beforeColl.containsKey("custCollList")){
				custCollList = (List<INDIVIDUAL_Custom_Collection>) beforeColl
						.get("custCollList");
			}
			APP_HSHL_RLT_Collection appCareTakerHshlPageColl = new APP_HSHL_RLT_Collection();
			if (pageCollection.containsKey("APP_HSHL_RLT_Collection")) {
				appCareTakerHshlPageColl = (APP_HSHL_RLT_Collection) pageCollection
						.get("APP_HSHL_RLT_Collection");
			}

			NO_ONE_Collection noOneCollection = null;
			if (pageCollection.containsKey("NO_ONE_Collection")) {
				noOneCollection = (NO_ONE_Collection) pageCollection
						.get("NO_ONE_Collection");
			}

			boolean isAddIndividualMode = false;

			if (beforeColl.containsKey("RMB_ADD_INDIVIDUAL_MODE")
					&& FwConstants.YES.equals(beforeColl
							.get("RMB_ADD_INDIVIDUAL_MODE"))) {
				isAddIndividualMode = true;
			}

			final ARHPGValidator arhpgValidator = new ARHPGValidator();
			final FwMessageList errorMessageList = arhpgValidator
					.validateCareTaker(childNameColl, hshlColCareTakerlList,
							appCareTakerHshlPageColl, noOneCollection);
			if (errorMessageList != null && arhpgValidator.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST,
						arhpgValidator.getMessageList());

				final List<INDIVIDUAL_Custom_Collection> careTakerErrorReturnList = new ArrayList<INDIVIDUAL_Custom_Collection>();
				final List<Map> careTakerMapList = new ArrayList<Map>();
				NO_ONE_Collection pageNoOneColl = null;
				final List<NO_ONE_Collection> noOneList = new ArrayList<NO_ONE_Collection>();
				for (int i = 0; i < childNameColl.size(); i++) {
					INDIVIDUAL_Custom_Cargo childNameCargo = (INDIVIDUAL_Custom_Cargo) childNameColl.get(i);
					final APP_HSHL_RLT_Collection appCareTakerHshlSessColl = hshlColCareTakerlList
							.get(i);
					final APP_HSHL_RLT_Collection appCareTakerHshlColl = combineSessionPageCollection(appCareTakerHshlSessColl, appCareTakerHshlPageColl);
							
					final INDIVIDUAL_Custom_Collection careTakerErrorReturnColl = new INDIVIDUAL_Custom_Collection();
					final Map careTakerMap = new HashMap();
					if (appCareTakerHshlColl != null) {
						for (int c = 0; c < appCareTakerHshlColl.size(); c++) {
							final APP_HSHL_RLT_Cargo careTakerHshlPageCargo = appCareTakerHshlColl
									.getCargo(c);
							if(childNameCargo.getIndv_seq_num().equals(careTakerHshlPageCargo.getRef_indv_seq_num())){
								careTakerErrorReturnColl.add(peopleHandler
										.getIndividual(careTakerHshlPageCargo
												.getSrc_indv_seq_num()));
								 String careTakerresp = AppConstants.NO;
								if(careTakerHshlPageCargo.getCare_resp()!=null && careTakerHshlPageCargo.getCare_resp().equals(AppConstants.YES)){
									careTakerresp = AppConstants.REQUIRED;
								}
								/*final String careTakerresp = getCareTakerResponse(
										appCareTakerHshlPageColl,
										careTakerHshlPageCargo
										.getSrc_indv_seq_num(),
										careTakerHshlPageCargo
										.getRef_indv_seq_num());*/
								careTakerMap.put(careTakerHshlPageCargo
										.getSrc_indv_seq_num(), careTakerresp);
							}
							
							
						}
					}
					careTakerMapList.add(careTakerMap);
					careTakerErrorReturnList.add(careTakerErrorReturnColl);
					/*if (careTakerMap != null
							&& !careTakerMap.containsValue("R")) {
						pageNoOneColl = new NO_ONE_Collection();
						final NO_ONE_Cargo noOneCargo = new NO_ONE_Cargo();
						noOneCargo.setNo_one_name(FwConstants.EMPTY_STRING);
						pageNoOneColl.add(new NO_ONE_Cargo());
						pageCollection.put("NO_ONE_Collection", pageNoOneColl);
						noOneList.add(pageNoOneColl);
					}*/
					
					if(noOneCollection!=null){
						noOneList.add(noOneCollection);
					}
					pageCollection.put("CareTakerMap", careTakerMap);
				}
				pageCollection.put("careTakerMapList", careTakerMapList);
				pageCollection.put("custCollList", careTakerErrorReturnList);
				pageCollection.put("childNameList", childNameColl);
				
				
				pageCollection.put("hshlCollList", hshlColCareTakerlList);
				pageCollection.put("noOneList", noOneList);
				
				if(beforeColl.containsKey("custCollCwList")){
					pageCollection.put("custCollCwList", beforeColl.get("custCollCwList"));
				}
				if(beforeColl.containsKey("careTakerMapCwList")){
					pageCollection.put("careTakerMapCwList", beforeColl.get("careTakerMapCwList"));
				}
								
				
				String addIndvMode = FwConstants.NO;
				if(isAddIndividualMode){
					addIndvMode = FwConstants.YES;
				}
				pageCollection.put("RMB_ADD_INDIVIDUAL_MODE", addIndvMode);
				
				
				txnBean.setPageCollection(pageCollection);
				txnBean.setRequest(request);
				return;
			}

			APP_HSHL_RLT_Collection appCareTakerHshlSessColl = new APP_HSHL_RLT_Collection();
			if (session.containsKey("APP_HSHL_CARE_TAKER_Collection")) {
				appCareTakerHshlSessColl = (APP_HSHL_RLT_Collection) session
						.get("APP_HSHL_CARE_TAKER_Collection");
			}
			
			APP_HSHL_RLT_Collection combinedCollection = new APP_HSHL_RLT_Collection();
			if (currentPageStatus != FwConstants.DRIVER_REQUIRED){
				
				 combinedCollection = combineSessionPageCollection(appCareTakerHshlSessColl, appCareTakerHshlPageColl);
				 appCareTakerHshlPageColl = combinedCollection;
				
			}
			//Translate no one check box into APP_HSHL_RLT_Collection cargo and adding it to page appCareTakerHshlPageColl
			List noOneList = new ArrayList();
			for(Object o : noOneCollection) {
				NO_ONE_Cargo cargo = (NO_ONE_Cargo) o;
				noOneList.add(cargo.getNo_one_name());
			}
			
			APP_HSHL_RLT_Collection careTakerCollection = new APP_HSHL_RLT_Collection();
			
			for (int index = 0; index < childNameColl.size(); index++) {
				INDIVIDUAL_Custom_Cargo indvCargo = (INDIVIDUAL_Custom_Cargo) childNameColl.get(index);
				if(noOneList.contains(indvCargo.getIndv_seq_num())) {
					INDIVIDUAL_Custom_Collection relColl =  custCollList.get(index);
//					Map careTakerMapCw = (Map) careTakerMapCwList.get(index);
					
					for(Object o:relColl) {
						INDIVIDUAL_Custom_Cargo indvCargo1 = (INDIVIDUAL_Custom_Cargo) o;
						
						APP_HSHL_RLT_Cargo rltCargo = new APP_HSHL_RLT_Cargo();
						rltCargo.setCare_resp(FwConstants.NO);
						rltCargo.setSrc_indv_seq_num(indvCargo1.getIndv_seq_num());
						rltCargo.setRef_indv_seq_num(indvCargo.getIndv_seq_num());
						
						appCareTakerHshlPageColl.add(rltCargo);
					}
				}
				
			}
			

			/*if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
				if (appCareTakerHshlSessColl != null
						&& !appCareTakerHshlSessColl.isEmpty()) {
					final APP_HSHL_RLT_Collection appCareTakerHshlDeleteColl = new APP_HSHL_RLT_Collection();
					for (int d = 0; d < appCareTakerHshlSessColl.size(); d++) {
						final APP_HSHL_RLT_Cargo appCareTakerSessionCargo = appCareTakerHshlSessColl
								.getCargo(d);
						appCareTakerSessionCargo
						.setRowAction(FwConstants.ROWACTION_DELETE);
						appCareTakerHshlDeleteColl
						.addCargo(appCareTakerSessionCargo);
					}
					appCareTakerHshlDeleteColl.persist(FwConstants.DAO);
				}
			}*/

			final APP_HSHL_RLT_Collection persistCareTakerCollection = new APP_HSHL_RLT_Collection();
			final APP_HSHL_RLT_Collection fullCaretakerCollection = houseHoldRelationBo.loadCaretakerColl(appNumber);
			
			if (appCareTakerHshlPageColl != null
					&& !appCareTakerHshlPageColl.isEmpty()) {
				for (int a = 0; a < appCareTakerHshlPageColl.size(); a++) {
					final APP_HSHL_RLT_Cargo appCareTakerPageCargo = appCareTakerHshlPageColl
							.getCargo(a);
					appCareTakerPageCargo.setApp_num(appNumber);
					/*appCareTakerPageCargo.setRlt_cd("NOT");*/
					appCareTakerPageCargo.setChg_eff_dt(getDate(new Date(),
							"yyyy-MM-dd"));
					if (appCareTakerPageCargo.getPhy_boe_sep_sw() == null
							|| appCareTakerPageCargo.getPhy_boe_sep_sw().trim()
							.length() <= 0) {
						appCareTakerPageCargo
						.setPhy_boe_sep_sw(FwConstants.SPACE);
					}
										
					updateSrcIndnRowAction(fullCaretakerCollection, appCareTakerPageCargo);
					persistCareTakerCollection.addCargo(appCareTakerPageCargo);
				}
			}
			
			
			for(int i = 0; i<childNameColl.size(); i++){
				INDIVIDUAL_Custom_Cargo childCargo = (INDIVIDUAL_Custom_Cargo) childNameColl.get(i);
				String childIndvId = childCargo.getIndv_seq_num();
				
				APP_HSHL_RLT_Collection fullChildColl = getChildColl(fullCaretakerCollection, childIndvId);
				APP_HSHL_RLT_Collection pageChildColl = getChildColl(appCareTakerHshlPageColl, childIndvId);
				APP_HSHL_RLT_Collection filteredFullChildColl = filterCollUsingSrcAppInd(fullChildColl);
				
				for( int j =0; j<filteredFullChildColl.size(); j++){
					
					APP_HSHL_RLT_Cargo childRltCargo = filteredFullChildColl.getCargo(j);
					if(pageChildColl!=null){
						if(updateCareResponse(childRltCargo, pageChildColl)){
							
							childRltCargo.setCare_resp(AppConstants.NO);
							if(childRltCargo.getSrc_app_ind().equals(AppConstants.RMC_MODIFIED_RECORD_IND)){
								childRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							} else if (childRltCargo.getSrc_app_ind().equals(AppConstants.RMC_NEW_RECORD_IND)){
								childRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							} else {
								childRltCargo.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
								childRltCargo.setRowAction(FwConstants.ROWACTION_INSERT);
							}
							childRltCargo.setChg_eff_dt(getDate(new Date(),
									"yyyy-MM-dd"));
							persistCareTakerCollection.addCargo(childRltCargo);
							
						}
					}
					
					
				}
				
				
			}
						
			
			session.put("APP_HSHL_CARE_TAKER_Collection",
					persistCareTakerCollection);
			//session.remove("CHILD_CARE_TAKER_CHANGE");
			txnBean.setSession(session);
			persistCareTakerCollection.persist(FwConstants.DAO);
			driverManager.makeComplete(FwConstants.RMC_DRIVER, currentPageId,
					driverArray, appNumber);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeCaretaker");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeCaretaker");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeCaretaker", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeCaretaker");
		}
		log(ILog.INFO,
				"HouseHoldInfoEJBBean.storeCaretaker() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Gets the care taker response.
	 *
	 * @param appCareTakerHshlPageColl the app care taker hshl page coll
	 * @param srcIndvSeqNum the src indv seq num
	 * @param refIndSeNum the ref ind se num
	 * @return the care taker response
	 */
	private String getCareTakerResponse(
			final APP_HSHL_RLT_Collection appCareTakerHshlPageColl,
			final String srcIndvSeqNum, final String refIndSeNum) {
		String careTakerResponse = FwConstants.SPACE;
		if (appCareTakerHshlPageColl != null) {
			for (int i = 0; i < appCareTakerHshlPageColl.size(); i++) {
				final APP_HSHL_RLT_Cargo tempCargo = appCareTakerHshlPageColl
						.getCargo(i);
				if (srcIndvSeqNum.equals(tempCargo.getRef_indv_seq_num())
						&& refIndSeNum.equals(tempCargo.getSrc_indv_seq_num())) {
					if (FwConstants.YES.equals(tempCargo.getCare_resp())) {
						careTakerResponse = "R";
					}
				}
			}
		}
		return careTakerResponse;
	}

	/**
	 * Gets the date.
	 *
	 * @param date the date
	 * @param format the format
	 * @return the date
	 */
	private String getDate(final Date date, final String format) {
		String dateString = AppConstants.HIGH_DATE;
		final DateFormat dateFormat = new SimpleDateFormat(format);
		dateString = dateFormat.format(date);
		return dateString;
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoRelationshipDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoRelationshipDetails() - START");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		Map pageCollection = txnBean.getPageCollection();
		String appNumber = null;
		Map beforeColl = null;
		int[] driverArray = null;
		int indvSeqNumber = 1;
		PeopleHandler peopleHandler = null;
		INDIVIDUAL_Custom_Collection indvSortedCustColl = null;
		INDIVIDUAL_Custom_Collection newIndvSortedCustColl = null;
		INDIVIDUAL_Custom_Collection indvSrcCustColl = null;
		INDIVIDUAL_Custom_Collection indvRefCustColl = null;
		HouseHoldInfoBO houseHoldInfoBO= new HouseHoldInfoBO();
		int relationPosition = 0;
		String pageId = null;
		int pageStatus = 0;
		int indvSortSize = 0;
		boolean detailKeyFlag = false;
		try {
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			pageStatus = driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
					pageId, driverArray);
			indvSortSize = peopleHandler.getNumberOfIndividuals();
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			if (!pageId.equals(previousPageId)) {
				// we need to remove the vallues from the session
				if(!beforeColl.containsKey(FwConstants.CURRENT_RECORD_INDEX) || !beforeColl.containsKey(FwConstants.LAST_RECORD_INDEX)) {
				session.remove(FwConstants.BEFORE_COLLECTION);
				beforeColl = new HashMap();
				}
			}
			indvSortedCustColl = (INDIVIDUAL_Custom_Collection) pageCollection
					.get("SortedColl");

			if (indvSortedCustColl == null) {
				// here we are getting the sorted collection
				// PCR 30516 - Get only In Home individuals
				indvSortedCustColl = peopleHandler
						.sortIndividualsByAge(peopleHandler
								.getInHomeIndividuals());
			}

			if (beforeColl != null&&!beforeColl.isEmpty()) {
				beforeColl.remove("APP_HSHL_RLT_Collection");
				beforeColl.remove("INDV_SRC_CUST_Collection");
				beforeColl.remove("INDV_REF_CUST_Collection");
				if (beforeColl.containsKey(FwConstants.CURRENT_RECORD_INDEX)) {
					relationPosition = Integer.parseInt((String) beforeColl
							.get(FwConstants.CURRENT_RECORD_INDEX));
					relationPosition = relationPosition + 1;
					
					if(beforeColl.get("AgeGenderChangeFlag")!=null){
						relationPosition=0;
						beforeColl.put(FwConstants.CURRENT_RECORD_INDEX, "0");
						beforeColl.put(FwConstants.LAST_RECORD_INDEX, "0");
						beforeColl.remove("AgeGenderChangeFlag");
						if (pageCollection.containsKey(FwConstants.DETAIL_KEY_BEAN)) {
							final IndivTypeSeqBean indvSeqBean = (IndivTypeSeqBean) pageCollection
									.get(FwConstants.DETAIL_KEY_BEAN);
							indvSeqBean.setIndivSeqNum("1");
							pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indvSeqBean);
						}
					}else if (!pageId.equals(previousPageId)) {
						final APP_HSHL_RLT_Cargo relationCargo = new APP_HSHL_RLT_Cargo();
						relationCargo.setApp_num(appNumber);
						relationCargo.setSrc_indv_seq_num(String.valueOf(relationPosition));
						APP_HSHL_RLT_Collection relationColl=houseHoldInfoBO.getRelationDetails(relationCargo);
						boolean found= false;
						for(int i=0;i<relationColl.size();i++){
							if("RM".equals(relationColl.getCargo(i).getSrc_app_ind())) {
								found=true;
								break;
							}
						}
						if(!found) relationPosition--;
						beforeColl.put(FwConstants.CURRENT_RECORD_INDEX, String.valueOf(relationPosition));
						if (pageCollection.containsKey(FwConstants.DETAIL_KEY_BEAN)) {
							final IndivTypeSeqBean indvSeqBean = (IndivTypeSeqBean) pageCollection
									.get(FwConstants.DETAIL_KEY_BEAN);
							indvSeqBean.setIndivSeqNum(indvSortedCustColl.getResult(relationPosition).getIndv_seq_num());
							pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indvSeqBean);
						}
					}
				
				}
			}
			

			final HouseHoldRelationshipBO houseHoldRelationBo = new HouseHoldRelationshipBO();
			indvSortSize = indvSortedCustColl.size();
			newIndvSortedCustColl = (INDIVIDUAL_Custom_Collection) pageCollection
					.get("NewSortedColl");

			newIndvSortedCustColl = new INDIVIDUAL_Custom_Collection();
			newIndvSortedCustColl.addAll(indvSortedCustColl);

			final int newIndvSortedCustCollSize = newIndvSortedCustColl.size();
			if (pageCollection.containsKey(FwConstants.DETAIL_KEY_BEAN)) {
				final IndivTypeSeqBean indvSeqBean = (IndivTypeSeqBean) pageCollection
						.get(FwConstants.DETAIL_KEY_BEAN);
				indvSeqNumber = Integer.parseInt(indvSeqBean.getIndivSeqNum());

				// now we are finding that position
				for (int i = 0; i < newIndvSortedCustCollSize; i++) {
					if (newIndvSortedCustColl.getResult(i).getIndv_seq_num()
							.equals(indvSeqBean.getIndivSeqNum())) {
						relationPosition = i;
						break;
					}
				}
				detailKeyFlag = true;
			} else if (pageStatus == FwConstants.DRIVER_COMPLETE) {
				INDIVIDUAL_Custom_Cargo indvSortCargo = null;
				for (int i = 0; i < newIndvSortedCustCollSize - 1; i++) {
					indvSortCargo = newIndvSortedCustColl.getResult(i);
					// here we need to determine the last record we need to show
					// are not
					if (indvSortSize == i + 1) {
						// now we need to determine that person rules
						indvSrcCustColl = new INDIVIDUAL_Custom_Collection();
						indvSrcCustColl.add(indvSortCargo);
					}
					populateRecordArray(
							new IndivTypeSeqBean(
									indvSortCargo.getIndv_seq_num(),
									FwConstants.EMPTY_STRING,
									FwConstants.EMPTY_STRING), session);
					relationPosition = i;
				}
			}

			// now i am creating the collections
			// first collection is src indv seq number
			indvSrcCustColl = new INDIVIDUAL_Custom_Collection();
			indvRefCustColl = new INDIVIDUAL_Custom_Collection();
			pageCollection = new HashMap();

			if (pageStatus == FwConstants.DRIVER_COMPLETE
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					|| pageStatus == FwConstants.DRIVER_REQUIRED
					|| detailKeyFlag) {
				// first i need to get the rel point one to the src collection
				if (newIndvSortedCustCollSize > 0) {
					indvSrcCustColl.add(newIndvSortedCustColl
							.get(relationPosition));
					indvSeqNumber = Integer.parseInt(indvSrcCustColl.getResult(
							0).getIndv_seq_num());
				}

				// now i am loging the page informaton
				pageCollection = houseHoldRelationBo
						.loadHousholdRelationshipDetails(appNumber,
								indvSeqNumber);
				/*
				 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
				 * javadoc
				 */

				for (int k = relationPosition + 1; k < indvSortSize; k++) {
					if (!indvSortedCustColl
							.getResult(k)
							.getIndv_seq_num()
							.equals(indvSrcCustColl.getResult(0)
									.getIndv_seq_num())) {
						indvRefCustColl.add(indvSortedCustColl.getResult(k));
					}
				}

				// now i am storing this seq number to the record array
				if (!detailKeyFlag && pageStatus != FwConstants.DRIVER_COMPLETE) {
					populateRecordArray(
							new IndivTypeSeqBean(indvSrcCustColl.getResult(0)
									.getIndv_seq_num(),
									FwConstants.EMPTY_STRING,
									FwConstants.EMPTY_STRING), session);
				}
				// filtered values
				final APP_HSHL_RLT_Collection relationCollection = houseHoldRelationBo
						.checkExitingRelations(appNumber);
				if (relationCollection != null) {
					pageCollection
					.put("RelationCollection", relationCollection);
				}

				pageCollection.put("INDV_SRC_CUST_Collection", indvSrcCustColl);
				pageCollection.put("INDV_REF_CUST_Collection", indvRefCustColl);
				pageCollection.put("SortedColl", indvSortedCustColl);
				pageCollection.put("NewSortedColl", newIndvSortedCustColl);
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNumber));
			}
			String snapPrgm = FwConstants.NO;
			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			if (programKey[2] != 0) {
				snapPrgm = FwConstants.YES;
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in
			 * this block
			 */

			pageCollection.put("SnapProgram", snapPrgm);
			pageCollection.put("CurrentPageStatus", String.valueOf(pageStatus));
			txnBean.setPageCollection(pageCollection);
			componentManager.getComponents(pageId, txnBean);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}
			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoRelationshipDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoRelationshipDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoRelationshipDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoRelationshipDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoRelationshipDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoRelationshipDetails(
			final FwTransaction txnBean) throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoRelationshipDetails() - START");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		String pageId = null;
		int currentPageStatus = 0;
		PeopleHandler peopleHandler = null;
		Map beforeColl = null;
		APP_HSHL_RLT_Collection appHshlRltColl = null;
		APP_HSHL_RLT_Collection appHshlRltBeforeColl = null;
		APP_HSHL_RLT_Cargo appHshlRltCargo = null;
		APP_HSHL_RLT_Cargo appHshlRltBeforeCargo = null;
		INDIVIDUAL_Custom_Collection newSortedColl = null;
		INDIVIDUAL_Custom_Collection refCustColl = null;
		String isTaxDepInd = "";
		int indvSeqNumber = 1;
		int newSortedCollSize = 0;
		String snapPrgm = FwConstants.EMPTY_STRING;
		try {
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			snapPrgm = (String) beforeColl.get("SnapProgram");

			appHshlRltColl = (APP_HSHL_RLT_Collection) pageCollection
					.get("APP_HSHL_RLT_Collection");
			if (beforeColl != null) {
				if (beforeColl.containsKey("NewSortedColl")) {
					newSortedColl = (INDIVIDUAL_Custom_Collection) beforeColl
							.get("NewSortedColl");
				}

				if (beforeColl.containsKey("APP_HSHL_RLT_Collection")) {
					appHshlRltBeforeColl = (APP_HSHL_RLT_Collection) beforeColl
							.get("APP_HSHL_RLT_Collection");
				}
				if (beforeColl.containsKey(AppConstants.INDV_SEQUENCE_NUMBERS)) {
					indvSeqNumber = Integer.parseInt((String) beforeColl
							.get(AppConstants.INDV_SEQUENCE_NUMBERS));
				}
				if (beforeColl.containsKey("INDV_REF_CUST_Collection")) {
					refCustColl = (INDIVIDUAL_Custom_Collection) beforeColl
							.get("INDV_REF_CUST_Collection");
				}

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 6 lines Commented Code
				 * in this block
				 */

			}
			if (newSortedColl != null) {
				newSortedCollSize = newSortedColl.size();
			}
			final HouseHoldRelationshipBO houseHoldRelationBo = new HouseHoldRelationshipBO();
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			if (backToMyAccess == null) {
				// now i am validating the data
				// Added Reference Cust Collection in order to sort the hshl
				// relation collection - PCR 30414
				pageCollection.put("SnapProgram", snapPrgm);
				houseHoldRelationBo.validateHousholdRelationshipDetails(
						snapPrgm, appHshlRltColl, peopleHandler, refCustColl,appNumber);
			}
			if (checkBackToMyAccessSelected(request)
					|| houseHoldRelationBo.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							houseHoldRelationBo.getMessageList());
				}
				if (appHshlRltColl != null && !appHshlRltColl.isEmpty()) {
					final int appHshlRelaCollSize = appHshlRltColl.size();
					if (appHshlRltBeforeColl != null && !appHshlRltBeforeColl.isEmpty()) {
						final int appHshlRelaBefoCollSize = appHshlRltBeforeColl.size();
						
						for (int i = 0; i < appHshlRelaCollSize; i++) {
							for (int j = 0; j < appHshlRelaBefoCollSize; j++) {
								if (appHshlRltColl.getCargo(i).getSrc_indv_seq_num()
										.equals(appHshlRltBeforeColl.getCargo(j).getSrc_indv_seq_num()) 
										&& appHshlRltColl.getCargo(i).getRef_indv_seq_num()
										.equals(appHshlRltBeforeColl.getCargo(j).getRef_indv_seq_num())) {
									
									if (StringUtils.isBlank(appHshlRltColl.getCargo(i).getSrc_app_ind())) {
										appHshlRltColl.getCargo(i).setSrc_app_ind(appHshlRltBeforeColl
												.getCargo(j).getSrc_app_ind());
									}								
								}
							}
						}
					}
					pageCollection.put("APP_HSHL_RLT_Collection", appHshlRltColl);
				}

				if (beforeColl.containsKey("INDV_SRC_CUST_Collection")) {
					pageCollection.put("INDV_SRC_CUST_Collection",
							beforeColl.get("INDV_SRC_CUST_Collection"));
				}
				if (refCustColl != null) {
					pageCollection.put("INDV_REF_CUST_Collection", 
							refCustColl);
				}
				if (beforeColl.containsKey("SortedColl")) {
					pageCollection.put("SortedColl",
							beforeColl.get("SortedColl"));
				}
				if (beforeColl.containsKey("RelationCollection")) {
					pageCollection.put("RelationCollection",
							beforeColl.get("RelationCollection"));
				}
				if (beforeColl.containsKey("RelationList")) {
					pageCollection.put("RelationList", 
							beforeColl.get("RelationList"));
				}
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNumber));
				pageCollection.put("CurrentPageStatus",
						String.valueOf(currentPageStatus));

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 6 lines Commented Code
				 * in this block
				 */
				/**
				 * // Added logic to set the FST and SEC CARGO back - Srividhya
				 * 8APR15
				 */

				// Added this in order to ensure the components don't disappear
				// during validations
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				return;
			}
			final boolean completeCareFlg = true;
			final List componentList = (ArrayList) beforeColl
					.get(FwConstants.PAGE_COMPONENT_LIST);
			// for the relation ship cargo
			if (appHshlRltColl != null && !appHshlRltColl.isEmpty()) {
				final int appHshlRltCollSize = appHshlRltColl.size();
				APP_HSHL_RLT_Collection appHshlRltDataColl = null;
				boolean foundFlag = false;
				boolean foundCWFlag = false;
				boolean rmRnEntryAvailable = false;
				String srcSeqNum = null;
				String refSeqNum = null;
				boolean completeRltFlag = true;

				for (int i = 0; i < appHshlRltCollSize; i++) {
					completeRltFlag = true;
					appHshlRltCargo = appHshlRltColl.getCargo(i);
					appHshlRltCargo.setApp_num(appNumber);
					// Source app indicator and change effective date default
					// values population PCR # 29768
					appHshlRltCargo.setChg_eff_dt(AppConstants.HIGH_DATE);
					appHshlRltCargo
					.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
					if (appHshlRltCargo.getCare_resp() == null) {
						appHshlRltCargo.setCare_resp(FwConstants.SPACE);
					}
					if (appHshlRltCargo.getPhy_boe_sep_sw() == null) {

						appHshlRltCargo.setPhy_boe_sep_sw(FwConstants.SPACE);
						if (componentList.contains("31")) {
							completeRltFlag = false;
						}
					}
					if (completeRltFlag && completeCareFlg) {
						appHshlRltCargo.setRec_cplt_ind(FwConstants.ONE);
					} else {
						appHshlRltCargo.setRec_cplt_ind(FwConstants.ZERO);
					}
					foundFlag = false;
					foundCWFlag = false;
					rmRnEntryAvailable = false;
					srcSeqNum = appHshlRltCargo.getSrc_indv_seq_num();
					refSeqNum = appHshlRltCargo.getRef_indv_seq_num();

					// now we are comparing the data
					if (appHshlRltBeforeColl != null
							&& !appHshlRltBeforeColl.isEmpty()) {

						/*
						 * Updated logic by Srividhya 10Apr15 to separate the
						 * relationship cargo based on recordInd, srcSeqNum,
						 * refSeqNum
						 */
						final APP_HSHL_RLT_Cargo rmcNewBeforeCargo = houseHoldRelationBo
								.splitRelationWithRecIndSeqNum(
										appHshlRltBeforeColl,
										AppConstants.RMC_NEW_RECORD_IND,
										srcSeqNum, refSeqNum);

						final APP_HSHL_RLT_Cargo rmcModifiedBeforeCargo = houseHoldRelationBo
								.splitRelationWithRecIndSeqNum(
										appHshlRltBeforeColl,
										AppConstants.RMC_MODIFIED_RECORD_IND,
										srcSeqNum, refSeqNum);

						final APP_HSHL_RLT_Cargo cwwBeforeCargo = houseHoldRelationBo
								.splitRelationWithRecIndSeqNum(
										appHshlRltBeforeColl,
										AppConstants.CWW_RECORD_IND, srcSeqNum,
										refSeqNum);

						if (cwwBeforeCargo != null) {
							isTaxDepInd = cwwBeforeCargo.getTax_dpnd_resp();
						}
						/*
						 * VG SONAR Cleanup - 08/31/2015 Changed Commented code
						 * block to javadoc
						 */
						/**
						 * if (null != rmcNewBeforeCargo &&
						 * rmcNewBeforeCargo.getSrc_indv_seq_num
						 * ().equals(srcSeqNum) &&
						 * rmcNewBeforeCargo.getRef_indv_seq_num
						 * ().equals(refSeqNum)) { rmRnEntryAvailable = true; }
						 *
						 * if (null != rmcModifiedBeforeCargo &&
						 * rmcModifiedBeforeCargo
						 * .getSrc_indv_seq_num().equals(srcSeqNum) &&
						 * rmcModifiedBeforeCargo
						 * .getRef_indv_seq_num().equals(refSeqNum)) { if
						 * (!rmRnEntryAvailable) { rmRnEntryAvailable = true; }
						 * }
						 */

						if (rmcNewBeforeCargo != null) {
							/**
							 * if (!rmRnEntryAvailable) { rmRnEntryAvailable =
							 * true; }
							 */

							appHshlRltCargo.setCare_resp(rmcNewBeforeCargo
									.getCare_resp());
							if (rmcNewBeforeCargo.getChg_eff_dt() != null) {
								appHshlRltCargo.setChg_eff_dt(rmcNewBeforeCargo
										.getChg_eff_dt());
							}
							appHshlRltCargo.setSrc_app_ind(rmcNewBeforeCargo
									.getSrc_app_ind());
							appHshlRltCargo = (APP_HSHL_RLT_Cargo) isChanged(
									rmcNewBeforeCargo, appHshlRltCargo);
							if (appHshlRltCargo.isDirty()) {
								appHshlRltCargo
								.setRowAction(FwConstants.ROWACTION_UPDATE);
								if (appHshlRltDataColl == null) {
									appHshlRltDataColl = new APP_HSHL_RLT_Collection();
								}
								appHshlRltDataColl.add(appHshlRltCargo);
								/*
								 * VG SONAR Cleanup - 08/31/2015 Changed
								 * Commented code block to javadoc
								 */
								/**
								 * // checking for the change relationship as //
								 * MTR,FTR,SON,DAU String beforeRel =
								 * rmcNewBeforeCargo.getRlt_cd(); String
								 * afterRel = appHshlRltCargo.getRlt_cd(); if
								 * (!beforeRel.equals(afterRel) &&
								 * currentPageStatus !=
								 * FwConstants.DRIVER_REQUIRED) {
								 * ABHouseHoldMemberBO houseHoldMemberBo = new
								 * ABHouseHoldMemberBO(); if
								 * (afterRel.equals("FTR") ||
								 * afterRel.equals("MTR")) { IndividualAge
								 * indvAge = peopleHandler.getIndividualAge(
								 * appHshlRltCargo .getRef_indv_seq_num()); if
								 * (indvAge.getYears() < 19) {
								 * houseHoldMemberBo.
								 * deleteAbsentParent(appHshlRltCargo
								 * .getRef_indv_seq_num(), appNumber); } } else
								 * if (afterRel.equals("SON") ||
								 * afterRel.equals("DAU")) { IndividualAge
								 * indvAge = peopleHandler.getIndividualAge(
								 * appHshlRltCargo .getSrc_indv_seq_num()); if
								 * (indvAge.getYears() < 19) {
								 * houseHoldMemberBo.
								 * deleteAbsentParent(appHshlRltCargo
								 * .getSrc_indv_seq_num(), appNumber); } } else
								 * if (afterRel.equals("HUS") ||
								 * afterRel.equals("WIF")) { IndividualAge
								 * indvAge = peopleHandler.getIndividualAge(
								 * appHshlRltCargo .getSrc_indv_seq_num()); if
								 * (indvAge.getYears() < 19) {
								 * houseHoldMemberBo.
								 * deleteAbsentParent(appHshlRltCargo
								 * .getSrc_indv_seq_num(), appNumber); } indvAge
								 * = peopleHandler.getIndividualAge(
								 * appHshlRltCargo .getRef_indv_seq_num()); if
								 * (indvAge.getYears() < 19) {
								 * houseHoldMemberBo.
								 * deleteAbsentParent(appHshlRltCargo
								 * .getRef_indv_seq_num(), appNumber); } } }
								 */
							}
							appHshlRltBeforeColl.remove(rmcNewBeforeCargo);
							foundFlag = true;
						}

						if (rmcModifiedBeforeCargo != null) {
							if (!rmRnEntryAvailable) {
								rmRnEntryAvailable = true;
							}

							appHshlRltCargo.setCare_resp(rmcModifiedBeforeCargo
									.getCare_resp());
							if (rmcModifiedBeforeCargo.getChg_eff_dt() != null) {
								appHshlRltCargo
								.setChg_eff_dt(rmcModifiedBeforeCargo
										.getChg_eff_dt());
							}
							appHshlRltCargo
							.setSrc_app_ind(rmcModifiedBeforeCargo
									.getSrc_app_ind());
							appHshlRltCargo = (APP_HSHL_RLT_Cargo) isChanged(
									rmcModifiedBeforeCargo, appHshlRltCargo);
							if (appHshlRltCargo.isDirty()) {
								appHshlRltCargo
								.setRowAction(FwConstants.ROWACTION_UPDATE);
								if (appHshlRltDataColl == null) {
									appHshlRltDataColl = new APP_HSHL_RLT_Collection();
								}
								appHshlRltDataColl.add(appHshlRltCargo);
								// checking for the change relationship as
								// MTR,FTR,SON,DAU
								final String beforeRel = rmcModifiedBeforeCargo
										.getRlt_cd();
								final String afterRel = appHshlRltCargo
										.getRlt_cd();
								if (!beforeRel.equals(afterRel)
										&& currentPageStatus != FwConstants.DRIVER_REQUIRED) {
									final ABHouseHoldMemberBO houseHoldMemberBo = new ABHouseHoldMemberBO();
									if ("FTR".equals(afterRel)
											|| "MTR".equals(afterRel)) {
										final IndividualAge indvAge = peopleHandler
												.getIndividualAge(appHshlRltCargo
														.getRef_indv_seq_num());
										if (indvAge.getYears() < 19) {
											houseHoldMemberBo
											.deleteAbsentParent(
													appHshlRltCargo
													.getRef_indv_seq_num(),
													appNumber);
										}
									} else if ("SON".equals(afterRel)
											|| "DAU".equals(afterRel)) {
										final IndividualAge indvAge = peopleHandler
												.getIndividualAge(appHshlRltCargo
														.getSrc_indv_seq_num());
										if (indvAge.getYears() < 19) {
											houseHoldMemberBo
											.deleteAbsentParent(
													appHshlRltCargo
													.getSrc_indv_seq_num(),
													appNumber);
										}
									} else if ("HUS".equals(afterRel)
											|| "WIF".equals(afterRel)) {
										IndividualAge indvAge = peopleHandler
												.getIndividualAge(appHshlRltCargo
														.getSrc_indv_seq_num());
										if (indvAge.getYears() < 19) {
											houseHoldMemberBo
											.deleteAbsentParent(
													appHshlRltCargo
													.getSrc_indv_seq_num(),
													appNumber);
										}
										indvAge = peopleHandler
												.getIndividualAge(appHshlRltCargo
														.getRef_indv_seq_num());
										if (indvAge.getYears() < 19) {
											houseHoldMemberBo
											.deleteAbsentParent(
													appHshlRltCargo
													.getRef_indv_seq_num(),
													appNumber);
										}
									}
								}
							}
							appHshlRltBeforeColl.remove(rmcModifiedBeforeCargo);
							foundFlag = true;
						}

						if (cwwBeforeCargo != null) {
							if (!rmRnEntryAvailable) {
								appHshlRltCargo
								.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
								foundCWFlag = true;
							}
							appHshlRltBeforeColl.remove(cwwBeforeCargo);
						}
						/*
						 * VG SONAR Cleanup - 08/31/2015 Changed Commented code
						 * block to javadoc
						 */
						/**
						 * int appHshlRltBeforeCollSize =
						 * appHshlRltBeforeColl.size(); for (int j = 0; j <
						 * appHshlRltBeforeCollSize; j++) {
						 * appHshlRltBeforeCargo =
						 * appHshlRltBeforeColl.getCargo(j); if
						 * (appHshlRltBeforeCargo
						 * .getSrc_indv_seq_num().equals(srcSeqNum) &&
						 * appHshlRltBeforeCargo
						 * .getRef_indv_seq_num().equals(refSeqNum)) {
						 *
						 * if (AppConstants.RMC_NEW_RECORD_IND.equals(
						 * appHshlRltBeforeCargo.getSrc_app_ind()) ||
						 * AppConstants .RMC_MODIFIED_RECORD_IND.equals(
						 * appHshlRltBeforeCargo .getSrc_app_ind())) {
						 * appHshlRltCargo.setCare_resp(appHshlRltBeforeCargo
						 * .getCare_resp()); if
						 * (appHshlRltBeforeCargo.getChg_eff_dt() != null)
						 * appHshlRltCargo
						 * .setChg_eff_dt(appHshlRltBeforeCargo.getChg_eff_dt
						 * ()); appHshlRltCargo.setSrc_app_ind(
						 * appHshlRltBeforeCargo .getSrc_app_ind());
						 * appHshlRltCargo = (APP_HSHL_RLT_Cargo)
						 * isChanged(appHshlRltBeforeCargo, appHshlRltCargo); if
						 * (appHshlRltCargo.isDirty()) { appHshlRltCargo
						 * .setRowAction(FwConstants.ROWACTION_UPDATE); if
						 * (appHshlRltDataColl == null) appHshlRltDataColl = new
						 * APP_HSHL_RLT_Collection();
						 * appHshlRltDataColl.add(appHshlRltCargo); // checking
						 * for the change relationship as // MTR,FTR,SON,DAU
						 * String beforeRel = appHshlRltBeforeCargo.getRlt_cd();
						 * String afterRel = appHshlRltCargo.getRlt_cd(); if
						 * (!beforeRel.equals(afterRel) && currentPageStatus !=
						 * FwConstants.DRIVER_REQUIRED) { ABHouseHoldMemberBO
						 * houseHoldMemberBo = new ABHouseHoldMemberBO(); if
						 * (afterRel.equals("FTR") || afterRel.equals("MTR")) {
						 * IndividualAge indvAge =
						 * peopleHandler.getIndividualAge
						 * (appHshlRltCargo.getRef_indv_seq_num()); if
						 * (indvAge.getYears() < 19) {
						 * houseHoldMemberBo.deleteAbsentParent
						 * (appHshlRltCargo.getRef_indv_seq_num(), appNumber); }
						 * } else if (afterRel.equals("SON") ||
						 * afterRel.equals("DAU")) { IndividualAge indvAge =
						 * peopleHandler .getIndividualAge(appHshlRltCargo.
						 * getSrc_indv_seq_num ()); if (indvAge.getYears() < 19)
						 * { houseHoldMemberBo.
						 * deleteAbsentParent(appHshlRltCargo.
						 * getSrc_indv_seq_num (), appNumber); } } else if
						 * (afterRel.equals("HUS") || afterRel.equals("WIF")) {
						 * IndividualAge indvAge = peopleHandler
						 * .getIndividualAge(appHshlRltCargo.getSrc_indv_seq_num
						 * ()); if (indvAge.getYears() < 19) {
						 * houseHoldMemberBo.
						 * deleteAbsentParent(appHshlRltCargo.
						 * getSrc_indv_seq_num (), appNumber); } indvAge =
						 * peopleHandler.getIndividualAge
						 * (appHshlRltCargo.getRef_indv_seq_num()); if
						 * (indvAge.getYears() < 19) {
						 * houseHoldMemberBo.deleteAbsentParent
						 * (appHshlRltCargo.getRef_indv_seq_num(), appNumber); }
						 * } } }
						 * appHshlRltBeforeColl.remove(appHshlRltBeforeCargo);
						 * foundFlag = true; break; } } }
						 *
						 * for (int k = 0; k < appHshlRltBeforeColl.size(); k++)
						 * { appHshlRltBeforeCargo =
						 * appHshlRltBeforeColl.getCargo(k); if
						 * (appHshlRltBeforeCargo
						 * .getSrc_indv_seq_num().equals(srcSeqNum) &&
						 * appHshlRltBeforeCargo
						 * .getRef_indv_seq_num().equals(refSeqNum)) { Added new
						 * logic by Srividhya 10Apr15 to create a new
						 * Relationship record with RM record indicator if
						 * (AppConstants
						 * .CWW_RECORD_IND.equals(appHshlRltBeforeCargo
						 * .getSrc_app_ind())) { if (!rmRnEntryAvailable) {
						 * appHshlRltCargo .setSrc_app_ind(AppConstants.
						 * RMC_MODIFIED_RECORD_IND ); foundCWFlag = true; }
						 * appHshlRltBeforeColl.remove(appHshlRltBeforeCargo);
						 * break; } } }
						 */
					}
					if (!foundFlag || foundCWFlag) {
						appHshlRltCargo
						.setRowAction(FwConstants.ROWACTION_INSERT);
						if (appHshlRltDataColl == null) {
							appHshlRltDataColl = new APP_HSHL_RLT_Collection();
						}
						/**
						 * if(appHshlRltCargo.getChg_eff_dt().length()>10){
						 * appHshlRltCargo
						 * .setChg_eff_dt(appHshlRltCargo.getChg_eff_dt
						 * ().substring(0,10)); }
						 */
						appHshlRltDataColl.add(appHshlRltCargo);
					}
					// now i am updating the people handler
					if (FwConstants.ONE.equals(refSeqNum)) {
						// now i need to update people handler
						peopleHandler.setRelationshipCode(srcSeqNum,
								appHshlRltCargo.getRlt_cd());
					} else if (FwConstants.ONE.equals(srcSeqNum)) {
						// now i need to get reverse relation
						// first i need to get the srcSeqNum gender
						final String gender = peopleHandler.getIndividual(
								srcSeqNum).getSex_ind();
						final String relation = appHshlRltCargo.getRlt_cd();
						final IReferenceTableManager iref = ReferenceTableManager
								.getInstance();
						if (AppConstants.SEX_IND_MALE.equals(gender)) {
							// i need to get reverse relation for the male
							peopleHandler.setRelationshipCode(refSeqNum, iref
									.getColumnValue("TREL", 69, relation,
											FwConstants.ENGLISH));
						} else {
							// i need to get reverse relation for the female
							peopleHandler.setRelationshipCode(refSeqNum, iref
									.getColumnValue("TREL", 70, relation,
											FwConstants.ENGLISH));
						}
					}
				}
				if (appHshlRltBeforeColl != null
						&& !appHshlRltBeforeColl.isEmpty()) {
					final int appHshlRltBeforeCollSize = appHshlRltBeforeColl
							.size();
					for (int i = 0; i < appHshlRltBeforeCollSize; i++) {
						appHshlRltBeforeCargo = appHshlRltBeforeColl
								.getCargo(i);
						if (!AppConstants.CWW_RECORD_IND
								.equals(appHshlRltBeforeCargo.getSrc_app_ind())) {
							appHshlRltBeforeCargo
							.setRowAction(FwConstants.ROWACTION_DELETE);
							if (appHshlRltDataColl == null) {
								appHshlRltDataColl = new APP_HSHL_RLT_Collection();
							}
							appHshlRltDataColl.add(appHshlRltBeforeCargo);
						}
					}
				}
				if (appHshlRltDataColl != null && !appHshlRltDataColl.isEmpty()) {
					// now we need to persist the collection
					APP_HSHL_RLT_Cargo appHshlRltParCargo = null;
					for (int j = 0; j < appHshlRltDataColl.size(); j++) {
						appHshlRltParCargo = appHshlRltDataColl.getCargo(j);
						if (appHshlRltParCargo.getChg_eff_dt() != null
								&& appHshlRltParCargo.getChg_eff_dt().length() > 10) {
							appHshlRltParCargo.setChg_eff_dt(appHshlRltParCargo
									.getChg_eff_dt().substring(0, 10));
						}
						if (isTaxDepInd != null && !"".equals(isTaxDepInd)) {
							appHshlRltParCargo.setTax_dpnd_resp(isTaxDepInd);
						} else {
							appHshlRltParCargo.setTax_dpnd_resp("");
						}

					}

					houseHoldRelationBo.storeHousholdRelationshipDetails(
							appHshlRltDataColl, null);

				}
			} else if (appHshlRltBeforeColl != null
					&& !appHshlRltBeforeColl.isEmpty()) {
				final int appHshlRltBeforeCollSize = appHshlRltBeforeColl
						.size();
				for (int i = 0; i < appHshlRltBeforeCollSize; i++) {
					appHshlRltBeforeCargo = appHshlRltBeforeColl.getCargo(i);
					if (!AppConstants.CWW_RECORD_IND
							.equals(appHshlRltBeforeCargo.getSrc_app_ind())) {
						appHshlRltBeforeCargo
						.setRowAction(FwConstants.ROWACTION_DELETE);
					}
				}
				// now we need to call the persist method
				houseHoldRelationBo.storeHousholdRelationshipDetails(
						appHshlRltBeforeColl, null);
			}
			boolean pageComplete = false;
			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
				// now i am checking is they any persons we have to display
				final int currentArrayIndex = Integer
						.parseInt((String) beforeColl
								.get(FwConstants.CURRENT_RECORD_INDEX));
				if (currentArrayIndex + 1 == newSortedCollSize
						|| currentArrayIndex + 2 == newSortedCollSize) {
					pageComplete = true;
					final String curArrayIndexRec = String
							.valueOf(currentArrayIndex + 1);
					beforeColl.put(FwConstants.CURRENT_RECORD_INDEX,
							curArrayIndexRec);
				}
			}
			// if the driver status is addnew and driver status is complete
			if (currentPageStatus == FwConstants.DRIVER_ADD_NEW
					|| currentPageStatus == FwConstants.DRIVER_COMPLETE) {
				pageComplete = true;
			} else {
				// think about this
				session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			}

			final ABHouseHoldRelationshipBO houseHoldRelationship = new ABHouseHoldRelationshipBO();
			final APP_HSHL_RLT_Collection houseHoldColl = houseHoldRelationship
					.runCareTakerCheck(peopleHandler.getAllIndividuals(),
							peopleHandler, appNumber);

			if (!(houseHoldColl != null && !houseHoldColl.isEmpty())) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHPG", driverArray, appNumber);
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in
			 * this block
			 */

			// this is page complete flag
			pageCollection.put("PageCompleteFlag", new Boolean(pageComplete));
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoRelationshipDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoRelationshipDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoRelationshipDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoRelationshipDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoRelationshipDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load disability gatepost.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadDisabilityGatepost(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadDisabilityGatepost() - START");
		try {
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			final Map request = txnBean.getRequest();
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
					.getInHomeIndividuals();

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final Map httpSessMap = (Map) session.get(FwConstants.HTTP_SESSION);
			final String language = (String) httpSessMap
					.get(FwConstants.LANGUAGE);

			final RMCRequestManager rmcRequestManager = new RMCRequestManager();

			final INDIVIDUAL_Custom_Collection indvSortedCustColl = null;

			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			RMC_RQST_Collection rmcPageColl = (RMC_RQST_Collection) session
					.get("RMC_RQST_COLLECTION");

			if (rmcPageColl == null) {
				rmcPageColl = new RMC_RQST_Collection();
				rmcPageColl.add(rmcRequestManager.loadRMCRequest(appNum));
			}
			final RMC_RQST_Cargo rmcCargo = rmcPageColl.getCargo(0);

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);

			final ARDisabilityBO dablBO = new ARDisabilityBO();
			final APP_IN_DABL_Collection dablColl = dablBO.listViewData(appNum);

			SortedSet selectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			boolean loadCatSelProfile = false;

			if ((selectionProfile == null || selectionProfile.isEmpty())
					&& driverStatus != FwConstants.DRIVER_NOT_REQUIRED) {
				loadCatSelProfile = true;

			} else if (selectionProfile != null && !selectionProfile.isEmpty()) {

				CategorySequenceDetail catSeqDetail = categorySelectionProfileManager
						.getCurrentSequenceDetail(selectionProfile);
				if (catSeqDetail == null) {
					catSeqDetail = categorySelectionProfileManager
							.getNextSequenceDetail(selectionProfile);
					if (catSeqDetail != null
							&& AppConstants.RMC_CAT_DABL_PRFL
							.equals(catSeqDetail
									.getChangeSelectionCategoryCd())) {
						loadCatSelProfile = false;
					} else {
						loadCatSelProfile = true;
					}
				}
			}

			if (loadCatSelProfile) {
				final String categoryCodes = "'"
						+ AppConstants.RMC_CAT_DABL_PRFL + "'";

				selectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfileByCategoryCds(
								appNum, categoryCodes);
				session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
						selectionProfile);
			}

			final List dablList = new ArrayList();
			dablList.add(dablColl);
			dablList.add(indvColl);
			dablList.add(rmcInPrflColl);
			dablList.add(rmcCargo);
			dablList.add(selectionProfile);
			dablList.add(driverStatus);

			final RMCDisabilityListView rmcDisabilitySelectionListView = new RMCDisabilityListView();

			rmcDisabilitySelectionListView.setLanguage(language);
			rmcDisabilitySelectionListView.setName("DISABILITY");
			rmcDisabilitySelectionListView.setCollection(indvSortedCustColl);
			rmcDisabilitySelectionListView.setDisplayData(dablList);
			rmcDisabilitySelectionListView.setPageSize(1000);
			pageCollection.put("DISABILITY", rmcDisabilitySelectionListView);
			pageCollection.put("DISABILITY_COLL", dablColl);

			final Map newDablMap = new HashMap();
			pageCollection.put("NEW_DABL_MAP", newDablMap);
			pageCollection.put("RMC_RQST_Collection", rmcPageColl);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
			txnBean.setPageCollection(pageCollection);
			txnBean.setSession(session);
		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadDisabilityGatepost");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadDisabilityGatepost");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadDisabilityGatepost", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadDisabilityGatepost");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadDisabilityGatepost() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store disability gatepost.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeDisabilityGatepost(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeDisabilityGatepost() - START");
		try {

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			request.get(FwConstants.CURRENT_PAGE_ID);
			final RMCRequestManager rmcRequestManager = new RMCRequestManager();

			final RMC_RESPONSE_Custom_Collection beforeRespColl = (RMC_RESPONSE_Custom_Collection) pageCollection
					.get("RMC_RESPONSE_Custom_Collection");
			RMC_RESPONSE_Custom_Collection respColl = new RMC_RESPONSE_Custom_Collection();
			for (int i = 0; i < beforeRespColl.size(); i++) {
				RMC_RESPONSE_Custom_Cargo rmcCustomCargo = null;
				rmcCustomCargo = beforeRespColl.getCargo(i);
				if (!FwConstants.NO.equalsIgnoreCase(rmcCustomCargo
						.getResponse())) {
					respColl.add(rmcCustomCargo);
				}

			}
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);

			final ARDisabilityBO disabilityBO = new ARDisabilityBO();
			respColl = disabilityBO.formatAssetResponse(respColl);

			RMC_RQST_Collection rmcRqstPageColl = (RMC_RQST_Collection) pageCollection
					.get("RMC_RQST_Collection");

			if (rmcRqstPageColl == null) {
				rmcRqstPageColl = new RMC_RQST_Collection();
				rmcRqstPageColl.add(rmcRequestManager.loadRMCRequest(appNum));
			}

			final RMC_RQST_Cargo rmcRqstCargo = rmcRqstPageColl.getCargo(0);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
					.getInHomeIndividuals();
			final int indvSize = indvColl.size();
			final Map indvNameMap = new HashMap();
			for (int i = 0; i < indvSize; i++) {
				final INDIVIDUAL_Custom_Cargo indvCargo = (INDIVIDUAL_Custom_Cargo) indvColl
						.get(i);
				indvNameMap.put(indvCargo.getIndv_seq_num(),
						indvCargo.getFst_nam());
			}

			final Map dablValidationMap = new HashMap();
			dablValidationMap.put("DABL", beforeColl.get("DISABILITY_COLL"));
			dablValidationMap.put("RMC_RQST_Cargo", rmcRqstCargo);

			final short[] responseArray = new short[] { IRMCResponseProfileManager.DISABLE };

			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			RMC_IN_PRFL_Collection rmcInPrflSessColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			RMC_RESPONSE_Custom_Cargo rmcCustomCargo = null;
			int size = respColl.size();
			RMC_IN_PRFL_Collection rmcPrflPageColl = (RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection");
			RMC_IN_PRFL_Cargo rmcPrflSessCargo = null;
			RMC_IN_PRFL_Cargo rmcPrflPageCargo = null;
			String seqNum = null;
			String catType = null;
			String indvSeqNum = null;
			boolean dablChangeSelected = false;

			boolean dablAddSelected = false;

			if (respColl != null && !respColl.isEmpty()) {
				for (int i = 0; i < respColl.size(); i++) {
					final RMC_RESPONSE_Custom_Cargo cargo = respColl
							.getCargo(i);
					if (cargo != null && cargo.getCategoryType() != null) {
						log(ILog.INFO,
								"category type.." + cargo.getCategoryType());

						final Map dablMap = disabilityBO.getDisability();

						dablMap.put(AppConstants.RMC_CAT_DABL_PRFL,
								AppConstants.RMC_CAT_DABL_PRFL);

						if (dablMap.containsKey(cargo.getCategoryType())) {
							if (!"2".equals(cargo.getUserEndSelectionInd())) {
								dablChangeSelected = true;
							}

						}
					}
				}
			}

			for (int i = 0; i < size; i++) {

				rmcCustomCargo = respColl.getCargo(i);
				seqNum = rmcCustomCargo.getSeqNum();
				catType = rmcCustomCargo.getCategoryType();

				indvSeqNum = rmcCustomCargo.getIndvSeqNum();
				rmcCustomCargo.getResponse();
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1/2 (part of a line)
				 * lines Commented Code in this block
				 */
				if (AppConstants.RMC_ADD_NEW_IND.equals(seqNum)) {
					if (rmcPrflPageColl != null) {
						rmcPrflPageCargo = rmcResponseProfileManager
								.getProfile(rmcPrflPageColl, indvSeqNum);
					} else {
						rmcPrflPageColl = new RMC_IN_PRFL_Collection();
					}
					if (rmcPrflPageCargo == null) {
						rmcPrflPageCargo = new RMC_IN_PRFL_Cargo();
						rmcPrflPageCargo.setApp_num(appNum);
						rmcPrflPageCargo.setIndv_seq_num(indvSeqNum);
						rmcPrflPageColl.addCargo(rmcPrflPageCargo);
					}
					if (rmcInPrflSessColl != null) {
						rmcPrflSessCargo = rmcResponseProfileManager
								.getProfile(rmcInPrflSessColl, indvSeqNum);
					} else {
						rmcInPrflSessColl = new RMC_IN_PRFL_Collection();
					}
					if (rmcPrflSessCargo == null) {
						rmcPrflSessCargo = new RMC_IN_PRFL_Cargo();
						rmcPrflSessCargo.setApp_num(appNum);
						rmcPrflSessCargo.setIndv_seq_num(indvSeqNum);
						rmcResponseProfileManager
						.createRMCIndividualProfile(rmcPrflSessCargo);
						rmcInPrflSessColl.addCargo(rmcPrflSessCargo);
					}

					if (AppConstants.RMC_CAT_DABL_PRFL.equals(catType)) {
						rmcPrflPageCargo.setDabl_resp(FwConstants.YES);
						dablAddSelected = true;
					}

					respColl.remove(i);
					size--;
					i--;
				}
			}

			session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflSessColl);
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			final Map httpSessionMap = (Map) session
					.get(FwConstants.HTTP_SESSION);
			httpSessionMap.get(AppConstants.LANGUAGE);

			final String reqWarningMsgs = (String) request
					.get(FwConstants.WARNING_MSG_DETAILS);
			List<String> warningsShown = new ArrayList();
			if (session.get(FwConstants.WARNING_MSG_DETAILS) != null) {
				warningsShown = (ArrayList) session
						.get(FwConstants.WARNING_MSG_DETAILS);
			}
			if (!warningsShown.contains(reqWarningMsgs)) {
				warningsShown.add(reqWarningMsgs);
				session.put(FwConstants.WARNING_MSG_DETAILS, warningsShown);
			}
			FwMessageList msgList = null;

			if (backToMyAccess == null) {
				disabilityBO.validateDisabilityChangeSelection(respColl,
						dablValidationMap, indvNameMap, warningsShown);
			}
			session.put(FwConstants.WARNING_MSG_DETAILS, warningsShown);
			if (disabilityBO.hasMessages()) {
				msgList = disabilityBO.getMessageList();

			}
			final boolean isWarningMessageShown = false;

			if (checkBackToMyAccessSelected(request) || msgList != null
					&& !isWarningMessageShown) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST, msgList);
				}

				if (rmcPrflPageColl != null) {
					rmcResponseProfileManager
					.translateProfileResponseAfterValidation(
							rmcPrflPageColl, rmcInPrflSessColl,
							responseArray);
				}
				if (respColl != null && !respColl.isEmpty()) {
					categorySelectionProfile = categorySelectionProfileManager
							.buildSelectionProfileAfterValidation(
									categorySelectionProfile, respColl);
				}

				final RMCDisabilityListView rmcDisabilitySelectionListView = (RMCDisabilityListView) beforeColl
						.get("DISABILITY");

				final APP_IN_DABL_Collection disabilityColl = (APP_IN_DABL_Collection) beforeColl
						.get("DISABILITY_COLL");

				final List dablDataList = new ArrayList();
				dablDataList.add(disabilityColl);
				dablDataList.add(indvColl);
				dablDataList.add(rmcPrflPageColl);
				dablDataList.add(rmcRqstCargo);
				dablDataList.add(categorySelectionProfile);
				dablDataList.add(driverStatus);

				rmcDisabilitySelectionListView.setDisplayData(dablDataList);
				pageCollection
				.put("DISABILITY", rmcDisabilitySelectionListView);
				pageCollection.put("DISABILITY_COLL", disabilityColl);
				pageCollection.put("RMC_RQST_Collection", rmcRqstPageColl);

				return;
			}
			if (session.containsKey(FwConstants.WARNING_MSG_DETAILS)) {
				session.remove(FwConstants.WARNING_MSG_DETAILS);
			}

			boolean disabilityTypeSelRequired = false;

			if (rmcInPrflSessColl != null) {
				if (rmcPrflPageColl == null) {
					rmcPrflPageColl = new RMC_IN_PRFL_Collection();
				}

				rmcResponseProfileManager.preparePageColl(rmcPrflPageColl,
						rmcInPrflSessColl, responseArray);

				final int rmcInPrflSessCollectionSize = rmcInPrflSessColl
						.size();
				final int rmcInPrflPageCollectionSize = rmcPrflPageColl.size();
				RMC_IN_PRFL_Cargo rmcInPrflPageCargo = null;
				String[] translatedProfileArray = null;
				String indivSeqNum = null;

				final int[] disabilityDetailDirtyIndicator = { IRMCResponseProfileManager.NOT_DIRTY };

				final Map indvResponseMap = new HashMap();
				final boolean[] dirtyIndicatorArray = new boolean[rmcResponseProfileManager
				                                                  .getMaxIndvSeqNumber(rmcInPrflSessColl) + 1];
				char status = IRMCResponseProfileManager.STATUS_NOT_REQUIRED;

				for (int s = 0; s < rmcInPrflSessCollectionSize; s++) {

					final RMC_IN_PRFL_Cargo rmcInPrflSessCargo = rmcInPrflSessColl
							.getCargo(s);

					for (int p = 0; p < rmcInPrflPageCollectionSize; p++) {
						rmcInPrflPageCargo = rmcPrflPageColl.getCargo(p);

						if (rmcInPrflPageCargo.getIndv_seq_num().equals(
								rmcInPrflSessCargo.getIndv_seq_num())) {
							translatedProfileArray = new String[responseArray.length];
							indivSeqNum = rmcInPrflPageCargo.getIndv_seq_num();

							if (rmcResponseProfileManager.determineDirtyStatus(
									rmcInPrflPageCargo.getDabl_resp(),
									rmcInPrflSessCargo.getDabl_resp(),
									disabilityDetailDirtyIndicator,
									driverStatus)) {
								if (!dirtyIndicatorArray[0]) {
									dirtyIndicatorArray[0] = true;
								}
								dirtyIndicatorArray[Integer
								                    .parseInt(indivSeqNum)] = true;
							}
							// Translating Profile Response
							if (!rmcInPrflSessCargo
									.getDabl_resp()
									.equalsIgnoreCase(
											String.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))) {
								rmcResponseProfileManager
								.translateProfileResponses(
										rmcInPrflPageCargo
										.getDabl_resp(),
										rmcInPrflSessCargo
										.getDabl_resp(),
										driverStatus,
										IRMCResponseProfileManager.DISABLE,
										rmcInPrflSessCargo);
							}
							// Setting Response Value in array
							translatedProfileArray[0] = rmcInPrflSessCargo
									.getDabl_resp();
							status = (null != rmcInPrflSessCargo.getDabl_resp()) ? (rmcInPrflSessCargo
									.getDabl_resp().charAt(0))
									: (IRMCResponseProfileManager.STATUS_NOT_REQUIRED);
							// Scheduling Details Page
							if (status == IRMCResponseProfileManager.STATUS_ADD_NEW
									|| status == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
									|| status == IRMCResponseProfileManager.STATUS_REQUIRED) {
								disabilityTypeSelRequired = true;
								driverManager.makeRequired(
										FwConstants.RMC_DRIVER, "ARHDD",
										driverArray, appNum);
							}
							// Getting Vehicle Details page status flag value
							if (!disabilityTypeSelRequired) {
								disabilityTypeSelRequired = isDisabilityPageRequired(rmcInPrflSessCargo);
							}
							// Getting driver status of vehicle details page
							// from driver array and scheduling page
							if (!IDriver.DRIVER_STATUS_COMPLETE
									.equals(driverManager.getStatus(
											FwConstants.RMC_DRIVER, "ARHDD",
											driverArray))) {
								driverManager.makeAbsoluteNotRequired(
										FwConstants.RMC_DRIVER, "ARHDD",
										driverArray, appNum);
							} else {
								driverManager.makeComplete(
										FwConstants.RMC_DRIVER, "ARHDD",
										driverArray, appNum);
							}

							indvResponseMap.put(indivSeqNum,
									translatedProfileArray);
							break;
						}
					}
				}
				// Persistence logic start
				if (dirtyIndicatorArray[0]) {
					String indvSeqNumber = null;
					for (int i = 0; i < rmcInPrflPageCollectionSize; i++) {
						indvSeqNumber = rmcPrflPageColl.getCargo(i)
								.getIndv_seq_num();
						// Changed indvSeqNum to indvSeqNumber
						if (dirtyIndicatorArray[Integer.parseInt(indvSeqNumber)]) {
							rmcResponseProfileManager.persist(appNum,
									indvSeqNumber, responseArray,
									(String[]) indvResponseMap
									.get(indvSeqNumber));
						}
					}
				}
			}

			if (categorySelectionProfile == null
					|| categorySelectionProfile.isEmpty()) {
				// This method will build profile for all the 6 assets types
				categorySelectionProfile = categorySelectionProfileManager
						.buildSelectionProfile(respColl, appNum);
			} else {

				categorySelectionProfileManager.rebuildSelectionProfileByCds(
						categorySelectionProfile, respColl, appNum,
						AppConstants.RMC_CAT_DABL_PRFL);
			}

			if (disabilityTypeSelRequired || dablAddSelected) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHDD",
						driverArray, appNum);
			} else {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHDD", driverArray, appNum);
			}

			String dablDetailPageStat = null;
			final Map dablCatTypes = disabilityBO.getDisability();
			if (disabilityTypeSelRequired
					|| disabilityBO.checkDisablePageRequired(
							categorySelectionProfile, dablCatTypes,
							AppConstants.RMC_CAT_DABL_PRFL)) {
				if (disabilityTypeSelRequired
						|| !categorySelectionProfileManager
						.areAllSequencesComplete(
								categorySelectionProfile, dablCatTypes)
								&& dablChangeSelected) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHDD",
							driverArray, appNum);
				} else {
					driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARHDD",
							driverArray, appNum);
				}
			} else {
				dablDetailPageStat = driverManager.getStatus(
						FwConstants.RMC_DRIVER, "ARHDD", driverArray);
				if (!IDriver.DRIVER_STATUS_COMPLETE.equals(dablDetailPageStat)
						&& !disabilityBO.checkDisabilityDataExistance(appNum)) {
					driverManager.makeNotRequired(FwConstants.RMC_DRIVER,
							"ARHDD", driverArray, appNum);
				} else {
					driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARHDD",
							driverArray, appNum);
				}
			}

			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARDGP",
					driverArray, appNum);
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
			session.put(FwConstants.BEFORE_COLLECTION,
					txnBean.getPageCollection());
			session.put(FwConstants.RMC_DRIVER, driverArray);
			pageCollection.put("RMC_RQST_Collection", rmcRqstPageColl);
			txnBean.setSession(session);

		} catch (final FwException fe) {
			log(ILog.ERROR, fe.getMessage());
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeDisabilityGatepost");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeDisabilityGatepost");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeDisabilityGatepost", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeDisabilityGatepost");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeDisabilityGatepost() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Checks if is disability page required.
	 *
	 * @param rmcInPrflSessCargo the rmc in prfl sess cargo
	 * @return true, if is disability page required
	 */
	private boolean isDisabilityPageRequired(
			final RMC_IN_PRFL_Cargo rmcInPrflSessCargo) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.isDisabilityPageRequired() - START");
		boolean isRequired = false;
		char status = IRMCResponseProfileManager.STATUS_NOT_REQUIRED;
		status = rmcInPrflSessCargo.getDabl_resp().charAt(0);
		if (status == IRMCResponseProfileManager.STATUS_ADD_NEW
				|| status == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
				|| status == IRMCResponseProfileManager.STATUS_REQUIRED) {
			isRequired = true;
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.isDisabilityPageRequired() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
		return isRequired;
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoDisabilityDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoDisabilityDetails() - START");

		try {
			log(ILog.INFO,
					"RMCLiquidAndOtherAssetsEJBBean::loadHouseHoldInfoDisabilityDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			String srcAppInd = FwConstants.EMPTY_STRING;
			String pageMode = null;
			APP_IN_DABL_Collection rmcInDisColl;
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			request.put("loopingQuestion", FwConstants.NO);

			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			ReferenceTableManager.getInstance();
			final String codeValues = AppConstants.DISABLED_BLIND;
			final Map disabilityTypeMap = new HashMap();
			disabilityTypeMap.put(codeValues, codeValues);

			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			String appType = FwConstants.EMPTY_STRING;
			appType = (String) session.get(FwConstants.ACCESS_APPLICATION_TYPE);
			String categoryCode = AppConstants.RMC_CAT_DABL_PRFL;

			if (null != appType
					&& appType.equalsIgnoreCase(String
							.valueOf(FwConstants.RMB_APP_TYPE))) {
				categoryCode = AppConstants.RMC_CAT_HH_SUMMARY_PRFL;
			}

			if (pageStatus == FwConstants.DRIVER_REQUIRED
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, disabilityTypeMap)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								categoryCode);
			} else if (pageStatus == FwConstants.DRIVER_COMPLETE
					&& !pageId.equals(previousPageId)
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, disabilityTypeMap)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								categoryCode);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			final ARDisabilityBO abDablBO = new ARDisabilityBO();
			final short[] responseNewType = new short[] { IRMCResponseProfileManager.DISABLE };

			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			String addnewPerson = FwConstants.EMPTY_STRING;
			SortedSet dablProfile = null;
			if (!pageId.equals(previousPageId)) {
				session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
				dablProfile = createPageProfile(categorySelectionProfile,
						rmcInPrflColl, responseNewType);
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code
				 * in this block
				 */

				if (pageStatus != FwConstants.DRIVER_REQUIRED) {
					APP_IN_DABL_Collection newDisabilityColl = abDablBO
							.loadDisableDetails(appNumber);
					newDisabilityColl = abDablBO.splitDisColl(
							newDisabilityColl, AppConstants.RMC_NEW_RECORD_IND);
					if (newDisabilityColl != null
							&& !newDisabilityColl.isEmpty()) {
						APP_IN_DABL_Cargo rmcInDisabilityCargo = null;
						final int newUtilityCollSize = newDisabilityColl.size();
						for (int i = 0; i < newUtilityCollSize; i++) {
							rmcInDisabilityCargo = newDisabilityColl
									.getCargo(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									dablProfile,
									null,
									null,
									Short.parseShort(rmcInDisabilityCargo
											.getIndv_seq_num()),
											Short.parseShort(rmcInDisabilityCargo
													.getSeq_num()), codeValues);
						}
					}
				}

				if (pageStatus == FwConstants.DRIVER_REQUIRED
						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(dablProfile);
				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE) {
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(dablProfile);
				}

				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				dablProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			if (beforeColl != null) {
				if (beforeColl.get(AppConstants.INDV_SEQUENCE_NUMBERS) != null) {
					Integer.parseInt(String.valueOf(beforeColl
							.get(AppConstants.INDV_SEQUENCE_NUMBERS)));
				}
				if (beforeColl.get("RMB_ADD_INDIVIDUAL_MODE") != null) {
					addnewPerson = (String) beforeColl
							.get("RMB_ADD_INDIVIDUAL_MODE");
				}

			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);

			if (indivSeqBean == null
					&& pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("Dabl_IndSeqBean");
			}

			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								dablProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					String userEndIndicator = indivSeqBean.getUserEndInd();
					if (userEndIndicator == null) {
						userEndIndicator = FwConstants.ZERO;
					}
					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(userEndIndicator)) {
						categorySelectionProfileManager
						.updateUserEndSelInd(dablProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							dablProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != Short
								.parseShort(userEndIndicator)) {
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType(),
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());

					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
						if (rmcInPrflColl != null) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl,
											indivSeqBean.getIndivSeqNum());
						} else {
							rmcInPrflColl = new RMC_IN_PRFL_Collection();
						}
						if (rmcInPrflCargo == null) {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setApp_num(appNumber);
							rmcInPrflCargo.setIndv_seq_num(indivSeqBean
									.getIndivSeqNum());
							rmcResponseProfileManager
							.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflColl.addCargo(rmcInPrflCargo);
						}

						final short[] responseArray = new short[] {
								IRMCResponseProfileManager.DISABLE,
								rmcResponseProfileManager.getResponseByType(
										IRMCResponseProfileManager.DISABLE,
										indivSeqBean.getType()) };
						rmcResponseProfileManager.makeAddNew(responseArray,
								rmcInPrflCargo, true);
						categorySelectionProfileManager
						.insertSequenceDetail(dablProfile, null, null,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
						categorySelectionProfileManager.getNextSequenceDetail(dablProfile);
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertSequenceDetail(dablProfile, null,
								categoryCode, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(dablProfile, null,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());

						categorySelectionProfileManager
						.insertSequenceDetail(categorySelectionProfile,
								appNumber, categoryCode, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put("Disability_IndSeqBean", indivSeqBean);
				session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
						categorySelectionProfile);
			}

			pageCollection
			.put(AppConstants.RMC_CATEGORY_PAGE_PRFL, dablProfile);
			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(dablProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(dablProfile);
			}

			final String categoryType = categorySeqDetail.getCategoryType();
			final String categorySeqNum = Long.toString(categorySeqDetail
					.getCategorySequence());
			final String indvSeqNum = Short.toString(categorySeqDetail
					.getIndividualSequence());
			rmcInDisColl = abDablBO.loadIndividualDisabilityDetails(appNumber,
					indvSeqNum, categorySeqNum);
			pageCollection.put("APP_IN_DABL_Collection", rmcInDisColl);

			APP_IN_DABL_Cargo cwwUtilityCargo = abDablBO.splitDisabilityColl(
					rmcInDisColl, AppConstants.CWW_RECORD_IND);
			if (cwwUtilityCargo == null) {
				cwwUtilityCargo = new APP_IN_DABL_Cargo();
			}
			pageCollection.put("SEC_DISABILITY",
					abDablBO.settingDablDefaultValues(cwwUtilityCargo));
			APP_IN_DABL_Cargo rmcUtilityCargo = abDablBO.splitDisabilityColl(
					rmcInDisColl, AppConstants.RMC_MODIFIED_RECORD_IND);
			if (rmcUtilityCargo != null) {
				pageCollection.put("FST_DISABILITY",
						abDablBO.settingDablDefaultValues(rmcUtilityCargo));
			} else {
				rmcUtilityCargo = abDablBO.splitDisabilityColl(rmcInDisColl,
						AppConstants.RMC_END_RECORD_IND);
				if (rmcUtilityCargo != null) {
					pageCollection.put("FST_DISABILITY",
							abDablBO.settingDablDefaultValues(rmcUtilityCargo));
				} else {
					rmcUtilityCargo = abDablBO.splitDisabilityColl(
							rmcInDisColl, AppConstants.RMC_NEW_RECORD_IND);
					if (rmcUtilityCargo != null) {
						pageCollection.put("FST_DISABILITY", abDablBO
								.settingDablDefaultValues(rmcUtilityCargo));
					} else {
						pageCollection.put("FST_DISABILITY", abDablBO
								.settingDablDefaultValues(cwwUtilityCargo));

					}

				}
			}

			if (rmcInDisColl != null && !rmcInDisColl.isEmpty()) {
				final APP_IN_DABL_Cargo appInDisCargo = rmcInDisColl
						.getCargo(0);
				srcAppInd = appInDisCargo.getSrc_app_ind();
			}
			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}

			if (categorySeqDetail.getUserEndSelectionInd() == 1) {
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd())) {
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equalsIgnoreCase(pageMode) || "E"
					.equalsIgnoreCase(pageMode))) {
				pageMode = FwConstants.NO;
			}
			pageCollection.put("PAGE_MODE", pageMode);
			pageCollection.put("DISABILITY_TYPE", categoryType);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNum));
			txnBean.setPageCollection(pageCollection);

			INDIVIDUAL_Custom_Collection indivCustCol = null;
			indivCustCol = peopleHandler.getInHomeIndividuals();
			for (int i = 0; i < indivCustCol.size(); i++) {
				if (Short.parseShort(indivCustCol.getResult(i)
						.getIndv_seq_num()) == categorySeqDetail
						.getIndividualSequence()) {
					indivCustCol.remove(i);
					break;
				}
			}
			pageCollection.put("PEOPLE_5064", indivCustCol);

			final APP_IN_DABL_Collection dablColl = (APP_IN_DABL_Collection) pageCollection
					.get("APP_IN_DABL_Collection");
			String showLoopingQuestionFlag = FwConstants.YES;
			final char typeStatus = categorySeqDetail.getStatus();
			if (typeStatus == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
					|| typeStatus == IRMCResponseProfileManager.STATUS_COMPLETE) {
				showLoopingQuestionFlag = FwConstants.NO;

			}
			pageCollection.put("showLoopingQuestion", showLoopingQuestionFlag);

			if (dablColl != null && !dablColl.isEmpty()) {
				final APP_IN_DABL_Cargo dablCargo = dablColl.getCargo(0);
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						dablCargo.getIndv_seq_num());
			}

			pageCollection.put("RMB_ADD_INDIVIDUAL_MODE", addnewPerson);

			request.remove("loopingQuestion");
			if (session.get(FwConstants.BEFORE_COLLECTION) != null) {

				if (((Map) session.get(FwConstants.BEFORE_COLLECTION))
						.containsKey("FST_JNT")) {
					((Map) session.get(FwConstants.BEFORE_COLLECTION))
					.remove("FST_JNT");
				}

				((Map) session.get(FwConstants.BEFORE_COLLECTION))
				.putAll(pageCollection);
			} else {
				final Map beforeJntOwnerColl = new HashMap();
				beforeJntOwnerColl.putAll(pageCollection);
				session.put(FwConstants.BEFORE_COLLECTION, beforeJntOwnerColl);
			}
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoDisabilityDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoDisabilityDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoDisabilityDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoDisabilityDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoDisabilityDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoDisabilityDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoDisabilityDetails() - START");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		APP_IN_DABL_Collection beforeAppInDablCollection = null;
		APP_IN_DABL_Collection appInDablCollection = null;
		final APP_IN_DABL_Cargo beforeAppInDablCargo = null;
		APP_IN_DABL_Cargo beforeDablCargo = null;
		try {
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);


			// build category selection profile

			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			final SortedSet disabilityProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			if (beforeColl.containsKey("APP_IN_DABL_Collection")) {
				beforeAppInDablCollection = (APP_IN_DABL_Collection) beforeColl
						.get("APP_IN_DABL_Collection");
			}
			if (pageCollection.containsKey("APP_IN_DABL_Collection")) {
				appInDablCollection = (APP_IN_DABL_Collection) pageCollection
						.get("APP_IN_DABL_Collection");
			}

			APP_IN_DABL_Cargo appInDablCargo = appInDablCollection.getCargo(0);
			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(disabilityProfile);
			// TO BE ADDED- FOR SOURCE APP IND

			categorySeqDetailBean.getCategorySequence();
			categorySeqDetailBean.getCategoryType();
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			// EDSP TEMP

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);

			beforeColl.get(AppConstants.FIRST_NAME);

			final DisabilityBO disabilityBO = new DisabilityBO();
			final ARHDDValidator arhddValidator = new ARHDDValidator();
			final String pageMode = (String) beforeColl.get("PAGE_MODE");

			if (!appInDablCollection.isEmpty()) {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 4,1 lines Commented
				 * Code in this block
				 */
				// Now calling the validate method

				appInDablCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
				final short[] programKey = (short[]) session
						.get(FwConstants.RMC_PROGRAM_KEY);
				final String backToMyAccess = (String) request
						.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
				if (backToMyAccess == null) {
					if ("E".equals(pageMode)) {
						arhddValidator.validateEndScreen(appInDablCargo);
					} else {
						arhddValidator.validateDisablityDetail(appInDablCargo,
								peopleHandler, programKey, request, beforeColl);
					}

				}
				if (checkBackToMyAccessSelected(request)
						|| arhddValidator.hasMessages()) {
					if (backToMyAccess == null) {
						request.put(FwConstants.MESSAGE_LIST,
								arhddValidator.getMessageList());
					}

					pageCollection.put("APP_IN_DABL_Collection",
							appInDablCollection);

					pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
							String.valueOf(indvSeqNum));
					pageCollection.put("PAGE_MODE", pageMode);
					pageCollection.put("FST_DISABILITY", appInDablCargo);

					pageCollection.put(AppConstants.FIRST_NAME,
							beforeColl.get(AppConstants.FIRST_NAME));
					pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
							beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
					componentManager.getComponents(currentPageID, txnBean);
					return;
				}
			}

			boolean disabilityDetailsUpdate = false;
			String recordInd = null;
			String sourceAppIndicator = null;

			if (beforeAppInDablCollection != null
					&& !beforeAppInDablCollection.isEmpty()) {
				final int size = beforeAppInDablCollection.size();

				if ("C".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
				} else if ("E".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
				} else {
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				}

				beforeDablCargo = disabilityBO.splitDablColl(
						beforeAppInDablCollection, sourceAppIndicator);

				if (beforeDablCargo == null
						&& (AppConstants.RMC_MODIFIED_RECORD_IND
								.equals(sourceAppIndicator) || AppConstants.RMC_END_RECORD_IND
								.equals(sourceAppIndicator))) {
					beforeDablCargo = disabilityBO.splitDablColl(
							beforeAppInDablCollection,
							AppConstants.CWW_RECORD_IND);
				}

				if (size > 1) {
					// if we have two records means cw and rm or cw and re
					// now we are getting RM/RE record to compare
					// now we need to update the data base if it dirty
					recordInd = FwConstants.ROWACTION_UPDATE;
				} else {
					// now we are checking this record is CW or RN
					recordInd = FwConstants.ROWACTION_INSERT;
					if (AppConstants.RMC_NEW_RECORD_IND
							.equals(sourceAppIndicator)
							&& beforeDablCargo != null) {
						recordInd = FwConstants.ROWACTION_UPDATE;
					} else if (AppConstants.RMC_END_RECORD_IND
							.equals(sourceAppIndicator)
							&& beforeDablCargo != null && !beforeDablCargo.getSrc_app_ind().equals(AppConstants.CWW_RECORD_IND)) {
						recordInd = FwConstants.ROWACTION_UPDATE;
					}
				}

				if (beforeDablCargo != null) {

					appInDablCargo.setApp_num(appNumber);
					appInDablCargo.setSrc_app_ind(beforeDablCargo
							.getSrc_app_ind());
					appInDablCargo.setIndv_seq_num(beforeDablCargo
							.getIndv_seq_num());
					appInDablCargo.setEcp_id(beforeDablCargo.getEcp_id());
					appInDablCargo.setSeq_num(beforeDablCargo.getSeq_num());
					if (beforeDablCargo.getNoLongerCaringForDisabled() != null) {
						appInDablCargo
						.setNoLongerCaringForDisabled(beforeDablCargo
								.getNoLongerCaringForDisabled());
					} else {
						appInDablCargo
						.setNoLongerCaringForDisabled(AppConstants.PROGRAM_NOT_SELECTED);
					}

					if (beforeDablCargo.getIrwe_sw() != null
							&& beforeDablCargo.getIrwe_sw().trim().length() > 0) {
						appInDablCargo.setIrwe_sw(beforeDablCargo.getIrwe_sw());
					} else {
						appInDablCargo.setIrwe_sw(FwConstants.SPACE);
					}

				} else {
					final APP_IN_DABL_Cargo beforeCargo = beforeAppInDablCollection
							.getCargo(0);
					appInDablCargo.setEcp_id(beforeCargo.getEcp_id());
				}

				if ("E".equalsIgnoreCase(pageMode)) {

					if (appInDablCargo.getDabl_end_dt() != null
							&& appInDablCargo.getDabl_end_dt().trim().length() != 0
							&& appInDablCargo.getDabl_end_dt().length() == 10
							&& appInDablCargo.getDabl_end_dt().charAt(2) == '/'

							) {
						final StringBuilder dateConverter = new StringBuilder();
						final String sAppDate = appInDablCargo.getDabl_end_dt();
						dateConverter.append(sAppDate.substring(6, 10))
						.append("-").append(sAppDate.substring(0, 2))
						.append("-").append(sAppDate.substring(3, 5));
						appInDablCargo.setDabl_end_dt(dateConverter.toString());
					}
					if (beforeDablCargo.getDabl_end_dt() != null
							&& appInDablCargo.getDabl_end_dt() == null) {
						appInDablCargo.setDabl_end_dt(displayFormatter
								.getYYYYMMDDDate(beforeDablCargo
										.getDabl_end_dt()));
					} else if (beforeDablCargo.getDabl_end_dt() == null
							&& appInDablCargo.getDabl_end_dt() == null) {
						appInDablCargo.setDabl_end_dt(AppConstants.HIGH_DATE);
					}

					if (beforeDablCargo.getDabl_type_cd() != null) {
						appInDablCargo.setDabl_type_cd(beforeDablCargo
								.getDabl_type_cd());
					}
				}

				appInDablCargo = (APP_IN_DABL_Cargo) isChanged(
						beforeAppInDablCargo, appInDablCargo);

				if (appInDablCargo.isDirty()) {
					appInDablCargo.setSrc_app_ind(sourceAppIndicator);
					appInDablCargo.setRowAction(recordInd);
					appInDablCargo.setRec_cplt_ind(FwConstants.ONE);
					disabilityDetailsUpdate = true;
				}

			} else {
				if ("C".equalsIgnoreCase(pageMode)) {
					appInDablCargo.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
				} else if ("E".equalsIgnoreCase(pageMode)) {
					appInDablCargo.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
				} else {
					appInDablCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				}
				appInDablCargo
				.setIndv_seq_num(String.valueOf(categorySeqDetailBean
						.getIndividualSequence()));
				appInDablCargo.setApp_num(appNumber);
				int seqNum = disabilityBO.getMaxDisabilitySeqNumber(appNumber,
						String.valueOf(indvSeqNum));
				seqNum = seqNum + 1;
				appInDablCargo.setSeq_num(String.valueOf(seqNum));
				recordInd = FwConstants.ROWACTION_INSERT;
				appInDablCargo.setRowAction(recordInd);
				appInDablCargo = (APP_IN_DABL_Cargo) isChanged(
						beforeAppInDablCargo, appInDablCargo);

				disabilityDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using update Mehod()
				categorySelectionProfileManager.updateSequence(
						disabilityProfile, null,
						categorySeqDetailBean.getIndividualSequence(), seqNum,
						categorySeqDetailBean.getCategoryType());
			}
			if (!"RN".equals(appInDablCargo.getSrc_app_ind())
					&& !"RE".equals(appInDablCargo.getSrc_app_ind())) {
				appInDablCargo.setSrc_app_ind("RM");
			}
			if (disabilityDetailsUpdate) {
				if (FwConstants.ROWACTION_INSERT.equals(appInDablCargo
						.getRowAction())) {
					disabilityBO.insertExistingDetails(appInDablCollection);
				} else {
					disabilityBO.storeDisabilityDetails(appInDablCollection);
				}
			}
			boolean loopingQuestion = false;

			if (request.get("loopingQuestion") != null
					&& FwConstants.YES.equals(request.get("loopingQuestion"))) {
				loopingQuestion = true;

				categorySelectionProfileManager.insertSequenceDetail(
						disabilityProfile, null, null,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategoryType());

				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
				// Make required the RMB Asset Summary page
				session.put(FwConstants.RMC_DRIVER, driverArray);

			}
			// now i need to update the rmc_in_prfl if looping question is null
			// COMM EDSP
			if (!loopingQuestion
					&& categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.DISABLE, rmcInPrflCargo,
							true);
				}
			}
			categorySelectionProfileManager.makeSequenceDetailComplete(
					disabilityProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			if (categorySelectionProfileManager
					.areAllSequencesComplete(disabilityProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				session.put(FwConstants.RMC_DRIVER, driverArray);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(disabilityProfile);
			}

			session.remove("EDIT_DABL_Response");
			session.remove("EDIT_DABL_IndvSeqNum");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoDisabilityDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoDisabilityDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoDisabilityDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoDisabilityDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoDisabilityDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Absent Parent Load Method.
	 *
	 * @author - Numa Canedo
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 * Creation Date Thu Sep 09 14:24:00 EDT 2015
	 */
	public void loadHouseHoldInfoAbsentParentDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoAbsentParentDetails() - START");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		List fatherMotherList = new ArrayList();

		String pageId = null;
		String previousPageId = null;
		String appNumber = null;
		int[] driverArray = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		String indvSeqNumber = null;
		String seqNumber = null;
		String absInd = null;
		int currentRecordIndex = 0;
		final AbsentParentBO absentParentBo = new AbsentParentBO();

		IndivTypeSeqBean detailKeyBean = null;
		SortedSet pageProfile = null;

		ICategorySelectionProfileManager categorySelectionProfileManager = null;

		boolean detailKeyBeanFlag = false;
		boolean pageProfileFlag = false;
		try {
			// ----------------------------------------------------------------------------------------------------
			// Get standard values
			// ----------------------------------------------------------------------------------------------------
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);

			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, pageId,
					driverArray);

			categorySelectionProfileManager = (ICategorySelectionProfileManager) FwServiceFactory
					.getInstance().create(
							ICategorySelectionProfileManager.class);
            final short[] programKey = (short[]) session
                    .get(FwConstants.RMC_PROGRAM_KEY);
            RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
                    .get(AppConstants.RMC_IN_PRFL_MASTER);

			// ----------------------------------------------------------------------------------------------------
			// Page loads for the first time
			// ----------------------------------------------------------------------------------------------------
			if (!pageId.equals(previousPageId)) {
				// Fetch FatherMotherList from session
				if (session.containsKey("FatherMotherList")
						&& !beforeColl.containsKey("FatherMotherList")
						&& !"ARHPG".equals(previousPageId)
						&& !"ARPGQ".equals(previousPageId)
						&& !"ARHRL".equals(previousPageId)) {
					beforeColl.put("FatherMotherList",
							session.get("FatherMotherList")); // Previous Button
				}

				if (pageCollection.containsKey(FwConstants.DETAIL_KEY_BEAN)) {
					// ----------------------------------------------------------------------------------------------------
					// Comming from Summary Page Edit
					// ----------------------------------------------------------------------------------------------------
					
					detailKeyBean = (IndivTypeSeqBean) pageCollection
							.get(FwConstants.DETAIL_KEY_BEAN);				
					detailKeyBeanFlag = true;
					// Validate for null FatherMotherList in before collection
					if (beforeColl.containsKey("FatherMotherList")
							&& null != beforeColl.get("FatherMotherList")) {
						fatherMotherList = (List) beforeColl
								.get("FatherMotherList");
						currentRecordIndex = fatherMotherList.size();
						if(currentRecordIndex!=0)
						currentRecordIndex--;
					} else {
						fatherMotherList = new ArrayList();
						IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
						indivTypeSeqBean.setIndivSeqNum(detailKeyBean.getIndivSeqNum());
						indivTypeSeqBean.setSeqNum(detailKeyBean.getSeqNum());
						indivTypeSeqBean.setType(detailKeyBean.getType());
						fatherMotherList.add(indivTypeSeqBean);
						session.put("summary_abslist", fatherMotherList);
					}
					//For CW records rec_cplt_ind is '0' . We update it to '2' to mark it as Required while editing. 
					absentParentBo.updateCompleteIndicator(appNumber,detailKeyBean.getIndivSeqNum(),detailKeyBean.getSeqNum(),"2");
				} else {
					// ----------------------------------------------------------------------------------------------------
					// Comming from Gate Post Questions Page
					// ----------------------------------------------------------------------------------------------------

					// Clean DETAIL_KEY_BEAN from Page Collection
					pageCollection.remove(FwConstants.DETAIL_KEY_BEAN);

					// Create Page Profile
					pageProfile = categorySelectionProfileManager
							.loadCategoryChangeSelectionProfile(appNumber,
									"HS", "AB");

					final Iterator pageProfileIterator = pageProfile.iterator();

					// Populate fatherMother List with user selection
					while (pageProfileIterator.hasNext()) {
						final CategorySequenceDetail categorySequenceDetail = (CategorySequenceDetail) pageProfileIterator
								.next();

						if (ICategorySelectionProfileManager.STATUS_REQUIRED == categorySequenceDetail
								.getStatus()
								|| ICategorySelectionProfileManager.STATUS_VISIT_AGAIN == categorySequenceDetail
										.getStatus()) {
							final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
							indivTypeSeqBean.setIndivSeqNum(""
									+ categorySequenceDetail
											.getIndividualSequence());
							indivTypeSeqBean.setSeqNum(""
									+ categorySequenceDetail
											.getCategorySequence());

							fatherMotherList.add(indivTypeSeqBean);
							pageProfileFlag = true;
						}
					}
				}

				if (!(detailKeyBeanFlag || pageProfileFlag)) {
					// ----------------------------------------------------------------------------------------------------
					// Comming from Previous Button
					// ----------------------------------------------------------------------------------------------------
					if (beforeColl.containsKey("FatherMotherList")) {
						// Previous
						fatherMotherList = (List) beforeColl
								.get("FatherMotherList");
						currentRecordIndex = fatherMotherList.size();
						if(currentRecordIndex!=0)
						currentRecordIndex--;
					} else {
						// ----------------------------------------------------------------------------------------------------
						// Comming as New Absent Parent
						// ----------------------------------------------------------------------------------------------------
						fatherMotherList = absentParentBo
								.getNewAbsentParentList(peopleHandler,
										appNumber,programKey,rmcInPrflColl);
					}
				}

				// Clean Before Collection
				beforeColl = new HashMap();
			} else {
				// ----------------------------------------------------------------------------------------------------
				// Comming from the same page
				// ----------------------------------------------------------------------------------------------------
				if (pageCollection.containsKey(FwConstants.DETAIL_KEY_BEAN)) {
					// ----------------------------------------------------------------------------------------------------
					// Comming from previous button
					// ----------------------------------------------------------------------------------------------------
					detailKeyBeanFlag = true;
					detailKeyBean = (IndivTypeSeqBean) pageCollection
							.get(FwConstants.DETAIL_KEY_BEAN);
					fatherMotherList = (List) beforeColl
							.get("FatherMotherList");
				} else {
					// ----------------------------------------------------------------------------------------------------
					// Looping the page
					// ----------------------------------------------------------------------------------------------------
					if (beforeColl != null) {
						if (beforeColl.containsKey("FatherMotherList")) {
							fatherMotherList = (List) beforeColl
									.get("FatherMotherList");
						}

						if (beforeColl
								.containsKey(FwConstants.CURRENT_RECORD_INDEX)) {
							currentRecordIndex = Integer
									.parseInt(String.valueOf(beforeColl
											.get(FwConstants.CURRENT_RECORD_INDEX)));
							currentRecordIndex++;
						}
					}
				}
			}

			// ----------------------------------------------------------------------------------------------------
			// Load Absent Parent Details
			// ----------------------------------------------------------------------------------------------------
			IndivTypeSeqBean fatherMotherSeqBean = null;

			if (detailKeyBeanFlag) {
				fatherMotherSeqBean = detailKeyBean;
			} else {
				if (fatherMotherList != null
						&& currentRecordIndex < fatherMotherList.size()){
				fatherMotherSeqBean = (IndivTypeSeqBean) fatherMotherList
						.get(currentRecordIndex);
				}
			}
			if(fatherMotherSeqBean == null){
				fatherMotherList = (List) session.get("summary_abslist");
				if(fatherMotherList!=null && !fatherMotherList.isEmpty()) {
				fatherMotherSeqBean = (IndivTypeSeqBean)fatherMotherList.get(0);
				}
			}
			if (fatherMotherSeqBean != null) {
				indvSeqNumber = fatherMotherSeqBean.getIndivSeqNum();
				seqNumber = fatherMotherSeqBean.getSeqNum();
				absInd = fatherMotherSeqBean.getType();

				// Load absent parent details from DB
				pageCollection.putAll(absentParentBo
						.loadAbsentParentDetailsPageCollection(appNumber,
								indvSeqNumber, seqNumber, absInd));
			}
			// ----------------------------------------------------------------------------------------------------
			// Setup Page Collection and Before Collection
			// ----------------------------------------------------------------------------------------------------
			pageCollection.put(FwConstants.RECORD_ARRAY, fatherMotherList); // THIS
																			// ENABLES
																			// PREVIOUS
																			// NAVIGATION
			pageCollection.put(FwConstants.CURRENT_RECORD_INDEX, ""
					+ currentRecordIndex);
			pageCollection.put("FatherMotherList", fatherMotherList);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			txnBean.setPageCollection(pageCollection);

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			// Fetch Components List and load it into Request
			componentManager.getComponents(pageId, txnBean);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoAbsentParentDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoAbsentParentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoAbsentParentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoAbsentParentDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoAbsentParentDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Absent Parent Store Method.
	 *
	 * @author - Numa Canedo
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 * Creation Date Thu Sep 09 14:24:00 EDT 2015
	 */
	public void storeHouseHoldInfoAbsentParentDetails(
			final FwTransaction txnBean) throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoAbsentParentDetails() - START");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		FwMessageList validateInfo = null;
		List fatherMotherList = null;
		int currentRecordIndex = 0;

		String pageId = null;
		String appNumber = null;
		int[] driverArray = null;
		Map beforeColl = null;
		int currentPageStatus = 0;

		String indvSeqNumber = null;
		String apSeqNum = FwConstants.ZERO;
		boolean updatedDetailRecFlag = false;
		boolean pageComplete = false;
		final AbsentParentBO absentParentBo = new AbsentParentBO();

		// Collections
		APP_IN_ABSNP_Collection appInAbsBeforeColl = new APP_IN_ABSNP_Collection();
		APP_ABS_PRNT_Collection appAbsBeforeColl = new APP_ABS_PRNT_Collection();
		APP_IN_ABSNP_Collection appInAbsColl = new APP_IN_ABSNP_Collection();
		APP_ABS_PRNT_Collection appAbsColl = new APP_ABS_PRNT_Collection();

		APP_ABS_PRNT_Cargo appAbsBeforeCargo = new APP_ABS_PRNT_Cargo();
		APP_IN_ABSNP_Cargo appInAbsCargo = new APP_IN_ABSNP_Cargo();
		APP_ABS_PRNT_Cargo appAbsCargo = new APP_ABS_PRNT_Cargo();

		try {
			// ----------------------------------------------------------------------------------------------------
			// Get standard values
			// ----------------------------------------------------------------------------------------------------
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);

			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);

			indvSeqNumber = (String) beforeColl
					.get(AppConstants.INDV_SEQUENCE_NUMBERS);
			fatherMotherList = (List) beforeColl.get("FatherMotherList");
			currentRecordIndex = Integer.valueOf((String) beforeColl
					.get(FwConstants.CURRENT_RECORD_INDEX));

			// ----------------------------------------------------------------------------------------------------
			// Fetch Collections and Cargos
			// ----------------------------------------------------------------------------------------------------
			// Get Absent Parent Before Collections
			if (null != beforeColl.get("APP_IN_ABSNP_Collection")) {
				appInAbsBeforeColl = (APP_IN_ABSNP_Collection) beforeColl
						.get("APP_IN_ABSNP_Collection");
			}
			if (null != beforeColl.get("APP_ABS_PRNT_Collection")) {
				appAbsBeforeColl = (APP_ABS_PRNT_Collection) beforeColl
						.get("APP_ABS_PRNT_Collection");
			}

			// Get Absent Parent Collections
			if (null != pageCollection.get("APP_IN_ABSNP_Collection")) {
				appInAbsColl = (APP_IN_ABSNP_Collection) pageCollection
						.get("APP_IN_ABSNP_Collection");
			}
			if (null != pageCollection.get("APP_ABS_PRNT_Collection")) {
				appAbsColl = (APP_ABS_PRNT_Collection) pageCollection
						.get("APP_ABS_PRNT_Collection");
			}

			// Get Absent Parent Before Cargos
			if (null!=appInAbsBeforeColl && !appInAbsBeforeColl.isEmpty()
					&& null != appInAbsBeforeColl.getCargo(0)) {
				appInAbsBeforeColl.getCargo(0);
			}
			if (null!=appAbsBeforeColl && !appAbsBeforeColl.isEmpty()
					&& null != appAbsBeforeColl.getCargo(0)) {
				appAbsBeforeCargo = appAbsBeforeColl.getCargo(0);
			}

			// Get Absent Parent Cargos
			if (null!=appInAbsColl && !appInAbsColl.isEmpty() && null != appInAbsColl.getCargo(0)) {
				appInAbsCargo = appInAbsColl.getCargo(0);
			}
			if (null!=appAbsColl && !appAbsColl.isEmpty() && null != appAbsColl.getCargo(0)) {
				appAbsCargo = appAbsColl.getCargo(0);
			}

			// ----------------------------------------------------------------------------------------------------
			// Validations
			// ----------------------------------------------------------------------------------------------------
			componentManager.getComponents(pageId, txnBean);
			validateInfo = absentParentBo.validateAbsentParentDetails(
					appAbsCargo,
					(List) pageCollection.get(FwConstants.PAGE_COMPONENT_LIST));

			if (validateInfo != null && validateInfo.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST, validateInfo);
				pageCollection.put("APP_IN_ABSNP_Collection", appInAbsColl);
				pageCollection.put("APP_ABS_PRNT_Collection", appAbsColl);

				pageCollection.put("CW_APP_ABS_PRNT_Collection",
						beforeColl.get("CW_APP_ABS_PRNT_Collection"));

				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						indvSeqNumber);
				return;
			}

			// ----------------------------------------------------------------------------------------------------
			// Validate for null fields and prepare Cargo
			// ----------------------------------------------------------------------------------------------------
			appAbsCargo.setApp_num(appNumber);
			appAbsCargo.setRec_cplt_ind(FwConstants.ONE);

			if (null != appAbsCargo.getAp_absn_dt()
					&& appAbsCargo.getAp_absn_dt().trim().length() > 0) {
				appAbsCargo.setAp_absn_dt(displayFormatter
						.getYYYYMMDDDate(appAbsCargo.getAp_absn_dt()));
			} else {
				appAbsCargo.setAp_absn_dt(AppConstants.HIGH_DATE);
			}
			if (null == appAbsCargo.getCase_gdcs_clm_sw()) {
				appAbsCargo.setCase_gdcs_clm_sw(FwConstants.SPACE);
			}
			if (AppConstants.NULL_STRING.equals(appAbsCargo.getSeq_num())) {
				appAbsCargo.setSeq_num(null);
			}
			if (null == appAbsCargo.getAp_sex_ind()
					|| AppConstants.NULL_STRING.equals(appAbsCargo
							.getAp_sex_ind())
							|| appAbsCargo.getAp_sex_ind().isEmpty()) {
				appAbsCargo.setAp_sex_ind(AppConstants.SEX_IND_UNKNOWN);
			}

			// ----------------------------------------------------------------------------------------------------
			// Store Master-Detail Absent Parent Records
			// ----------------------------------------------------------------------------------------------------
			// Check if cargo is dirty
			appAbsCargo = (APP_ABS_PRNT_Cargo) isChanged(appAbsBeforeCargo,
					appAbsCargo);
			if (appAbsCargo.isDirty()) {

				if (null == appAbsCargo.getSeq_num()
						|| FwConstants.EMPTY_STRING.equals(appAbsCargo
								.getSeq_num().trim())
								|| FwConstants.ZERO.equals(appAbsCargo.getSeq_num())) {
					if (appAbsCargo.getSrc_app_ind() == null) {
						appAbsCargo
								.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
					}
					appAbsCargo.setRowAction(FwConstants.ROWACTION_INSERT);
				} else {
					if (AppConstants.CWW_RECORD_IND
							.equalsIgnoreCase(appAbsCargo.getSrc_app_ind())) {
						appAbsCargo
						.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
						appAbsCargo.setRowAction(FwConstants.ROWACTION_INSERT);
						updatedDetailRecFlag = true;
						if(appAbsBeforeCargo != null && null != appAbsBeforeCargo.getEcp_id()){
							appAbsCargo.setEcp_id(appAbsBeforeCargo.getEcp_id());
						}
					} else {
						appAbsCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						updatedDetailRecFlag = true;
					}
				}
				if(appAbsCargo.getAbs_prnt_ssn_num()!=null){
					appAbsCargo.setAbs_prnt_ssn_num(appAbsCargo.getAbs_prnt_ssn_num().trim());
				}
				if(null!=appAbsCargo && (appAbsCargo.getSrc_app_ind()==null || appAbsCargo.getSrc_app_ind().length()>2))
				{
					log(ILog.FATAL,"DeepLog::RMCHouseHoldInfoEJBBean.storeHouseholdInfoAbsentParentDetails()::appNum::"+appNumber);
					log(ILog.FATAL,"DeepLog::RMCHouseHoldInfoEJBBean.storeHouseholdInfoAbsentParentDetails()::src_app_ind::"+appAbsCargo.getSrc_app_ind());
				}
				apSeqNum = absentParentBo.storeAbsentParentDetails(null,
						appAbsColl);

				// Update Seq Num to enable Previous Navigation for New Absent
				// Parents
				if (null != fatherMotherList && !fatherMotherList.isEmpty()) {
					final IndivTypeSeqBean indivTypeSeqBean = (IndivTypeSeqBean) fatherMotherList
							.get(currentRecordIndex);
					if (null == indivTypeSeqBean.getSeqNum()
							|| indivTypeSeqBean.getSeqNum().trim().isEmpty()
							|| "0".equals(indivTypeSeqBean.getSeqNum().trim())) {
						indivTypeSeqBean.setSeqNum(apSeqNum);

						fatherMotherList.set(currentRecordIndex,
								indivTypeSeqBean);
						beforeColl.put("FatherMotherList", fatherMotherList);
					}
				}

				// Insert Master Record
				if (!updatedDetailRecFlag) {
					appInAbsCargo.setDirty(true);
					appInAbsCargo.setApp_num(appNumber);
					appInAbsCargo.setAp_seq_num(apSeqNum);
					appInAbsCargo.setIndv_seq_num(indvSeqNumber);
					appInAbsCargo.setPater_estb_sw(AppConstants.SPACE);
					appInAbsCargo.setRec_cplt_ind(FwConstants.ONE);

					appInAbsCargo.setRowAction(FwConstants.ROWACTION_INSERT);

					appInAbsColl.addCargo(appInAbsCargo);
					absentParentBo.storeAbsentParentDetails(appInAbsColl, null);
				}
				else
				{
					absentParentBo.updateCompleteIndicator(appNumber,indvSeqNumber,apSeqNum,"1");
				}
			}

			// ----------------------------------------------------------------------------------------------------
			// Complete Page Logic
			// ----------------------------------------------------------------------------------------------------
			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {

				// Page Completion check
				if (null != fatherMotherList && !fatherMotherList.isEmpty()) {
					if (currentRecordIndex + 1 == fatherMotherList.size()) {
						pageComplete = true;
					}
				} else {
					pageComplete = true;
				}
			}

			if (currentPageStatus == FwConstants.DRIVER_NOT_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_ADD_NEW
					|| currentPageStatus == FwConstants.DRIVER_COMPLETE) {
				pageComplete = true;
			}

			// Put before collection into session
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			// ----------------------------------------------------------------------------------------------------
			// Navigation
			// ----------------------------------------------------------------------------------------------------
			if (pageComplete) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						(String) request.get(FwConstants.CURRENT_PAGE_ID),
						driverArray, appNumber);
				beforeColl.remove(FwConstants.RECORD_ARRAY); // Remove record
				// array to
				// avoid wrong
				// previous
				// navigation
				if(null !=fatherMotherList && fatherMotherList.size()>0){
				session.put("FatherMotherList", fatherMotherList);
				}else{
					List fatherMotherListRM = new ArrayList();
					IndivTypeSeqBean indivTypeSeqBeanRM = new IndivTypeSeqBean();
					indivTypeSeqBeanRM.setIndivSeqNum(indvSeqNumber);
					indivTypeSeqBeanRM.setSeqNum(apSeqNum);
					String sexInd = appAbsCargo.getAp_sex_ind();
					
					if (AppConstants.SEX_IND_MALE.equals(sexInd)) {
						indivTypeSeqBeanRM.setType(AppConstants.ABS_FATHER);
					} else if (AppConstants.SEX_IND_FEMALE.equals(sexInd)) {
						indivTypeSeqBeanRM.setType(AppConstants.ABS_MOTHER);
					} else if (AppConstants.SEX_IND_UNKNOWN.equals(sexInd)) {
						indivTypeSeqBeanRM.setType(AppConstants.ABS_UNKNOWN);
					} else {
						indivTypeSeqBeanRM.setType(AppConstants.ABS_UNKNOWN);
					}
					fatherMotherListRM.add(indivTypeSeqBeanRM);
					session.put("FatherMotherList", fatherMotherListRM);
					
				}
			} else {
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						(String) request.get(FwConstants.CURRENT_PAGE_ID),
						driverArray, appNumber);
			}

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoAbsentParentDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoAbsentParentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoAbsentParentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoAbsentParentDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoAbsentParentDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");

	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoSchoolEnrollmentDetails(
			final FwTransaction txnBean) throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoSchoolEnrollmentDetails() - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoSchoolEnrollmentDetails:Start");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		// PCR# 40362 changes: page mode
		String pageMode = null;
		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final SchoolEnrollmentBO schoolEnrollmentBo = new SchoolEnrollmentBO();

			// PCR# 40362 Changes: To retain RMC functionality
			// PCR# 40362 Changes for RMB/SMIRF starts here

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.SCHOOL_ENROLLEMENT_CHANGE,
					AppConstants.SCHOOL_ENROLLEMENT_CHANGE);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.SCHL_ENRL_RESP };
			SortedSet schoolDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.SCHOOL_ENROLLEMENT_CHANGE;

			if (!pageId.equals(previousPageId)) {
				schoolDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented
					 * Code in this block
					 */

					final APP_IN_SCHLE_Collection schoolColl = schoolEnrollmentBo
							.loadSchoolEnrollment(appNumber);
					final APP_IN_SCHLE_Collection newSchoolColl = schoolEnrollmentBo
							.splitSchoolEnrlColl(schoolColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newSchoolColl != null && !newSchoolColl.isEmpty()) {
						APP_IN_SCHLE_Cargo appInSchoolCargo = null;
						final int newSchoolCollSize = newSchoolColl.size();
						rnRecordFound = true;

						for (int i = 0; i < newSchoolCollSize; i++) {
							appInSchoolCargo = newSchoolColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									schoolDetailsProfile, null, null,
									Short.parseShort(appInSchoolCargo
											.getIndv_seq_num()),
											(short) 0, categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(schoolDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(schoolDetailsProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				schoolDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("SchoolEnrl_IndSeqBean");
			}
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								schoolDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.updateUserEndSelInd(schoolDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.SCHOOL_ENROLLEMENT_CHANGE,
												Short.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							schoolDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber,
									Short.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE,
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.ADD_SCHOOL_ENROLLMENT
								.equals(indivSeqBean.getType())) {
							// first we are checking rnc in profile exists in
							// the sess
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}
							// now we need to make required the MAPP page
							rmcResponseProfileManager.makeAddNew(
									IRMCResponseProfileManager.SCHL_ENRL_RESP,
									rmcInPrflCargo, true);
							/*
							 * VG SONAR Cleanup - 08/31/2015 Deleted 1 loooong
							 * lines Commented Code in this block
							 */

							CategorySequenceDetail catseqDet = null;
							if (!schoolDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												schoolDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										schoolDetailsProfile,
										null,
										null,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean sErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;
									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.SCHOOL_ENROLLEMENT_CHANGE
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												sErowExists = true;
												break;
											}
										}

									}
								}
								if (sErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
								categorySelectionProfileManager
									.insertExistingSequenceDetail(
											categorySelectionProfile,
											appNumber,
											AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													0,
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
								} else {
									categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
									
								}

								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.SCHOOL_ENROLLEMENT_CHANGE);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.SCHOOL_ENROLLEMENT_CHANGE };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!schoolDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													schoolDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											schoolDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
									schoolDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									schoolDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!schoolDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													schoolDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											schoolDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
									categorySelectionProfileManager
									.insertSequenceDetail(
											schoolDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											schoolDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.SCHOOL_ENROLLEMENT_CHANGE);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								schoolDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								schoolDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put("SchoolEnrl_IndSeqBean", indivSeqBean);
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					schoolDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(schoolDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(schoolDetailsProfile);
			}

			categorySeqDetail.getCategoryType();

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final APP_IN_SCHLE_Collection appInSchoolColl = schoolEnrollmentBo
					.loadSchlEnrollment(appNumber, indvSeqNumber);

			pageCollection.put("APP_IN_SCHLE_Collection", appInSchoolColl);

			APP_IN_SCHLE_Cargo cwwInSchoolCargo = schoolEnrollmentBo
					.splitSchoolColl(appInSchoolColl,
							AppConstants.CWW_RECORD_IND);

			if (cwwInSchoolCargo == null) {
				cwwInSchoolCargo = new APP_IN_SCHLE_Cargo();
			}
			pageCollection.put("SEC_SCHL",
					schoolEnrollmentBo.settingDefaultValues(cwwInSchoolCargo));

			APP_IN_SCHLE_Cargo rmcInSchoolCargo = schoolEnrollmentBo
					.splitSchoolColl(appInSchoolColl,
							AppConstants.RMC_NEW_RECORD_IND);
			if (rmcInSchoolCargo != null) {
				pageCollection.put("FST_SCHL", schoolEnrollmentBo
						.settingDefaultValues(rmcInSchoolCargo));
			} else {
				rmcInSchoolCargo = schoolEnrollmentBo.splitSchoolColl(
						appInSchoolColl, AppConstants.RMC_MODIFIED_RECORD_IND);
				if (rmcInSchoolCargo != null) {
					pageCollection.put("FST_SCHL", schoolEnrollmentBo
							.settingDefaultValues(rmcInSchoolCargo));
				} else {
					pageCollection.put("FST_SCHL", schoolEnrollmentBo
							.settingDefaultValues(rmcInSchoolCargo));
				}

			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (appInSchoolColl != null && !appInSchoolColl.isEmpty()) {
				final APP_IN_SCHLE_Cargo appInSchlCargo = appInSchoolColl
						.getResult(0);
				srcAppInd = appInSchlCargo.getSrc_app_ind();
			}

			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3,3 lines Commented Code in
			 * this block
			 */

			if (categorySeqDetail.getUserEndSelectionInd() == 1)

			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd()))

				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equals(pageMode) || "E".equals(pageMode))) {
				pageMode = FwConstants.NO;
			}

			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);
			String immuneStatus = "false";
			final short[] programKeyArray = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			final short tanf = 9;
			if (programKeyArray[tanf] != 0) {
				final IndividualAge indvAge = indvCargo.getIndv_age();
				if (indvAge.getYears() <= 18) {
					immuneStatus = "true";
				}
			}
			pageCollection.put("DISPLAY_IMMUNIZATION", immuneStatus);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoSchoolEnrollmentDetails:END");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoSchoolEnrollmentDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoSchoolEnrollmentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoSchoolEnrollmentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoSchoolEnrollmentDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoSchoolEnrollmentDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeHouseHoldInfoSchoolEnrollmentDetails(
			final FwTransaction txnBean) throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoSchoolEnrollmentDetails() - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::storeHouseHoldInfoSchoolEnrollmentDetails:Start");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;

		PeopleHandler peopleHandler = null;
		String pageId = null;
		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Get program key
			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			String displayImmunization = FwConstants.EMPTY_STRING;
			if (beforeColl.containsKey("DISPLAY_IMMUNIZATION")) {
				displayImmunization = (String) beforeColl
						.get("DISPLAY_IMMUNIZATION");
			}
			// PCR# 40362 Changes: To retail RMC flow

			// PCR# 40362 Changes Starts here: For RMB/SMIRF

			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			// get the BeforeCollection

			final SortedSet inSchoolProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final APP_IN_SCHLE_Collection appInSchoolCollection = (APP_IN_SCHLE_Collection) pageCollection
					.get("APP_IN_SCHLE_Collection");
			APP_IN_SCHLE_Cargo appInSchoolCargo = appInSchoolCollection
					.getResult(0);

			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inSchoolProfile);

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1,2,5 lines Commented Code
			 * in this block
			 */

			// Run Validations

			final SchoolEnrollmentBO schoolEnrollmentBo = new SchoolEnrollmentBO();

			// Calling the Validator method
			final ARHSEValidator arhseValidator = new ARHSEValidator();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			if (backToMyAccess == null) {
				arhseValidator.validateSchoolEnrollmentDetails(
						appInSchoolCargo, displayImmunization);
			}

			if (checkBackToMyAccessSelected(request)
					|| arhseValidator.hasMessages()) {

				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							arhseValidator.getMessageList());
				}

				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("APP_IN_SCHLE_Collection",
						appInSchoolCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection.put("DISPLAY_IMMUNIZATION",
						beforeColl.get("DISPLAY_IMMUNIZATION"));
				pageCollection.put("PEOPLE_362", beforeColl.get("PEOPLE_362"));

				if (beforeColl.containsKey("SEC_SCHL")) {
					pageCollection.put("SEC_SCHL", beforeColl.get("SEC_SCHL"));
				}
				pageCollection.put("FST_SCHL", appInSchoolCargo);
				return;
			}

			appInSchoolCargo.setApp_num(appNumber);
			appInSchoolCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			schoolEnrollmentBo.completenessCheckSchoolEnrollment(
					appInSchoolCargo, programKey);
			// For Check boxe is unchecked, is null I am setting it to '0'(Zero)
			if (appInSchoolCargo.getChld_care_ind() == null) {
				appInSchoolCargo.setChld_care_ind(FwConstants.ZERO);
			}
			// For Check boxe is unchecked, is null I am setting it to '0'(Zero)
			if (appInSchoolCargo.getIsfc_dy_care_ind() == null) {
				appInSchoolCargo.setIsfc_dy_care_ind(FwConstants.ZERO);
			}
			// For Check boxe is unchecked, is null I am setting it to '0'(Zero)
			if (appInSchoolCargo.getWork_stdy_ind() == null) {
				appInSchoolCargo.setWork_stdy_ind(FwConstants.ZERO);
			}
			// For Check boxe is unchecked, is null I am setting it to '0'(Zero)
			if (appInSchoolCargo.getSchl_plcm_ind() == null) {
				appInSchoolCargo.setSchl_plcm_ind(FwConstants.ZERO);
			}
			// education cd
			if (appInSchoolCargo.getEduc_cd() == null
					|| AppConstants.SELECT_DEFAULT_OPTION
					.equals(appInSchoolCargo.getEduc_cd())) {
				appInSchoolCargo.setEduc_cd(FwConstants.SPACE);
			}
			if (appInSchoolCargo.getHs_grad_stat_cd() == null
					|| AppConstants.SELECT_DEFAULT_OPTION
					.equals(appInSchoolCargo.getHs_grad_stat_cd())) {
				appInSchoolCargo.setHs_grad_stat_cd(FwConstants.SPACE);
			}

			if (appInSchoolCargo.getRec_cplt_ind() == null
					|| appInSchoolCargo.getRec_cplt_ind().trim().length() == 0) {
				appInSchoolCargo.setRec_cplt_ind(FwConstants.ONE);
			} else {
				appInSchoolCargo.setRec_cplt_ind(appInSchoolCargo
						.getRec_cplt_ind());
			}

			if (appInSchoolCargo.getHs_grad_dt() == null
					|| appInSchoolCargo.getHs_grad_dt().trim().length() == 0) {
				appInSchoolCargo.setHs_grad_dt(AppConstants.HIGH_DATE);
			}

			final APP_IN_SCHLE_Collection beforeAppInSchoolColl = (APP_IN_SCHLE_Collection) beforeColl
					.get("APP_IN_SCHLE_Collection");
			APP_IN_SCHLE_Cargo beforeInSchoolCargo = null;

			String sourceAppIndicator = null;
			String recordInd = null;

			// now we are checking for the before collection

			boolean inSchoolDetailsUpdate = false;

			if (beforeAppInSchoolColl != null
					&& !beforeAppInSchoolColl.isEmpty()) {
				final int size = beforeAppInSchoolColl.size();

				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInSchoolCargo = schoolEnrollmentBo.splitSchoolColl(
							beforeAppInSchoolColl, sourceAppIndicator);

				} else {
					// now we are checking this record is CW or RN
					sourceAppIndicator = AppConstants.CWW_RECORD_IND;
					beforeInSchoolCargo = schoolEnrollmentBo.splitSchoolColl(
							beforeAppInSchoolColl, sourceAppIndicator);
					if (beforeInSchoolCargo != null) {
						sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
						recordInd = FwConstants.ROWACTION_INSERT;
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInSchoolCargo = schoolEnrollmentBo
								.splitSchoolColl(beforeAppInSchoolColl,
										sourceAppIndicator);
					}
				}

				// check dirty
				appInSchoolCargo = (APP_IN_SCHLE_Cargo) isChanged(
						beforeInSchoolCargo, appInSchoolCargo);

				appInSchoolCargo.setSrc_app_ind(sourceAppIndicator);
				appInSchoolCargo.setRowAction(recordInd);

				if (appInSchoolCargo.isDirty()) {
					inSchoolDetailsUpdate = true;
				}
			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;

				appInSchoolCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInSchoolCargo.setRowAction(recordInd);

				inSchoolDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inSchoolProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code
				 * in this block
				 */

				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}

			// now we need to check the flags
			if (inSchoolDetailsUpdate) {
				schoolEnrollmentBo
				.storeSchoolEnrollmentDetails(appInSchoolCollection);
				/**
				 * if (recordInd.equals(FwConstants.ROWACTION_INSERT)) {
				 * schoolEnrollmentBo
				 * .insertSchoolEnrollmentDetails(appInSchoolCollection); } else
				 * { schoolEnrollmentBo.updateSchoolEnrollmentDetails(
				 * appInSchoolCollection); }
				 */
			}

			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.SCHL_ENRL_RESP,
							rmcInPrflCargo, true);
				}
			}

			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inSchoolProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			if (categorySelectionProfileManager
					.areAllSequencesComplete(inSchoolProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inSchoolProfile);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeHouseHoldInfoSchoolEnrollmentDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoSchoolEnrollmentDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoSchoolEnrollmentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoSchoolEnrollmentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoSchoolEnrollmentDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoSchoolEnrollmentDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load house hold info medicare details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void loadHouseHoldInfoMedicareDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMedicareDetails() - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoMedicareDetails:Start");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String pageMode = null;
		appNumber = (String) session.get(AppConstants.APP_NUMBER);
		driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
		pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
		currentPageStatus = driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
				pageId, driverArray);
		previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
		final MedicareBO medicareBO = new MedicareBO();

		SortedSet categorySelectionProfile = (SortedSet) session
				.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
		final Map catMappTypes = new HashMap();
		catMappTypes.put(AppConstants.MEDICARE_INFORMATION,
				AppConstants.MEDICARE_INFORMATION);

		if (currentPageStatus == FwConstants.DRIVER_REQUIRED
				|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
				&& categorySelectionProfileManager.isEmpty(
						categorySelectionProfile, catMappTypes)) {
			categorySelectionProfile = categorySelectionProfileManager
					.loadCategoryChangeSelectionProfile(appNumber,
							AppConstants.MEDICARE_INFORMATION);
		} else if (currentPageStatus == FwConstants.DRIVER_COMPLETE
				&& !pageId.equals(previousPageId)
				&& categorySelectionProfileManager.isEmpty(
						categorySelectionProfile, catMappTypes)) {
			categorySelectionProfile = categorySelectionProfileManager
					.loadCategoryChangeSelectionProfile(appNumber,
							AppConstants.MEDICARE_INFORMATION);
		}

		RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
				.get(AppConstants.RMC_IN_PRFL_MASTER);
		previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

		final short[] responseType = new short[] { IRMCResponseProfileManager.RECEIVE_MEDICARE };
		SortedSet medicCareProfile = null;
		final String categType = AppConstants.MEDICARE_INFORMATION;

		if (!pageId.equals(previousPageId)) {
			medicCareProfile = createPageProfile(categorySelectionProfile,
					rmcInPrflColl, responseType);
			if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
				final APP_IN_MEDCR_Collection appInMedcrColl = medicareBO
						.loadMedicareDetails(appNumber, null, null);
				final APP_IN_MEDCR_Collection newMedcrColl = medicareBO
						.splitMediCareColl(appInMedcrColl,
								AppConstants.RMC_NEW_RECORD_IND);

				if (newMedcrColl != null && !newMedcrColl.isEmpty()) {
					APP_IN_MEDCR_Cargo appInMedCrCargo = null;
					final int newHlthCollSize = newMedcrColl.size();
					for (int i = 0; i < newHlthCollSize; i++) {
						appInMedCrCargo = newMedcrColl.getResult(i);
						categorySelectionProfileManager
						.insertExistingSequenceDetail(medicCareProfile,
								null, null, Short
								.parseShort(appInMedCrCargo
										.getIndv_seq_num()),
										Short.parseShort(appInMedCrCargo
												.getSeq_num()), categType);
					}
				}
			}

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
				// set the current record indicator to the first one
				categorySelectionProfileManager
				.setCurrentRecordIndToFirst(medicCareProfile);
			}

			if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
				// set the current record indicator to the end of the detail
				// bean
				categorySelectionProfileManager
				.setCurrentRecordIndToLast(medicCareProfile);
			}
			// create add new sorted set
			// we need to remove the vallues from the session
			session.remove(FwConstants.BEFORE_COLLECTION);
		} else {
			// catAddNewProfile get it from the before collection
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			medicCareProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
		}

		IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
				.get(FwConstants.DETAIL_KEY_BEAN);
		if (indivSeqBean == null
				&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
				&& !pageId.equals(previousPageId)) {
			indivSeqBean = (IndivTypeSeqBean) session
					.get("Medicare_IndSeqBean");
		}
		if (indivSeqBean != null) {
			final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
					.getCategorySequenceDetail(medicCareProfile,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());

			if (categorySeqDetail1 != null) {
				if (categorySeqDetail1.getUserEndSelectionInd() != Short
						.parseShort(indivSeqBean.getUserEndInd())) {
					categorySelectionProfileManager.updateUserEndSelInd(
							medicCareProfile, appNumber,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType(),
							Short.parseShort(indivSeqBean.getUserEndInd()));
				}

				categorySelectionProfileManager.makeSequenceDetailRequired(
						medicCareProfile, null,
						Short.parseShort(indivSeqBean.getIndivSeqNum()),
						Short.parseShort(indivSeqBean.getSeqNum()),
						indivSeqBean.getType());
				final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								categorySelectionProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail2 != null) {
					if (categorySeqDetail2.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(categorySelectionProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							categorySelectionProfile, appNumber,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
				}
			} else {
				if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
					RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
					if (rmcInPrflColl != null) {
						rmcInPrflCargo = rmcResponseProfileManager.getProfile(
								rmcInPrflColl, indivSeqBean.getIndivSeqNum());
					} else {
						rmcInPrflColl = new RMC_IN_PRFL_Collection();
					}
					if (rmcInPrflCargo == null) {
						rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
						rmcInPrflCargo.setApp_num(appNumber);
						rmcInPrflCargo.setIndv_seq_num(indivSeqBean
								.getIndivSeqNum());
						rmcResponseProfileManager
						.createRMCIndividualProfile(rmcInPrflCargo);
						rmcInPrflColl.addCargo(rmcInPrflCargo);
					}

					rmcResponseProfileManager.makeAddNew(
							IRMCResponseProfileManager.RECEIVE_MEDICARE,
							rmcInPrflCargo, true);
					// Not needed for Room and Board
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 1 loooooong lines
					 * Commented Code in this block
					 */
					categorySelectionProfileManager.insertSequenceDetail(
							medicCareProfile, null, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType(),
							Short.parseShort(indivSeqBean.getUserEndInd()));
					session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
				} else {
					String userEndInd = indivSeqBean.getUserEndInd();
					if (userEndInd == null) {
						userEndInd = FwConstants.ZERO;
					}

					categorySelectionProfileManager.insertSequenceDetail(
							medicCareProfile, null,
							AppConstants.MEDICARE_INFORMATION,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType(),
							Short.parseShort(userEndInd));
					categorySelectionProfileManager.makeSequenceDetailRequired(
							medicCareProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());

					categorySelectionProfileManager.insertSequenceDetail(
							categorySelectionProfile, appNumber,
							AppConstants.MEDICARE_INFORMATION,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType(),
							Short.parseShort(userEndInd));
					categorySelectionProfileManager.makeSequenceDetailRequired(
							categorySelectionProfile, appNumber,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
				}
			}

			session.put("Medicare_IndSeqBean", indivSeqBean);
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
		}
		pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
				medicCareProfile);

		CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
				.getCurrentSequenceDetail(medicCareProfile);
		if (categorySeqDetail == null) {
			categorySeqDetail = categorySelectionProfileManager
					.getNextSequenceDetail(medicCareProfile);
		}

		categorySeqDetail.getCategoryType();
		final String categorySeqNum = Long.toString(categorySeqDetail
				.getCategorySequence());

		indvSeqNumber = Short.toString(categorySeqDetail
				.getIndividualSequence());

		final APP_IN_MEDCR_Collection appInMedCrColl = medicareBO
				.loadMedicareDetails(appNumber, indvSeqNumber, categorySeqNum);

		pageCollection
		.put(AppConstants.APP_IN_MEDCR_COLLECTION, appInMedCrColl);

		APP_IN_MEDCR_Cargo cwAppInMedCrCargo = medicareBO.splitAppInMedCrCargo(
				appInMedCrColl, AppConstants.CWW_RECORD_IND);

		if (cwAppInMedCrCargo == null) {
			cwAppInMedCrCargo = new APP_IN_MEDCR_Cargo();
		}
		pageCollection.put(AppConstants.SEC_MEDCR,
				medicareBO.settingDefaultValues(cwAppInMedCrCargo));

		APP_IN_MEDCR_Cargo rmcHlthCvrgCargo = medicareBO.splitAppInMedCrCargo(
				appInMedCrColl, AppConstants.RMC_NEW_RECORD_IND);
		if (rmcHlthCvrgCargo != null) {
			pageCollection.put(AppConstants.FST_MEDCR,
					medicareBO.settingDefaultValues(rmcHlthCvrgCargo));
		} else {
			rmcHlthCvrgCargo = medicareBO.splitAppInMedCrCargo(appInMedCrColl,
					AppConstants.RMC_MODIFIED_RECORD_IND);
			if (rmcHlthCvrgCargo != null) {
				pageCollection.put(AppConstants.FST_MEDCR,
						medicareBO.settingDefaultValues(rmcHlthCvrgCargo));
			} else {
				pageCollection.put(AppConstants.FST_MEDCR,
						medicareBO.settingDefaultValues(cwAppInMedCrCargo));
			}
		}
		String srcAppInd = AppConstants.EMPTY_STRING;
		if (appInMedCrColl != null && !appInMedCrColl.isEmpty()) {
			final APP_IN_MEDCR_Cargo appInMedCrCargo = appInMedCrColl
					.getResult(0);
			srcAppInd = appInMedCrCargo.getSrc_app_ind();
		}
		if ((AppConstants.CWW_RECORD_IND.equalsIgnoreCase(srcAppInd) || AppConstants.RMC_MODIFIED_RECORD_IND
				.equalsIgnoreCase(srcAppInd))
				&& categorySeqDetail.getUserEndSelectionInd() == 0) {
			pageMode = AppConstants.COMPLETE;
		}
		/*
		 * VG SONAR Cleanup - 08/31/2015 Deleted 3,3 lines Commented Code in
		 * this block
		 */

		if (categorySeqDetail.getUserEndSelectionInd() == 1) {

			pageMode = AppConstants.ENDED;
		} else if (indivSeqBean != null && indivSeqBean.getUserEndInd() != null) {
			if (AppConstants.ONE.equalsIgnoreCase(indivSeqBean.getUserEndInd()))

			{
				pageMode = AppConstants.ENDED;
			} else if (AppConstants.ZERO.equals(indivSeqBean.getUserEndInd())
					&& AppConstants.RMC_MODIFIED_RECORD_IND
					.equalsIgnoreCase(srcAppInd)
					|| AppConstants.CWW_RECORD_IND.equalsIgnoreCase(srcAppInd)) {
				pageMode = AppConstants.COMPLETE;
			} else {
				pageMode = AppConstants.NEW;
			}
		} else if (!(pageMode == AppConstants.COMPLETE || pageMode == AppConstants.ENDED)) {
			pageMode = AppConstants.NEW;
		}
		pageCollection.put(AppConstants.PAGE_MODE, pageMode);
		request.put(AppConstants.PAGE_MODE, pageMode);
		peopleHandler = (PeopleHandler) session
				.get(AppConstants.INDIV_MASTER_HANDLER);
		pageCollection.put(AppConstants.FIRST_NAME,
				peopleHandler.getFirstName(indvSeqNumber));
		pageCollection.put(AppConstants.BIRTH_DATE,
				peopleHandler.getBirthDt(indvSeqNumber));
		peopleHandler.getIndividual(indvSeqNumber);
		pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS, indvSeqNumber);
		pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM, indvSeqNumber);
		txnBean.setPageCollection(pageCollection);
		txnBean.setRequest(request);
		beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
		componentManager.getComponents(pageId, txnBean);
		// Checking for Before Collection is Null
		if (beforeColl == null) {
			beforeColl = new HashMap();
		}
		beforeColl.putAll(pageCollection);
		session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoSchoolEnrollmentDetails:END");

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoMedicareDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Method to store values in CP_APP_IN_MEDCR table for Medicare Detail
	 * screen.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storeHouseHoldInfoMedicareDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMedicareDetails() - START");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		final PeopleHandler peopleHandler = (PeopleHandler) session
				.get(AppConstants.INDIV_MASTER_HANDLER);
		final String currentPageID = (String) request
				.get(FwConstants.CURRENT_PAGE_ID);
		final Map beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
		final String pageMode = (String) beforeColl.get(AppConstants.PAGE_MODE);
		final int[] driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
		driverManager.getAFBStatus(FwConstants.RMC_DRIVER, currentPageID,
				driverArray);
		session.remove("Medicare_IndSeqBean");
		final MedicareBO medicareBO = new MedicareBO();
		// data entered on screen is rpesent in page Collection
		final APP_IN_MEDCR_Collection appInMedcrColl = (APP_IN_MEDCR_Collection) pageCollection
				.get(AppConstants.APP_IN_MEDCR_COLLECTION);
		APP_IN_MEDCR_Cargo appInMedcrCargo = appInMedcrColl.getResult(0);
		// data already set in beforeCollection or data currently in DB
		final APP_IN_MEDCR_Collection beforeCollAppInMedcrColl = (APP_IN_MEDCR_Collection) beforeColl
				.get(AppConstants.APP_IN_MEDCR_COLLECTION);
		APP_IN_MEDCR_Cargo appInMedcrBeforeCargo = null;
		// build category selection profile
		final SortedSet categorySelectionProfile = (SortedSet) session
				.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

		final SortedSet appInMedcrProfile = (SortedSet) beforeColl
				.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
		final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
				.getCurrentSequenceDetail(appInMedcrProfile);

		final String appNum = (String) session.get(AppConstants.APP_NUMBER);
		final String indvSeqNum = new Short(
				categorySeqDetailBean.getIndividualSequence()).toString();
		String.valueOf(categorySeqDetailBean.getCategorySequence());
		final String dateOfBirth = peopleHandler.getBirthDt(indvSeqNum);
		final short userEndInd = categorySeqDetailBean.getUserEndSelectionInd();
		categorySeqDetailBean.getCategoryType();
		// setting data in cargo for processing & validations
		if (appInMedcrCargo.getParta_prem_amt() == null
				|| appInMedcrCargo.getParta_prem_amt().isEmpty()) {
			appInMedcrCargo.setParta_prem_amt(AppConstants.EMPTY_STRING);
			appInMedcrCargo.setParta_prem_ind(AppConstants.ERROR);
		} else {
			appInMedcrCargo.setPartb_prem_ind(AppConstants.ZERO);
		}
		if (appInMedcrCargo.getPartb_prem_amt() == null
				|| appInMedcrCargo.getPartb_prem_amt().isEmpty()) {
			appInMedcrCargo.setPartb_prem_amt(AppConstants.EMPTY_STRING);
			appInMedcrCargo.setPartb_prem_ind(AppConstants.ERROR);
		} else {
			appInMedcrCargo.setPartd_prem_ind(AppConstants.ZERO);
		}
		if (appInMedcrCargo.getPartd_prem_amt() == null
				|| appInMedcrCargo.getPartd_prem_amt().isEmpty()) {
			appInMedcrCargo.setPartd_prem_amt(AppConstants.EMPTY_STRING);
			appInMedcrCargo.setPartd_prem_ind(AppConstants.ERROR);
		} else {
			appInMedcrCargo.setPartd_prem_ind(AppConstants.ZERO);
		}

		if (appInMedcrCargo.getParta_beg_dt() == null
				|| appInMedcrCargo.getParta_beg_dt().isEmpty()) {
			appInMedcrCargo.setParta_beg_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartb_beg_dt() == null
				|| appInMedcrCargo.getPartb_beg_dt().isEmpty()) {
			appInMedcrCargo.setPartb_beg_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartd_beg_dt() == null
				|| appInMedcrCargo.getPartd_beg_dt().isEmpty()) {
			appInMedcrCargo.setPartd_beg_dt(AppConstants.EMPTY_STRING);
		}

		if (appInMedcrCargo.getParta_end_dt() == null
				|| appInMedcrCargo.getParta_end_dt().isEmpty()) {
			appInMedcrCargo.setParta_end_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartb_end_dt() == null
				|| appInMedcrCargo.getPartb_end_dt().isEmpty()) {
			appInMedcrCargo.setPartb_end_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartd_end_dt() == null
				|| appInMedcrCargo.getPartd_end_dt().isEmpty()) {
			appInMedcrCargo.setPartd_end_dt(AppConstants.EMPTY_STRING);
		}

		if (appInMedcrCargo.getParta_prem_payr_cd() == null
				|| AppConstants.SELECT_DEFAULT_OPTION.equals(appInMedcrCargo
						.getParta_prem_payr_cd())) {
			appInMedcrCargo.setParta_prem_payr_cd(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartb_prem_payr_cd() == null
				|| AppConstants.SELECT_DEFAULT_OPTION.equals(appInMedcrCargo
						.getPartb_prem_payr_cd())) {
			appInMedcrCargo.setPartb_prem_payr_cd(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartd_prem_payr_cd() == null
				|| AppConstants.SELECT_DEFAULT_OPTION.equals(appInMedcrCargo
						.getPartd_prem_payr_cd())) {
			appInMedcrCargo.setPartd_prem_payr_cd(AppConstants.EMPTY_STRING);
		}

		if (appInMedcrCargo.getParta_ettl_resp() == null) {
			appInMedcrCargo.setParta_ettl_resp(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartb_ettl_resp() == null) {
			appInMedcrCargo.setPartb_ettl_resp(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartd_ettl_resp() == null) {
			appInMedcrCargo.setPartd_ettl_resp(AppConstants.EMPTY_STRING);
		}

		if (appInMedcrCargo.getRetr_resp() == null) {
			appInMedcrCargo.setRetr_resp(AppConstants.EMPTY_STRING);
		}

		/*
		 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in this
		 * block
		 */

		// initializing validator for form data validations
		final ARHMDValidator arhmdValidator = new ARHMDValidator();
		arhmdValidator.validateDetails(appInMedcrCargo, dateOfBirth);

		final String backToMyAccess = (String) request
				.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
		if (checkBackToMyAccessSelected(request)
				|| arhmdValidator.hasMessages()) {
			// if Back to my Access is not clicked then show validation errors
			if (backToMyAccess == null) {
				request.put(FwConstants.MESSAGE_LIST,
						arhmdValidator.getMessageList());
			}
			// put the first Name into request to avoid null pointer in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					beforeColl.get(AppConstants.FIRST_NAME));
			if (beforeColl.containsKey(AppConstants.SEC_MEDCR)) {
				pageCollection.put(AppConstants.SEC_MEDCR,
						beforeColl.get(AppConstants.SEC_MEDCR));
			}
			pageCollection.put(AppConstants.FST_MEDCR, appInMedcrCargo);
			request.put(AppConstants.PAGE_MODE, pageMode);
			pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
					beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
			return;
		}
		// setting correct set of values before inserting in DB
		appInMedcrCargo.setApp_num(appNum);
		appInMedcrCargo.setIndv_seq_num(indvSeqNum);

		if (appInMedcrCargo.getPartb_beg_dt() != null
				&& !appInMedcrCargo.getPartb_beg_dt().trim().isEmpty()) {
			appInMedcrCargo.setPartb_beg_dt(DisplayFormatter.getInstance()
					.getYYYYMMDDDate(appInMedcrCargo.getPartb_beg_dt().trim()));
		} else {
			appInMedcrCargo.setPartb_beg_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getParta_beg_dt() != null
				&& !appInMedcrCargo.getParta_beg_dt().trim().isEmpty()) {
			appInMedcrCargo.setParta_beg_dt(DisplayFormatter.getInstance()
					.getYYYYMMDDDate(appInMedcrCargo.getParta_beg_dt().trim()));
		} else {
			appInMedcrCargo.setParta_beg_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartd_beg_dt() != null
				&& !appInMedcrCargo.getPartd_beg_dt().trim().isEmpty()) {
			appInMedcrCargo.setPartd_beg_dt(DisplayFormatter.getInstance()
					.getYYYYMMDDDate(appInMedcrCargo.getPartd_beg_dt().trim()));
		} else {
			appInMedcrCargo.setPartd_beg_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartb_end_dt() != null
				&& !appInMedcrCargo.getPartb_end_dt().trim().isEmpty()) {
			appInMedcrCargo.setPartb_end_dt(DisplayFormatter.getInstance()
					.getYYYYMMDDDate(appInMedcrCargo.getPartb_end_dt().trim()));
		} else {
			appInMedcrCargo.setPartb_end_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getParta_end_dt() != null
				&& !appInMedcrCargo.getParta_end_dt().trim().isEmpty()) {
			appInMedcrCargo.setParta_end_dt(DisplayFormatter.getInstance()
					.getYYYYMMDDDate(appInMedcrCargo.getParta_end_dt().trim()));
		} else {
			appInMedcrCargo.setParta_end_dt(AppConstants.EMPTY_STRING);
		}
		if (appInMedcrCargo.getPartd_end_dt() != null
				&& !appInMedcrCargo.getPartd_end_dt().trim().isEmpty()) {
			appInMedcrCargo.setPartd_end_dt(DisplayFormatter.getInstance()
					.getYYYYMMDDDate(appInMedcrCargo.getPartd_end_dt().trim()));
		} else {
			appInMedcrCargo.setPartd_end_dt(AppConstants.EMPTY_STRING);
		}

		String sourceAppIndicator = null;
		String recordInd = null;
		long medcrSeqNum = 0;
		boolean medCareUpdate = false;
		if (beforeCollAppInMedcrColl != null
				&& !beforeCollAppInMedcrColl.isEmpty()) {
			final int size = beforeCollAppInMedcrColl.size();
			medcrSeqNum = categorySeqDetailBean.getCategorySequence();
			if (size > 1) {
				// if we have two records means cw and rm now we are getting RM
				// record to compare
				// now we need to update the data base if it dirty
				sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
				recordInd = FwConstants.ROWACTION_UPDATE;
				appInMedcrBeforeCargo = medicareBO.splitAppInMedCrCargo(
						beforeCollAppInMedcrColl, sourceAppIndicator);
				if (appInMedcrBeforeCargo == null) {
					sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					appInMedcrBeforeCargo = medicareBO.splitAppInMedCrCargo(
							beforeCollAppInMedcrColl, sourceAppIndicator);
				}
			} else {
				// now we are checking this record is CW or RN
				appInMedcrBeforeCargo = medicareBO.splitAppInMedCrCargo(
						beforeCollAppInMedcrColl, AppConstants.CWW_RECORD_IND);
				if (appInMedcrBeforeCargo != null) {
					if (userEndInd == 2) {
						sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
						recordInd = FwConstants.ROWACTION_INSERT;

					} else {
						sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
						recordInd = FwConstants.ROWACTION_INSERT;
					}
				} else {
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					appInMedcrBeforeCargo = medicareBO.splitAppInMedCrCargo(
							beforeCollAppInMedcrColl, sourceAppIndicator);
				}
			}
			appInMedcrCargo.setApp_num(appNum);
			//
			appInMedcrCargo.setIndv_seq_num(appInMedcrBeforeCargo
					.getIndv_seq_num());
			appInMedcrCargo.setSeq_num(appInMedcrBeforeCargo.getSeq_num());
			appInMedcrCargo.setSrc_app_ind(sourceAppIndicator);
			appInMedcrCargo = (APP_IN_MEDCR_Cargo) isChanged(
					appInMedcrBeforeCargo, appInMedcrCargo);

			appInMedcrCargo.setRowAction(recordInd);
			// PersistData if the cargo is dirty
			if (appInMedcrCargo.isDirty()) {
				medCareUpdate = true;
			}
		} else {
			sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
			appInMedcrCargo.setIndv_seq_num(String
					.valueOf(categorySeqDetailBean.getIndividualSequence()));
			// get the MAX seq number from data base
			medcrSeqNum = medicareBO.getMaxPolicySeqNumber(appNum, indvSeqNum);
			medcrSeqNum = medcrSeqNum + 1;
			appInMedcrCargo.setSeq_num(String.valueOf(medcrSeqNum));
			appInMedcrCargo.setSrc_app_ind(sourceAppIndicator);
			recordInd = FwConstants.ROWACTION_INSERT;
			appInMedcrCargo.setRowAction(recordInd);
			medCareUpdate = true;
			categorySelectionProfileManager.updateSequence(appInMedcrProfile,
					null, categorySeqDetailBean.getIndividualSequence(),
					medcrSeqNum, categorySeqDetailBean.getCategoryType());
		}

		if (medCareUpdate) {
			medicareBO.storeMedicareDetails(appInMedcrColl);
		}
		final boolean loopingQuestion = false;
		if (!loopingQuestion
				&& categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
					.getProfile(rmcInPrflColl, String
							.valueOf(categorySeqDetailBean
									.getIndividualSequence()));

			if (rmcInPrflCargo != null) {
				rmcResponseProfileManager.makeComplete(
						rmcResponseProfileManager.getResponseByType(
								IRMCResponseProfileManager.RECEIVE_MEDICARE,
								categorySeqDetailBean.getCategoryType()),
								rmcInPrflCargo, true);
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1,1 lines Commented
				 * Code in this block
				 */

			}
		}
		// Mark complete job sequence using common methods
		categorySelectionProfileManager.makeSequenceDetailComplete(
				appInMedcrProfile, null,
				categorySeqDetailBean.getIndividualSequence(),
				categorySeqDetailBean.getCategorySequence(),
				categorySeqDetailBean.getCategoryType());
		if (categorySelectionProfile != null) {
			categorySelectionProfileManager.makeSequenceDetailComplete(
					categorySelectionProfile, appNum,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
		}

		if (categorySelectionProfileManager
				.areAllSequencesComplete(appInMedcrProfile)) {
			driverManager.makeComplete(FwConstants.RMC_DRIVER, currentPageID,
					driverArray, appNum);
		} else {
			categorySelectionProfileManager
			.getNextSequenceDetail(appInMedcrProfile);
		}
		session.remove(AppConstants.APP_IN_MEDCR_COLLECTION);
		session.put(AppConstants.APP_IN_MEDCR_COLLECTION, appInMedcrColl);

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::storeHouseHoldInfoMedicareDetails:End");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoMedicareDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load HouseHoldInfo Summary.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadHouseHoldInfoSummary(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoSummary() - START");
		try {
			final Map pageCollection = txnBean.getPageCollection();
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			boolean isAnyChanges = false;
			Map beforeColl = null;

			final Map httpSessionMap = (Map) session
					.get(FwConstants.HTTP_SESSION);
			final String languageCd = (String) httpSessionMap
					.get(AppConstants.LANGUAGE);
			final String jsEnabled = (String) httpSessionMap
					.get(FwConstants.JS_ENABLED);

			request.get(FwConstants.CURRENT_PAGE_ID);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			if (session.containsKey(AppConstants.RMC_CATEGORY_PAGE_PRFL)) {
				session.remove(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}
			final String applicationType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);

			SortedSet selectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			boolean loadCatSelProfile = false;
			if ((selectionProfile == null || selectionProfile.isEmpty())
					&& driverStatus != FwConstants.DRIVER_NOT_REQUIRED) {
				loadCatSelProfile = true;
			} else if (selectionProfile != null && !selectionProfile.isEmpty()) {

				CategorySequenceDetail catSeqDetail = categorySelectionProfileManager
						.getCurrentSequenceDetail(selectionProfile);
				if (catSeqDetail == null) {
					catSeqDetail = categorySelectionProfileManager
							.getNextSequenceDetail(selectionProfile);
					if (catSeqDetail != null
							&& !"null".equals(catSeqDetail
									.getChangeSelectionCategoryCd())
									&& AppConstants.RMC_CAT_HO_COMP_PRFL
									.equals(catSeqDetail
											.getChangeSelectionCategoryCd())) {
						loadCatSelProfile = false;
					} else {
						loadCatSelProfile = true;
					}
				}
			}

			if (loadCatSelProfile) {
				selectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNum,
								AppConstants.RMC_CAT_HO_COMP_PRFL);
			}
			categorySelectionProfileManager
			.resetCurrentSeqeunceDetail(selectionProfile);

			final String appType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);

			/* Contact Info ListView Begin */
			final ABRegistrationSummaryBO registrationSummaryBO = new ABRegistrationSummaryBO();
			final MovedInBO movedInBO = new MovedInBO();
			final APP_RGST_Collection appRgstCollection = registrationSummaryBO
					.loadRegistrationSummary(appNum);
			final APP_INDV_Collection appIndvColl = movedInBO
					.loadAppIndvColl(appNum);

			final int sizeRegColl = appRgstCollection.size();
			String newOrModifiedExists = FwConstants.NO;
			if (FwConstants.NO.equals(newOrModifiedExists)) {
				for (int i = 0; i < sizeRegColl; i++) {
					APP_RGST_Cargo appRgstCargo = new APP_RGST_Cargo();
					appRgstCargo = appRgstCollection.getCargo(i);
					if (AppConstants.RMC_NEW_RECORD_IND.equals(appRgstCargo
							.getSrc_app_ind())
							|| AppConstants.RMC_MODIFIED_RECORD_IND
							.equals(appRgstCargo.getSrc_app_ind())) {
						newOrModifiedExists = FwConstants.YES;
					}
				}
			}

			final RMCContactInfoSummaryListView contactInfoListView = new RMCContactInfoSummaryListView();

			contactInfoListView.setRegCollection(appRgstCollection);
			contactInfoListView.setIndvCollection(appIndvColl);
			contactInfoListView.setAppType(appType);
			contactInfoListView.setLanguage(languageCd);
			contactInfoListView
			.setName("ARHouseHoldInfoSummaryListView_ListView");
			contactInfoListView.setDisplayData(appRgstCollection);
			contactInfoListView.setPageSize(1000);

			pageCollection.put("ARHouseHoldInfoSummaryListView_ListView",
					contactInfoListView);
			pageCollection.put("APP_RGST_Collection", appRgstCollection);
			pageCollection.put("APP_INDV_Collection", appIndvColl);
			/* Contact Info ListView End */

			/* Moved Out Details ListView Begin */
			final LivingArrangementBO livingArrBO = new LivingArrangementBO();
			final APP_INDV_Collection prsnLeftTheHomeColl = livingArrBO
					.loadMoveOutCollection(appNum);
			final ARLeftTheHomeSummaryListView leftTheHomeDtlsListView = new ARLeftTheHomeSummaryListView();
			leftTheHomeDtlsListView.setLanguage(languageCd);
			leftTheHomeDtlsListView.setJsEnabled(jsEnabled);
			leftTheHomeDtlsListView.setDisplayData(prsnLeftTheHomeColl);
			leftTheHomeDtlsListView
			.setName("ARLeftTheHomeSummaryListView_ListView");
			leftTheHomeDtlsListView.setPageSize(100);
			final int[] leftTheHomeDtlsDataType = {
					IListviewFormatter.stringCol, IListviewFormatter.stringCol,
					IListviewFormatter.stringCol };
			leftTheHomeDtlsListView.setColDataType(leftTheHomeDtlsDataType);
			if (leftTheHomeDtlsListView.getDisplayData().length != 0) {
				isAnyChanges = true;
			}
			pageCollection.put("ARLeftTheHomeSummaryListView_ListView",
					leftTheHomeDtlsListView);
			pageCollection.put("ARHCS_LEFTHOME_DETAILS_COLLECTION",
					prsnLeftTheHomeColl);
			/* Moved Out Details ListView End */
			
			//show individuals who are on the case(in WP or only CW records)
			INDIVIDUAL_Custom_Collection indvCustomColl = new INDIVIDUAL_Custom_Collection();
			INDIVIDUAL_Custom_Collection filIndvCustomColl = new INDIVIDUAL_Custom_Collection();
			indvCustomColl.setResults(peopleHandler.getAllIndividuals().cloneResults());
			MovedInBO movedInBo = new MovedInBO();
			APP_INDV_Collection cwIndvColl = splitCollection(appIndvColl, AppConstants.CWW_RECORD_IND);
			
			for(Object o: indvCustomColl) {
				INDIVIDUAL_Custom_Cargo indvCustCargo = (INDIVIDUAL_Custom_Cargo) o;
				
				for(Object p: cwIndvColl) {
					APP_INDV_Cargo indvCargo = (APP_INDV_Cargo) p;
					if(indvCustCargo.getIndv_seq_num().equalsIgnoreCase(indvCargo.getIndv_seq_num())) {
						filIndvCustomColl.add(indvCustCargo);
						break;
					}
				}
				
			}
			pageCollection.put("PEOPLE_20055", filIndvCustomColl);

			/* PCR 35980 - get listView for HMO Change */
			final Object rmcHMOUpdObj = session
					.get(AppConstants.RMC_HMO_UPDATE);
			final boolean rmcHMOUpdate = rmcHMOUpdObj != null ? ((Boolean) rmcHMOUpdObj)
					.booleanValue() : false;
					pageCollection.put("HMO_CHANGE_DISPLAY_FLAG",
							String.valueOf(rmcHMOUpdate));

					/* Death Details ListView Begin */
					final INDV_LIVE_CHG_Collection deathDtlColl = livingArrBO
							.loadLivingArrangementDetailsByLiveArrType(appNum,
									AppConstants.SOMEONE_DIED);

					final ARDeathDetailsSummaryListView dthDtlsListView = new ARDeathDetailsSummaryListView();
					dthDtlsListView.setLanguage(languageCd);
					dthDtlsListView.setJsEnabled(jsEnabled);
					dthDtlsListView.setDisplayData(deathDtlColl);
					dthDtlsListView.setName("ARDeathDetailsSummaryListView_ListView");
					dthDtlsListView.setPageSize(100);
					final boolean[] sortableCols1 = new boolean[3];
					dthDtlsListView.setSortableColumns(sortableCols1);
					final int[] dataType1 = { IListviewFormatter.stringCol,
							IListviewFormatter.stringCol, IListviewFormatter.stringCol };
					dthDtlsListView.setColDataType(dataType1);
					if (dthDtlsListView.getDisplayData().length != 0) {
						isAnyChanges = true;
					}
					pageCollection.put("ARDeathDetailsSummaryListView_ListView",
							dthDtlsListView);
					pageCollection.put("ARHCS_DEATH_DTL_COLLECTION", deathDtlColl);
					/* Death Details ListView End */


					/* Pregnancy Details Listview Begin */

					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code in
					 * this block
					 */

					final PregnancyBO pregnancyBO = new PregnancyBO();
					final ARPregChangeDtlsSummaryListView pregEndDtlsListView = new ARPregChangeDtlsSummaryListView();
					pregEndDtlsListView.setLanguage(languageCd);
					pregEndDtlsListView.setAppType(applicationType);
					pregEndDtlsListView.setDisplayData(appNum);
					pregEndDtlsListView.setJsEnabled(jsEnabled);
					pregEndDtlsListView
					.setName("ARPregChangeDtlsSummaryListView_ListView");
					pregEndDtlsListView.setPageSize(100);

					final int[] pregChgDtlsDataType = { IListviewFormatter.stringCol,
							IListviewFormatter.stringCol, IListviewFormatter.stringCol };
					pregEndDtlsListView.setColDataType(pregChgDtlsDataType);

					if (pregEndDtlsListView.getDisplayData().length != 0) {
						isAnyChanges = true;
					}
					pageCollection.put("ARPregChangeDtlsSummaryListView_ListView",
							pregEndDtlsListView);

					APP_IN_PREG_Collection appInPregColl = pregnancyBO
							.loadPregnancyDetails(appNum);
					pageCollection.put("ARHCS_PREG_CHG_DTLS_COLLECTION", appInPregColl);

					final INDIVIDUAL_Custom_Collection newAppPregEndColl = new INDIVIDUAL_Custom_Collection();
					final INDIVIDUAL_Custom_Collection indvCustColl = peopleHandler
							.getInHomeIndividuals();
					int indvCollSize = indvCustColl.size();
					for (int i = 0; i < indvCollSize; i++) {
						final INDIVIDUAL_Custom_Cargo indvCargo = indvCustColl
								.getResult(i);
						if (RulesBO.isFemale(indvCargo)
								&& RulesBO.isBetweenAges(indvCargo.getIndv_age(), 10,
										RulesBO.OPERAND_GREATER_THAN_EQUAL, 200,
										RulesBO.OPERAND_LESS_THAN)) {
							final INDIVIDUAL_Custom_Cargo appIndvCargo = new INDIVIDUAL_Custom_Cargo();
							boolean dataExists = false;
							for (int j = 0; j < appInPregColl.size(); j++) {
								final APP_IN_PREG_Cargo pregCargo = appInPregColl
										.getCargo(j);
								if (pregCargo.getIndv_seq_num().equals(
										indvCargo.getIndv_seq_num())) {
									if(!dataExists && (AppConstants.RMC_END_RECORD_IND.equals(pregCargo.getSrc_app_ind()) || AppConstants.CWW_RECORD_IND.equals(pregCargo.getSrc_app_ind())))
										dataExists = true ;
									else if(dataExists && (AppConstants.RMC_END_RECORD_IND.equals(pregCargo.getSrc_app_ind()) || AppConstants.CWW_RECORD_IND.equals(pregCargo.getSrc_app_ind())) ){
										dataExists = false ;
										break;
									} else if(!AppConstants.RMC_NEW_RECORD_IND.equals(pregCargo.getSrc_app_ind())) {
									dataExists = true;
									break;
								}
								}

							}
							if (dataExists) {
								appIndvCargo.setRlt_cd(indvCargo.getRlt_cd());
								appIndvCargo.setIndv_seq_num(indvCargo
										.getIndv_seq_num());
								appIndvCargo.setBrth_dt(indvCargo.getBrth_dt());
								appIndvCargo.setIndv_age(indvCargo.getIndv_age());
								appIndvCargo.setSrc_app_ind(indvCargo.getSrc_app_ind());
								appIndvCargo.setFst_nam(indvCargo.getFst_nam());
								appIndvCargo.setMid_init(indvCargo.getMid_init());
								appIndvCargo.setLast_nam(indvCargo.getLast_nam());
								appIndvCargo.setSuffix_name(indvCargo.getSuffix_name());
								newAppPregEndColl.addCargo(appIndvCargo);
							}
						}
					}
					request.put("PEOPLE_5063", newAppPregEndColl);
					pageCollection.put("PEOPLE_5063", newAppPregEndColl);

					final INDIVIDUAL_Custom_Collection newAppPregStartColl = new INDIVIDUAL_Custom_Collection();

					indvCollSize = indvCustColl.size();
					for (int i = 0; i < indvCollSize; i++) {
						final INDIVIDUAL_Custom_Cargo indvCargo = indvCustColl
								.getResult(i);
						if (RulesBO.isFemale(indvCargo)
								&& RulesBO.isBetweenAges(indvCargo.getIndv_age(), 10,
										RulesBO.OPERAND_GREATER_THAN_EQUAL, 200,
										RulesBO.OPERAND_LESS_THAN)) {
							final INDIVIDUAL_Custom_Cargo appIndvCargo = new INDIVIDUAL_Custom_Cargo();
							boolean dataExists = false;
							for (int j = 0; j < appInPregColl.size(); j++) {
								final APP_IN_PREG_Cargo pregCargo = appInPregColl
										.getCargo(j);
								if (pregCargo.getIndv_seq_num().equals(
										indvCargo.getIndv_seq_num())) {
									dataExists = true;
									break;
								}

							}
							if (!dataExists) {
								appIndvCargo.setRlt_cd(indvCargo.getRlt_cd());
								appIndvCargo.setIndv_seq_num(indvCargo
										.getIndv_seq_num());
								appIndvCargo.setBrth_dt(indvCargo.getBrth_dt());
								appIndvCargo.setIndv_age(indvCargo.getIndv_age());
								appIndvCargo.setSrc_app_ind(indvCargo.getSrc_app_ind());
								appIndvCargo.setFst_nam(indvCargo.getFst_nam());
								appIndvCargo.setMid_init(indvCargo.getMid_init());
								appIndvCargo.setLast_nam(indvCargo.getLast_nam());
								appIndvCargo.setSuffix_name(indvCargo.getSuffix_name());
								newAppPregStartColl.addCargo(appIndvCargo);
							}
						}
					}
					request.put("PEOPLE_5268", newAppPregStartColl);
					pageCollection.put("PEOPLE_5268", newAppPregStartColl);
					/* Pregnancy Details Listview End */

					/* SomeOne Moved In ListView Begin */
					final APP_INDV_Collection movedInCollection = getMovedInIndvColl(appIndvColl);
					final ARAddPersonDtlsSummaryListView addPrsnDtlsListView = new ARAddPersonDtlsSummaryListView();
					addPrsnDtlsListView.setLanguage(languageCd);
					addPrsnDtlsListView.setJsEnabled(jsEnabled);
					addPrsnDtlsListView.setPeopleHandler(peopleHandler);
					addPrsnDtlsListView.setDisplayData(movedInCollection);
					addPrsnDtlsListView
					.setName("ARAddPersonDtlsSummaryListView_ListView");
					addPrsnDtlsListView.setPageSize(100);
					pageCollection.put("ARAddPersonDtlsSummaryListView_ListView",
							addPrsnDtlsListView);
					pageCollection.put("ARHCS_ADD_PRSN_DTLS_COLLECTION",
							movedInCollection);
					/* SomeOne Moved In ListView End */

					/* Disability Listview Begin */
					final DisabilityBO disabilityBO = new DisabilityBO();
					APP_IN_DABL_Collection appInDablColl = null;
					appInDablColl = disabilityBO.loadDisability(appNum);

					final ARAddDisabilityDtlsSummaryListView addDablDtlsListView = new ARAddDisabilityDtlsSummaryListView();
					addDablDtlsListView.setLanguage(languageCd);
					addDablDtlsListView.setJsEnabled(jsEnabled);
					addDablDtlsListView.setCollection(appInDablColl);
					addDablDtlsListView.setAppType(applicationType);
					addDablDtlsListView.setDisplayData(appInDablColl);
					addDablDtlsListView
					.setName("ARAddDisabilityDtlsSummaryListView_ListView");
					addDablDtlsListView.setPageSize(100);
					pageCollection.put("ARHCS_ADD_DABL_DTLS_COLLECTION", appInDablColl);
					pageCollection.put("ARAddDisabilityDtlsSummaryListView_ListView",
							addDablDtlsListView);

					final INDIVIDUAL_Custom_Collection indvCustCollDis = peopleHandler
							.getInHomeIndividuals();
					final INDIVIDUAL_Custom_Collection newAppIndvColl = new INDIVIDUAL_Custom_Collection();
					final int indvCollSizeDis = indvCustCollDis.size();

					for (int i = 0; i < indvCollSizeDis; i++) {
						final INDIVIDUAL_Custom_Cargo indvCargo = indvCustCollDis
								.getResult(i);
						final INDIVIDUAL_Custom_Cargo appIndvCargo = new INDIVIDUAL_Custom_Cargo();
						boolean dataExists = false;
						for (int j = 0; j < appInDablColl.size(); j++) {
							final APP_IN_DABL_Cargo dablCargo = appInDablColl
									.getCargo(j);
							if (dablCargo.getIndv_seq_num().equals(
									indvCargo.getIndv_seq_num())) {
								dataExists = true;
								break;
							}

						}
						if (!dataExists) {

							appIndvCargo.setRlt_cd(indvCargo.getRlt_cd());
							appIndvCargo.setIndv_seq_num(indvCargo.getIndv_seq_num());
							appIndvCargo.setBrth_dt(indvCargo.getBrth_dt());
							appIndvCargo.setIndv_age(indvCargo.getIndv_age());
							appIndvCargo.setSrc_app_ind(indvCargo.getSrc_app_ind());
							appIndvCargo.setFst_nam(indvCargo.getFst_nam());
							appIndvCargo.setMid_init(indvCargo.getMid_init());
							appIndvCargo.setLast_nam(indvCargo.getLast_nam());
							appIndvCargo.setSuffix_name(indvCargo.getSuffix_name());
							newAppIndvColl.addCargo(appIndvCargo);
						}
					}
					request.put("PEOPLE_5064", newAppIndvColl);
					pageCollection.put("PEOPLE_5064", newAppIndvColl);
					/* Disability Listview End */

					// Summary logic of Household relationship section
					final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
							.getSortedIndividualsByIndvSeqNum();
					final int indvColSize = indvColl.size();
					final String[] indvSeq = new String[indvColSize];
					for (int i = 0; i < indvCollSize; i++) {
						indvSeq[i] = indvColl.getResult(i).getIndv_seq_num();
					}

					// ListView for Drug Felony
					final DrugFelonyBO drugFelonyBO = new DrugFelonyBO();
					final APP_IN_DRUG_FELN_Collection drugFelColl = drugFelonyBO
							.loadDrugFelonyCollection(appNum);
					final RMBDrugFelonySummaryListView rmbDrugFelonListView = new RMBDrugFelonySummaryListView();
					rmbDrugFelonListView.setCollection(drugFelColl);
					rmbDrugFelonListView.setLanguage(languageCd);
					rmbDrugFelonListView.setJsEnabled(jsEnabled);
					if (drugFelColl != null) {
						rmbDrugFelonListView.setDisplayData(drugFelColl);
					}
					rmbDrugFelonListView.setName("RMC_DRUG_FELN_SUMMARY_LISTVIEW");
					final int[] dgDataType = { IListviewFormatter.stringCol,
							IListviewFormatter.stringCol, IListviewFormatter.stringCol };
					rmbDrugFelonListView.setColDataType(dgDataType);
					if (rmbDrugFelonListView.getDisplayData().length != 0) {
						isAnyChanges = true;
					}
					pageCollection.put("APP_IN_DRUG_FELN_Collection", drugFelColl);
					pageCollection.put("RMC_DRUG_FELN_SUMMARY_LISTVIEW",
							rmbDrugFelonListView);

					// help from others
					final HouseHoldInfoBO infoBO = new HouseHoldInfoBO();
					final APP_AR_LG_CNTC_Collection helpColl = infoBO
							.loadHelpFromOthersDetails(appNum);

					final RMBHelpFromOthersSummaryListView helpFromOthersListView = new RMBHelpFromOthersSummaryListView();
					final List dataList = new ArrayList();
					dataList.add(0, helpColl);
					final String response = FwConstants.EMPTY_STRING;
					dataList.add(1, response);
					helpFromOthersListView.setLanguage(languageCd);
					helpFromOthersListView.setDisplayData(dataList);
					helpFromOthersListView.setName("HelpFromOthers_ListView");
					helpFromOthersListView.setPageSize(100);
					pageCollection.put("APP_AR_LG_CNTC_Collection", helpColl);
					pageCollection.put("HelpFromOthers_ListView",
							helpFromOthersListView);
					// get RMB_RQST from session
					final RMB_RQST_Collection rmbRqstColl = (RMB_RQST_Collection) session
							.get(AppConstants.RMB_RQST_COLLECTION);
					String helpFrmOtherResp = FwConstants.EMPTY_STRING;
					if (rmbRqstColl != null) {
						final RMB_RQST_Cargo rmbRqstCargo = rmbRqstColl.getCargo(0);
						if (FwConstants.YES
								.equals(rmbRqstCargo.getHelp_othr_stat_ind())) {
							helpFrmOtherResp = FwConstants.YES;
						} else if (FwConstants.NO.equals(rmbRqstCargo
								.getHelp_othr_stat_ind())) {
							helpFrmOtherResp = FwConstants.NO;
						}
					}
					pageCollection.put("HelpFromOthers_Response", helpFrmOtherResp);

					/* Relationship Listview Begin */
					if (applicationType
							.equals(String.valueOf(FwConstants.RMC_APP_TYPE))) {
						final RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
								.get(AppConstants.RMC_RQST);

						final HouseHoldRelationshipBO houseHoldRelationshipBO = new HouseHoldRelationshipBO();
						final APP_HSHL_RLT_Collection appHshlRltCollection = houseHoldRelationshipBO
								.loadHouseholdRelationshipsSummary(appNum);
						final RMCHouseHoldRelationshipsListview relationshipListview = new RMCHouseHoldRelationshipsListview();
						relationshipListview.setPeopleHandler(peopleHandler);
						relationshipListview.setLanguage(languageCd);
						relationshipListview.setDisplayData(appHshlRltCollection);
						relationshipListview.setPageSize(1000);

						pageCollection.put(
								"RMCHouseHoldRelationshipsListview_ListView",
								relationshipListview);
						pageCollection.put("ARHCS_RELATIONSHIP_COLLECTION",
								appHshlRltCollection);

						if (!isAnyChanges
								&& rmcRqstCargo.getEi_chg_sw() != null
								&& !FwConstants.YES.equals(rmcRqstCargo.getEi_chg_sw())
								&& rmcRqstCargo.getHous_util_stat_sw() != null
								&& !FwConstants.YES.equals(rmcRqstCargo
										.getHous_util_stat_sw())
										&& rmcRqstCargo.getOthr_stat_sw() != null
										&& !FwConstants.YES.equals(rmcRqstCargo
												.getOthr_stat_sw())) {

							pageCollection.put("ANY_SELECTIONS", FwConstants.NO);

						} else {
							pageCollection.put("ANY_SELECTIONS", FwConstants.YES);
						}
					} else {
						/*
						 * This method will pull only the records from the database that
						 * are new The listview will filter the people who died and left
						 * the home
						 */
						final HouseHoldRelationshipBO houseHoldRelationshipBO = new HouseHoldRelationshipBO();
						final APP_HSHL_RLT_Collection appHshlRltCollection = houseHoldRelationshipBO
								.loadHouseholdRelationshipsSummary(appNum);
						final RMCHouseHoldRelationshipsListview relationshipListview = new RMCHouseHoldRelationshipsListview();
						relationshipListview.setPeopleHandler(peopleHandler);
						relationshipListview.setLanguage(languageCd);
						relationshipListview.setDisplayData(appHshlRltCollection);
						relationshipListview.setPageSize(1000);

						pageCollection.put(
								"RMCHouseHoldRelationshipsListview_ListView",
								relationshipListview);
						pageCollection.put("ARHCS_RELATIONSHIP_COLLECTION",
								appHshlRltCollection);
						// END - Household relationships - Matt
					}
					/* Relationship Listview End */
						final APP_INDV_Collection appIndvColl2 = movedInBO
								.getHouseHoldMemberDetails(appNum);
						/*
						 * VG SONAR Cleanup - 08/31/2015 Deleted 2,1 lines Commented
						 * Code in this block
						 */

						final RMBHouseHoldMemberListView householdMemberListView = new RMBHouseHoldMemberListView();
						final int appIndvCollSize = appIndvColl2 != null ? appIndvColl2
								.size() : 0;
								householdMemberListView.setLanguage(languageCd);
								householdMemberListView.setJsEnabled(jsEnabled);
								householdMemberListView.sethhCollection(appIndvColl2);
								if (appIndvColl2 != null) {
									householdMemberListView.setDisplayData(appIndvColl2);
								}
								householdMemberListView
								.setName("RMB_HOUSEHOLD_SUMMARY_LISTVIEW");
								final int[] hhDataType = { IListviewFormatter.stringCol,
										IListviewFormatter.stringCol,
										IListviewFormatter.stringCol };
								householdMemberListView.setColDataType(hhDataType);
								if (householdMemberListView.getDisplayData().length != 0) {
									isAnyChanges = true;
								}
								pageCollection.put("APP_IN_INDV_Collection", appIndvColl2);

								pageCollection.put("RMB_HOUSEHOLD_SUMMARY_LISTVIEW",
										householdMemberListView);
								pageCollection.put("INDIVIDUAL_ON_CASE_Collection",
										String.valueOf(appIndvCollSize));

					

					/* prepare drug felony add individuals list - start */
					if (applicationType
							.equals(String.valueOf(FwConstants.RMB_APP_TYPE))) {
						final INDIVIDUAL_Custom_Collection people5260 = peopleHandler
								.getAllIndividuals();

						pageCollection.put("PEOPLE_5260", people5260);
					}
					boolean drugFelRequired = false;
					final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					if (!applicationType.equals(String
							.valueOf(FwConstants.RMC_APP_TYPE))) {

						if (rmcInPrflColl != null) {
							final int size = rmcInPrflColl.size();
							for (int i = 0; i < size; i++) {
								final RMC_IN_PRFL_Cargo cargo = rmcInPrflColl
										.getCargo(i);
								if (cargo.getDrug_feln_resp() != null) {
									if ("C".equals(cargo.getDrug_feln_resp())
											|| "V".equals(cargo.getDrug_feln_resp())) {
										drugFelRequired = true;
										break;
									}
								}
							}
						}

					}
					pageCollection.put("DFREQ", String.valueOf(drugFelRequired));
					/* prepare drug felony add individuals list - ends */

					/* Probation/Parole Listview Begin */
					final RMC_IN_PRFL_Collection rmcInPrflCollPP = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					final RMBProbationParoleSummaryListView pPListView = new RMBProbationParoleSummaryListView();
					pPListView.setLanguage(languageCd);
					pPListView.setPageSize(100);
					pPListView.setJsEnabled(jsEnabled);
					pPListView.setName("PROBATION_PAROLE");
					pPListView.setDisplayData(rmcInPrflCollPP);

					pageCollection.put("RMC_IN_PRFL_Collection_PP", rmcInPrflCollPP);
					pageCollection.put("RMBProbationParoleSummaryListView", pPListView);

					final INDIVIDUAL_Custom_Collection peopleProbationParoleBefore = peopleHandler
							.getAllIndividuals();
					final INDIVIDUAL_Custom_Collection peopleProbationParoleAfter = new INDIVIDUAL_Custom_Collection();
					INDIVIDUAL_Custom_Cargo tempIndvCargoPP;
					String indivIsnPP;
					String rmcIndivIsnPP;
					String rmcIndivRespPP;
					for (int x = 0; x < peopleProbationParoleBefore.size(); x++) {
						tempIndvCargoPP = peopleProbationParoleBefore.getResult(x);
						indivIsnPP = tempIndvCargoPP.getIndv_seq_num();

						for (int y = 0; y < rmcInPrflCollPP.size(); y++) {
							rmcIndivIsnPP = rmcInPrflCollPP.getCargo(y)
									.getIndv_seq_num();
							rmcIndivRespPP = rmcInPrflCollPP.getCargo(y)
									.getParole_violation_resp();

							if (indivIsnPP != null && rmcIndivIsnPP != null
									&& indivIsnPP.equals(rmcIndivIsnPP)
									&& !AppConstants.YES.equals(rmcIndivRespPP)) {
								peopleProbationParoleAfter.addCargo(tempIndvCargoPP);
								break;
							}
						}
					}

					pageCollection.put("people_ProbationParole",
							peopleProbationParoleAfter);
					/* Probation/Parole Listview Begin */

					/* Roomer/Boarder ListView Begin */
					final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					pageCollection.put("RMC_IN_PRFL_Collection_RB", rmcInPrflCollRB);

					final INDIVIDUAL_Custom_Collection peopleRoomBoardBefore = peopleHandler
							.getAllIndividuals();
					final INDIVIDUAL_Custom_Collection peopleRoomBoardAfter = new INDIVIDUAL_Custom_Collection();
					INDIVIDUAL_Custom_Cargo tempIndvCargo;
					String indivISN;
					String rmcIndivISN;
					String rmcIndivResp;
					for (int x = 0; x < peopleRoomBoardBefore.size(); x++) {
						tempIndvCargo = peopleRoomBoardBefore.getResult(x);
						indivISN = tempIndvCargo.getIndv_seq_num();

						for (int y = 0; y < rmcInPrflCollRB.size(); y++) {
							rmcIndivISN = rmcInPrflCollRB.getCargo(y).getIndv_seq_num();
							rmcIndivResp = rmcInPrflCollRB.getCargo(y)
									.getRoom_board_resp();

							if (indivISN != null && rmcIndivISN != null
									&& indivISN.equals(rmcIndivISN)
									&& !AppConstants.YES.equals(rmcIndivResp)) {
								peopleRoomBoardAfter.addCargo(tempIndvCargo);
								break;
							}
						}
					}

					pageCollection.put("people_RoomBoard", peopleRoomBoardAfter);
					/* Roomer/Boarder ListView End */

					/* Head Of Household Listview Begin */
					final RMC_IN_PRFL_Collection rmcInPrflCollHOH = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					final ARHeadOfHouseholdSummaryListView hOHListView = new ARHeadOfHouseholdSummaryListView();
					hOHListView.setLanguage(languageCd);
					hOHListView.setPageSize(100);
					hOHListView.setJsEnabled(jsEnabled);
					hOHListView.setName("HEAD_OF_HOUSEHOLD");
					hOHListView.setDisplayData(rmcInPrflCollHOH);

					pageCollection.put("RMC_IN_PRFL_Collection_HOH", rmcInPrflCollHOH);
					pageCollection.put("ARHeadOfHouseholdSummaryListView", hOHListView);
					pageCollection.put("people_HOH", peopleHandler.getAllIndividuals());
					/* Head Of Household Listview Begin */

					/*---- Caretaker Non- Parent - Start */
					componentManager.getComponents("ARHCS", txnBean);


					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code in
					 * this block
					 */

					peopleHandler.getInHomeIndividuals();

					/* Absent Parent Details Begin */
					if (applicationType
							.equals(String.valueOf(FwConstants.RMC_APP_TYPE))
							|| applicationType.equals(String
									.valueOf(FwConstants.RMB_APP_TYPE))) {

						final AbsentParentBO absentParentBO = new AbsentParentBO();

						final APP_IN_ABSNP_Collection appInAbsnpColl = absentParentBO
								.loadAbsentParentDetails(appNum);
						final APP_ABS_PRNT_Collection appAbsPrntColl = absentParentBO
								.getAbsentParentPresentDetails(appNum);

						final ARAbsentParentSummaryListView arAbsentParentSummaryListView = new ARAbsentParentSummaryListView();
						arAbsentParentSummaryListView.setAppType(applicationType);
						arAbsentParentSummaryListView.setLanguage(languageCd);
						arAbsentParentSummaryListView.setJsEnabled(jsEnabled);
						arAbsentParentSummaryListView.setAppAbsPrntColl(appAbsPrntColl);						
						arAbsentParentSummaryListView.setDisplayData(appInAbsnpColl);
						log(ILog.INFO, "RMCHouseHoldInfoEJBBean.loadHouseHoldInfoSummary() after arAbsentParentSummaryListView.setDisplayData");
						arAbsentParentSummaryListView
						.setName("RMBAbsentparentSummaryListView_ListView");
						arAbsentParentSummaryListView.setPageSize(100);

						arAbsentParentSummaryListView
						.setColDataType(pregChgDtlsDataType);
						if (arAbsentParentSummaryListView.getDisplayData().length != 0) {
							isAnyChanges = true;
						}
						pageCollection.put("RMBAbsentparentSummaryListView_ListView",
								arAbsentParentSummaryListView);
						pageCollection.put("APP_IN_ABSNP_Collection", appInAbsnpColl);

					}
					/* Absent Parent Details End */

					request.put("PEOPLE_5063", newAppPregEndColl);
					pageCollection.put("PEOPLE_5063", newAppPregEndColl);


					final TaxClaimDependantBO taxClaimDependantBO = new TaxClaimDependantBO();
					final CP_APP_IN_TAX_INFORMATION_Collection appInTaxCollection = taxClaimDependantBO
							.loadTaxClaimDependantInfo(appNum);
					final TaxReturnBO taxReturnBO = new TaxReturnBO();
					final CP_APP_IN_TAX_RETURN_Collection appInTaxReturnCollection = taxReturnBO
							.loadTaxReturnInfo(appNum);
					final RMBAddTaxInformationSummaryListView taxReturnListView = new RMBAddTaxInformationSummaryListView();

					taxReturnListView.setLanguage(languageCd);
					taxReturnListView.setJsEnabled(jsEnabled);
					final Map additionalTaxReturnInfo = new HashMap();

					additionalTaxReturnInfo.put(
							AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
							appInTaxReturnCollection);
					taxReturnListView.setAdditionalInfo(additionalTaxReturnInfo);
					taxReturnListView.setTaxCollection(appInTaxReturnCollection);
					taxReturnListView.setDisplayData(appInTaxReturnCollection);
					taxReturnListView.setName("RMBAddTaxInformationSummaryListView");
					final int[] dataTypeTaxReturn = { IListviewFormatter.stringCol,
							IListviewFormatter.stringCol, IListviewFormatter.stringCol };
					taxReturnListView.setColDataType(dataTypeTaxReturn);
					pageCollection.put("RMBAddTaxInformationSummaryListView",
							taxReturnListView);
					pageCollection.put(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
							appInTaxReturnCollection);

					final String[] indvIds = new String[appInTaxReturnCollection.size()];
					for (int k = 0; k < appInTaxReturnCollection.size(); k++) {
						if (FwConstants.YES.equalsIgnoreCase(appInTaxReturnCollection
								.getCargo(k).getJointly_file_sw())) {
							indvIds[k] = appInTaxReturnCollection.getCargo(k)
									.getSpouse_indv_id();
						}
					}
					pageCollection.put(AppConstants.SPOUSE_INDV_IDS, indvIds);

					final INDIVIDUAL_Custom_Collection indvCustCollTaxReturn = peopleHandler
							.getInHomeIndividuals();
					final INDIVIDUAL_Custom_Collection newAppIndvCollTaxReturn = new INDIVIDUAL_Custom_Collection();
					int indvCollSizeTaxReturn = indvCustCollTaxReturn.size();
					/*
					 * Remove the tax claimers from list of tax filers
					 * */
					INDIVIDUAL_Custom_Collection custTaxIndvToRemove=null;
					if(null != appInTaxCollection && !appInTaxCollection.isEmpty())
					{
						custTaxIndvToRemove= new INDIVIDUAL_Custom_Collection();
					for (int i = 0; i < indvCollSizeTaxReturn; i++) {
							INDIVIDUAL_Custom_Cargo indvCargo = indvCustCollTaxReturn
								.getResult(i);
							for(int j=0;j<appInTaxCollection.size();j++)
							{
							CP_APP_IN_TAX_INFORMATION_Cargo taxInfoCargo=appInTaxCollection.getCargo(j);
							if(null!=taxInfoCargo && taxInfoCargo.getIndv_seq_num().equals(indvCargo.getIndv_seq_num())){
								custTaxIndvToRemove.add(indvCargo);
							}
							}							
						}
						if(null!=custTaxIndvToRemove)
							indvCustCollTaxReturn.removeAll(custTaxIndvToRemove);
					}
					for (int i = 0; i < indvCustCollTaxReturn.size(); i++) {
						final INDIVIDUAL_Custom_Cargo taxReturnindvCargo = indvCustCollTaxReturn
								.getResult(i);
						final INDIVIDUAL_Custom_Cargo taxReturnappIndvCargo = new INDIVIDUAL_Custom_Cargo();
						boolean taxReturndataExists = false;
						for (int j = 0; j < appInTaxReturnCollection.size(); j++) {
							final CP_APP_IN_TAX_RETURN_Cargo lostHealthCargo = appInTaxReturnCollection
									.getCargo(j);
							if (lostHealthCargo.getIndv_seq_num().equals(
									taxReturnindvCargo.getIndv_seq_num())) {
								taxReturndataExists = true;
								break;
							}

						}
						if (!taxReturndataExists) {
							taxReturnappIndvCargo.setRlt_cd(taxReturnindvCargo
									.getRlt_cd());
							taxReturnappIndvCargo.setIndv_seq_num(taxReturnindvCargo
									.getIndv_seq_num());
							taxReturnappIndvCargo.setBrth_dt(taxReturnindvCargo
									.getBrth_dt());
							taxReturnappIndvCargo.setIndv_age(taxReturnindvCargo
									.getIndv_age());
							taxReturnappIndvCargo.setSrc_app_ind(taxReturnindvCargo
									.getSrc_app_ind());
							taxReturnappIndvCargo.setFst_nam(taxReturnindvCargo
									.getFst_nam());
							taxReturnappIndvCargo.setMid_init(taxReturnindvCargo
									.getMid_init());
							taxReturnappIndvCargo.setLast_nam(taxReturnindvCargo
									.getLast_nam());
							taxReturnappIndvCargo.setSuffix_name(taxReturnindvCargo
									.getSuffix_name());
							newAppIndvCollTaxReturn.addCargo(taxReturnappIndvCargo);
						}
					}
					request.put("PEOPLE_6001", newAppIndvCollTaxReturn);
					pageCollection.put("PEOPLE_6001", newAppIndvCollTaxReturn);
					// NextGen NG-6481 Phase 2 updates to ACA Streamline changes  end

					// NextGen NG-5805 ACA Streamline changes  start



					final RMBAddTaxClaimDependentSummaryListView taxClaimDependentListView = new RMBAddTaxClaimDependentSummaryListView();

					taxClaimDependentListView.setLanguage(languageCd);
					taxClaimDependentListView.setJsEnabled(jsEnabled);
					final Map additionalTaxInfo = new HashMap();
					
					additionalTaxInfo.put(
							AppConstants.CP_APP_IN_TAX_INFORMATION_COLLECTION,
							appInTaxCollection);
					taxClaimDependentListView.setAdditionalInfo(additionalTaxInfo);
					taxClaimDependentListView.setTaxCollection(appInTaxCollection);
					taxClaimDependentListView.setDisplayData(appInTaxCollection);
					taxClaimDependentListView
					.setName("RMBAddTaxClaimDependentSummaryListView");
					final int[] dataTypeTax = { IListviewFormatter.stringCol,
							IListviewFormatter.stringCol, IListviewFormatter.stringCol };
					taxClaimDependentListView.setColDataType(dataTypeTax);
					pageCollection.put("RMBAddTaxClaimDependentSummaryListView",
							taxClaimDependentListView);
					pageCollection.put(
							AppConstants.CP_APP_IN_TAX_INFORMATION_COLLECTION,
							appInTaxCollection);

					final INDIVIDUAL_Custom_Collection indvCustCollTax = peopleHandler
							.getInHomeIndividuals();
					final INDIVIDUAL_Custom_Collection newAppIndvCollTax = new INDIVIDUAL_Custom_Collection();
					int indvCollSizeTax = indvCustCollTax.size();
					/*
					 * Remove the tax filers from list of tax claimers
					 * */
					INDIVIDUAL_Custom_Collection custIndvToRemove=null;
					if(null != appInTaxReturnCollection && !appInTaxReturnCollection.isEmpty())
					{
						custIndvToRemove= new INDIVIDUAL_Custom_Collection();
						for (int i = 0; i < indvCollSizeTax; i++) {
							INDIVIDUAL_Custom_Cargo indvCargo = indvCustCollTax
								.getResult(i);
							for(int j=0;j<appInTaxReturnCollection.size();j++)
							{
							CP_APP_IN_TAX_RETURN_Cargo taxReturnCargo=appInTaxReturnCollection.getCargo(j);
							if(null!=taxReturnCargo && taxReturnCargo.getIndv_seq_num().equals(indvCargo.getIndv_seq_num())){
								custIndvToRemove.add(indvCargo);
							}
							}							
						}
						if(null!=custIndvToRemove)
							indvCustCollTax.removeAll(custIndvToRemove);
					}

					for (int i = 0; i < indvCustCollTax.size(); i++) {
						final INDIVIDUAL_Custom_Cargo indvCargo = indvCustCollTax
								.getResult(i);
						final INDIVIDUAL_Custom_Cargo appIndvCargo = new INDIVIDUAL_Custom_Cargo();
						boolean dataExists = false;
						for (int j = 0; j < appInTaxCollection.size(); j++) {
							final CP_APP_IN_TAX_INFORMATION_Cargo taxClaimCargo = appInTaxCollection
									.getCargo(j);
							if (taxClaimCargo.getIndv_seq_num().equals(
									indvCargo.getIndv_seq_num())) {
								dataExists = true;
								break;
							}

						}
						if (!dataExists) {

							appIndvCargo.setRlt_cd(indvCargo.getRlt_cd());
							appIndvCargo.setIndv_seq_num(indvCargo.getIndv_seq_num());
							appIndvCargo.setBrth_dt(indvCargo.getBrth_dt());
							appIndvCargo.setIndv_age(indvCargo.getIndv_age());
							appIndvCargo.setSrc_app_ind(indvCargo.getSrc_app_ind());
							appIndvCargo.setFst_nam(indvCargo.getFst_nam());
							appIndvCargo.setMid_init(indvCargo.getMid_init());
							appIndvCargo.setLast_nam(indvCargo.getLast_nam());
							appIndvCargo.setSuffix_name(indvCargo.getSuffix_name());
							newAppIndvCollTax.addCargo(appIndvCargo);
						}
					}
					request.put("PEOPLE_5998", newAppIndvCollTax);
					pageCollection.put("PEOPLE_5998", newAppIndvCollTax);
					final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl = new RMC_RESPONSE_Custom_Collection();
					
					log(ILog.INFO, "RMCHouseHoldInfoEJBBean.loadHouseHoldInfoSummary() before LoadPregnancyResponseMapsToPageCollection()");
					LoadPregnancyResponseMapsToPageCollection(rmcInPrflColl,
							rmcRspnseCustomColl, pageCollection, peopleHandler, true,
							driverStatus, txnBean);

					txnBean.setPageCollection(pageCollection);
					beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
					if (beforeColl == null) {
						beforeColl = new HashMap();
					}
					beforeColl.putAll(txnBean.getPageCollection());
					if (beforeColl.containsKey(AppConstants.RMC_CATEGORY_PAGE_PRFL)) {
						beforeColl.remove(AppConstants.RMC_CATEGORY_PAGE_PRFL);
					}
					if (beforeColl != null
							&& beforeColl.containsKey(FwConstants.RECORD_ARRAY)) {
						beforeColl.remove(FwConstants.RECORD_ARRAY);
					}
					
					INDIVIDUAL_Custom_Collection indvCollCare = peopleHandler
							.getSortedIndividualsByIndvSeqNum();
					pageCollection.put("INDV_SRC_CUST_Collection", indvCollCare);
					
					
					session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
					session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
							selectionProfile);
					log(ILog.INFO,
							"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoSummary() before populateCareTaker()");
					populateCareTaker(txnBean,true);
					txnBean.setSession(session);
					

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoSummary");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoSummary");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoSummary", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoSummary");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoSummary() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Adds the tax information details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addTaxInformationDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.addTaxInformationDetails() - START");

		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			request.put("firstName_MAPP", null);
			// short array for appProfile (someone outside the home)
			final short[] appPrflArray = new short[1];
			appPrflArray[0] = IAppProfileManager.POLICY_HOLDER_OTHER_RESP;
			final String[] appPrflResponseArray = new String[1];
			appPrflResponseArray[0] = "R";

			// Initialize ValidationBO
			final TaxReturnBO taxReturnBO = new TaxReturnBO();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the session AIP Collection
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			// Cargo

			/*final int rmcPrflCollSize = rmcInPrflColl != null ? rmcInPrflColl
					.size() : 0;*/

					// Get the firstName
					final String indvSeqNum = (String) request
							.get("firstName_addTaxInformationDtls");

					// Run Validation
					taxReturnBO.validateTaxAdd(indvSeqNum);
					if (taxReturnBO.hasMessages()) {
						request.put(FwConstants.MESSAGE_LIST,
								taxReturnBO.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
					if(rmcInPrflColl != null){
						if (!rmcInPrflColl.isEmpty()) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl, indvSeqNum);
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNum);
								rmcInPrflCargo.setIndv_seq_num(indvSeqNum);
								rmcInPrflCargo.setUpdt_dt(fwDate.getToday());
								rmcInPrflCargo.setUser(FwConstants.ONE);
								rmcInPrflCargo = rmcResponseProfileManager
										.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflCargo.setTax_info_ind("R");
								rmcInPrflColl.addCargo(rmcInPrflCargo);
								session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
							}
							rmcInPrflCargo.setTax_info_ind("R");
						} else {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setIndv_seq_num(indvSeqNum);
							rmcInPrflCargo.setUpdt_dt(fwDate.getToday());
							rmcInPrflCargo.setUser(FwConstants.ONE);
							rmcInPrflCargo = rmcResponseProfileManager
									.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflCargo.setTax_info_ind("R");
							rmcInPrflColl.addCargo(rmcInPrflCargo);
							session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
						}
					}
					

					rmcResponseProfileManager.makeRequired(IRMCResponseProfileManager.TAX_INFO_IND, rmcInPrflCargo, true);
					driverManager.makeAddNew(FwConstants.RMC_DRIVER, "ARTXI",
							driverArray, appNum);

					// make summary page as required
					driverManager.makeRequired(FwConstants.RMC_DRIVER,
							(String) request.get(FwConstants.CURRENT_PAGE_ID),
							driverArray, appNum);
					// end
					log(ILog.INFO,
							"RMCOtherBenefitsEJBBean::addTaxInformationDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addTaxInformationDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addTaxInformationDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addTaxInformationDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addTaxInformationDetails");
		}
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.addTaxInformationDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Erase tax information.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseTaxInformation(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG, "RMCOtherBenefitsEJBBean.eraseTaxInformation() - START");

		try {
			log(ILog.INFO, "RMCHousingExpenseEJBBean::eraseMappDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			String indvSeqNum = null;
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final CP_APP_IN_TAX_RETURN_Collection medColl = (CP_APP_IN_TAX_RETURN_Collection) pageCollection
					.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);
			final CP_APP_IN_TAX_RETURN_Cargo taxCargo = medColl.getResult(0);
			indvSeqNum = taxCargo.getIndv_seq_num();

			final TaxReturnBO medBO = new TaxReturnBO();
			final CP_APP_IN_TAXDEPENDENTS_OH_Collection OhColl =medBO.loadTaxDependentOutsideDetailsAFB(appNum, indvSeqNum);

			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			final String indivSeqNum = ((CP_APP_IN_TAX_RETURN_Cargo) medColl
					.get(0)).getIndv_seq_num();
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indivSeqNum);
			CP_APP_IN_TAX_RETURN_Cargo beforemedCargo = (CP_APP_IN_TAX_RETURN_Cargo) beforeColl
					.get(AppConstants.CP_APP_IN_TAX_RETURN_CARGO);
			
			final PeopleHandler peopleHandler = (PeopleHandler) session.get(AppConstants.INDIV_MASTER_HANDLER);
			String name = peopleHandler.getFirstName(indvSeqNum);

			if (beforemedCargo == null
					|| medBO.isDifferentTaxReturn(taxCargo, beforemedCargo)) {

				medBO.validateErase(name);
				request.put(FwConstants.MESSAGE_LIST, medBO.getMessageList());
				beforemedCargo = new CP_APP_IN_TAX_RETURN_Cargo();
				beforemedCargo.setIndv_seq_num(indvSeqNum);
				beforeColl.put(AppConstants.CP_APP_IN_TAX_RETURN_CARGO,
						beforemedCargo);
				txnBean.setPageCollection(beforeColl);
				return;

			}

			medBO.deleteTaxInformationRecords(indvSeqNum, appNum);
			medBO.deleteTaxDependentsRecords(indvSeqNum, appNum);
			medBO.deleteTaxDependentsOHRecords(indvSeqNum, appNum);
			ABHouseHoldMemberBO abHouseHoldMemberBO = new ABHouseHoldMemberBO();
			APP_INDV_Collection indvColl = abHouseHoldMemberBO.loadAppIndvCollection(appNum, indvSeqNum);
			APP_INDV_Cargo indvCargo = new APP_INDV_Cargo();
			if(indvColl!=null && !indvColl.isEmpty()) {
				APP_INDV_Collection cwCollection = medBO.splitAppIndvColl(indvColl, "CW");
				APP_INDV_Collection rmCollection = medBO.splitAppIndvColl(indvColl, "RM");
				APP_INDV_Collection rnCollection = medBO.splitAppIndvColl(indvColl, "RN");
				if(rnCollection!=null && !rnCollection.isEmpty()) {
					indvCargo = rnCollection.getCargo(0);
				}else if(rmCollection!=null && !rmCollection.isEmpty()) {
					indvCargo = rmCollection.getCargo(0);
				}else {
					indvCargo = cwCollection.getCargo(0);
				}
			}
			indvCargo.setTax_joint_file_ind(AppConstants.NO);
			indvCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
			APP_INDV_Collection newCollectionToUpdate = new APP_INDV_Collection();
			newCollectionToUpdate.addCargo(indvCargo);
			newCollectionToUpdate.persist(FwConstants.DAO);

			final short[] responseArray = new short[] { IRMCResponseProfileManager.TAX_INFO_IND };

			if (beforeColl != null) {
				int count = 0;
				CP_APP_IN_TAX_RETURN_Collection rb1Coll = null;
				CP_APP_IN_TAX_RETURN_Cargo rb1Cargo = null;
				rb1Coll = (CP_APP_IN_TAX_RETURN_Collection) beforeColl
						.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);
				if (rb1Coll != null && !rb1Coll.isEmpty()) {
					final int rbCollSize = rb1Coll.size();
					for (int i = 0; i < rbCollSize; i++) {
						rb1Cargo = rb1Coll.getResult(i);
						if (rb1Cargo.getIndv_seq_num().equals(indvSeqNum)
								&& "RM".equals(rb1Cargo.getSrc_app_ind())) {
							count++;
						}
					}
				}
				if (count == 1) {
					// now we need to make that profile requirred
					final RMC_IN_PRFL_Cargo rmcResCargo = rmcResponseProfileManager
							.getProfile(rmcInPrflColl, indvSeqNum);
					rmcResponseProfileManager.makeAbsoluteNotRequired(
							responseArray, rmcResCargo, true);
				}
			}

			boolean rmcPrflMedNotRequired = false;

			// here we need to check we have no entrys in rmcPrfl for the job
			// income detail
			// as well as we need to check
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.TAX_INFO_IND)) {
					rmcPrflMedNotRequired = true;
				}

			} else {
				rmcPrflMedNotRequired = true;

			}
			final Map medEnrl = new HashMap();
			medEnrl.put("TR", "TR");
			if (!checkBenefitDetailPageRequired(rmcSelPrfl, medEnrl)
					&& rmcPrflMedNotRequired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARTXI", driverArray, appNum);
			}

			if(medColl!=null&&medColl.size()==1) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARTXI", driverArray, appNum);
			}
			
			if(OhColl!=null&&OhColl.size()==1) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARTDP", driverArray, appNum);
			}

			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);
			log(ILog.INFO, "RMCOtherBenefitsEJBBean.eraseTaxInformation():End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseTaxInformation");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseTaxInformation");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseTaxInformation", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseTaxInformation");
		}
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.eraseTaxInformation() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * End tax information.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endTaxInformation(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.endTaxInformation() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::endTaxInformation");
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final CP_APP_IN_TAX_RETURN_Collection assetColl = (CP_APP_IN_TAX_RETURN_Collection) pageCollection
					.get("CP_APP_IN_TAX_RETURN_Collection");
			final CP_APP_IN_TAX_RETURN_Cargo liquidAssetCargo = assetColl
					.getCargo(0);

			final IndivTypeSeqBean seqBean = new IndivTypeSeqBean();
			seqBean.setIndivSeqNum(liquidAssetCargo.getIndv_seq_num());
			seqBean.setSeqNum(FwConstants.ZERO);
			seqBean.setType(AppConstants.TAX_RETURN_CHANGE);
			seqBean.setUserEndInd(FwConstants.ONE);
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, seqBean);
			// Get App Number
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
			 * javadoc
			 */
			/**
			 * RMBRequestManager rmbRqstManager = new RMBRequestManager();
			 * RMB_RQST_Cargo rmbCargo = rmbRqstManager.loadRMBRequest(appNum);
			 * RMB_RQST_Collection pageRMBRqstColl = new RMB_RQST_Collection();
			 *
			 * if(rmbCargo!=null) {
			 * rmbCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
			 * rmbCargo.setLqd_aset_stat_ind(AppConstants.YES);
			 * pageRMBRqstColl.addCargo(rmbCargo);
			 * rmbRqstManager.storeRMBRqst(pageRMBRqstColl);
			 * session.put(AppConstants.RMB_RQST_COLLECTION, pageRMBRqstColl); }
			 */

			// Set RMB Asset Details page - make required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARTXI",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);
			// End
			log(ILog.INFO,
					"RMCLiquidAndOtherAssetsEJBBean::endTaxInformation");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("endTaxInformation");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endTaxInformation");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"endTaxInformation", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endTaxInformation");
		}

		log(ILog.INFO,
				"RMCLiquidAndOtherAssetsEJBBean.endTaxInformation() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edits the tax information.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editTaxInformation(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG, "RMCOtherBenefitsEJBBean.editTaxInformation() - START");

		try {
			log(ILog.INFO, "RMCHousingExpenseEJBBean::editTaxInformation:Start");
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			final TaxReturnBO taxBo = new TaxReturnBO();
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get the APP_IN_EMPL_Collection from pageCollection.
			final CP_APP_IN_TAX_RETURN_Collection medColl = (CP_APP_IN_TAX_RETURN_Collection) pageCollection
					.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);

			final CP_APP_IN_TAXDEPENDENTS_OH_Collection taxCollection = taxBo
					.loadTaxDepOutsideForAppNumSrcApp((String) session
							.get(AppConstants.APP_NUMBER),
							AppConstants.SRC_APP_IND_AFB, medColl.getCargo(0)
							.getIndv_seq_num());
			final CP_APP_IN_TAX_RETURN_Cargo medCargo = medColl.getResult(0);
			final String indvSeqNum = medCargo.getIndv_seq_num();

			final IndivTypeSeqBean seqBean = new IndivTypeSeqBean();
			seqBean.setIndivSeqNum(medCargo.getIndv_seq_num());
			seqBean.setSeqNum(FwConstants.ZERO);
			seqBean.setType(medCargo.getSrc_app_ind());
			// setting user end indicator

//			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, seqBean);
			session.put(AppConstants.CP_APP_IN_TAXDEPENDENTS_OH_COLLECTION,
					taxCollection);
			final short[] responseArray = new short[] { IRMCResponseProfileManager.TAX_INFO_IND };
			
			if (session.get(AppConstants.RMC_IN_PRFL_MASTER) != null) {
				RMC_IN_PRFL_Collection rmcInPrflSessionColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				RMC_IN_PRFL_Cargo newCargo;
				RMC_IN_PRFL_Collection newCollection = new RMC_IN_PRFL_Collection();
				for (int i = 0; i < rmcInPrflSessionColl.size(); i++) {
					newCargo = rmcInPrflSessionColl.getCargo(i);
					if (indvSeqNum.equals(newCargo.getIndv_seq_num())) {
						newCargo.setTax_info_ind("R");
						newCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						newCollection.addCargo(newCargo);
						newCollection.persist(FwConstants.DAO);
					}
				}
			}
			
			// Get App Number
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// Set RMC page Job Income Details make required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARTXI",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);
			// End
			log(ILog.INFO, "RMCHousingExpenseEJBBean::editTaxInformation:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editTaxInformation");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editTaxInformation");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editTaxInformation", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editTaxInformation");
		}
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.editTaxInformation() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Adds the tax claim dependent details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addTaxClaimDependentDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.addTaxClaimDependentDetails() - START");

		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			request.put("firstName_MAPP", null);
			// short array for appProfile (someone outside the home)
			final short[] appPrflArray = new short[1];
			appPrflArray[0] = IAppProfileManager.POLICY_HOLDER_OTHER_RESP;
			final String[] appPrflResponseArray = new String[1];
			appPrflResponseArray[0] = "R";

			// Initialize ValidationBO
			final TaxClaimDependantBO taxClaimDependantBO = new TaxClaimDependantBO();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the session AIP Collection
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			// Cargo

			/*final int rmcPrflCollSize = rmcInPrflColl != null ? rmcInPrflColl
					.size() : 0;*/

					// Get the firstName
					final String indvSeqNum = (String) request
							.get("firstName_addTaxClaimDtls");

					// Run Validation
					taxClaimDependantBO.validateTaxAdd(indvSeqNum);
					if (taxClaimDependantBO.hasMessages()) {
						request.put(FwConstants.MESSAGE_LIST,
								taxClaimDependantBO.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					RMC_IN_PRFL_Cargo rmcInPrflCargo=null;
					if(rmcInPrflColl != null){
						if (!rmcInPrflColl.isEmpty()) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl, indvSeqNum);
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNum);
								rmcInPrflCargo.setIndv_seq_num(indvSeqNum);
								rmcInPrflCargo.setUpdt_dt(fwDate.getToday());
								rmcInPrflCargo.setUser(FwConstants.ONE);
								rmcInPrflCargo = rmcResponseProfileManager
										.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflCargo.setTax_claim_dependant_resp("R");
								rmcInPrflColl.addCargo(rmcInPrflCargo);
								session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
							}
							rmcInPrflCargo.setTax_claim_dependant_resp("R");
						} else {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setIndv_seq_num(indvSeqNum);
							rmcInPrflCargo.setUpdt_dt(fwDate.getToday());
							rmcInPrflCargo.setUser(FwConstants.ONE);
							rmcInPrflCargo = rmcResponseProfileManager
									.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflCargo.setTax_claim_dependant_resp("R");
							rmcInPrflColl.addCargo(rmcInPrflCargo);
							session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
						}
					}
					
					rmcResponseProfileManager.makeRequired(IRMCResponseProfileManager.TAX_CLAIM_DEPENDENT, rmcInPrflCargo, true);
					driverManager.makeAddNew(FwConstants.RMC_DRIVER, ARTAX,
							driverArray, appNum);

					// make summary page as required
					driverManager.makeRequired(FwConstants.RMC_DRIVER,
							(String) request.get(FwConstants.CURRENT_PAGE_ID),
							driverArray, appNum);
					// end
					log(ILog.INFO,
							"RMCOtherBenefitsEJBBean::addTaxClaimDependentDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addTaxClaimDependentDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addTaxClaimDependentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addTaxClaimDependentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addTaxClaimDependentDetails");
		}
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.addTaxClaimDependentDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edits the tax claim dependent details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editTaxClaimDependentDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.editTaxClaimDependentDetails() - START");

		try {
			log(ILog.INFO,
					"RMCOtherBenefitsEJBBean::editTaxClaimDependentDetails:Start");
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get the APP_IN_EMPL_Collection from pageCollection.
			final CP_APP_IN_TAX_INFORMATION_Collection taxInColl = (CP_APP_IN_TAX_INFORMATION_Collection) pageCollection
					.get(AppConstants.CP_APP_IN_TAX_INFORMATION_COLLECTION);
			final CP_APP_IN_TAX_INFORMATION_Cargo taxInCargo = taxInColl
					.getCargo(0);

			final IndivTypeSeqBean seqBean = new IndivTypeSeqBean();
			seqBean.setIndivSeqNum(taxInCargo.getIndv_seq_num());
			seqBean.setSeqNum(FwConstants.ZERO);
			seqBean.setType(AppConstants.TAX_CLAIM_DEPENDENT);
			// setting user end indicator

			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, seqBean);

			final RMB_RQST_Collection rmbColl = (RMB_RQST_Collection) session
					.get(AppConstants.RMB_RQST_COLLECTION);

			// Get RMB_RQST_Cargo for appNum
			if (rmbColl != null && !rmbColl.isEmpty()) {
				final RMB_RQST_Cargo rmbRqstCargo = rmbColl.getCargo(0);
				if (rmbRqstCargo.getTax_claim_dependant_ind() != null
						&& !FwConstants.YES.equals(rmbRqstCargo
								.getTax_claim_dependant_ind())) {
					rmbRqstCargo.setTax_claim_dependant_ind(FwConstants.YES);
					rmbRqstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					rmbColl.addCargo(rmbRqstCargo);
					rmbColl.persist(FwConstants.DAO);
				}
				// add to session
				session.put(AppConstants.RMB_RQST_COLLECTION, rmbColl);
			}

			// Get App Number
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// Set RMC page Job Income Details make required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, ARTAX,
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);
			// End
			log(ILog.INFO,
					"RMCHousingExpenseEJBBean::editTaxClaimDependentDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editMedInsDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editTaxClaimDependentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editTaxClaimDependentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editTaxClaimDependentDetails");
		}
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.editTaxClaimDependentDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");

	}

	/**
	 * Check benefit detail page required.
	 *
	 * @param categorySelectionProfile the category selection profile
	 * @param catType the cat type
	 * @return true, if successful
	 */
	public boolean checkBenefitDetailPageRequired(
			final SortedSet categorySelectionProfile, final Map catType) {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCOtherBenefitsEJBBean.checkBenefitDetailPageRequired() - START");

		try {
			boolean isexpensePageRequired = false;
			if (categorySelectionProfile != null) {
				// this one form the category selection profile
				final Iterator iter = categorySelectionProfile.iterator();
				CategorySequenceDetail categorySeqDtl = null;
				while (iter.hasNext()) {
					categorySeqDtl = (CategorySequenceDetail) iter.next();
					if (catType != null
							&& catType.get(categorySeqDtl.getCategoryType()) != null
							&& categorySeqDtl.getUserEndSelectionInd() != AppConstants.RMB_NO_CHANGE_SEL_IND) {
						isexpensePageRequired = true;
						break;
					}
				}
			}
			log(ILog.DEBUG,
					"RMCOtherBenefitsEJBBean.checkBenefitDetailPageRequired() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return isexpensePageRequired;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkBenefitDetailPageRequired");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"checkExpenseDetailPageRequired", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkBenefitDetailPageRequired");
		}
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void nextHouseHoldInfoSummary(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.nextHouseHoldInfoSummary() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::nextHouseHoldInfoSummary:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get App Number
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setType(AppConstants.NEXT_PAGE);
			String anyChangesStr = FwConstants.EMPTY_STRING;
			if (beforeMap.get("CHANGES_REPORTED") != null) {
				anyChangesStr = (String) beforeMap.get("CHANGES_REPORTED");
			}
			final ARHCSValidator validator = new ARHCSValidator();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			final String applicationType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);
			final char[] rmcApplicationType = { FwConstants.RMC_APP_TYPE };
			
			//caretaker
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final ABHouseHoldRelationshipBO houseHoldRelationBo = new ABHouseHoldRelationshipBO();
			INDIVIDUAL_Custom_Collection childNameColl = new INDIVIDUAL_Custom_Collection();
			if (beforeColl.containsKey("childNameList")) {
				childNameColl = (INDIVIDUAL_Custom_Collection) beforeColl
						.get("childNameList");
			}
			APP_HSHL_RLT_Collection appCareTakerHshlPageColl = new APP_HSHL_RLT_Collection();
			if (pageCollection.containsKey("APP_HSHL_RLT_Collection")) {
				appCareTakerHshlPageColl = (APP_HSHL_RLT_Collection) pageCollection
						.get("APP_HSHL_RLT_Collection");
			}

			NO_ONE_Collection noOneCollection = null;
			if (pageCollection.containsKey("NO_ONE_Collection")) {
				noOneCollection = (NO_ONE_Collection) pageCollection
						.get("NO_ONE_Collection");
			}
			
			List<APP_HSHL_RLT_Collection> hshlColCareTakerlList = new ArrayList<APP_HSHL_RLT_Collection>(); 
			if (beforeColl.containsKey("hshlCollList")) {
				hshlColCareTakerlList = (List<APP_HSHL_RLT_Collection>) beforeColl
						.get("hshlCollList");
			}
			
			boolean isAddIndividualMode = false;

			if (beforeColl.containsKey("RMB_ADD_INDIVIDUAL_MODE")
					&& FwConstants.YES.equals(beforeColl
							.get("RMB_ADD_INDIVIDUAL_MODE"))) {
				isAddIndividualMode = true;
			}

			boolean rmcApp = false;
			if (applicationType != null
					&& rmcApplicationType.equals(applicationType)) {
				rmcApp = true;
			}
			final Map noOneCheckedMap = (Map) beforeColl
					.get(AppConstants.NO_ONE_CHECKED_MAP);
			final RMC_IN_PRFL_Collection rmcInPrflPageColl = (RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection");
			final Map assetValidationMap = new HashMap();
			assetValidationMap.put(AppConstants.PEOPLE + "AC",
					beforeColl.get(AppConstants.PEOPLE + "AC"));
			assetValidationMap.put(AppConstants.PEOPLE + "UB",
					beforeColl.get(AppConstants.PEOPLE + "UB"));
			
			final RMBPeopleGatePostBO rmbPeopleGatePostBo = new RMBPeopleGatePostBO();
			final INDIVIDUAL_Custom_Collection peopleAC = (INDIVIDUAL_Custom_Collection) assetValidationMap
					.get(AppConstants.PEOPLE + "AC");
			if (null != peopleAC && !peopleAC.isEmpty()) {
				rmbPeopleGatePostBo.validateRMBSummary(
						rmcInPrflPageColl, noOneCollection, noOneCheckedMap);
				rmbPeopleGatePostBo.validateCaretaker(appCareTakerHshlPageColl, noOneCollection);
			}

			if (!FwConstants.YES.equals(anyChangesStr)
					|| backToMyAccess != null) {

				boolean warningMsgFlag = false;
				if (checkBackToMyAccessSelected(request) || rmbPeopleGatePostBo.hasMessages()) {

					final List<INDIVIDUAL_Custom_Collection> careTakerErrorReturnList = new ArrayList<INDIVIDUAL_Custom_Collection>();
					final List<Map> careTakerMapList = new ArrayList<Map>();
					NO_ONE_Collection pageNoOneColl = null;
					final List<NO_ONE_Collection> noOneList = new ArrayList<NO_ONE_Collection>();
					for (int i = 0; i < childNameColl.size(); i++) {
						INDIVIDUAL_Custom_Cargo childNameCargo = (INDIVIDUAL_Custom_Cargo) childNameColl.get(i);
						final APP_HSHL_RLT_Collection appCareTakerHshlSessColl = hshlColCareTakerlList.get(i);
						final APP_HSHL_RLT_Collection appCareTakerHshlColl = combineSessionPageCollection(appCareTakerHshlSessColl,
								appCareTakerHshlPageColl);

						final INDIVIDUAL_Custom_Collection careTakerErrorReturnColl = new INDIVIDUAL_Custom_Collection();
						final Map careTakerMap = new HashMap();
						if (appCareTakerHshlColl != null) {
							for (int c = 0; c < appCareTakerHshlColl.size(); c++) {
								final APP_HSHL_RLT_Cargo careTakerHshlPageCargo = appCareTakerHshlColl.getCargo(c);
								if (childNameCargo.getIndv_seq_num().equals(careTakerHshlPageCargo.getRef_indv_seq_num())) {
									careTakerErrorReturnColl.add(peopleHandler.getIndividual(careTakerHshlPageCargo.getSrc_indv_seq_num()));
									String careTakerresp = AppConstants.NO;
									if (careTakerHshlPageCargo.getCare_resp() != null
											&& careTakerHshlPageCargo.getCare_resp().equals(AppConstants.YES)) {
										careTakerresp = AppConstants.REQUIRED;
									}
									careTakerMap.put(careTakerHshlPageCargo.getSrc_indv_seq_num(), careTakerresp);
								}

							}
						}
						careTakerMapList.add(careTakerMap);
						careTakerErrorReturnList.add(careTakerErrorReturnColl);
						if (noOneCollection != null) {
							noOneList.add(noOneCollection);
						}
						beforeColl.put("CareTakerMap", careTakerMap);
					}
					beforeColl.put("careTakerMapList", careTakerMapList);
					beforeColl.put("custCollList", careTakerErrorReturnList);
					beforeColl.put("childNameList", childNameColl);

					beforeColl.put("hshlCollList", hshlColCareTakerlList);
					beforeColl.put("noOneList", noOneList);

					String addIndvMode = FwConstants.NO;
					if (isAddIndividualMode) {
						addIndvMode = FwConstants.YES;
					}
					beforeColl.put("RMB_ADD_INDIVIDUAL_MODE", addIndvMode);
					
					txnBean.setRequest(request);
					
					final String reqWarningMsgs = (String) request
							.get(FwConstants.WARNING_MSG_DETAILS);
					if (backToMyAccess == null) {
						warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
								rmbPeopleGatePostBo.getMessageList());
					}
					if (!warningMsgFlag) {
						if (backToMyAccess == null) {
							request.put(FwConstants.MESSAGE_LIST,
									rmbPeopleGatePostBo.getMessageList());
						}
						txnBean.setPageCollection((Map) beforeColl);
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					} else {
						final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
								.get(AppConstants.INDV_TYPE_SEQ_BEAN);
						final boolean sameType = postIndivSeqBean.getType()
								.equals(indivTypeSeqBean.getType()) ? true
										: false;
						if (sameType == false) {
							if (backToMyAccess == null) {
								request.put(FwConstants.MESSAGE_LIST,
										validator.getMessageList());
							}
							session.put(FwConstants.BEFORE_COLLECTION,
									beforeMap);
							txnBean.setPageCollection((Map) session
									.get(FwConstants.BEFORE_COLLECTION));
							beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
									indivTypeSeqBean);
							return;
						}
					}
				}
				
				
				
			}

			// change indicator
			final DisabilityBO disabilityBo = new DisabilityBO();
			final APP_IN_DABL_Collection modifiedCollection = disabilityBo
					.loadModifiedDisabilityCollection(appNum);
			final APP_IN_DABL_Collection newlyAddedCollection = disabilityBo
					.loadNewlyAddedDisabilityCollection(appNum);

			final RMC_IN_PRFL_Collection rmcInPrflSessColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			/*final RMC_IN_PRFL_Collection rmcInPrflPageColl = (RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection");*/
			if (rmcInPrflPageColl != null && !rmcInPrflPageColl.isEmpty()) {

				final RMC_IN_PRFL_Cargo rmcInPrflPageCargo = rmcInPrflPageColl
						.getCargo(0);
				for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
					final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
							.getCargo(i);

					if (sessionCargo.getIndv_seq_num().equals(
							rmcInPrflPageCargo.getIndv_seq_num())) {
						final String ableToConcieve = rmcInPrflPageCargo
								.getAble_to_conceive_resp();
						final String underWeightBirth = rmcInPrflPageCargo
								.getUnderweight_birth_resp();
						sessionCargo.setAble_to_conceive_resp(ableToConcieve);
						sessionCargo
						.setUnderweight_birth_resp(underWeightBirth);

					}
				}
			}

			final short[] questionsIndicators = new short[2];
			questionsIndicators[0] = IRMCResponseProfileManager.DABL_STAT_IND;
			questionsIndicators[1] = IRMCResponseProfileManager.IRWE_CHG_IND;

			String[] indivResponseIndForIndv = null;
			final Map indivResponseIndIndv = new HashMap();

			for (int j = 0; j < rmcInPrflSessColl.size(); j++) {
				indivResponseIndForIndv = new String[2];
				indivResponseIndForIndv[0] = AppConstants.NO;
				indivResponseIndForIndv[1] = AppConstants.NO;

				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
						.getCargo(j);

				if (modifiedCollection != null && !modifiedCollection.isEmpty()) {
					for (int i = 0; i < modifiedCollection.size(); i++) {
						final APP_IN_DABL_Cargo modifiedCargo = (APP_IN_DABL_Cargo) modifiedCollection
								.get(i);

						if (sessionCargo.getIndv_seq_num().equals(
								modifiedCargo.getIndv_seq_num())) {
							sessionCargo.setDabl_stat_ind(AppConstants.YES);
							indivResponseIndForIndv[0] = AppConstants.YES;
						}
						indivResponseIndIndv.put(
								sessionCargo.getIndv_seq_num(),
								indivResponseIndForIndv);
					}

				}
				if (newlyAddedCollection != null
						&& !newlyAddedCollection.isEmpty()) {
					for (int i = 0; i < newlyAddedCollection.size(); i++) {
						final APP_IN_DABL_Cargo modifiedCargo = (APP_IN_DABL_Cargo) newlyAddedCollection
								.get(i);

						if (sessionCargo.getIndv_seq_num().equals(
								modifiedCargo.getIndv_seq_num())) {
							sessionCargo.setIrwe_chg_ind(AppConstants.YES);
							indivResponseIndForIndv[1] = AppConstants.YES;
						}
						indivResponseIndIndv.put(
								sessionCargo.getIndv_seq_num(),
								indivResponseIndForIndv);
					}

				}
				indivResponseIndIndv.put(sessionCargo.getIndv_seq_num(),
						indivResponseIndForIndv);
			}

			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
						.getCargo(i);
				rmcResponseProfileManager.persist(appNum, sessionCargo
						.getIndv_seq_num(), questionsIndicators,
						(String[]) indivResponseIndIndv.get(sessionCargo
								.getIndv_seq_num()));
			}

			// planning healthy babies section

			final RMCRequestManager rmcRequestManager = new RMCRequestManager();
			final RMC_RQST_Cargo rmcRqstCargo = rmcRequestManager
					.loadRMCRequest(appNum);

			
			INDIVIDUAL_Custom_Collection indvColl = peopleHandler
					.getAllIndividuals();
			indvColl = PeopleRulesBO.getPregnantableIndividuals(indvColl);

			final RMC_IN_PRFL_Collection pregnantableProfiles = new RMC_IN_PRFL_Collection();

			for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
				final RMC_IN_PRFL_Cargo rCargo = rmcInPrflSessColl.getCargo(i);
				for (int j = 0; j < indvColl.size(); j++) {
					final INDIVIDUAL_Custom_Cargo aCargo = indvColl
							.getResult(j);
					if (aCargo.getIndv_seq_num().equals(
							rCargo.getIndv_seq_num())) {
						pregnantableProfiles.add(rCargo);
					}
				}
			}
			if (rmcRqstCargo != null) {
				if (pregnantableProfiles != null) {
					APP_IN_PLAN_HLTH_BABIES_Collection cwColl;
					APP_IN_PLAN_HLTH_BABIES_Collection rmColl;
					APP_IN_PLAN_HLTH_BABIES_Collection rnColl;
					String ableToConceiveResp = FwConstants.EMPTY_STRING;
					String underWeightBirthResp = FwConstants.EMPTY_STRING;
					final PregnancyBO pregnancyBO = new PregnancyBO();

					for (int i = 0; i < pregnantableProfiles.size(); i++) {
						final RMC_IN_PRFL_Cargo individualCargo = pregnantableProfiles
								.getCargo(i);
						ableToConceiveResp = individualCargo
								.getAble_to_conceive_resp();
						if (AppConstants.REQUIRED.equals(ableToConceiveResp)) {
							ableToConceiveResp = AppConstants.YES;
						}

						underWeightBirthResp = individualCargo
								.getUnderweight_birth_resp();
						if (AppConstants.REQUIRED.equals(underWeightBirthResp)) {
							underWeightBirthResp = AppConstants.YES;
						}
						final String indvSeqNum = individualCargo
								.getIndv_seq_num();
						// check for cw cargo to determine change or new

						cwColl = pregnancyBO.loadIndvHealtBabiesColl(appNum,
								indvSeqNum, AppConstants.CWW_RECORD_IND);
						rmColl = pregnancyBO.loadIndvHealtBabiesColl(appNum,
								indvSeqNum,
								AppConstants.RMC_MODIFIED_RECORD_IND);
						rnColl = pregnancyBO.loadIndvHealtBabiesColl(appNum,
								indvSeqNum, AppConstants.RMC_NEW_RECORD_IND);

						if (cwColl.isEmpty() && rmColl.isEmpty()) {
							if (rnColl.isEmpty()) {
								if (AppConstants.YES
										.equalsIgnoreCase(ableToConceiveResp)
										|| AppConstants.YES
										.equalsIgnoreCase(underWeightBirthResp)) {
									rmcRqstCargo
									.setHlthy_baby_chg_ind(AppConstants.YES);
									storeAndPersist(ableToConceiveResp,
											underWeightBirthResp,
											AppConstants.RMC_NEW_RECORD_IND,
											FwConstants.ROWACTION_INSERT,
											appNum, indvSeqNum, null);
								}
							} else if (!rnColl.isEmpty()) {
								final APP_IN_PLAN_HLTH_BABIES_Cargo rnCargo = rnColl
										.getCargo(0);
								if (rnCargo.getAble_to_conceive_resp().equals(
										ableToConceiveResp)
										|| rnCargo.getUnderweight_birth_resp()
										.equals(underWeightBirthResp)) {
									storeAndPersist(ableToConceiveResp,
											underWeightBirthResp,
											AppConstants.RMC_NEW_RECORD_IND,
											FwConstants.ROWACTION_UPDATE,
											appNum, indvSeqNum, null);
									rmcRqstCargo
									.setHlthy_baby_chg_ind(AppConstants.YES);
								}
							}

						} else if (null != rmcRqstCargo && !cwColl.isEmpty()) {
							final APP_IN_PLAN_HLTH_BABIES_Cargo cwCargo = cwColl
									.getCargo(0);

							if (!cwCargo.getAble_to_conceive_resp().equals(
									ableToConceiveResp)
									|| !cwCargo.getUnderweight_birth_resp()
									.equals(underWeightBirthResp)) {

								if (rmColl.isEmpty()) {
									List pageComp = (List) beforeColl.get(FwConstants.PAGE_COMPONENT_LIST);
									if(pageComp.contains("806") && pageComp.contains("807")){
										storeAndPersist(
												ableToConceiveResp,
												underWeightBirthResp,
												AppConstants.RMC_MODIFIED_RECORD_IND,
												FwConstants.ROWACTION_INSERT,
												appNum, indvSeqNum,
												cwCargo.getEcp_id());
										rmcRqstCargo
										.setHlthy_baby_chg_ind(AppConstants.YES);
									}
								} else if (!rmColl.isEmpty()) {
									storeAndPersist(
											ableToConceiveResp,
											underWeightBirthResp,
											AppConstants.RMC_MODIFIED_RECORD_IND,
											FwConstants.ROWACTION_UPDATE,
											appNum, indvSeqNum,
											cwCargo.getEcp_id());
									rmcRqstCargo
									.setHlthy_baby_chg_ind(AppConstants.YES);
								}

							}
						}
					}

				}
			}

			if (rmcApp) {

				final RMC_RQST_Collection rmcRqstcoll = new RMC_RQST_Collection();
				rmcRqstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				rmcRqstcoll.addCargo(rmcRqstCargo);
				rmcRequestManager.storeRMCRqst(rmcRqstcoll);
				session.put(AppConstants.RMC_RQST, rmcRqstCargo);
			}
			
			//caretaker 
			final APP_HSHL_RLT_Collection persistCareTakerCollection = new APP_HSHL_RLT_Collection();
			final APP_HSHL_RLT_Collection fullCaretakerCollection = houseHoldRelationBo.loadCaretakerColl(appNum);
			
			if (appCareTakerHshlPageColl != null
					&& !appCareTakerHshlPageColl.isEmpty()) {
				for (int a = 0; a < appCareTakerHshlPageColl.size(); a++) {
					final APP_HSHL_RLT_Cargo appCareTakerPageCargo = appCareTakerHshlPageColl
							.getCargo(a);
					appCareTakerPageCargo.setApp_num(appNum);
					appCareTakerPageCargo.setChg_eff_dt(getDate(new Date(),
							"yyyy-MM-dd"));
					if (appCareTakerPageCargo.getPhy_boe_sep_sw() == null
							|| appCareTakerPageCargo.getPhy_boe_sep_sw().trim()
							.length() <= 0) {
						appCareTakerPageCargo
						.setPhy_boe_sep_sw(FwConstants.SPACE);
					}
										
					updateSrcIndnRowAction(fullCaretakerCollection, appCareTakerPageCargo);
					persistCareTakerCollection.addCargo(appCareTakerPageCargo);
				}
			}
			
			
			for(int i = 0; i<childNameColl.size(); i++){
				INDIVIDUAL_Custom_Cargo childCargo = (INDIVIDUAL_Custom_Cargo) childNameColl.get(i);
				String childIndvId = childCargo.getIndv_seq_num();
				
				APP_HSHL_RLT_Collection fullChildColl = getChildColl(fullCaretakerCollection, childIndvId);
				APP_HSHL_RLT_Collection pageChildColl = getChildColl(appCareTakerHshlPageColl, childIndvId);
				APP_HSHL_RLT_Collection filteredFullChildColl = filterCollUsingSrcAppInd(fullChildColl);
				
				for( int j =0; j<filteredFullChildColl.size(); j++){
					
					APP_HSHL_RLT_Cargo childRltCargo = filteredFullChildColl.getCargo(j);
					if(pageChildColl!=null){
						if(updateCareResponse(childRltCargo, pageChildColl)){
							
							childRltCargo.setCare_resp(AppConstants.NO);
							if(childRltCargo.getSrc_app_ind().equals(AppConstants.RMC_MODIFIED_RECORD_IND)){
								childRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							} else if (childRltCargo.getSrc_app_ind().equals(AppConstants.RMC_NEW_RECORD_IND)){
								childRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							} else {
								childRltCargo.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
								childRltCargo.setRowAction(FwConstants.ROWACTION_INSERT);
							}
							childRltCargo.setChg_eff_dt(getDate(new Date(),
									"yyyy-MM-dd"));
							persistCareTakerCollection.addCargo(childRltCargo);
							
						}
					}					
					
				}
				
				
			}
						
			
			session.put("APP_HSHL_CARE_TAKER_Collection",
					persistCareTakerCollection);
			persistCareTakerCollection.persist(FwConstants.DAO);
			final ChangingValidation cv = new ChangingValidation();
			cv.setChangePersonalInfoInd(txnBean);
			cv.setLivingArrangmentInd(txnBean);
			cv.setAddressInd(txnBean);
			cv.setPregencyInd(txnBean);
			cv.setMoveInInd(txnBean);
			cv.setMoveOutInd(txnBean);
			cv.setAbsentParentInd(txnBean);
			cv.setMarrStatInd(txnBean);
			cv.setAliasNameChangeInd(txnBean);
			cv.setDemographicsChgInd(txnBean);
			cv.setAlienChgInd(txnBean);
			cv.setIndvProgramChangeInd(txnBean);

			// categorySelectionProfileManager.
			// Set RMC page Job Income Details make required
			driverManager.makeComplete(FwConstants.RMC_DRIVER, currentPageID,
					driverArray, appNum);
			session.put(FwConstants.RMC_DRIVER, driverArray);
			disabilityBo.determineAndStoreTaxFilingStatusRMC(appNum,
					rmcInPrflSessColl);
			// End
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::nextHouseHoldInfoSummary:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("nextHouseHoldInfoSummary");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "nextHouseHoldInfoSummary");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"nextHouseHoldInfoSummary", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "nextHouseHoldInfoSummary");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.nextHouseHoldInfoSummary() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store and persist.
	 *
	 * @param ableToConceiveResp the able to conceive resp
	 * @param underWeightBirth the under weight birth
	 * @param srcAppInd the src app ind
	 * @param rowAction the row action
	 * @param appNum the app num
	 * @param indvSeqNum the indv seq num
	 * @param ecpId the ecp id
	 */
	private void storeAndPersist(final String ableToConceiveResp,
			final String underWeightBirth, final String srcAppInd,
			final String rowAction, final String appNum,
			final String indvSeqNum, final String ecpId) {
		final APP_IN_PLAN_HLTH_BABIES_Cargo newCargo = new APP_IN_PLAN_HLTH_BABIES_Cargo();
		if (ecpId != null) {
			newCargo.setEcp_id(ecpId);
		}
		newCargo.setApp_num(appNum);
		newCargo.setAble_to_conceive_resp(ableToConceiveResp);
		newCargo.setUnderweight_birth_resp(underWeightBirth);
		newCargo.setIndv_seq_num(indvSeqNum);
		newCargo.setSrc_app_ind(srcAppInd);
		newCargo.setRowAction(rowAction);
		final APP_IN_PLAN_HLTH_BABIES_Collection collection = new APP_IN_PLAN_HLTH_BABIES_Collection();
		collection.add(newCargo);
		collection.persist(FwConstants.DAO);
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editContactInfo(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.editContactInfo() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editContactInfo:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// make contact info page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARACD",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editContactInfo:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editContactInfo");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editContactInfo");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editContactInfo", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editContactInfo");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editContactInfo() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseContactInfo(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseContactInfo() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseContactInfo:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_RGST_Collection appRgstColl = (APP_RGST_Collection) pageCollection
					.get("APP_RGST_Collection");
			final ARHCSValidator validator = new ARHCSValidator();

			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setType("ContactInfo");

			boolean warningMsgFlag = false;
			validator.validateErase("ContactInfo");
			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {
					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}

			final APP_RGST_Collection deleteAppRgstColl = new APP_RGST_Collection();
			final APP_RGST_Cargo deleteAppRgstCargo = appRgstColl.getCargo(0);
			deleteAppRgstCargo
			.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
			deleteAppRgstCargo.setApp_num(appNum);
			deleteAppRgstCargo.setRowAction(FwConstants.ROWACTION_DELETE);
			deleteAppRgstColl.addCargo(deleteAppRgstCargo);

			final ABRegistrationSummaryBO registrationSummaryBO = new ABRegistrationSummaryBO();
			// delete existing row from INDV_LIVE_CHG
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1,1,2 lines Commented Code
			 * in this block
			 */

			registrationSummaryBO.deleteAppRgstRecord(deleteAppRgstColl);



			driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
					"ARACD", driverArray, appNum);
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseContactInfo:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseContactInfo");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseContactInfo");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseContactInfo", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseContactInfo");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseContactInfo() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endContactInfo(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		try {

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("endContactInfo");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endContactInfo");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"endContactInfo", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endContactInfo");
		}
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editDeathDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.editDeathDetails() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editDeathDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final INDV_LIVE_CHG_Collection indvLiveChgColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");

			// Define IndvSeqNum
			String indvSeqNum = null;

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = indvLiveChgColl.getCargo(0).getIndv_seq_num();

			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setType(AppConstants.SOMEONE_DIED);

			// make contact info page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editDeathDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editDeathDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDeathDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editDeathDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDeathDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editDeathDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseDeathDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseDeathDetails() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseDeathDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final INDV_LIVE_CHG_Collection indvLiveChgColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");
			final ARHCSValidator validator = new ARHCSValidator();
			final String indvSeqNum = indvLiveChgColl.getCargo(0)
					.getIndv_seq_num();
			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.SOMEONE_DIED);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 4 lines Commented Code in
			 * this block
			 */

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);
			boolean warningMsgFlag = false;
			validator.validateErase(AppConstants.SOMEONE_DIED, name);
			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setRequest(request);
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {
					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}

			final INDV_LIVE_CHG_Collection deleteIndvLiveChgColl = new INDV_LIVE_CHG_Collection();
			INDV_LIVE_CHG_Cargo deleteIndvLiveChgCargo = new INDV_LIVE_CHG_Cargo();
			final int indvLiveChgCollSize = indvLiveChgColl.size();
			for (int i = 0; i < indvLiveChgCollSize; i++) {
				deleteIndvLiveChgCargo = indvLiveChgColl.getCargo(i);
				deleteIndvLiveChgCargo.setApp_num(appNum);
				deleteIndvLiveChgCargo
				.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteIndvLiveChgCargo
				.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				deleteIndvLiveChgCargo
				.setLive_arng_typ(AppConstants.DEATH_INDICATOR);
				deleteIndvLiveChgColl.addCargo(deleteIndvLiveChgCargo);
			}

			final LivingArrangementBO livingArrBO = new LivingArrangementBO();
			// delete existing row from INDV_LIVE_CHG
			livingArrBO.deleteIndvLiveChgRecord(deleteIndvLiveChgColl);

			// delete record from category selection profile
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// as death page and moved out page are clubbed, we have to check
			// for both now.
			final Map catType = new HashMap();
			catType.put(AppConstants.SOMEONE_DIED, AppConstants.SOMEONE_DIED);
			catType.put(AppConstants.LEFT_THE_HOME, AppConstants.LEFT_THE_HOME);

			final Map someOneDiedCatMap = new HashMap();
			someOneDiedCatMap.put(AppConstants.SOMEONE_DIED,
					AppConstants.SOMEONE_DIED);
			final long catSeqNum = 0;

			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.SOMEONE_DIED);

			// make the page not required if, no other death row exists
			if (categorySelectionProfileManager.isEmpty(rmcSelPrfl, catType)) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMO", driverArray, appNum);
			}
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);
			peopleHandler.eraseMovedOutOrDeadIndividuals(Short
					.parseShort(indvSeqNum));
			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseDeathDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseDeathDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDeathDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseDeathDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDeathDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDeathDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endDeathDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		// do nothing
			}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addDeathDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addDeathDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String deathDtlsSeq = request.get("firstName_deathDtls") != null ? (String) request
					.get("firstName_deathDtls") : FwConstants.EMPTY_STRING;

					final ARHCSValidator validator = new ARHCSValidator();
					// validate selections
					if (deathDtlsSeq == null
							|| AppConstants.SELECT_DEFAULT_OPTION.equals(deathDtlsSeq)) {
						validator.validateAdd(AppConstants.SOMEONE_DIED);
						// add validation message and return
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					final String appNum = (String) session.get(AppConstants.APP_NUMBER);

					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
					indivSeqBean.setIndivSeqNum(deathDtlsSeq);
					indivSeqBean.setSeqNum(FwConstants.ZERO);
					indivSeqBean.setType(AppConstants.SOMEONE_DIED);
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

					// set driver status
					final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO", driver,
							appNum);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
							appNum);
					session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addDeathDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDeathDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addDeathDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDeathDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addDeathDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editDivorcedDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.editDivorcedDetails() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editDivorcedDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final INDV_LIVE_CHG_Collection indvLiveChgColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");

			// Define IndvSeqNum
			String indvSeqNum = null;

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = indvLiveChgColl.getCargo(0).getIndv_seq_num();

			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setType(AppConstants.GOT_DIVORCED);

			// make divorce details page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMA",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editDivorcedDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editDivorcedDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDivorcedDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editDivorcedDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDivorcedDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editDivorcedDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseDivorcedDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseDivorcedDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseDivorcedDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final INDV_LIVE_CHG_Collection indvLiveChgColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");
			final ARHCSValidator validator = new ARHCSValidator();
			final String indvSeqNum = indvLiveChgColl.getCargo(0)
					.getIndv_seq_num();
			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.GOT_DIVORCED);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);
			boolean warningMsgFlag = false;
			validator.validateErase(AppConstants.GOT_DIVORCED, name);
			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {
					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}
			final INDV_LIVE_CHG_Collection deleteIndvLiveChgColl = new INDV_LIVE_CHG_Collection();
			INDV_LIVE_CHG_Cargo deleteIndvLiveChgCargo = new INDV_LIVE_CHG_Cargo();
			final int indvLiveChgCollSize = indvLiveChgColl.size();
			for (int i = 0; i < indvLiveChgCollSize; i++) {
				deleteIndvLiveChgCargo = indvLiveChgColl.getCargo(i);
				deleteIndvLiveChgCargo.setApp_num(appNum);
				deleteIndvLiveChgCargo
				.setLive_arng_typ(AppConstants.DIVORCE_INDICATOR);
				deleteIndvLiveChgCargo
				.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteIndvLiveChgCargo
				.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				deleteIndvLiveChgColl.addCargo(deleteIndvLiveChgCargo);

			}

			final LivingArrangementBO livingArrBO = new LivingArrangementBO();
			// delete existing row from INDV_LIVE_CHG
			livingArrBO.deleteIndvLiveChgRecord(deleteIndvLiveChgColl);

			// delete record from category selection profile
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catType = new HashMap();
			catType.put(AppConstants.GOT_DIVORCED, AppConstants.GOT_DIVORCED);
			catType.put(AppConstants.GOT_MARRIED, AppConstants.GOT_MARRIED);

			final Map gotDivorcedCatMap = new HashMap();
			gotDivorcedCatMap.put(AppConstants.GOT_DIVORCED,
					AppConstants.GOT_DIVORCED);

			final long catSeqNum = 0;
			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.GOT_DIVORCED);

			if (categorySelectionProfileManager.isEmpty(rmcSelPrfl, catType)) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMA", driverArray, appNum);
			}

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseDivorcedDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseDivorcedDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDivorcedDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseDivorcedDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDivorcedDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDivorcedDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endDivorcedDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		// do nothing 
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addDivorcedDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addDivorcedDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String divorceDtlsSeq = request.get("firstName_divorceDtls") != null ? (String) request
					.get("firstName_divorceDtls") : FwConstants.EMPTY_STRING;

					final ARHCSValidator validator = new ARHCSValidator();
					// validate selections
					if (divorceDtlsSeq == null
							|| AppConstants.SELECT_DEFAULT_OPTION
							.equals(divorceDtlsSeq)) {
						validator.validateAdd(AppConstants.GOT_DIVORCED);
						// add validation message and return
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					final String appNum = (String) session.get(AppConstants.APP_NUMBER);

					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
					indivSeqBean.setIndivSeqNum(divorceDtlsSeq);
					indivSeqBean.setSeqNum(FwConstants.ZERO);
					indivSeqBean.setType(AppConstants.GOT_DIVORCED);
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

					// set driver status
					final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMA", driver,
							appNum);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
							appNum);
					session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addDivorcedDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDivorcedDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addDivorcedDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDivorcedDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addDivorcedDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edit Person Moved out Details from HouseholdInfo Summary Page.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editMovedOutDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.editMovedOutDetails() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMovedOutDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final INDV_LIVE_CHG_Collection indvLiveChgColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");

			String indvSeqNum = null;
			indvSeqNum = indvLiveChgColl.getCargo(0).getIndv_seq_num();

			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setType(AppConstants.LEFT_THE_HOME);
			indivTypeSeqBean.setUserEndInd(FwConstants.ZERO);
			/* Make Moved Out Detail Page Required */
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO",
					driverArray, appNum);
			/* Make household Summary Page Required */
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			txnBean.setPageCollection(pageCollection);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMovedOutDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editMovedOutDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMovedOutDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editMovedOutDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMovedOutDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editMovedOutDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Erase Moved Out Persons Details from HouseholdInfo summary page.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseMovedOutDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseMovedOutDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseMovedOutDetails:Start");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final INDV_LIVE_CHG_Collection appIndvColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");
			appIndvColl.getCargo(0);

			final String indvSeqNum = appIndvColl.getCargo(0).getIndv_seq_num();

			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.LEFT_THE_HOME);
			final ARHCSValidator validator = new ARHCSValidator();
			INDV_LIVE_CHG_Cargo beforeindvCargo = (INDV_LIVE_CHG_Cargo) beforeMap
					.get("INDV_LIVE_CHG_Cargo");

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);

			final MovedInBO movedInBo = new MovedInBO();

			if (beforeindvCargo == null) {

				validator.validateErase(AppConstants.LEFT_THE_HOME, name);
				request.put(FwConstants.MESSAGE_LIST,
						validator.getMessageList());
				beforeindvCargo = new INDV_LIVE_CHG_Cargo();
				beforeindvCargo.setIndv_seq_num(indvSeqNum);
				beforeMap.put("INDV_LIVE_CHG_Cargo", beforeindvCargo);
				txnBean.setPageCollection(beforeMap);
				return;

			}
			//Start
			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			if (rmcInPrflColl == null) {
				rmcInPrflColl = rmcResponseProfileManager.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
			}
			
			
			if (rmcInPrflColl != null) {
				final RMC_IN_PRFL_Cargo rmcResCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, indvSeqNum);
				if (rmcResCargo != null) {
					rmcResponseProfileManager.makeAbsoluteNotRequired(
							IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP, rmcResCargo,
							true);
				}
			}

			boolean rmcPrflNotRequired = false;
			// here we need to check we have no entrys in rmcPrfl for disability
			// response
			// as well as we need to check
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP)) {
					rmcPrflNotRequired = true;
				}
			} else {
				rmcPrflNotRequired = true;
			}
			
			//end
			
			movedInBo.deleteMovedOutMemberRecords(indvSeqNum, appNum);

			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catType = new HashMap();
			catType.put(AppConstants.LEFT_THE_HOME, AppConstants.LEFT_THE_HOME);
			catType.put(AppConstants.SOMEONE_DIED, AppConstants.SOMEONE_DIED);

			final Map leftTheHomeMap = new HashMap();
			leftTheHomeMap.put(AppConstants.LEFT_THE_HOME,
					AppConstants.LEFT_THE_HOME);
			

			long catSeqNum = 1;
			final Iterator iter = rmcSelPrfl.iterator();
			CategorySequenceDetail categorySeqDtl = null;
			while (iter.hasNext()) {
				categorySeqDtl = (CategorySequenceDetail) iter.next();
				if ((Short.parseShort(indvSeqNum) == categorySeqDtl.getIndividualSequence()) 
						&& AppConstants.LEFT_THE_HOME.equals(categorySeqDtl.getCategoryType())) {
					catSeqNum = categorySeqDtl.getCategorySequence();
					break;
				}
			}
			
			final SortedSet categorySelectionProfile = categorySelectionProfileManager
					.loadCategoryChangeSelectionProfile(appNum,
							AppConstants.LEFT_THE_HOME);
			categorySelectionProfileManager.removeSequenceDetail(categorySelectionProfile,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.LEFT_THE_HOME);

			if (categorySelectionProfileManager.isEmpty(rmcSelPrfl, catType)&& rmcPrflNotRequired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMO", driverArray, appNum);
			}
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);
			peopleHandler.eraseMovedOutOrDeadIndividuals(Short
					.parseShort(indvSeqNum));

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			txnBean.setPageCollection(pageCollection);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseMovedOutDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseMovedOutDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseMovedOutDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseMovedOutDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseMovedOutDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseMovedOutDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endMovedOutDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		// do nothing
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addMovedOutDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addMovedOutDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String movedOutDtlsSeq = request
					.get("firstName_movedOutDtls") != null ? (String) request
							.get("firstName_movedOutDtls") : FwConstants.EMPTY_STRING;
							// Get beforeMap
							final Map beforeMap = (Map) session
									.get(FwConstants.BEFORE_COLLECTION);

							ARHCSValidator validator = new ARHCSValidator();
							// validate selections
							if (movedOutDtlsSeq == null
									|| AppConstants.SELECT_DEFAULT_OPTION
									.equals(movedOutDtlsSeq)) {
								validator.validateAdd(AppConstants.LEFT_THE_HOME);
								// add validation message and return
								request.put(FwConstants.MESSAGE_LIST,
										validator.getMessageList());
								txnBean.setPageCollection((Map) session
										.get(FwConstants.BEFORE_COLLECTION));
								return;
							}

							// if someone tries to tell us that a person who they've reported as
							// dead has moved out of the house
							INDV_LIVE_CHG_Collection indvLiveChgBeforeColl = new INDV_LIVE_CHG_Collection();
							if (beforeMap != null) {
								indvLiveChgBeforeColl = (INDV_LIVE_CHG_Collection) beforeMap
										.get("ARHCS_DEATH_DTL_COLLECTION");
							}
							validator = new ARHCSValidator();
							validator.validateMovedOutDeath(movedOutDtlsSeq,
									indvLiveChgBeforeColl);
							if (validator.hasMessages()) {
								final String reqWarningMsgs = (String) request
										.get(FwConstants.WARNING_MSG_DETAILS);
								if (!checkForWarningMesgs(reqWarningMsgs,
										validator.getMessageList())) {

									request.put(FwConstants.MESSAGE_LIST,
											validator.getMessageList());
									txnBean.setRequest(request);
									txnBean.setPageCollection((Map) session
											.get(FwConstants.BEFORE_COLLECTION));
									return;
								}
							}
							final String appNum = (String) session.get(AppConstants.APP_NUMBER);

							final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
							indivSeqBean.setIndivSeqNum(movedOutDtlsSeq);
							indivSeqBean.setSeqNum(FwConstants.ONE);
							indivSeqBean.setType(AppConstants.LEFT_THE_HOME);
							indivSeqBean.setUserEndInd(FwConstants.ZERO);
							pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

							// set driver status
							final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
							driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO", driver,
									appNum);
							driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
									appNum);
							session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addMovedOutDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addMovedOutDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addMovedOutDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addMovedOutDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addMovedOutDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editMarriageDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.editMarriageDetails() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMarriageDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final INDV_LIVE_CHG_Collection indvLiveChgColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");

			// Define IndvSeqNum
			String indvSeqNum = null;

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = indvLiveChgColl.getCargo(0).getIndv_seq_num();

			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setType(AppConstants.GOT_MARRIED);
			// make contact info page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMA",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMarriageDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editMarriageDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMarriageDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editMarriageDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMarriageDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editMarriageDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseMarriageDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseMarriageDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseMarriageDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final INDV_LIVE_CHG_Collection indvLiveChgColl = (INDV_LIVE_CHG_Collection) pageCollection
					.get("INDV_LIVE_CHG_Collection");
			final ARHCSValidator validator = new ARHCSValidator();
			final String indvSeqNum = indvLiveChgColl.getCargo(0)
					.getIndv_seq_num();
			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.GOT_MARRIED);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);
			boolean warningMsgFlag = false;
			validator.validateErase(AppConstants.GOT_MARRIED, name);
			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {
					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}

			final INDV_LIVE_CHG_Collection deleteIndvLiveChgColl = new INDV_LIVE_CHG_Collection();
			INDV_LIVE_CHG_Cargo deleteIndvLiveChgCargo = new INDV_LIVE_CHG_Cargo();


			final int indvLiveChgCollSize = indvLiveChgColl.size();

			for (int i = 0; i < indvLiveChgCollSize; i++) {
				deleteIndvLiveChgCargo = indvLiveChgColl.getCargo(i);
				deleteIndvLiveChgCargo.setApp_num(appNum);
				deleteIndvLiveChgCargo
				.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteIndvLiveChgCargo
				.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				deleteIndvLiveChgCargo
				.setLive_arng_typ(AppConstants.MARRIAGE_INDICATOR);
				deleteIndvLiveChgColl.addCargo(deleteIndvLiveChgCargo);

			}

			final LivingArrangementBO livingArrBO = new LivingArrangementBO();
			// delete existing row from INDV_LIVE_CHG
			livingArrBO.deleteIndvLiveChgRecord(deleteIndvLiveChgColl);

			// delete the relationship row "RM" from APP_RLT table?
			final MaritalBO maritalBO = new MaritalBO();
			maritalBO.deleteAppHshlRltRecords(indvSeqNum, appNum);

			// make the page not required if, no other death row exists
			// Get the before INDV_LIVE_CHG_Collection
			final INDV_LIVE_CHG_Collection indvLiveChgBeforeColl = (INDV_LIVE_CHG_Collection) beforeMap
					.get("ARHCS_MARRIAGE_DETAILS_COLLECTION");
			indvLiveChgBeforeColl.size();

			// delete record from category selection profile
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catType = new HashMap();
			catType.put(AppConstants.GOT_MARRIED, AppConstants.GOT_MARRIED);
			catType.put(AppConstants.GOT_DIVORCED, AppConstants.GOT_DIVORCED);

			final Map gotMarriedCatMap = new HashMap();
			gotMarriedCatMap.put(AppConstants.GOT_MARRIED,
					AppConstants.GOT_MARRIED);
			final long catSeqNum = 0;
			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.GOT_MARRIED);

			if (categorySelectionProfileManager.isEmpty(rmcSelPrfl, catType)) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMA", driverArray, appNum);
			}

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseMarriageDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseMarriageDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseMarriageDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseMarriageDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseMarriageDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseMarriageDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endMarriageDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		// do nothing
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addMarriageDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addMarriageDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String marrDtlsSeq = request.get("firstName_marrDtls") != null ? (String) request
					.get("firstName_marrDtls") : FwConstants.EMPTY_STRING;

					final ARHCSValidator validator = new ARHCSValidator();
					// validate selections
					if (marrDtlsSeq == null
							|| AppConstants.SELECT_DEFAULT_OPTION.equals(marrDtlsSeq)) {
						validator.validateAdd(AppConstants.GOT_MARRIED);
						// add validation message and return
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					final String appNum = (String) session.get(AppConstants.APP_NUMBER);

					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
					indivSeqBean.setIndivSeqNum(marrDtlsSeq);
					indivSeqBean.setSeqNum(FwConstants.ZERO);
					indivSeqBean.setType(AppConstants.GOT_MARRIED);
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

					// set driver status
					final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMA", driver,
							appNum);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
							appNum);
					session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addMarriageDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addMarriageDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addMarriageDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addMarriageDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addMarriageDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edit Pregnancy End Details from householdinfo summary page Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editPregnancyEndDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editPregnancyEndDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editPregnancyEndDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final APP_IN_PREG_Collection appInPregColl = (APP_IN_PREG_Collection) pageCollection
					.get(APP_IN_PREG_COLLECTION_KEY);

			String indvSeqNum = null;
			indvSeqNum = appInPregColl.getCargo(0).getIndv_seq_num();

			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setType(AppConstants.PREGNANCY_ENDED);

			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARSUM",
					driverArray, appNum);

			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);
			txnBean.setPageCollection(pageCollection);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editPregnancyEndDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editPregnancyEndDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editPregnancyEndDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editPregnancyEndDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editPregnancyEndDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editPregnancyEndDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Erase pregnancy End Details from household info summary page.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void erasePregnancyEndDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.erasePregnancyEndDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::erasePregnancyEndDetails:Start");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final APP_IN_PREG_Collection appInPregColl = (APP_IN_PREG_Collection) pageCollection
					.get(APP_IN_PREG_COLLECTION_KEY);

			final String indvSeqNum = appInPregColl.getCargo(0)
					.getIndv_seq_num();

			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.PREGNANCY_ENDED);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);

			final String name = peopleHandler.getFirstName(indvSeqNum);
			boolean warningMsgFlag = false;

			final ARHCSValidator validator = new ARHCSValidator();
			
			validator.validateErase(AppConstants.PREGNANCY_ENDED, name);

			if (validator.hasMessages()) {

				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());

				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {

					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;

					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}

			/* Delete record from CP_APP_IN_PREG */
			final APP_IN_PREG_Collection deleteAppInPregColl = new APP_IN_PREG_Collection();
			APP_IN_PREG_Cargo deleteAppInPregCargo = new APP_IN_PREG_Cargo();
			final int appInPregCollSize = appInPregColl.size();
			for (int i = 0; i < appInPregCollSize; i++) {
				deleteAppInPregCargo = appInPregColl.getCargo(i);
				deleteAppInPregCargo.setApp_num(appNum);
				deleteAppInPregCargo.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteAppInPregCargo
				.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
				deleteAppInPregColl.addCargo(deleteAppInPregCargo);

			}

			final PregnancyBO pregBO = new PregnancyBO();
			pregBO.deleteAppInPregRecord(deleteAppInPregColl);

			/* Delete record from CP_APP_IN_CHILD_INFO */
			final APP_IN_CHILD_INFO_Collection deleteAppInChildInfoColl = new APP_IN_CHILD_INFO_Collection();
			final APP_IN_CHILD_INFO_Cargo deleteAppChildInfoCargo = new APP_IN_CHILD_INFO_Cargo();

			for (int i = 0; i < appInPregCollSize; i++) {
				deleteAppInPregCargo = appInPregColl.getCargo(i);
				deleteAppChildInfoCargo.setApp_num(appNum);
				deleteAppChildInfoCargo.setIndv_seq_num(deleteAppInPregCargo
						.getIndv_seq_num());
				deleteAppChildInfoCargo
				.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteAppChildInfoCargo
				.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
				deleteAppChildInfoCargo.setSeq_num(FwConstants.ZERO);
				deleteAppChildInfoCargo.setCargoName("APP_IN_CHILD_INFO_Cargo");
				deleteAppInChildInfoColl.addCargo(deleteAppChildInfoCargo);
			}
			pregBO.deleteAppInChildInfoRecord(deleteAppInChildInfoColl);

			/* Delete record from category selection profile CP_RMC_CHG_SEL_PRFL */
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map pregCatTypes = new HashMap();
			pregCatTypes.put(AppConstants.PREGNANCY_ENDED,
					AppConstants.PREGNANCY_ENDED);
//			pregCatTypes.put(AppConstants.BECAME_PREGNANT,
//					AppConstants.BECAME_PREGNANT);

			final Map pregEndCatTypeMap = new HashMap();
			pregEndCatTypeMap.put(AppConstants.PREGNANCY_ENDED,
					AppConstants.PREGNANCY_ENDED);

			final long catSeqNum = 0;
			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.RMC_CAT_HO_COMP_PRFL,AppConstants.PREGNANCY_ENDED);

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			if (rmcInPrflColl == null) {
				rmcInPrflColl = rmcResponseProfileManager.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
			}

			boolean rmcPrflNotRequired = false;
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.PREGNANCY)) {
					rmcPrflNotRequired = true;
				}
			} else {
				rmcPrflNotRequired = true;
			}

			/* Make pregnancy Detail page not required */
			/*if (categorySelectionProfileManager.isEmpty(rmcSelPrfl,
					pregCatTypes) && rmcPrflNotRequired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHPD", driverArray, appNum);
			}*/
			final APP_IN_PREG_Collection pregColl = pregBO.loadPregnancyColl(appNum);
			if(pregColl==null || pregColl.isEmpty()){
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARSUM", driverArray, appNum);
			}
			/* Make household summary page required */
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			txnBean.setPageCollection(pageCollection);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::erasePregnancyEndDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("erasePregnancyEndDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "erasePregnancyEndDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"erasePregnancyEndDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "erasePregnancyEndDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.erasePregnancyEndDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endPregnancyChangeDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		// do nothing
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addPregnancyChangeDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addPregnancyChangeDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String pregChgDtlsSeq = request.get("firstName_pregChgDtls") != null ? (String) request
					.get("firstName_pregChgDtls") : FwConstants.EMPTY_STRING;
					final String appNum = (String) session.get(AppConstants.APP_NUMBER);
					final ARHCSValidator validator = new ARHCSValidator();
					// validate selections
					if (pregChgDtlsSeq == null
							|| AppConstants.SELECT_DEFAULT_OPTION
							.equals(pregChgDtlsSeq)) {
						validator.validateAdd(AppConstants.PREGNANCY_ENDED);
						// add validation message and return
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
					// not ma

					// not ma

					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
					indivSeqBean.setIndivSeqNum(pregChgDtlsSeq);
					indivSeqBean.setSeqNum(FwConstants.ZERO);
					indivSeqBean.setType(AppConstants.PREGNANCY_ENDED);
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);
					// set driver status

					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHPD", driver,
							appNum);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
							appNum);
					session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addPregnancyChangeDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addPregnancyChangeDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addPregnancyChangeDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addPregnancyChangeDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addPregnancyChangeDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editMovedInDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.editMovedInDetails() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMovedInDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_INDV_Collection appIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");

			// Define IndvSeqNum
			String indvSeqNum = null;

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = appIndvColl.getCargo(0).getIndv_seq_num();

			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setType(AppConstants.PERSONAL_INFO);
			indivTypeSeqBean.setUserEndInd(FwConstants.ZERO);
			// make Moved In Details page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMI",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMX",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMovedInDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editMovedInDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMovedInDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editMovedInDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMovedInDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editMovedInDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseMovedInDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseMovedInDetails() - START");
		try {

			// delete from RMC_RQST, APP_INDV, RMC_IN_PRFL, PEOPLE_HANDLER< Look
			// at HOUSEHOLDINFOEJBBEAN
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseMovedInDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_INDV_Collection appIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");
			final ARHCSValidator validator = new ARHCSValidator();
			final String indvSeqNum = appIndvColl.getCargo(0).getIndv_seq_num();
			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.PERSONAL_INFO);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);
			boolean warningMsgFlag = false;
			validator.validateErase(AppConstants.PERSONAL_INFO, name);
			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {
					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}

			final IndividualAge indvAge = peopleHandler
					.getIndividualAge(indvSeqNum);
			final int indvYears = indvAge.getYears();
			final String sexInd = peopleHandler.getIndividual(indvSeqNum)
					.getSex_ind();

			SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			rmcSelPrfl = categorySelectionProfileManager
					.loadCategoryChangeSelectionProfile(appNum,
							AppConstants.RMC_CAT_HO_COMP_PRFL);

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			if (rmcInPrflColl == null) {
				rmcInPrflColl = rmcResponseProfileManager.loadProfile(appNum);
			}

			final MovedInBO movedInBO = new MovedInBO();
			final AbsentParentBO absentParentBo = new AbsentParentBO();

			// delete Absent Parent, and scheduling logic for absent parent
			if (absentParentBo.isParentForChild(indvSeqNum, appNum,
					peopleHandler, AppConstants.RMC_NEW_RECORD_IND)) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHAP",
						driverArray, appNum);
			}
			boolean absentParentFlag = false;
			if (AppConstants.SEX_IND_FEMALE.equals(sexInd)
					&& absentParentBo.checkUnMarriedPregWomen(rmcInPrflColl,
							peopleHandler, indvSeqNum, appNum)) {
				movedInBO.deleteAbsentParentUnBornChild(indvSeqNum, appNum);
				absentParentFlag = true;
			}

			// Delete individual from people handler
			peopleHandler.deleteIndividual(appNum, indvSeqNum);
			peopleHandler.eraseMovedInIndividuals(Short.parseShort(indvSeqNum));
			final SortedSet categorySelectionProfile = categorySelectionProfileManager
					.loadCategoryChangeSelectionProfile(appNum,
							AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			if(categorySelectionProfile!=null && categorySelectionProfile.size()>0)
			{
			categorySelectionProfileManager.removeSequenceDetail(categorySelectionProfile,
					appNum, Short.parseShort(indvSeqNum),
					Long.parseLong("0"),AppConstants.RMC_CAT_HH_SUMMARY_PRFL , AppConstants.CITIZEN_INFO);
			}
			final short[] programKeyArray = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			if (indvYears < 19) {
				movedInBO.deleteAppAbsentParent(indvSeqNum, appNum);
				movedInBO.deleteAbsentParent(indvSeqNum, appNum);
				List fatherMotherList = new ArrayList();
				if(null!=session.get("FatherMotherList"))
				{
					fatherMotherList=(List)session.get("FatherMotherList");
				}
				List fatherMotherListToRemove = new ArrayList<IndivTypeSeqBean>();
				if(null!=fatherMotherList && fatherMotherList.size()>0 && !fatherMotherList.isEmpty())
				{
					for(int i=0;i<fatherMotherList.size();i++)
					{
						IndivTypeSeqBean indivSeqBean =	(IndivTypeSeqBean)fatherMotherList.get(i);
						if(indivSeqBean.getIndivSeqNum().equals(indvSeqNum)){
							fatherMotherListToRemove.add(indivSeqBean);	
						}
					}
					fatherMotherList.removeAll(fatherMotherListToRemove);
				}
				absentParentFlag = true;
			}
			if (absentParentFlag) {
				if (!absentParentBo.checkAbsentParentRequired(peopleHandler,
						rmcInPrflColl, appNum, programKeyArray)) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARHAP", driverArray,
							appNum);
				}
			}

			// Deleting household relationship details of the individual
			movedInBO.deleteRelationship(indvSeqNum, appNum);

			// Deleting the new born information
			if (indvYears == 0 || indvYears == 1 && indvAge.getMonths() < 1) {
				movedInBO.deleteNewBorn(indvSeqNum, appNum);
			}

			rmcResponseProfileManager.getProfile(rmcInPrflColl, indvSeqNum);
			rmcInPrflColl = rmcResponseProfileManager
					.deleteIndividualFromAppIndividualProfile(rmcInPrflColl,
							indvSeqNum);

			// delete Add Person Gatepost
			// deleting rmc_in_prfl in the above step will take care of deleting
			// the person gatepost data,
			// but we still have to take of the scheduling logic which was done
			// in this page.
			// We will have to unschedule all the pages scheduled by this page.

			// delete Medicare
			// check if Medicare details is complete/any other status than Not
			// Required.
			if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARHMD",
					driverArray) != FwConstants.DRIVER_NOT_REQUIRED) {
				movedInBO.deleteMedicareDetails(appNum, indvSeqNum);
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl,
						IRMCResponseProfileManager.RECEIVE_MEDICARE)) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARHMD", driverArray,
							appNum);
				}
			}

			// delete school enrollment details
			// ARHSE
			if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARHSE",
					driverArray) != FwConstants.DRIVER_NOT_REQUIRED) {
				movedInBO.deleteSchoolEnrollment(indvSeqNum, appNum);
			}
			// scheduling logic for school enrollment
			if (indvYears < 49) {
				final SchoolEnrollmentBO schoolBo = new SchoolEnrollmentBO();
				final List schoolList = schoolBo.findSchoolEnrollmentPeople(
						peopleHandler, programKeyArray);
				if (schoolList == null) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARHSE", driverArray,
							appNum);
				}
			}

			// Page scheduling logic
			INDIVIDUAL_Custom_Collection indvCustomColl = new INDIVIDUAL_Custom_Collection();
			indvCustomColl = peopleHandler.getAllIndividuals();
			final int indvCustCollSize = indvCustomColl.size();
			int countPinNum = 0;
			for (int i = 0; i < indvCustCollSize; i++) {
				final INDIVIDUAL_Custom_Cargo indivCargo = indvCustomColl
						.getResult(i);
				if (indivCargo.getIndv_pin_num() == null
						|| FwConstants.ZERO
						.equals(indivCargo.getIndv_pin_num())) {
					countPinNum++;
				}
			}

			if (countPinNum == 0) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHRL", driverArray, appNum);
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMD", driverArray, appNum);
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHSE", driverArray, appNum);
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHPG", driverArray, appNum);
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMI", driverArray, appNum);
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMX", driverArray, appNum);
			}

			// delete Disaibility Details
			// ARHDD
			if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARHDD",
					driverArray) != FwConstants.DRIVER_NOT_REQUIRED) {
				final DisabilityBO disabilityBO = new DisabilityBO();
				disabilityBO.deleteIndividualDisabilityDet(appNum, indvSeqNum);

				boolean rmcPrflDisabilityNotRequired = false;
				// here we need to check we have no entrys in rmcPrfl for
				// disability response
				if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
					if (rmcResponseProfileManager.isAppResponseNotRequired(
							rmcInPrflColl, IRMCResponseProfileManager.DISABLE)) {
						rmcPrflDisabilityNotRequired = true;
					}
				} else {
					rmcPrflDisabilityNotRequired = true;
				}

				final Map catType = new HashMap();
				catType.put(AppConstants.DISABLED_BLIND,
						AppConstants.DISABLED_BLIND);
				final long catSeqNum = 0;
				// remove from Category Selection Profile
				categorySelectionProfileManager.removeSequenceDetail(
						rmcSelPrfl, appNum, Short.parseShort(indvSeqNum),
						catSeqNum, AppConstants.DISABLED_BLIND);

				if (categorySelectionProfileManager
						.isEmpty(rmcSelPrfl, catType)
						&& rmcPrflDisabilityNotRequired) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARHDD", driverArray,
							appNum);

				}
			}

			// delete Pregnancy End/Add Details
			// ARHPD

			if (AppConstants.SEX_IND_FEMALE.equals(sexInd) && indvYears >= 10
					&& indvYears < 60) {
				movedInBO.deletePregnancy(indvSeqNum, appNum,
						AppConstants.RMC_NEW_RECORD_IND);
				boolean rmcPrflPregNotRequired = false;
				// here we need to check we have no entrys in rmcPrfl for
				// disability response
				if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
					if (rmcResponseProfileManager
							.isAppResponseNotRequired(rmcInPrflColl,
									IRMCResponseProfileManager.PREGNANCY)) {
						rmcPrflPregNotRequired = true;
					}
				} else {
					rmcPrflPregNotRequired = true;
				}

				final Map catType = new HashMap();
				catType.put(AppConstants.BECAME_PREGNANT,
						AppConstants.BECAME_PREGNANT);
				catType.put(AppConstants.PREGNANCY_ENDED,
						AppConstants.PREGNANCY_ENDED);

				final Map becamePregnantCatMap = new HashMap();
				becamePregnantCatMap.put(AppConstants.BECAME_PREGNANT,
						AppConstants.BECAME_PREGNANT);
				final long catSeqNum = 0;
				categorySelectionProfileManager.removeSequenceDetail(
						rmcSelPrfl, appNum, Short.parseShort(indvSeqNum),
						catSeqNum, AppConstants.BECAME_PREGNANT);

				if (categorySelectionProfileManager
						.isEmpty(rmcSelPrfl, catType) && rmcPrflPregNotRequired) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARHPD", driverArray,
							appNum);
				}

				}

			// delete Job Income Details and Self Employment Details.
			// ARJID
			if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARJID",
					driverArray) != FwConstants.DRIVER_NOT_REQUIRED
					|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
							"ARJSD", driverArray) != FwConstants.DRIVER_NOT_REQUIRED
							|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
									"ARJSE", driverArray) != FwConstants.DRIVER_NOT_REQUIRED
									|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
											"ARJIS", driverArray) != FwConstants.DRIVER_NOT_REQUIRED) {
				// delete from APP_IN_EMPL, APP_IN_EMPL_WAGE and APP_IN_SELFE
				movedInBO.deleteJobIncomeDtls(indvSeqNum, appNum);

				// start of Employment Category type
				rmcSelPrfl = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNum,
								AppConstants.RMC_CAT_EMP_PRFL);

				final Map catAllJobIncTypesMap = new HashMap();
				catAllJobIncTypesMap.put(AppConstants.EMPL_REGULAR,
						AppConstants.EMPL_REGULAR);
				catAllJobIncTypesMap.put(AppConstants.EMPL_INKIND,
						AppConstants.EMPL_INKIND);
				catAllJobIncTypesMap.put(AppConstants.SELF_EMPLOYMENT,
						AppConstants.SELF_EMPLOYMENT);

				final Map catEmplTypesMap = new HashMap();
				catEmplTypesMap.put(AppConstants.EMPL_REGULAR,
						AppConstants.EMPL_REGULAR);
				catEmplTypesMap.put(AppConstants.EMPL_INKIND,
						AppConstants.EMPL_INKIND);

				final Map catSelfEmplTypeMap = new HashMap();
				catSelfEmplTypeMap.put(AppConstants.SELF_EMPLOYMENT,
						AppConstants.SELF_EMPLOYMENT);

				boolean rmcPrflEmplNotRequired = false;
				boolean rmcPrflSelfEmplNotRequired = false;
				boolean rmcPrflJobIncNotRequired = false;

				// here we need to check we have no entrys in rmcPrfl for the
				// job income detail
				if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
					if (rmcResponseProfileManager.isAppResponseNotRequired(
							rmcInPrflColl,
							IRMCResponseProfileManager.REGULAR_EMPL)) {
						if (rmcResponseProfileManager.isAppResponseNotRequired(
								rmcInPrflColl,
								IRMCResponseProfileManager.JOB_IN_KIND)) {
							rmcPrflEmplNotRequired = true;
							if (rmcResponseProfileManager
									.isAppResponseNotRequired(
											rmcInPrflColl,
											IRMCResponseProfileManager.SELF_EMPLOYMENT)) {
								rmcPrflJobIncNotRequired = true;
							}
						}
					}

					if (rmcResponseProfileManager.isAppResponseNotRequired(
							rmcInPrflColl,
							IRMCResponseProfileManager.SELF_EMPLOYMENT)) {
						rmcPrflSelfEmplNotRequired = true;
					}
				} else {
					rmcPrflJobIncNotRequired = true;
					rmcPrflEmplNotRequired = true;
					rmcPrflSelfEmplNotRequired = true;
				}
				final long catSeqNum = 0;
				String catTypeStr = AppConstants.EMPL_REGULAR;
				categorySelectionProfileManager.removeSequenceDetail(
						rmcSelPrfl, appNum, Short.parseShort(indvSeqNum),
						catSeqNum, catTypeStr);
				catTypeStr = AppConstants.EMPL_INKIND;
				categorySelectionProfileManager.removeSequenceDetail(
						rmcSelPrfl, appNum, Short.parseShort(indvSeqNum),
						catSeqNum, catTypeStr);
				catTypeStr = AppConstants.SELF_EMPLOYMENT;
				categorySelectionProfileManager.removeSequenceDetail(
						rmcSelPrfl, appNum, Short.parseShort(indvSeqNum),
						catSeqNum, catTypeStr);

				if (categorySelectionProfileManager.isEmpty(rmcSelPrfl,
						catAllJobIncTypesMap) && rmcPrflJobIncNotRequired) {
					// make abs not required: Job Income Selection ARJSE,
					// Employment Details ARJID, Self Employment Details ARJSD
					// and Job Income Summary ARJIS
					final String[] pageIds = { "ARJSE", "ARJID", "ARJSD",
					"ARJIS" };
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, pageIds, driverArray,
							appNum);
				}

				if (categorySelectionProfileManager.isEmpty(rmcSelPrfl,
						catEmplTypesMap) && rmcPrflEmplNotRequired) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARJID", driverArray,
							appNum);
				}

				if (categorySelectionProfileManager.isEmpty(rmcSelPrfl,
						catSelfEmplTypeMap) && rmcPrflSelfEmplNotRequired) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARJSD", driverArray,
							appNum);
				}

			}

			// Unearned Income Details
			if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARUII",
					driverArray) != FwConstants.DRIVER_NOT_REQUIRED
					|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
							"ARUIT", driverArray) != FwConstants.DRIVER_NOT_REQUIRED
							|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
									"ARUID", driverArray) != FwConstants.DRIVER_NOT_REQUIRED
									|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
											"ARUIS", driverArray) != FwConstants.DRIVER_NOT_REQUIRED) {

				// delete from APP_IN_EMPL, APP_IN_EMPL_WAGE and APP_IN_SELFE
				movedInBO.deleteUnearnedIncomeDtls(indvSeqNum, appNum,
						AppConstants.RMC_NEW_RECORD_IND);

				// load rmcSelPrfl for Other Income Type
				rmcSelPrfl = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNum,
								AppConstants.RMC_CAT_OT_INC_PRFL);
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code
				 * in this block
				 */

				boolean rmcPrflUEINotRequired = false;
				// here we need to check we have no entrys in rmcPrfl for the
				// other income detail
				if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
					if (rmcResponseProfileManager.isAppResponseNotRequired(
							rmcInPrflColl,
							IRMCResponseProfileManager.OTHER_INCOME)) {
						rmcPrflUEINotRequired = true;
					}
				} else {
					rmcPrflUEINotRequired = true;
				}

				final Map catType = new HashMap();
				catType.put(AppConstants.RMC_CAT_OT_INC_PRFL,
						AppConstants.RMC_CAT_OT_INC_PRFL);

				if (categorySelectionProfileManager
						.isEmpty(rmcSelPrfl, catType) && rmcPrflUEINotRequired) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARUII", driverArray,
							appNum);
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARUIT", driverArray,
							appNum);
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARUID", driverArray,
							appNum);
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARUIS", driverArray,
							appNum);
				} else if (rmcPrflUEINotRequired) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARUIT", driverArray,
							appNum);
				}
			}

			// delete housing details
			if (driverManager.getAFBStatus(FwConstants.RMC_DRIVER, "ARXHU",
					driverArray) != FwConstants.DRIVER_NOT_REQUIRED
					|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
							"ARXHI", driverArray) != FwConstants.DRIVER_NOT_REQUIRED
							|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
									"ARXHD", driverArray) != FwConstants.DRIVER_NOT_REQUIRED
									|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
											"ARXUD", driverArray) != FwConstants.DRIVER_NOT_REQUIRED
											|| driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
													"ARXHS", driverArray) != FwConstants.DRIVER_NOT_REQUIRED) {

				// delete from APP_IN_EMPL, APP_IN_EMPL_WAGE and APP_IN_SELFE
				movedInBO.deleteHousingUtilityDtls(indvSeqNum, appNum,
						AppConstants.RMC_NEW_RECORD_IND);

				// load rmcSelPrfl for Other Income Type
				rmcSelPrfl = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNum,
								AppConstants.RMC_CAT_HO_EXP_PRFL);

				boolean rmcPrflHousingNotRequired = false;
				boolean rmcPrflUtilityNotRequired = false;
				// here we need to check we have no entrys in rmcPrfl for the
				// other income detail
				if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
					if (rmcResponseProfileManager.isAppResponseNotRequired(
							rmcInPrflColl,
							IRMCResponseProfileManager.PAY_HOUSING_BILL)) {
						rmcPrflHousingNotRequired = true;
					}
					if (rmcResponseProfileManager.isAppResponseNotRequired(
							rmcInPrflColl,
							IRMCResponseProfileManager.UTILITY_EXPENSE)) {
						rmcPrflUtilityNotRequired = true;
					}
				} else {
					rmcPrflHousingNotRequired = true;
					rmcPrflUtilityNotRequired = true;
				}

				final Map catType = new HashMap();
				catType.put(AppConstants.RMC_CAT_HO_EXP_PRFL,
						AppConstants.RMC_CAT_HO_EXP_PRFL);
				boolean catSelEmpty = false;
				catSelEmpty = categorySelectionProfileManager.isEmpty(
						rmcSelPrfl, catType);
				if (catSelEmpty
						&& (rmcPrflHousingNotRequired || rmcPrflUtilityNotRequired)) {

					if (rmcPrflHousingNotRequired) {
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, "ARXHD", driverArray,
								appNum);
					}

					if (rmcPrflUtilityNotRequired) {
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, "ARXUD", driverArray,
								appNum);
					}

					if (rmcPrflHousingNotRequired && rmcPrflUtilityNotRequired) {
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, "ARXHU", driverArray,
								appNum);
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, "ARXHI", driverArray,
								appNum);
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, "ARXHS", driverArray,
								appNum);
					}
				}

				if (rmcPrflHousingNotRequired && rmcPrflUtilityNotRequired) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARXHI", driverArray,
							appNum);
				}

			}
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseMovedInDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseMovedInDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseMovedInDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseMovedInDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseMovedInDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseMovedInDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endMovedInDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		// do nothing
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addMovedInDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addMovedInDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String movedInDtlsSeq = request.get("firstName_movedInDtls") != null ? (String) request
					.get("firstName_movedInDtls") : FwConstants.EMPTY_STRING;

					final MovedInBO movedInBO = new MovedInBO();
					final String appNum = (String) session.get(AppConstants.APP_NUMBER);
					final String indvSeqNumber = String.valueOf(movedInBO
							.loadMaxSeqNum(appNum) + 1);
					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
					indivSeqBean.setIndivSeqNum(movedInDtlsSeq);
					indivSeqBean.setIndivSeqNum(indvSeqNumber);
					indivSeqBean.setSeqNum(FwConstants.ONE);
					indivSeqBean.setType(AppConstants.PERSONAL_INFO);
					session.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);
					// added to test
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

					// set driver status
					final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
					driverManager.makeAddNew(FwConstants.RMC_DRIVER, "ARHMI", driver,
							appNum);
					driverManager.makeAddNew(FwConstants.RMC_DRIVER, "ARHMX", driver,
							appNum);
					final String[] requiredPages = { "ARHPG", "ARHCS", "ARHRL",
							"AROBC", "AROBS" };
					driverManager.makeRequired(FwConstants.RMC_DRIVER, requiredPages,
							driver, appNum);
					session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addMovedInDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addMovedInDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addMovedInDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addMovedInDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addMovedInDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	// EDSP CP ADDED Household changes screen:Starts
	/**
	 * Load people intermediate questions.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void loadPeopleIntermediateQuestions(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadPeopleIntermediateQuestions() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadPeopleIntermediateQuestions:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			beforeColl.get(AppConstants.NO_ONE_CHECKED_MAP);

			// Reading RMC_RESPONSE_Custom from Session
			final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl = new RMC_RESPONSE_Custom_Collection();
			// Determine Driver Status
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);

			// Calling Component manager to get the list of components
			// component ids are put into the pageCollection via this method
			// if rules exist, the individual custom collection is put into the
			// page collection
			componentManager.getComponents("ARPIQ", txnBean);

			// Getting page Collection
			final Map pageCollection = txnBean.getPageCollection();

			// check which responses are present in RMC_RQST table
			final RMB_RQST_Collection rmbRqstColl = (RMB_RQST_Collection) session
					.get(AppConstants.RMB_RQST_COLLECTION);
			final RMB_RQST_Cargo rmbRqstCargo = rmbRqstColl.getCargo(0);

			// Call create and load response maps to create the maps needed to
			// create the AFBIndividuals tags
			createandLoadARPIQResponseMapsToPageCollection(rmcRspnseCustomColl,
					pageCollection, peopleHandler, true, driverStatus, txnBean,
					rmbRqstCargo);
			if ((driverStatus == FwConstants.DRIVER_REQUIRED || driverStatus == FwConstants.DRIVER_VISIT_AGAIN)
					&& pageCollection.get(AppConstants.NO_ONE_CHECKED_MAP) != null) {
				final Map noOneMap = (Map) pageCollection
						.get(AppConstants.NO_ONE_CHECKED_MAP);
				noOneMap.put("NO_ONE_CHECKED_DB", FwConstants.NO);
				noOneMap.put("NO_ONE_CHECKED_DRUG_FELONY", FwConstants.NO);
				noOneMap.put("NO_ONE_CHECKED_PAR_VIOLATION", FwConstants.NO);
				noOneMap.put("NO_ONE_CHECKED_ROOMER", FwConstants.NO);
				pageCollection.put("NO_ONE_CHECKED_MAP", noOneMap);
			}

			final String[] securityResponse = new String[6];
			securityResponse[0] = FwConstants.READ_WRITE_ACCESS;
			securityResponse[1] = FwConstants.READ_WRITE_ACCESS;
			securityResponse[2] = FwConstants.READ_WRITE_ACCESS;
			securityResponse[3] = FwConstants.READ_WRITE_ACCESS;
			securityResponse[4] = FwConstants.READ_WRITE_ACCESS;
			securityResponse[5] = FwConstants.READ_WRITE_ACCESS;

			final int aARPIQPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, "ARPIQ", driverArray);

			// If the page was already completed we need to see if the detail
			// pages for the moved in and moved out pages were completed
			if (aARPIQPageStatus == FwConstants.DRIVER_COMPLETE
					|| aARPIQPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {

				// Check to see if anyone was moved into the home
				final INDIVIDUAL_Custom_Collection indvColl = peopleHandler
						.getAllIndividuals();
				for (int i = 0; i < indvColl.size(); i++) {
					final INDIVIDUAL_Custom_Cargo indvCargo = indvColl
							.getResult(i);
					if (indvCargo.getIndv_pin_num() == null
							|| FwConstants.ZERO.equals(indvCargo
									.getIndv_pin_num())) {
						securityResponse[0] = FwConstants.READ_ONLY_ACCESS;
						break;
					}
				}

				// Check to see if the moved out detail page was completed
				if (DriverManager.getInstance().getAFBStatus(
						FwConstants.RMC_DRIVER, "ARHMO", driverArray) != FwConstants.DRIVER_REQUIRED
						&& DriverManager.getInstance().getAFBStatus(
								FwConstants.RMC_DRIVER, "ARHMO", driverArray) != FwConstants.DRIVER_NOT_REQUIRED) {

					securityResponse[1] = FwConstants.READ_ONLY_ACCESS;
					securityResponse[2] = FwConstants.READ_WRITE_ACCESS;
					securityResponse[3] = FwConstants.READ_WRITE_ACCESS;
					securityResponse[4] = FwConstants.READ_WRITE_ACCESS;
					securityResponse[5] = FwConstants.READ_WRITE_ACCESS;
				}
			}

			pageCollection.put("RESPONSE", securityResponse);
			pageCollection.put("DRIVER_STATUS", new Integer(driverStatus));
			pageCollection.put("RMB_Rqst_Cargo", rmbRqstCargo);
			pageCollection.put("PEOPLE_INTER_RESP_COLL_BEFORE",
					rmcRspnseCustomColl);
			displayProgramSpecificInfo(session, pageCollection);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code in
			 * this block
			 */

			txnBean.setPageCollection(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION,
					txnBean.getPageCollection());
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadPeopleIntermediateQuestions:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadPeopleIntermediateQuestions");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPeopleIntermediateQuestions");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadPeopleIntermediateQuestions", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadPeopleIntermediateQuestions");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadPeopleIntermediateQuestions() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	// EDSP CP ADDED Household changes screen:Ends
	// EDSP CP ADDED Household changes screen:Starts
	/**
	 * PCR# 40362 - RMB changes Method for Loading the Response Map.
	 *
	 * @param rmcRspnseCustomColl the rmc rspnse custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @param txnBean the txn bean
	 * @param rmbRqstCargo the rmb rqst cargo
	 * @return the map
	 */
	private Map createandLoadARPIQResponseMapsToPageCollection(
			final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean pageLoad, final int driverStatus,
			final FwTransaction txnBean, final RMB_RQST_Cargo rmbRqstCargo) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.createandLoadARPIQResponseMapsToPageCollection() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::createandLoadARPIQResponseMapsToPageCollection:Start");

			getPeopleCollectionAndUpdateMaps(rmcRspnseCustomColl,
					pageCollection, peopleHandler, AppConstants.LEFT_THE_HOME,
					false, txnBean, rmbRqstCargo, true); // 5196

			getPeopleCollectionAndUpdateMaps(rmcRspnseCustomColl,
					pageCollection, peopleHandler, AppConstants.DISABLED_BLIND,
					false, txnBean, rmbRqstCargo, true); // 5197

			getPeopleCollectionAndUpdateMaps(rmcRspnseCustomColl,
					pageCollection, peopleHandler,
					AppConstants.BECAME_DRUG_FELONY, false, txnBean,
					rmbRqstCargo, true);
			// PEOPLE_5199 is being put into pageCollection unknown where
			if (pageCollection.get("PEOPLE_5199") != null) {
				pageCollection.remove("PEOPLE_5199");
			}
			getPeopleCollectionAndUpdateMapsForEDSP(rmcRspnseCustomColl,
					pageCollection, peopleHandler, "5199", false, txnBean,
					rmbRqstCargo, true);

			getPeopleCollectionAndUpdateMapsForEDSP(rmcRspnseCustomColl,
					pageCollection, peopleHandler, "5200", false, txnBean,
					rmbRqstCargo, true);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::createandLoadARPIQResponseMapsToPageCollection:End");
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.createandLoadARPIQResponseMapsToPageCollection() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createandLoadARPIQResponseMapsToPageCollection");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"createandLoadARPIQResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createandLoadARPIQResponseMapsToPageCollection");
		}

	}

	// EDSP CP ADDED Household changes screen:Ends

	// EDSP CP ADDED Household changes screen:Starts
	/**
	 * Store people intermediate questions.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storePeopleIntermediateQuestions(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storePeopleIntermediateQuestions() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storePeopleIntermediateQuestions:Start");
			final Map request = txnBean.getRequest();
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			// get app_num from session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final RMBRequestManager rmbRqstManager = new RMBRequestManager();

			RMC_RESPONSE_Custom_Collection rmcRespCustomColl = new RMC_RESPONSE_Custom_Collection();
			rmcRespCustomColl = (RMC_RESPONSE_Custom_Collection) pageCollection
					.get("RMC_RESPONSE_Custom_Collection");

			final NO_ONE_Collection noOneColl = (NO_ONE_Collection) pageCollection
					.get("NO_ONE_Collection");

			final Map noOneCheckedMap = (Map) beforeColl
					.get(AppConstants.NO_ONE_CHECKED_MAP);

			final RMB_RQST_Collection pageRMBRqstColl = (RMB_RQST_Collection) pageCollection
					.get("RMB_RQST_Collection");
			RMB_RQST_Cargo pageRMBRqstCargo = pageRMBRqstColl.getCargo(0);

			final RMB_RQST_Collection sessRMBRqstColl = (RMB_RQST_Collection) session
					.get(AppConstants.RMB_RQST_COLLECTION);
			final RMB_RQST_Cargo sessRMBRqstCargo = sessRMBRqstColl.getCargo(0);
			// get driver array from session
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// get people handler from session
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			// get compoenet list from before collection
			final List componentList = (ArrayList) beforeColl
					.get(FwConstants.PAGE_COMPONENT_LIST);

			FwMessageList validateInfo = null;
			final ARPIQValidator validationBO = new ARPIQValidator();
			// check for back to my access
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			if (backToMyAccess == null) {
				validateInfo = validationBO.validateARPIQ(pageRMBRqstCargo,
						noOneCheckedMap, noOneColl, componentList,
						rmcRespCustomColl, sessRMBRqstCargo);
			}

			if (checkBackToMyAccessSelected(request) || validateInfo != null
					&& validateInfo.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				// vgundlap
				displayProgramSpecificInfo(session, pageCollection);
				componentManager.getComponents("ARPIQ", txnBean);

				if (!checkForWarningMesgs(reqWarningMsgs,
						validationBO.getMessageList())) {
					if (backToMyAccess == null) {
						request.put(FwConstants.MESSAGE_LIST,
								validationBO.getMessageList());
					}

					getPeopleCollectionForValidationARPIQ(rmcRespCustomColl,
							pageCollection, peopleHandler, /* "5196" */
							AppConstants.LEFT_THE_HOME, false, txnBean);
					getPeopleCollectionForValidationARPIQ(rmcRespCustomColl,
							pageCollection, peopleHandler, /* "5197" */
							AppConstants.DISABLED_BLIND, false, txnBean);
					getPeopleCollectionForValidationARPIQ(rmcRespCustomColl,
							pageCollection, peopleHandler, /* "5198" */
							AppConstants.BECAME_DRUG_FELONY, false, txnBean);
					// PEOPLE_5199 is being put into pageCollection unknown
					// where
					if (pageCollection.get("PEOPLE_5199") != null) {
						pageCollection.remove("PEOPLE_5199");
					}
					getPeopleCollectionForValidationARPIQ(rmcRespCustomColl,
							pageCollection, peopleHandler, "5199", false,
							txnBean);
					getPeopleCollectionForValidationARPIQ(rmcRespCustomColl,
							pageCollection, peopleHandler, "5200", false,
							txnBean);

					pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
							beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented
					 * Code in this block
					 */

					pageCollection.put("RMB_Rqst_Cargo", sessRMBRqstCargo);
					pageCollection.put("PEOPLE_INTER_RESP_COLL_BEFORE",
							beforeColl.get("PEOPLE_INTER_RESP_COLL_BEFORE"));
					if (beforeColl.containsKey("RESPONSE")) {
						pageCollection.put("RESPONSE",
								beforeColl.get("RESPONSE"));
					}
					txnBean.setPageCollection(pageCollection);
					return;
				}
			}

			// Moved-in or moved out question store logic
			boolean moveInReqFlag = false;
			boolean moveOutReqFlag = false;

			// call request manager to get complete cargo
			RMB_RQST_Cargo rmbRqstCargo = rmbRqstManager.getCompleteCargo(
					sessRMBRqstCargo, pageRMBRqstCargo);
			// now call ischanged
			rmbRqstCargo = (RMB_RQST_Cargo) isChanged(sessRMBRqstCargo,
					rmbRqstCargo);

			if (rmbRqstCargo.isDirty()) {
				final RMB_RQST_Collection rmbRqstColl = new RMB_RQST_Collection();
				rmbRqstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				rmbRqstColl.addCargo(rmbRqstCargo);
				rmbRqstManager.storeRMBRqst(rmbRqstColl);
				// put the update RMB_RQST_Collection into session
				session.put(AppConstants.RMB_RQST_COLLECTION, rmbRqstColl);
			}
			pageRMBRqstCargo = rmbRqstCargo;
			// STRAT - ROOM & BORADER / PROBATION PAROLE
			final short[] responseArray = new short[] {
					IRMCResponseProfileManager.ROOM_BOARD,
					IRMCResponseProfileManager.PAROLE_VIOLATION };
			final int driverStatusA = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
			final RMC_IN_PRFL_Collection rmcInPrflSessColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection rmcPrflPageColl = new RMC_IN_PRFL_Collection();
			RMC_IN_PRFL_Cargo rmcPrflPageCargo = null;
			// create RMC_IN_PRFL Collection from Custom Collection
			for (int i = 0; i < rmcRespCustomColl.size(); i++) {
				final RMC_RESPONSE_Custom_Cargo cargo = rmcRespCustomColl
						.getCargo(i);
				rmcPrflPageCargo = new RMC_IN_PRFL_Cargo();
				rmcPrflPageCargo.setIndv_seq_num(cargo.getIndvSeqNum());
				if ("RO".equals(cargo.getCategoryType())) {
					rmcPrflPageCargo.setRoom_board_resp(FwConstants.YES);
				}
				if ("PR".equals(cargo.getCategoryType())) {
					rmcPrflPageCargo.setParole_violation_resp(FwConstants.YES);
				}
				rmcPrflPageColl.addCargo(rmcPrflPageCargo);
			}
			//
			if (rmcPrflPageColl != null) {
				// populating missing app in profile collection into page
				// collection for enter key press
				rmcResponseProfileManager.preparePageColl(rmcPrflPageColl,
						rmcInPrflSessColl, responseArray);

				final int rmcInPrflSessCollectionSize = rmcInPrflSessColl
						.size();
				final int rmcInPrflPageCollectionSize = rmcPrflPageColl.size();
				RMC_IN_PRFL_Cargo rmcInPrflPageCargo = null;
				String[] translatedProfileArray = null;
				String indivSeqNum = null;

				final int[] roomAndBoardDirtyIndicator = { IRMCResponseProfileManager.NOT_DIRTY };
				final int[] paroleProbationDirtyIndicator = { IRMCResponseProfileManager.NOT_DIRTY };

				final Map indvResponseMap = new HashMap();
				final boolean[] dirtyIndicatorArray = new boolean[rmcResponseProfileManager
				                                                  .getMaxIndvSeqNumber(rmcInPrflSessColl) + 1];
				// Loop for each individual in session app indv profile
				for (int s = 0; s < rmcInPrflSessCollectionSize; s++) {

					final RMC_IN_PRFL_Cargo rmcInPrflSessCargo = rmcInPrflSessColl
							.getCargo(s);
					// Loop for each individual in page collection app indv
					// profile
					for (int p = 0; p < rmcInPrflPageCollectionSize; p++) {
						rmcInPrflPageCargo = rmcPrflPageColl.getCargo(p);
						// Picking up the matching individuals of session app
						// indv profile from page collection app indv profile
						if (rmcInPrflPageCargo.getIndv_seq_num().equals(
								rmcInPrflSessCargo.getIndv_seq_num())) {
							translatedProfileArray = new String[responseArray.length];

							indivSeqNum = rmcInPrflPageCargo.getIndv_seq_num();

							if (rmcInPrflPageCargo.getRoom_board_resp() != null) {
								// room and board response
								if (rmcResponseProfileManager
										.determineDirtyStatus(
												rmcInPrflPageCargo
												.getRoom_board_resp(),
												rmcInPrflSessCargo
												.getRoom_board_resp(),
												roomAndBoardDirtyIndicator,
												driverStatusA)) {
									if (!dirtyIndicatorArray[0]) {
										dirtyIndicatorArray[0] = true;
									}
									dirtyIndicatorArray[Integer
									                    .parseInt(indivSeqNum)] = true;
								}

								/*
								 * VG SONAR Cleanup - 08/31/2015 Deleted 2,2
								 * lines Commented Code in this block
								 */

								if (rmcInPrflPageCargo.getRoom_board_resp() != null) {
									translatedProfileArray[0] = rmcInPrflPageCargo
											.getRoom_board_resp();
									rmcInPrflSessColl
									.getCargo(s)
									.setRoom_board_resp(
											rmcInPrflPageCargo
											.getRoom_board_resp());
								} else {
									translatedProfileArray[0] = FwConstants.NO;
								}

							} else {
								translatedProfileArray[0] = FwConstants.NO;
							}
							if (rmcInPrflPageCargo.getParole_violation_resp() != null) {
								// parole probation response
								if (rmcResponseProfileManager
										.determineDirtyStatus(
												rmcInPrflPageCargo
												.getParole_violation_resp(),
												rmcInPrflSessCargo
												.getParole_violation_resp(),
												paroleProbationDirtyIndicator,
												driverStatusA)) {
									if (!dirtyIndicatorArray[0]) {
										dirtyIndicatorArray[0] = true;
									}
									dirtyIndicatorArray[Integer
									                    .parseInt(indivSeqNum)] = true;
								}

								if (rmcInPrflPageCargo
										.getParole_violation_resp() != null) {
									translatedProfileArray[1] = rmcInPrflPageCargo
											.getParole_violation_resp();
									rmcInPrflSessColl
									.getCargo(s)
									.setParole_violation_resp(
											rmcInPrflPageCargo
											.getParole_violation_resp());
								} else {
									translatedProfileArray[1] = FwConstants.NO;
								}
							} else {
								translatedProfileArray[1] = FwConstants.NO;
							}

							indvResponseMap.put(indivSeqNum,
									translatedProfileArray);
							// breaking to pick the next matching individual
							// from session app indv profile

						}
					}
				}
				// Persistence logic start
				if (dirtyIndicatorArray[0]) {
					String indvSeqNumber = null;
					for (int i = 0; i < rmcInPrflPageCollectionSize; i++) {
						indvSeqNumber = rmcPrflPageColl.getCargo(i)
								.getIndv_seq_num();
						// Changed indvSeqNum to indvSeqNumber
						if (dirtyIndicatorArray[Integer.parseInt(indvSeqNumber)]) {
							rmcResponseProfileManager.persist(appNum,
									indvSeqNumber, responseArray,
									(String[]) indvResponseMap
									.get(indvSeqNumber));
						}
					}
				}
			}

			session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflSessColl);

			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, "ARPIQ", driverArray);
			final int pageARHMIStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, "ARHMI", driverArray);
			final int pageARHMOStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, "ARHMO", driverArray);
			if (pageStatus == FwConstants.DRIVER_REQUIRED) {
				if (FwConstants.YES.equals(pageRMBRqstCargo
						.getPrsn_add_stat_ind())) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMI",
							driverArray, appNum);
					moveInReqFlag = true;
				}

				if (FwConstants.YES.equals(pageRMBRqstCargo
						.getPrsn_move_stat_ind())) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO",
							driverArray, appNum);
					moveOutReqFlag = true;
				}
			} else {
				if (FwConstants.YES.equals(pageRMBRqstCargo
						.getPrsn_add_stat_ind())
						&& (FwConstants.NO.equals(sessRMBRqstCargo
								.getPrsn_add_stat_ind()) || FwConstants.HIDDEN
								.equals(sessRMBRqstCargo.getPrsn_add_stat_ind()))) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMI",
							driverArray, appNum);
					moveInReqFlag = true;
				} else if (FwConstants.YES.equals(pageRMBRqstCargo
						.getPrsn_add_stat_ind())
						&& FwConstants.YES.equals(sessRMBRqstCargo
								.getPrsn_add_stat_ind())
								&& (pageARHMIStatus == FwConstants.DRIVER_REQUIRED || pageARHMIStatus == FwConstants.DRIVER_VISIT_AGAIN)) {
					moveInReqFlag = true;
				}

				if (FwConstants.YES.equals(pageRMBRqstCargo
						.getPrsn_move_stat_ind())
						&& (FwConstants.NO.equals(sessRMBRqstCargo
								.getPrsn_move_stat_ind()) || FwConstants.HIDDEN
								.equals(sessRMBRqstCargo
										.getPrsn_move_stat_ind()))) {
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMO",
							driverArray, appNum);
					moveOutReqFlag = true;
				} else if (FwConstants.YES.equals(pageRMBRqstCargo
						.getPrsn_move_stat_ind())
						&& FwConstants.YES.equals(sessRMBRqstCargo
								.getPrsn_move_stat_ind())
								&& (pageARHMOStatus == FwConstants.DRIVER_REQUIRED || pageARHMOStatus == FwConstants.DRIVER_VISIT_AGAIN)) {
					moveOutReqFlag = true;
				}
			}

			if (!moveInReqFlag) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMI", driverArray, appNum);
			}
			if (!moveOutReqFlag) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMO", driverArray, appNum);
			}

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			if (categorySelectionProfile == null
					|| categorySelectionProfile.isEmpty()) {
				categorySelectionProfile = categorySelectionProfileManager
						.buildSelectionProfile(rmcRespCustomColl, appNum,
								AppConstants.RMC_CAT_HO_COMP_PRFL);
			} else {
				final List catTypeList = new ArrayList();
				catTypeList.add(AppConstants.LEFT_THE_HOME);
				catTypeList.add(AppConstants.DISABLED_BLIND);

				categorySelectionProfileManager.rebuildSelectionProfile(
						categorySelectionProfile, rmcRespCustomColl, appNum,
						AppConstants.RMC_CAT_HO_COMP_PRFL, catTypeList);
			}

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);

			request.get(FwConstants.CURRENT_PAGE_ID);


			final Map pageIdCatTypeHm = new HashMap();
			pageIdCatTypeHm.put(AppConstants.LEFT_THE_HOME, "ARHMO");
			pageIdCatTypeHm.put(AppConstants.DISABLED_BLIND, "ARHDD");

			// Reading Page Collection from txnBean
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code in
			 * this block
			 */

			final RMC_RESPONSE_Custom_Collection rmcRespBeforeColl = (RMC_RESPONSE_Custom_Collection) beforeColl
					.get("PEOPLE_INTER_RESP_COLL_BEFORE");

			final Map beforeCollMap = new HashMap();
			final int rmcRespBeforeCollSize = rmcRespBeforeColl.size();
			for (int i = 0; i < rmcRespBeforeCollSize; i++) {
				final RMC_RESPONSE_Custom_Cargo beforeCargo = (RMC_RESPONSE_Custom_Cargo) rmcRespBeforeColl
						.get(i);
				final String beforeCargoCatType = beforeCargo.getCategoryType();
				final String beforeCargoIndivSeqNum = beforeCargo
						.getIndvSeqNum();
				String beforeCargoResponse = null;
				if (beforeCargo.getResponse() != null
						&& beforeCargo.getResponse().trim().length() > 0) {
					beforeCargoResponse = beforeCargo.getResponse();
				}
				final String key = beforeCargoCatType + "_"
						+ beforeCargoIndivSeqNum;
				final String value = beforeCargoResponse;
				beforeCollMap.put(key, value);
			}

			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			indivColl = peopleHandler.getAllIndividuals();
			boolean isAnySelection = false;
			final Iterator itr = pageIdCatTypeHm.keySet().iterator();
			// for each category
			while (itr.hasNext()) {
				final String catId = (String) itr.next();
				final int indivCollSize = indivColl.size();
				final List changesList = new ArrayList(indivCollSize);
				final String pageId = (String) pageIdCatTypeHm.get(catId);
				// for each individual
				for (int i = 0; i < indivCollSize; i++) {
					final INDIVIDUAL_Custom_Cargo indivCargo = indivColl
							.getResult(i);
					final String indivSeqNum = indivCargo.getIndv_seq_num();
					final short catSeqNum = 0;
					final char currentResponse = categorySelectionProfileManager
							.getSequenceDetailStatus(categorySelectionProfile,
									Short.parseShort(indivSeqNum), catSeqNum,
									catId);
					final String currRespStr = String.valueOf(currentResponse);
					final String beforeResp = (String) beforeCollMap.get(catId
							+ "_" + indivSeqNum);

					if (!currRespStr
							.equals(String
									.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))) {
						isAnySelection = true;
					}

					if (currRespStr.equals(beforeResp)) {
						if (!FwConstants.NO.equals(currRespStr)) {
							if (currRespStr
									.equals(String
											.valueOf(ICategorySelectionProfileManager.STATUS_COMPLETE))
											|| currRespStr
											.equals(String
													.valueOf(ICategorySelectionProfileManager.STATUS_VISIT_AGAIN))) {
								changesList.add("Comp");
							} else {
								changesList.add("Req");
							}
						} else if (FwConstants.NO.equals(currRespStr)) {
							changesList.add("NotReq");
						}

					}
					// if there was a selection before and no selection now
					if (beforeResp != null
							&& !beforeResp
							.equals(String
									.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))
									&& currRespStr
									.equals(String
											.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))) {
						changesList.add("makeAbsNotReq");
					} else if ((beforeResp == null || beforeResp
							.equals(String
									.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED)))
									&& !currRespStr
									.equals(String
											.valueOf(ICategorySelectionProfileManager.STATUS_NOT_REQUIRED))) {
						// if no selection before and a selection now
						changesList.add("makeReq");
					}
				}
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1,1,1,1,3 lines
				 * Commented Code in this block
				 */

				if (changesList.contains("makeReq")) {
					final int driverStatus = driverManager.getAFBStatus(
							FwConstants.RMC_DRIVER, pageId, driverArray);
					if (driverStatus == FwConstants.DRIVER_COMPLETE
							|| driverStatus == FwConstants.DRIVER_VISIT_AGAIN) {
						driverManager.makeAbsoluteNotRequired(
								FwConstants.RMC_DRIVER, pageId, driverArray,
								appNum);
					}
					driverManager.makeRequired(FwConstants.RMC_DRIVER, pageId,
							driverArray, appNum);

				} else if (!changesList.contains("makeReq")
						&& !changesList.contains("Req")
						&& changesList.contains("makeAbsNotReq")) {
					driverManager.getAFBStatus(FwConstants.RMC_DRIVER, pageId,
							driverArray);

					driverManager
					.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
							pageId, driverArray, appNum);

				}
				if (changesList.contains("Comp")
						&& !changesList.contains("Req")
						&& !changesList.contains("makeReq")) {
					final int driverStatus = driverManager.getAFBStatus(
							FwConstants.RMC_DRIVER, pageId, driverArray);
					if (driverStatus != FwConstants.DRIVER_REQUIRED) {
						driverManager.makeComplete(FwConstants.RMC_DRIVER,
								pageId, driverArray, appNum);
					}
				}

			}

			if (isAnySelection) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
						driverArray, appNum);
			} else {
				// Checking the driver status & if it is not any of the
				// following calling 'makeAbsoluteNotRequired'
				final int driverStatus = driverManager.getAFBStatus(
						FwConstants.RMC_DRIVER, "ARHCS", driverArray);
				if (driverStatus != FwConstants.DRIVER_COMPLETE
						&& driverStatus != FwConstants.DRIVER_REQUIRED
						&& driverStatus != FwConstants.DRIVER_VISIT_AGAIN) {
					driverManager.makeAbsoluteNotRequired(
							FwConstants.RMC_DRIVER, "ARHCS", driverArray,
							appNum);
				}
			}

			// logic reuired
			// EDSP

			pageCollection.put("HOUSEHOLD_COMP_INDV_SEL_RESP_COLL_BEFORE",
					rmcRespCustomColl);
			txnBean.setPageCollection(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
			session.put(FwConstants.RMC_DRIVER, driverArray);
			txnBean.setSession(session);

			// Make PeopleIntermediate Questions page complete
			driverManager.makeComplete(FwConstants.RMC_DRIVER, "ARPIQ",
					driverArray, appNum);
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storePeopleIntermediateQuestions:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storePeopleIntermediateQuestions");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePeopleIntermediateQuestions");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storePeopleIntermediateQuestions", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storePeopleIntermediateQuestions");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storePeopleIntermediateQuestions() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	// EDSP CP ADDED Household changes screen:Ends
	// EDSP CP ADD:Starts

	/**
	 * Gets the people collection and update maps.
	 *
	 * @param rmcRespCustomColl the rmc resp custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param categoryID the category id
	 * @param getRelevant the get relevant
	 * @param txnBean the txn bean
	 * @param rmbRqstCargo the rmb rqst cargo
	 * @param pageLoad the page load
	 * @return the people collection and update maps
	 */
	public Map getPeopleCollectionAndUpdateMaps(
			final RMC_RESPONSE_Custom_Collection rmcRespCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String categoryID, final boolean getRelevant,
			final FwTransaction txnBean, final RMB_RQST_Cargo rmbRqstCargo,
			final boolean pageLoad) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - START");
		try {
			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo = new INDIVIDUAL_Custom_Cargo();
			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			final INDIVIDUAL_Custom_Collection indivFilColl = new INDIVIDUAL_Custom_Collection();
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(categoryID);
			final Map session = txnBean.getSession();

			indivColl = peopleHandler.getAllIndividuals();

			if (AppConstants.BECAME_PREGNANT.equals(categoryID)) {
				indivColl = PeopleRulesBO.getPregnantableIndividuals(indivColl);
			}

			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			RMC_RESPONSE_Custom_Cargo rmcRspnseCustomCargo = null;

			String questionResp = FwConstants.NO;
			final SortedSet selectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final short catSeqNum = 0;
			String noOneChecked = FwConstants.YES;

			// loop individual collection and remove the indiv cargo who's
			// DABLResp is YES- for Disability Type
			if (AppConstants.DISABLED_BLIND.equals(categoryID)) {
				for (int i = 0; i < indivColl.size(); i++) {
					indivCargo = indivColl.getResult(i);
					String tempDABLResp = FwConstants.NO;
					if (indivCargo.getDabl_resp() != null) {
						tempDABLResp = indivCargo.getDabl_resp();
					} else {
						indivFilColl.addCargo(indivCargo);
					}
					if (indivCargo.getDabl_resp() != null
							&& FwConstants.NO.equals(tempDABLResp)) {
						indivFilColl.addCargo(indivCargo);
					}
				}
			}

			if (AppConstants.DISABLED_BLIND.equals(categoryID)) {
				indivColl = indivFilColl;
			}
			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivColl.size(); i++) {
				indivCargo = indivColl.getResult(i);
				indivSeqNum = indivCargo.getIndv_seq_num();
				questionResp = FwConstants.NO;
				String newPregOption = FwConstants.NO;
				String newDrugFelony = FwConstants.NO;

				if (selectionProfile != null) {
					questionResp = String
							.valueOf(categorySelectionProfileManager
									.getSequenceDetailStatusView(
											selectionProfile,
											Short.parseShort(indivSeqNum),
											catSeqNum, categoryID));
				}
				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

				if (AppConstants.BECAME_DRUG_FELONY.equals(categoryID)) {
					if ("R".equals(questionResp)) {
						newDrugFelony = FwConstants.YES;
						pageCollection.put("predDrugAddSel", newDrugFelony);
						pageCollection.put("DRUGACCESS",
								FwConstants.READ_WRITE_ACCESS);
					} else if ("C".equals(questionResp)
							|| "V".equals(questionResp)
							|| "A".equals(questionResp)) {
						newDrugFelony = FwConstants.YES;
						pageCollection.put("predDrugAddSel", newDrugFelony);
						pageCollection.put("DRUGACCESS",
								FwConstants.READ_ONLY_ACCESS);
					}
				}
				if (AppConstants.BECAME_PREGNANT.equals(categoryID)) {
					if ("R".equals(questionResp)) {
						newPregOption = FwConstants.YES;
						pageCollection.put("predAddSel", newPregOption);
						pageCollection.put("PREGACCESS",
								FwConstants.READ_WRITE_ACCESS);
					} else if ("C".equals(questionResp)
							|| "V".equals(questionResp)
							|| "A".equals(questionResp)) {
						newPregOption = FwConstants.YES;
						pageCollection.put("predAddSel", newPregOption);
						pageCollection.put("PREGACCESS",
								FwConstants.READ_ONLY_ACCESS);
					}
				}

				if (pageLoad == true) {
					// for each question, set the noOneChecked flag
					// check if there is anything other than not required - if
					// so, change flag
					if (AppConstants.DISABLED_BLIND.equals(categoryID)
							&& ("R".equals(questionResp) || "C"
									.equals(questionResp))) {

						noOneChecked = FwConstants.NO;
					}
				}
				// create the cargo
				if (rmbRqstCargo != null) {
					boolean isAddCargo = false;

					if (AppConstants.LEFT_THE_HOME.equals(categoryID)) {
						if (rmbRqstCargo.getPrsn_move_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getPrsn_move_stat_ind())) {
							isAddCargo = true;
						}

					} else if (AppConstants.DISABLED_BLIND.equals(categoryID)) {
						if (rmbRqstCargo.getDabl_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getDabl_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.INDV_DMGRPH_CHANGE.equals(categoryID)) {
						if (rmbRqstCargo.getHshl_chg_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getHshl_chg_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.BECAME_PREGNANT.equals(categoryID)) {
						if (rmbRqstCargo.getPreg_chg_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getPreg_chg_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.PREGNANCY_ENDED.equals(categoryID)) {
						if (rmbRqstCargo.getPreg_chg_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getPreg_chg_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.PREGNANCY_CHANGE.equals(categoryID)) {
						if (rmbRqstCargo.getPreg_chg_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getPreg_chg_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.BECAME_DRUG_FELONY.equals(categoryID)) {
						if (rmbRqstCargo.getDrug_feln_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getDrug_feln_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.CHANGE_DRUG_FELONY.equals(categoryID)) {
						if (rmbRqstCargo.getDrug_feln_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getDrug_feln_stat_ind())) {
							isAddCargo = true;
						}
					}

					if (isAddCargo) {
						rmcRspnseCustomCargo = new RMC_RESPONSE_Custom_Cargo();
						rmcRspnseCustomCargo.setIndvSeqNum(indivSeqNum);
						rmcRspnseCustomCargo.setCategoryType(categoryID);
						rmcRspnseCustomCargo.setResponse(questionResp);
						rmcRespCustomColl.addCargo(rmcRspnseCustomCargo);
					}
				}

			}// end for loop

			if (pageLoad == true) {
				// get the NoOneChecked map from the pagecollection
				Map noOneCheckedMap = (Map) pageCollection
						.get(AppConstants.NO_ONE_CHECKED_MAP);
				if (noOneCheckedMap == null) {
					noOneCheckedMap = new HashMap();
				}

				// update the noOneCheckedMap and re-add it to the page coll
				final StringBuilder noOneCheckedString = new StringBuilder();
				noOneCheckedString.append(AppConstants.NO_ONE_CHECKED);
				noOneCheckedString.append(AppConstants.DISABLED_BLIND);
				noOneCheckedMap
				.put(noOneCheckedString.toString(), noOneChecked);
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
			}

			// Store all maps in page collection
			String respMapString = new String();
			respMapString = AppConstants.RESP_MAP;
			respMapString = respMapString + categoryID;
			pageCollection.put(respMapString, questionRespMap);

			// store people collection in page collection
			String peopleString = new String();
			peopleString = AppConstants.PEOPLE;
			peopleString = peopleString + categoryID;
			pageCollection.put(peopleString, indivColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMaps");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionAndUpdateMaps", e);
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMaps");
		}
	}

	// EDSP CP ADD:Ends
	/**
	 * Gets the people collection for validation arpiq.
	 *
	 * @param currRespCustomColl the curr resp custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param categoryID the category id
	 * @param getRelevant the get relevant
	 * @param txnBean the txn bean
	 * @return the people collection for validation arpiq
	 */
	// EDSP CP ADDED Household changes screen:Starts
	public Map getPeopleCollectionForValidationARPIQ(
			final RMC_RESPONSE_Custom_Collection currRespCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String categoryID, final boolean getRelevant,
			final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionForValidationARPIQ() - START");
		try {
			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo = new INDIVIDUAL_Custom_Cargo();
			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(categoryID);
			final Map session = txnBean.getSession();

			// try to get a filtered list. If it doesn't exist, get the
			// peopleHandler getIndividuals
			if (pageCollection.get(indivCollKey.toString()) == null) {
				if (getRelevant) {
					indivColl = peopleHandler.getRelevantIndividuals();
				} else {
					indivColl = peopleHandler.getAllIndividuals();
				}
			} else {
				indivColl = (INDIVIDUAL_Custom_Collection) pageCollection
						.get(indivCollKey.toString());
			}

			// loop individual collection and remove the indiv cargo who's
			// DABLResp is YES- for Disability Type
			final INDIVIDUAL_Custom_Collection indivFilColl = new INDIVIDUAL_Custom_Collection();

			if (AppConstants.DISABLED_BLIND.equals(categoryID)) {
				for (int i = 0; i < indivColl.size(); i++) {
					indivCargo = indivColl.getResult(i);
					String tempDABLResp = FwConstants.NO;
					if (indivCargo.getDabl_resp() != null) {
						tempDABLResp = indivCargo.getDabl_resp();
					} else {
						indivFilColl.addCargo(indivCargo);
					}
					if (indivCargo.getDabl_resp() != null
							&& FwConstants.NO.equals(tempDABLResp)) {
						indivFilColl.addCargo(indivCargo);
					}
				}
			}

			if (AppConstants.DISABLED_BLIND.equals(categoryID)) {
				indivColl = indivFilColl;
			}

			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			final SortedSet selectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final short catSeqNum = 0;
			// get size of the collection
			final int indivCollSize = indivColl.size();
			String questionResp = new String();
			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				// get the indivCargo
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);

				// get app_indiv_seq_num
				indivSeqNum = indivCargo.getIndv_seq_num();

				// get the AIP Response for the given question from this cargo
				questionResp = FwConstants.NO;
				final int currRespCustomCollSize = currRespCustomColl.size();
				final Map catTyepMap = new HashMap();
				catTyepMap.put(categoryID, categoryID);
				for (int j = 0; j < currRespCustomCollSize; j++) {
					final RMC_RESPONSE_Custom_Cargo tempCargo = (RMC_RESPONSE_Custom_Cargo) currRespCustomColl
							.get(j);
					if (tempCargo.getIndvSeqNum().equals(indivSeqNum)
							&& categoryID.equals(tempCargo.getCategoryType())) {
						if (selectionProfile != null
								&& !categorySelectionProfileManager.isEmpty(
										selectionProfile, catTyepMap)) {
							questionResp = String
									.valueOf(categorySelectionProfileManager.getSequenceDetailStatusView(
											selectionProfile,
											Short.parseShort(indivSeqNum),
											catSeqNum, categoryID));
							if (questionResp != null
									&& questionResp.trim().length() == 0) {
								questionResp = String
										.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
							}
						} else {
							questionResp = String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
						}
						break;
					}
				}
				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

			}// end for loop

			// get the NoOneChecked map from the pagecollection
			Map noOneCheckedMap = (Map) pageCollection
					.get(AppConstants.NO_ONE_CHECKED_MAP);
			if (noOneCheckedMap == null) {
				noOneCheckedMap = new HashMap();
			}

			final String noOneChecked = FwConstants.NO;
			// update the noOneCheckedMap and re-add it to the page coll
			final StringBuilder noOneCheckedString = new StringBuilder();
			noOneCheckedString.append(AppConstants.NO_ONE_CHECKED);
			noOneCheckedString.append(AppConstants.DISABLED_BLIND);
			noOneCheckedMap.put(noOneCheckedString.toString(), noOneChecked);
			pageCollection
			.put(AppConstants.NO_ONE_CHECKED_MAP, noOneCheckedMap);

			// Store all maps in page collection
			String respMapString = new String();
			respMapString = AppConstants.RESP_MAP;
			respMapString = respMapString + categoryID;
			pageCollection.put(respMapString.toString(), questionRespMap);

			// store people collection in page collection
			String peopleString = new String();
			peopleString = AppConstants.PEOPLE;
			peopleString = peopleString + categoryID;
			pageCollection.put(peopleString.toString(), indivColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionForValidationARPIQ() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionForValidationARPIQ");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionForValidation", e);
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionForValidationARPIQ");
		}

	}

	// EDSP CP ADDED Household changes screen:Ends
	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editDisabilityDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editDisabilityDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editDisabilityDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_IN_DABL_Collection appInDablColl = (APP_IN_DABL_Collection) pageCollection
					.get("APP_IN_DABL_Collection");
			final APP_IN_DABL_Cargo appInDablCargo = appInDablColl.getCargo(0);
			// Define IndvSeqNum
			String indvSeqNum = null;

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = appInDablColl.getCargo(0).getIndv_seq_num();
			final String seqNum = appInDablColl.getCargo(0).getSeq_num();
			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(seqNum);
			indivTypeSeqBean.setType(AppConstants.DISABLED_BLIND);

			if ("RE".equals(appInDablCargo.getSrc_app_ind())) {
				indivTypeSeqBean.setUserEndInd(FwConstants.ONE);
			} else {
				indivTypeSeqBean.setUserEndInd(FwConstants.ZERO);
			}

			// make contact info page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHDD",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			final String editResponse = FwConstants.YES;
			session.put("EDIT_DABL_Response", editResponse);
			session.put("EDIT_DABL_IndvSeqNum", indvSeqNum);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editDisabilityDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editDisabilityDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDisabilityDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editDisabilityDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDisabilityDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editDisabilityDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseDisabilityChangeDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDisabilityChangeDetails() - START");

		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseDisabilityChangeDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get RMCSessionBean from the session
			// Define IndvSeqNum and the SeqNum and Type and RowNum
			String indvSeqNum = null;
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final APP_IN_DABL_Collection appInDablColl = (APP_IN_DABL_Collection) pageCollection
					.get("APP_IN_DABL_Collection");
			final APP_IN_DABL_Cargo appInDablCargo = appInDablColl.getCargo(0);

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = appInDablColl.getCargo(0).getIndv_seq_num();

			APP_IN_DABL_Cargo beforeCargo = (APP_IN_DABL_Cargo) beforeColl
					.get("APP_IN_DABL_Cargo");

			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);

			final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeColl
					.get(AppConstants.INDV_TYPE_SEQ_BEAN);

			boolean eraseData = false;

			if (postIndivSeqBean != null) {
				if (postIndivSeqBean.getIndivSeqNum().equals(
						indivTypeSeqBean.getIndivSeqNum())) {
					eraseData = true;
				}
			}

			final DisabilityBO dablBo = new DisabilityBO();
			if (beforeCargo == null || appInDablCargo.isDifferent(beforeCargo)
					|| !eraseData) {
				dablBo.validateEraseChanges();
				request.put(FwConstants.MESSAGE_LIST, dablBo.getMessageList());
				beforeCargo = new APP_IN_DABL_Cargo();
				beforeCargo.setIndv_seq_num(indvSeqNum);
				beforeColl.put("APP_IN_DABL_Cargo", beforeCargo);
				beforeColl.put(AppConstants.INDV_TYPE_SEQ_BEAN,
						indivTypeSeqBean);
				txnBean.setPageCollection(beforeColl);
				return;
			}

			dablBo.deleteModifiedRecords(indvSeqNum, appNum);

			// delete record from rmc selection profile
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final Map catType = new HashMap();
			catType.put(AppConstants.DISABLED_BLIND,
					AppConstants.DISABLED_BLIND);
			final long catSeqNum = 0;
			// remove from Category Selection Profile
			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.DISABLED_BLIND);

			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			boolean rmcPrflNotRequeired = false;

			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.DISABLE)) {
					if (rmcResponseProfileManager.isAppResponseNotRequired(
							rmcInPrflColl, IRMCResponseProfileManager.DISABLE)) {
						rmcPrflNotRequeired = true;
					}
				}
			} else {
				rmcPrflNotRequeired = true;
			}

			final String[] pageId = { "ARHDD" };
			if (categorySelectionProfileManager.isRemoved(rmcSelPrfl, catType)
					&& rmcPrflNotRequeired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						pageId, driverArray, appNum);
			}
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseDisabilityChangeDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDisabilityChangeDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseDisabilityChangeDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDisabilityChangeDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDisabilityChangeDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");

	}

	/**
	 * Erase disability details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseDisabilityDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDisabilityDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseDisabilityDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_IN_DABL_Collection appInDablColl = (APP_IN_DABL_Collection) pageCollection
					.get("APP_IN_DABL_Collection");
			final DisabilityBO disabilityBO = new DisabilityBO();
			final ARHCSValidator validator = new ARHCSValidator();
			final String indvSeqNum = appInDablColl.getCargo(0)
					.getIndv_seq_num();
			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.DISABLED_BLIND);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);
			boolean warningMsgFlag = false;
			validator.validateErase(AppConstants.DISABLED_BLIND, name);
			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {
					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}
			final APP_IN_DABL_Collection deleteAppInDablColl = new APP_IN_DABL_Collection();
			APP_IN_DABL_Cargo deleteAppInDablCargo = new APP_IN_DABL_Cargo();
			final int appInDablCollSize = appInDablColl.size();
			for (int i = 0; i < appInDablCollSize; i++) {
				deleteAppInDablCargo = appInDablColl.getCargo(i);
				deleteAppInDablCargo.setApp_num(appNum);
				deleteAppInDablCargo.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteAppInDablColl.addCargo(deleteAppInDablCargo);

			}

			// delete existing row from INDV_LIVE_CHG
			disabilityBO.deleteAppInDablRecord(deleteAppInDablColl);

			// make the page not required if, no other death row exists
			// Get the before INDV_LIVE_CHG_Collection
			final APP_IN_DABL_Collection appInDablBeforeColl = (APP_IN_DABL_Collection) beforeMap
					.get("ARHCS_ADD_DABL_DTLS_COLLECTION");
			final int appInDablBeforeCollSize = appInDablBeforeColl.size();
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 4 lines Commented Code in
			 * this block
			 */

			// delete record from category selection profile
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			if (rmcInPrflColl == null) {
				rmcInPrflColl = rmcResponseProfileManager.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
			}
			int count = 0;
			for (int i = 0; i < appInDablBeforeCollSize; i++) {
				APP_IN_DABL_Cargo appInDablBeforeCargo = new APP_IN_DABL_Cargo();
				appInDablBeforeCargo = appInDablBeforeColl.getCargo(i);
				if (appInDablBeforeCargo.getIndv_seq_num().equals(indvSeqNum)) {
					count++;
				}
			}

			// remove from RMC_IN_PRFL
			if (count == 1 && rmcInPrflColl != null) {
				final RMC_IN_PRFL_Cargo rmcResCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, indvSeqNum);
				if (rmcResCargo != null) {
					rmcResponseProfileManager.makeAbsoluteNotRequired(
							IRMCResponseProfileManager.DISABLE, rmcResCargo,
							true);
				}
			}

			boolean rmcPrflNotRequired = false;
			// here we need to check we have no entrys in rmcPrfl for disability
			// response
			// as well as we need to check
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.DISABLE)) {
					rmcPrflNotRequired = true;
				}
			} else {
				rmcPrflNotRequired = true;
			}

			final Map catType = new HashMap();
			catType.put(AppConstants.DISABLED_BLIND,
					AppConstants.DISABLED_BLIND);
			final long catSeqNum = 0;
			// remove from Category Selection Profile
			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.DISABLED_BLIND);

			if (categorySelectionProfileManager.isEmpty(rmcSelPrfl, catType)
					&& rmcPrflNotRequired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHDD", driverArray, appNum);
			}

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseDisabilityDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseDisabilityDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDisabilityDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseDisabilityDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDisabilityDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDisabilityDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endDisabilityDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		try {

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::endDisabilityDetails:Start");
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final APP_IN_DABL_Collection dablColl = (APP_IN_DABL_Collection) pageCollection
					.get("APP_IN_DABL_Collection");
			final APP_IN_DABL_Cargo dablCargo = dablColl.getCargo(0);

			final IndivTypeSeqBean seqBean = new IndivTypeSeqBean();
			seqBean.setIndivSeqNum(dablCargo.getIndv_seq_num());
			seqBean.setUserEndInd(FwConstants.ONE);
			seqBean.setSeqNum(FwConstants.ZERO);
			seqBean.setType(AppConstants.DISABLED_BLIND);
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, seqBean);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// Set RMC page Job Income Details make required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHDD",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			// End
			log(ILog.INFO, "RMCJobIncomeEJBBean::endInKindIncome:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("endDisabilityDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endDisabilityDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"endDisabilityDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endDisabilityDetails");
		}
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addDisabilityDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addDisabilityDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String addDablDtlsSeq = request.get("firstName_addDablDtls") != null ? (String) request
					.get("firstName_addDablDtls") : FwConstants.EMPTY_STRING;

					final ARHCSValidator validator = new ARHCSValidator();
					// validate selections
					if (addDablDtlsSeq == null
							|| AppConstants.SELECT_DEFAULT_OPTION
							.equals(addDablDtlsSeq)) {
						validator.validateAdd(AppConstants.DISABLED_BLIND);
						// add validation message and return
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					final String appNum = (String) session.get(AppConstants.APP_NUMBER);

					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
					indivSeqBean.setIndivSeqNum(addDablDtlsSeq);
					indivSeqBean.setSeqNum(FwConstants.ZERO);
					indivSeqBean.setType(AppConstants.DISABLED_BLIND);
					indivSeqBean.setUserEndInd(FwConstants.ZERO);
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

					// set driver status
					final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHDD", driver,
							appNum);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
							appNum);
					session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addDisabilityDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDisabilityDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addDisabilityDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDisabilityDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addDisabilityDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addDrugFelonyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addDrugFelonyDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			// get cargo determining user selection
			final String addDrugDtlsSeq = request.get("firstName_drugFelony") != null ? (String) request
					.get("firstName_drugFelony") : FwConstants.EMPTY_STRING;

					final ARHCSValidator validator = new ARHCSValidator();
					// validate selections
					if (addDrugDtlsSeq == null
							|| AppConstants.SELECT_DEFAULT_OPTION
							.equals(addDrugDtlsSeq)) {
						validator.validateAdd(AppConstants.DISABLED_BLIND);
						// add validation message and return
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						return;
					}
					final String appNum = (String) session.get(AppConstants.APP_NUMBER);

					final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
					indivSeqBean.setIndivSeqNum(addDrugDtlsSeq);
					indivSeqBean.setSeqNum(FwConstants.ZERO);
					indivSeqBean.setType(AppConstants.BECAME_DRUG_FELONY);
					indivSeqBean.setUserEndInd(FwConstants.ZERO);
					pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

					// set driver status
					final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
							appNum);
					driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,
							appNum);
					session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addDrugFelonyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDrugFelonyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addDrugFelonyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addDrugFelonyDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addDrugFelonyDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseDrugFelonyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDrugFelonyDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseDrugFelonyDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get beforeMap
			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_IN_DRUG_FELN_Collection appInDablColl = (APP_IN_DRUG_FELN_Collection) pageCollection
					.get("APP_IN_DRUG_FELN_Collection");
			final DrugFelonyBO drugFelonyBO = new DrugFelonyBO();
			final ARHCSValidator validator = new ARHCSValidator();
			final String indvSeqNum = appInDablColl.getCargo(0)
					.getIndv_seq_num();
			// Setting IndivSeqTypeBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.DRUG_FELONY);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);
			boolean warningMsgFlag = false;
			validator.validateErase(AppConstants.DRUG_FELONY, name);
			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {
					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}
			final APP_IN_DRUG_FELN_Collection deleteAppInDablColl = new APP_IN_DRUG_FELN_Collection();
			APP_IN_DRUG_FELN_Cargo deleteAppInDablCargo = new APP_IN_DRUG_FELN_Cargo();
			final int appInDablCollSize = appInDablColl.size();
			for (int i = 0; i < appInDablCollSize; i++) {
				deleteAppInDablCargo = appInDablColl.getCargo(i);
				deleteAppInDablCargo.setApp_num(appNum);
				deleteAppInDablCargo.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteAppInDablColl.addCargo(deleteAppInDablCargo);

			}

			// delete existing row
			drugFelonyBO.deleteAppInDrugFelonyRecord(deleteAppInDablColl);

			// make the page not required if, no other death row exists
			// Get the before INDV_LIVE_CHG_Collection
			final APP_IN_DRUG_FELN_Collection appInDablBeforeColl = (APP_IN_DRUG_FELN_Collection) beforeMap
					.get("APP_IN_DRUG_FELN_Collection");
			final int appInDablBeforeCollSize = appInDablBeforeColl.size();
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code in
			 * this block
			 */

			// delete record from category selection profile
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			if (rmcInPrflColl == null) {
				rmcInPrflColl = rmcResponseProfileManager.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
			}
			int count = 0;
			for (int i = 0; i < appInDablBeforeCollSize; i++) {
				APP_IN_DRUG_FELN_Cargo appInDablBeforeCargo = new APP_IN_DRUG_FELN_Cargo();
				appInDablBeforeCargo = appInDablBeforeColl.getCargo(i);
				if (appInDablBeforeCargo.getIndv_seq_num().equals(indvSeqNum)) {
					count++;
				}
			}

			// remove from RMC_IN_PRFL
			if (count == 1 && rmcInPrflColl != null) {
				final RMC_IN_PRFL_Cargo rmcResCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, indvSeqNum);
				if (rmcResCargo != null) {
					rmcResponseProfileManager.makeAbsoluteNotRequired(
							IRMCResponseProfileManager.DRUG_FELON, rmcResCargo,
							true);
				}
			}

			boolean rmcPrflNotRequired = false;
			// here we need to check we have no entrys in rmcPrfl for disability
			// response
			// as well as we need to check
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.DRUG_FELON)) {
					rmcPrflNotRequired = true;
				}
			} else {
				rmcPrflNotRequired = true;
			}

			final Map catType = new HashMap();
			catType.put(AppConstants.DRUG_FELONY, AppConstants.DRUG_FELONY);
			final long catSeqNum = 0;
			// remove from Category Selection Profile
			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.DRUG_FELONY);

			if (categorySelectionProfileManager.isEmpty(rmcSelPrfl, catType)
					&& rmcPrflNotRequired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARDFD", driverArray, appNum);



			}

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseDrugFelonyDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseDrugFelonyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDrugFelonyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseDrugFelonyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseDrugFelonyDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseDrugFelonyDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editDrugFelonyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editDrugFelonyDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editDisabilityDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_IN_DRUG_FELN_Collection appInDrugColl = (APP_IN_DRUG_FELN_Collection) pageCollection
					.get("APP_IN_DRUG_FELN_Collection");

			// Define IndvSeqNum
			String indvSeqNum = null;

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = appInDrugColl.getCargo(0).getIndv_seq_num();

			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setUserEndInd(FwConstants.ONE);
			indivTypeSeqBean.setType(AppConstants.BECAME_DRUG_FELONY);

			// make contact info page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARDFD",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			final String editResponse = FwConstants.YES;
			session.put("EDIT_DABL_Response", editResponse);
			session.put("EDIT_DABL_IndvSeqNum", indvSeqNum);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editDisabilityDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editDrugFelonyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDrugFelonyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editDrugFelonyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editDrugFelonyDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editDrugFelonyDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edit New Pregnancy details from householdinfo Summary page Comment here.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editAddPregnancyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editAddPregnancyDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editAddPregnancyDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final APP_IN_PREG_Collection appInPregColl = (APP_IN_PREG_Collection) pageCollection
					.get(APP_IN_PREG_COLLECTION_KEY);

			String indvSeqNum = null;
			indvSeqNum = appInPregColl.getCargo(0).getIndv_seq_num();

			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ONE);
			indivTypeSeqBean.setType(AppConstants.BECAME_PREGNANT);

			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHPD",
					driverArray, appNum);

			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);
			txnBean.setPageCollection(pageCollection);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editAddPregnancyDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editAddPregnancyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editAddPregnancyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editAddPregnancyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editAddPregnancyDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editAddPregnancyDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Erase new Pregnancy details from the household summary page.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseAddPregnancyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseAddPregnancyDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseAddPregnancyDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final Map beforeMap = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final APP_IN_PREG_Collection appInPregColl = (APP_IN_PREG_Collection) pageCollection
					.get(APP_IN_PREG_COLLECTION_KEY);

			final String indvSeqNum = appInPregColl.getCargo(0)
					.getIndv_seq_num();

			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(AppConstants.BECAME_PREGNANT);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);

			boolean warningMsgFlag = false;
			final ARHCSValidator validator = new ARHCSValidator();
			validator.validateErase(AppConstants.BECAME_PREGNANT, name);

			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
							indivTypeSeqBean);
					return;
				} else {

					final IndivTypeSeqBean postIndivSeqBean = (IndivTypeSeqBean) beforeMap
							.get(AppConstants.INDV_TYPE_SEQ_BEAN);
					final boolean sameIndivSeqNum = postIndivSeqBean
							.getIndivSeqNum().equals(
									indivTypeSeqBean.getIndivSeqNum()) ? true
											: false;
					final boolean sameType = postIndivSeqBean.getType().equals(
							indivTypeSeqBean.getType()) ? true : false;
					if (sameIndivSeqNum == false || sameType == false) {
						request.put(FwConstants.MESSAGE_LIST,
								validator.getMessageList());
						session.put(FwConstants.BEFORE_COLLECTION, beforeMap);
						txnBean.setPageCollection((Map) session
								.get(FwConstants.BEFORE_COLLECTION));
						beforeMap.put(AppConstants.INDV_TYPE_SEQ_BEAN,
								indivTypeSeqBean);
						return;
					}
				}
			}

			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);

			final String applicationType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);

			if (!programManager.isThisProgramRequested(programKey,
					FwConstants.FMA_INDEX)
					&& applicationType.equals(String
							.valueOf(FwConstants.RMC_APP_TYPE))) {

				final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Collection persistCollection = new RMC_IN_PRFL_Collection();
				RMC_IN_PRFL_Cargo cargo;

				for (int i = 0; i < rmcInPrflCollRB.size(); i++) {
					cargo = rmcInPrflCollRB.getCargo(i);
					if (indvSeqNum.equals(cargo.getIndv_seq_num())) {
						cargo.setPreg_resp(AppConstants.NO);
						cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						persistCollection.addCargo(cargo);
						break;
					}
				}
				final ABHouseholdInformationSummaryBO bo = new ABHouseholdInformationSummaryBO();
				bo.storeRoomerBoarderCollection(persistCollection);

				final RMC_IN_PRFL_Collection newrmcInPrfl = rmcResponseProfileManager
						.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, newrmcInPrfl);
			}

			/* delete pregnancy details from CP_APP_IN_PREG */
			final APP_IN_PREG_Collection deleteAppInPregColl = new APP_IN_PREG_Collection();
			APP_IN_PREG_Cargo deleteAppInPregCargo = new APP_IN_PREG_Cargo();
			final int appInPregCollSize = appInPregColl.size();
			for (int i = 0; i < appInPregCollSize; i++) {
				deleteAppInPregCargo = appInPregColl.getCargo(i);
				deleteAppInPregCargo.setApp_num(appNum);
				deleteAppInPregCargo.setRowAction(FwConstants.ROWACTION_DELETE);
				deleteAppInPregCargo
				.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				deleteAppInPregColl.addCargo(deleteAppInPregCargo);

			}
			final PregnancyBO pregBO = new PregnancyBO();
			pregBO.deleteAppInPregRecord(deleteAppInPregColl);

			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final long catSeqNum = 0;
			categorySelectionProfileManager.removeSequenceDetail(rmcSelPrfl,
					appNum, Short.parseShort(indvSeqNum), catSeqNum,
					AppConstants.RMC_CAT_HO_COMP_PRFL,AppConstants.BECAME_PREGNANT);

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			if (rmcInPrflColl == null) {
				rmcInPrflColl = rmcResponseProfileManager.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, rmcInPrflColl);
			}

			boolean rmcPrflNotRequired = false;
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.PREGNANCY)) {
					rmcPrflNotRequired = true;
				}
			} else {
				rmcPrflNotRequired = true;
			}

			final Map pregCatTypes = new HashMap();
//			pregCatTypes.put(AppConstants.PREGNANCY_ENDED,
//					AppConstants.PREGNANCY_ENDED);
			pregCatTypes.put(AppConstants.BECAME_PREGNANT,
					AppConstants.BECAME_PREGNANT);

			if (categorySelectionProfileManager.isEmpty(rmcSelPrfl,
					pregCatTypes) && rmcPrflNotRequired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHPD", driverArray, appNum);
			}

			final Map pregAddCatTypeMap = new HashMap();
			pregAddCatTypeMap.put(AppConstants.BECAME_PREGNANT,
					AppConstants.BECAME_PREGNANT);

			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER, rmcSelPrfl);
			txnBean.setPageCollection(pageCollection);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseAddPregnancyDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseAddPregnancyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseAddPregnancyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseAddPregnancyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseAddPregnancyDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseAddPregnancyDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Add Pregnancy End Details from household summary page after deleteing
	 * persons pregnancy end records.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endAddPregnancyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.endAddPregnancyDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final String addPregEndDtlsSeq = request
					.get("firstName_pregChgDtls") != null ? (String) request
							.get("firstName_pregChgDtls") : FwConstants.EMPTY_STRING;

			final ARHCSValidator validator = new ARHCSValidator();
	
			if (addPregEndDtlsSeq == null
					|| AppConstants.SELECT_DEFAULT_OPTION
					.equals(addPregEndDtlsSeq)) {
				validator.validateAdd(AppConstants.PREGNANCY_ENDED);
				request.put(FwConstants.MESSAGE_LIST,
						validator.getMessageList());
				txnBean.setPageCollection((Map) session
						.get(FwConstants.BEFORE_COLLECTION));
				return;
			}
	
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
	
			final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
			final String applicationType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);
	
			if (!programManager.isThisProgramRequested(programKey, FwConstants.FMA_INDEX)
					&& applicationType.equals(String.valueOf(FwConstants.RMC_APP_TYPE))) {
	
				final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Collection persistCollection = new RMC_IN_PRFL_Collection();
				RMC_IN_PRFL_Cargo cargo;
	
				for (int i = 0; i < rmcInPrflCollRB.size(); i++) {
					cargo = rmcInPrflCollRB.getCargo(i);
					if (addPregEndDtlsSeq.equals(cargo.getIndv_seq_num())) {
						cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						cargo.setPreg_resp(AppConstants.YES);
						persistCollection.addCargo(cargo);
						break;
					}
				}
	
				final ABHouseholdInformationSummaryBO bo = new ABHouseholdInformationSummaryBO();
				bo.storeRoomerBoarderCollection(persistCollection);
	
				final RMC_IN_PRFL_Collection newrmcInPrfl = rmcResponseProfileManager
						.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, newrmcInPrfl);
			}
			
			final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
			indivSeqBean.setIndivSeqNum(addPregEndDtlsSeq);
			indivSeqBean.setSeqNum(FwConstants.ZERO);
			indivSeqBean.setType(AppConstants.PREGNANCY_ENDED);
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);
	
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARSUM",	driver, appNum);	
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,	appNum);	
			session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("endAddPregnancyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endAddPregnancyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"endAddPregnancyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endAddPregnancyDetails");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.endAddPregnancyDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Add Pregnancy Start Details from household summary page after deleteing
	 * persons pregnancy Start records.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void addAddPregnancyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addAddPregnancyDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final String addPregDtlsSeq = request.get("firstName_addPregDtls") != null ? (String) request
					.get("firstName_addPregDtls") : FwConstants.EMPTY_STRING;

			final ARHCSValidator validator = new ARHCSValidator();

			if (addPregDtlsSeq == null
					|| AppConstants.SELECT_DEFAULT_OPTION
					.equals(addPregDtlsSeq)) {
				validator.validateAdd(AppConstants.BECAME_PREGNANT);

				request.put(FwConstants.MESSAGE_LIST,
						validator.getMessageList());
				txnBean.setPageCollection((Map) session
						.get(FwConstants.BEFORE_COLLECTION));
				return;
			}

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final short[] programKey = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);

			final int[] driver = (int[]) session.get(FwConstants.RMC_DRIVER);
			final String applicationType = (String) session
					.get(FwConstants.ACCESS_APPLICATION_TYPE);

			if (!programManager.isThisProgramRequested(programKey, FwConstants.FMA_INDEX)
					&& applicationType.equals(String.valueOf(FwConstants.RMC_APP_TYPE))) {

				final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Collection persistCollection = new RMC_IN_PRFL_Collection();
				RMC_IN_PRFL_Cargo cargo;

				for (int i = 0; i < rmcInPrflCollRB.size(); i++) {
					cargo = rmcInPrflCollRB.getCargo(i);
					if (addPregDtlsSeq.equals(cargo.getIndv_seq_num())) {
						cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						cargo.setPreg_resp(AppConstants.YES);
						persistCollection.addCargo(cargo);
						break;
					}
				}

				final ABHouseholdInformationSummaryBO bo = new ABHouseholdInformationSummaryBO();
				bo.storeRoomerBoarderCollection(persistCollection);

				final RMC_IN_PRFL_Collection newrmcInPrfl = rmcResponseProfileManager
						.loadProfile(appNum);
				session.put(AppConstants.RMC_IN_PRFL_MASTER, newrmcInPrfl);
			}
			
			final IndivTypeSeqBean indivSeqBean = new IndivTypeSeqBean();
			indivSeqBean.setIndivSeqNum(addPregDtlsSeq);
			indivSeqBean.setSeqNum(FwConstants.ZERO);
			indivSeqBean.setType(AppConstants.BECAME_PREGNANT);
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);

			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHPD", driver, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS", driver,	appNum);
			session.put(FwConstants.RMC_DRIVER, driver);

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addAddPregnancyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addAddPregnancyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addAddPregnancyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addAddPregnancyDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addAddPregnancyDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Method for Loading the Response Map.
	 *
	 * @param appInPrflColl the app in prfl coll
	 * @param rmcRspnseCustomColl the rmc rspnse custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @param txnBean the txn bean
	 * @return the map
	 */
	private Map createandLoadARHISResponseMapsToPageCollection(
			final RMC_IN_PRFL_Collection appInPrflColl,
			final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean pageLoad, final int driverStatus,
			final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.createandLoadARHISResponseMapsToPageCollection() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::createandLoadARHISResponseMapsToPageCollection:Start");
			getPeopleCollectionAndUpdateMaps(appInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler,
					AppConstants.PERSONAL_INFO,
					IRMCResponseProfileManager.PRSN_INFO_STAT_SW, pageLoad,
					true, driverStatus, txnBean);
			getPeopleCollectionAndUpdateMaps(appInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler,
					AppConstants.RLT_CHG,
					IRMCResponseProfileManager.RLT_CHG_STAT_SW, pageLoad, true,
					driverStatus, txnBean);
			getPeopleCollectionAndUpdateMaps(appInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler,
					AppConstants.ABLE_TO_CONCEIVE,
					IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP, pageLoad,
					true, driverStatus, txnBean);
			getPeopleCollectionAndUpdateMaps(appInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler,
					AppConstants.BECAME_PREGNANT,
					IRMCResponseProfileManager.PREG_ADD_STAT_SW, pageLoad,
					true, driverStatus, txnBean);
			getPeopleCollectionAndUpdateMaps(appInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler,
					AppConstants.UNDERWEIGHT_BIRTH,
					IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP,
					pageLoad, true, driverStatus, txnBean);
			getPeopleCollectionAndUpdateMaps(appInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler,
					AppConstants.PREGNANCY_ENDED,
					IRMCResponseProfileManager.PREG_CHG_STAT_SW, pageLoad,
					true, driverStatus, txnBean);
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::createandLoadARHISResponseMapsToPageCollection:End");
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.createandLoadARHISResponseMapsToPageCollection() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createandLoadARHISResponseMapsToPageCollection");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"createandLoadABHEQResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createandLoadARHISResponseMapsToPageCollection");
		}

	}

	/**
	 * Gets the people collection and update maps.
	 *
	 * @param appInPrflColl the app in prfl coll
	 * @param rmcRespCustomColl the rmc resp custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param categoryID the category id
	 * @param questionName the question name
	 * @param pageLoad the page load
	 * @param getRelevant the get relevant
	 * @param driverStatus the driver status
	 * @param txnBean the txn bean
	 * @return the people collection and update maps
	 */
	/*
	 * New Method added by Srividhya 16Mar15 for RMC5 Pregnancy changes
	 *
	 * This method gets the people collection for a questions page, populates
	 * maps for AFBIndividualsTags and creates a map of noOneChecked strings -
	 * padmana
	 */
	public Map getPeopleCollectionAndUpdateMaps(
			final RMC_IN_PRFL_Collection appInPrflColl,
			final RMC_RESPONSE_Custom_Collection rmcRespCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String categoryID, final short questionName,
			final boolean pageLoad, final boolean getRelevant,
			final int driverStatus, final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - START");
		try {

			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo = new INDIVIDUAL_Custom_Cargo();
			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(categoryID);
			final Map session = txnBean.getSession();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			// try to get a filtered list. If it doesn't exist, get the
			// peopleHandler getIndividuals
			if (pageCollection.get(indivCollKey.toString()) == null) {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 2,1 lines Commented
				 * Code in this block
				 */

				indivColl = peopleHandler.getAllIndividuals();

			} else {
				indivColl = (INDIVIDUAL_Custom_Collection) pageCollection
						.get(indivCollKey.toString());
			}
			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			// create an appInPrfl object
			RMC_IN_PRFL_Cargo rmcInPrflCargo = null;

			// get size of the collection
			final int indivCollSize = indivColl.size();

			String noOneChecked = FwConstants.NO;

			boolean anyPersonChecked = false;


			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				// get the indivCargo
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);

				// get app_indiv_seq_num
				indivSeqNum = indivCargo.getIndv_seq_num();

				// Get the rmcInPrflCargo for this person
				rmcInPrflCargo = rmcResponseProfileManager.getProfile(
						appInPrflColl, indivSeqNum);

				// get the RMC_IN_PRFL Response for the given question from this
				// cargo
				String questionResp = rmcResponseProfileManager
						.getProfileResponse(rmcInPrflCargo, questionName);

				// get the AIP Response for the given question from this cargo
				final int currRespCustomCollSize = rmcRespCustomColl.size();
				for (int j = 0; j < currRespCustomCollSize; j++) {
					final RMC_RESPONSE_Custom_Cargo tempCargo = (RMC_RESPONSE_Custom_Cargo) rmcRespCustomColl
							.get(j);
					if (tempCargo.getIndvSeqNum().equals(indivSeqNum)
							&& categoryID.equals(tempCargo.getCategoryType())) {
						if (AppConstants.PERSONAL_INFO.equals(categoryID)
								&& IRMCResponseProfileManager.PRSN_INFO_STAT_SW == questionName) {
							questionResp = String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
							rmcInPrflCargo.setPrsn_info_stat_sw(questionResp);
						} else if (AppConstants.RLT_CHG.equals(categoryID)
								&& IRMCResponseProfileManager.RLT_CHG_STAT_SW == questionName) {
							questionResp = String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
							rmcInPrflCargo.setRlt_chg_stat_sw(questionResp);
						} else if (AppConstants.ABLE_TO_CONCEIVE
								.equals(categoryID)
								&& IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP == questionName) {
							questionResp = String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
							rmcInPrflCargo
							.setAble_to_conceive_resp(questionResp);
						} else if (AppConstants.BECAME_PREGNANT
								.equals(categoryID)
								&& IRMCResponseProfileManager.PREG_ADD_STAT_SW == questionName) {
							questionResp = String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
							rmcInPrflCargo.setPreg_add_stat_sw(questionResp);
						} else if (AppConstants.UNDERWEIGHT_BIRTH
								.equals(categoryID)
								&& IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP == questionName) {
							questionResp = String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
							rmcInPrflCargo
							.setUnderweight_birth_resp(questionResp);
						} else if (AppConstants.PREGNANCY_ENDED
								.equals(categoryID)
								&& IRMCResponseProfileManager.PREG_CHG_STAT_SW == questionName) {
							questionResp = String
									.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
							rmcInPrflCargo.setPreg_chg_stat_sw(questionResp);
						}
						break;
					}
				}
				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

				if (pageLoad == true) {
					noOneChecked = FwConstants.YES;
					// for each question, set the noOneChecked flag
					// check if there is anything other than not required - if
					// so, change flag
					if (null != questionResp
							&& questionResp.charAt(0) != IRMCResponseProfileManager.STATUS_NOT_REQUIRED) {
						if (!anyPersonChecked) {
							anyPersonChecked = true;
						}
					}
					if (null == questionResp
							|| questionResp.charAt(0) != IRMCResponseProfileManager.STATUS_NOT_REQUIRED) {
						noOneChecked = FwConstants.NO;
					}
				}

			}// end for loop

			if (pageLoad == true) {
				if (driverStatus == FwConstants.DRIVER_REQUIRED) {
					noOneChecked = FwConstants.NO;
				}

				// get the NoOneChecked map from the pagecollection
				Map noOneCheckedMap = (Map) pageCollection
						.get(AppConstants.NO_ONE_CHECKED_MAP);
				if (noOneCheckedMap == null) {
					noOneCheckedMap = new HashMap();
				}
				if (anyPersonChecked) {
					noOneChecked = FwConstants.NO;
				}
				// update the noOneCheckedMap and re-add it to the page coll
				final StringBuilder noOneCheckedString = new StringBuilder();
				noOneCheckedString.append(AppConstants.NO_ONE_CHECKED);
				noOneCheckedString.append(categoryID);
				if (!noOneCheckedMap.containsKey(noOneCheckedString.toString())) {
					noOneCheckedMap.put(noOneCheckedString.toString(),
							noOneChecked);
				}
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
			}

			// Store all maps in page collection
			String respMapString = new String();
			respMapString = AppConstants.RESP_MAP;
			respMapString = respMapString + categoryID;
			pageCollection.put(respMapString, questionRespMap);

			// store people collection in page collection
			String peopleString = new String();
			peopleString = AppConstants.PEOPLE;
			peopleString = peopleString + categoryID;

			final PeopleRulesBO peopleRulesBO = new PeopleRulesBO();
			APP_IN_PREG_Collection pregCollection = new APP_IN_PREG_Collection();
			if (beforeColl.containsKey(APP_IN_PREG_COLLECTION_KEY)) {
				pregCollection = (APP_IN_PREG_Collection) beforeColl
						.get(APP_IN_PREG_COLLECTION_KEY);
			} else {
				pregCollection = (APP_IN_PREG_Collection) pageCollection
						.get(APP_IN_PREG_COLLECTION_KEY);
			}

			// Updated by Srividhya to have only females populating under
			// pregnancy details section
			if (AppConstants.ABLE_TO_CONCEIVE.equalsIgnoreCase(categoryID)
					|| AppConstants.UNDERWEIGHT_BIRTH
					.equalsIgnoreCase(categoryID)) {
				indivColl = PeopleRulesBO.getPregnantableIndividuals(indivColl);

				pageCollection.put(peopleString, indivColl);
			} else if (AppConstants.PREGNANCY_ENDED
					.equalsIgnoreCase(categoryID)) {
				pregCollection = (APP_IN_PREG_Collection) pageCollection
						.get(APP_IN_PREG_COLLECTION_KEY);
				indivColl = peopleRulesBO.getNonPregnantableIndividuals(
						indivColl, pregCollection);

				pageCollection.put(peopleString, indivColl);

			} else if (AppConstants.BECAME_PREGNANT
					.equalsIgnoreCase(categoryID)) {

				indivColl = peopleRulesBO.getPregnantableIndividuals(indivColl,
						pregCollection);

				pageCollection.put(peopleString, indivColl);
			
			/*
			 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
			 * javadoc
			 */
			/**
			 * else if
			 * (categoryID.equalsIgnoreCase(AppConstants.PREGNANCY_ENDED)) {
			 * APP_IN_PREG_Collection appInPregColl =
			 * pregBO.loadPregnancyDetails(appNum, AppConstants.CWW_RECORD_IND);
			 * for (int i = 0; i < appInPregColl.size(); i++) { appInPregCargo =
			 * appInPregColl.getCargo(i); for (int j = 0; j < indivCollSize;
			 * j++) { indivCargo = indivColl.getResult(j); if
			 * (appInPregCargo.getIndv_seq_num
			 * ().equals(indivCargo.getIndv_seq_num())) {
			 * pregnancyColl.addCargo(indivCargo); } } }
			 * pageCollection.put(peopleString, pregnancyColl); }
			 */
			} else {
				pageCollection.put(peopleString, indivColl);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");

			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMaps");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionAndUpdateMaps", e);
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMaps");
		}
	}

	/**
	 * Gets the people collection and update maps.
	 *
	 * @param rmcRespCustomColl the rmc resp custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param categoryID the category id
	 * @param getRelevant the get relevant
	 * @param txnBean the txn bean
	 * @param rmcRqstCargo the rmc rqst cargo
	 * @param aTfsSw the a tfs sw
	 * @return the people collection and update maps
	 */
	/*
	 * This method gets the people collection for a questions page, populates
	 * maps for AFBIndividualsTags and creates a map of noOneChecked strings -
	 * padmana
	 */
	public Map getPeopleCollectionAndUpdateMaps(
			final RMC_RESPONSE_Custom_Collection rmcRespCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String categoryID, final boolean getRelevant,
			final FwTransaction txnBean, final RMC_RQST_Cargo rmcRqstCargo,
			final String aTfsSw) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - START");
		try {
			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo = new INDIVIDUAL_Custom_Cargo();
			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(categoryID);
			final Map session = txnBean.getSession();

			// try to get a filtered list. If it doesn't exist, get the
			// peopleHandler getIndividuals
			if (pageCollection.get(indivCollKey.toString()) == null) {

				indivColl = peopleHandler.getAllIndividuals();

			}

			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			// get size of the collection
			final int indivCollSize = indivColl.size();

			String questionResp = FwConstants.NO;
			// Logic added by Srividhya - 15Mar15
			// Define NoOneChecked = YES flags for the question
			String noOneChecked = null;
			boolean anyPersonChecked = false;
			// Logic added by Srividhya - 15Mar15
			// get the NoOneChecked map from the pagecollection
			Map noOneCheckedMap = (Map) pageCollection
					.get(AppConstants.NO_ONE_CHECKED_MAP);
			if (noOneCheckedMap == null) {
				noOneCheckedMap = new HashMap();
			}

			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				// get the indivCargo
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);

				// get app_indiv_seq_num
				indivSeqNum = indivCargo.getIndv_seq_num();

				// get the AIP Response for the given question from this cargo

				final int currRespCustomCollSize = rmcRespCustomColl.size();
				for (int j = 0; j < currRespCustomCollSize; j++) {
					final RMC_RESPONSE_Custom_Cargo tempCargo = (RMC_RESPONSE_Custom_Cargo) rmcRespCustomColl
							.get(j);
					if (tempCargo.getIndvSeqNum().equals(indivSeqNum)
							&& categoryID.equals(tempCargo.getCategoryType())) {
						questionResp = String
								.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
						/*
						 * VG SONAR Cleanup - 08/31/2015 Deleted 1,2 lines
						 * Commented Code in this block
						 */

						anyPersonChecked = true;
						break;
					}
				}
				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

			}// end for loop

			if (anyPersonChecked) {
				noOneChecked = FwConstants.NO;
			}

			// Logic added by Srividhya - 15Mar15
			// update the noOneCheckedMap and re-add it to the page coll
			final StringBuilder noOneCheckedString = new StringBuilder();
			noOneCheckedString.append(AppConstants.NO_ONE_CHECKED);
			noOneCheckedString.append(categoryID);
			if (null != noOneChecked) {
				noOneCheckedMap
				.put(noOneCheckedString.toString(), noOneChecked);
			}

			pageCollection
			.put(AppConstants.NO_ONE_CHECKED_MAP, noOneCheckedMap);

			// Store all maps in page collection
			String respMapString = new String();
			respMapString = AppConstants.RESP_MAP;
			respMapString = respMapString + categoryID;
			pageCollection.put(respMapString, questionRespMap);

			// store people collection in page collection
			String peopleString = new String();
			peopleString = AppConstants.PEOPLE;
			peopleString = peopleString + categoryID;

			// Updated by Srividhya to have only females populating under
			// pregnancy details section
			if (AppConstants.BECAME_PREGNANT.equalsIgnoreCase(categoryID)
					|| AppConstants.ABLE_TO_CONCEIVE
					.equalsIgnoreCase(categoryID)
					|| AppConstants.UNDERWEIGHT_BIRTH
					.equalsIgnoreCase(categoryID)
					|| AppConstants.PREGNANCY_ENDED
					.equalsIgnoreCase(categoryID)) {
				indivColl = PeopleRulesBO.getPregnantableIndividuals(indivColl);

				pageCollection.put(peopleString, indivColl);
			
			/*
			 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
			 * javadoc
			 */
			/**
			 * else if
			 * (categoryID.equalsIgnoreCase(AppConstants.PREGNANCY_ENDED)) {
			 * APP_IN_PREG_Collection appInPregColl =
			 * pregBO.loadPregnancyDetails(appNum, AppConstants.CWW_RECORD_IND);
			 * for (int i = 0; i < appInPregColl.size(); i++) { appInPregCargo =
			 * appInPregColl.getCargo(i); for (int j = 0; j < indivCollSize;
			 * j++) { indivCargo = indivColl.getResult(j); if
			 * (appInPregCargo.getIndv_seq_num
			 * ().equals(indivCargo.getIndv_seq_num())) {
			 * pregnancyColl.addCargo(indivCargo); } } }
			 * pageCollection.put(peopleString, pregnancyColl); }
			 */

			} else {
				pageCollection.put(peopleString, indivColl);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");

			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMaps");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionAndUpdateMaps", e);
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMaps");
		}
	}

	/**
	 * Gets the people collection and update maps for rmc.
	 *
	 * @param rmcInPrflColl the rmc in prfl coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param compID the comp id
	 * @param questionName the question name
	 * @param driverStatus the driver status
	 * @return the people collection and update maps for rmc
	 */
	public Map getPeopleCollectionAndUpdateMapsForRMC(
			final RMC_IN_PRFL_Collection rmcInPrflColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String compID, final short questionName,
			final int driverStatus) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMapsForRMC() - START");
		try {
			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo;
			INDIVIDUAL_Custom_Collection indivColl;
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(compID);

			// try to get a filtered list. If it doesn't exist, get the
			// peopleHandler getIndividuals
			if (pageCollection.get(indivCollKey.toString()) == null) {
				indivColl = peopleHandler.getAllIndividuals();
			} else {
				indivColl = (INDIVIDUAL_Custom_Collection) pageCollection
						.get(indivCollKey.toString());
			}

			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			// create an appInPrfl object
			RMC_IN_PRFL_Cargo rmcInPrflCargo = null;

			// get size of the collection
			final int indivCollSize = indivColl.size();

			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				// get the indivCargo
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);

				// get app_indiv_seq_num
				indivSeqNum = indivCargo.getIndv_seq_num();

				// Get the appInPrflCargo for this person
				rmcInPrflCargo = rmcResponseProfileManager.getProfile(
						rmcInPrflColl, indivSeqNum);

				// get the AIP Response for the given question from this cargo
				final String questionResp = rmcResponseProfileManager
						.getProfileResponse(rmcInPrflCargo, questionName);

				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);
			}// end for loop

			// Store all maps in page collection
			final StringBuilder respMapString = new StringBuilder();
			respMapString.append(AppConstants.RESP_MAP);
			respMapString.append(compID);
			pageCollection.put(respMapString.toString(), questionRespMap);

			// store people collection in page collection
			final StringBuilder peopleString = new StringBuilder();
			peopleString.append(AppConstants.PEOPLE);
			peopleString.append(compID);
			pageCollection.put(peopleString.toString(), indivColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMapsForRMC() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(compID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMapsForRMC");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionAndUpdateMapsForRMC", e);
			fe.setParameterText(compID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMapsForRMC");
		}
	}

	/**
	 * Gets the people collection for validation.
	 *
	 * @param currRespCustomColl the curr resp custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param categoryID the category id
	 * @param getRelevant the get relevant
	 * @param txnBean the txn bean
	 * @return the people collection for validation
	 */
	public Map getPeopleCollectionForValidation(
			final RMC_RESPONSE_Custom_Collection currRespCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String categoryID, final boolean getRelevant,
			final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionForValidation() - START");
		try {
			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo = new INDIVIDUAL_Custom_Cargo();
			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(categoryID);

			// try to get a filtered list. If it doesn't exist, get the
			// peopleHandler getIndividuals
			if (pageCollection.get(indivCollKey.toString()) == null) {
				if (getRelevant) {
					indivColl = peopleHandler.getRelevantIndividuals();
				} else {
					indivColl = peopleHandler.getAllIndividuals();
				}
			} else {
				indivColl = (INDIVIDUAL_Custom_Collection) pageCollection
						.get(indivCollKey.toString());
			}

			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			// get size of the collection
			final int indivCollSize = indivColl.size();
			String questionResp = new String();

			String noOneChecked = null;
			boolean anyPersonChecked = false;

			// Logic added by Srividhya - 15Mar15
			// get the NoOneChecked map from the pagecollection
			Map noOneCheckedMap = (Map) pageCollection
					.get(AppConstants.NO_ONE_CHECKED_MAP);
			if (noOneCheckedMap == null) {
				noOneCheckedMap = new HashMap();
			}
			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				// get the indivCargo
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);

				// get app_indiv_seq_num
				indivSeqNum = indivCargo.getIndv_seq_num();

				// get the AIP Response for the given question from this cargo
				questionResp = FwConstants.NO;
				final int currRespCustomCollSize = currRespCustomColl.size();
				for (int j = 0; j < currRespCustomCollSize; j++) {
					final RMC_RESPONSE_Custom_Cargo tempCargo = (RMC_RESPONSE_Custom_Cargo) currRespCustomColl
							.get(j);
					if (tempCargo.getIndvSeqNum().equals(indivSeqNum)
							&& categoryID.equals(tempCargo.getCategoryType())) {
						questionResp = String
								.valueOf(ICategorySelectionProfileManager.STATUS_REQUIRED);
						anyPersonChecked = true;
						break;
					}
				}
				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

			}// end for loop

			if (anyPersonChecked) {
				noOneChecked = FwConstants.NO;
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			// Logic added by Srividhya - 15Mar15
			// update the noOneCheckedMap and re-add it to the page coll
			final StringBuilder noOneCheckedString = new StringBuilder();
			noOneCheckedString.append(AppConstants.NO_ONE_CHECKED);
			noOneCheckedString.append(categoryID);
			if (null != noOneChecked) {
				noOneCheckedMap
				.put(noOneCheckedString.toString(), noOneChecked);
			}
			pageCollection
			.put(AppConstants.NO_ONE_CHECKED_MAP, noOneCheckedMap);

			// Store all maps in page collection
			String respMapString = new String();
			respMapString = AppConstants.RESP_MAP;
			respMapString = respMapString + categoryID;
			pageCollection.put(respMapString.toString(), questionRespMap);

			// store people collection in page collection
			String peopleString = new String();
			peopleString = AppConstants.PEOPLE;
			peopleString = peopleString + categoryID;
			pageCollection.put(peopleString.toString(), indivColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionForValidation() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionForValidation");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionForValidation", e);
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionForValidation");
		}
	}

	/**
	 * Edit Absent Parent Details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void editAbsentParentDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editAbsentParentDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHousingExpenseEJBBean::editChildCareDetails:Start");

			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final APP_IN_ABSNP_Collection appInAbsnpColl = (APP_IN_ABSNP_Collection) pageCollection
					.get("APP_IN_ABSNP_Collection");
			final APP_IN_ABSNP_Cargo appInAbsnpCargo = appInAbsnpColl
					.getResult(0);

			final IndivTypeSeqBean seqBean = new IndivTypeSeqBean();
			seqBean.setIndivSeqNum(appInAbsnpCargo.getIndv_seq_num());
			seqBean.setSeqNum(appInAbsnpCargo.getAp_seq_num());

			if (AppConstants.SEX_IND_MALE.equals(appInAbsnpCargo
					.getPater_estb_sw())) {
				seqBean.setType(AppConstants.ABS_FATHER);
			} else if (AppConstants.SEX_IND_FEMALE.equals(appInAbsnpCargo
					.getPater_estb_sw())) {
				seqBean.setType(AppConstants.ABS_MOTHER);
			} else if (AppConstants.SEX_IND_UNKNOWN.equals(appInAbsnpCargo
					.getPater_estb_sw())) {
				seqBean.setType(AppConstants.ABS_UNKNOWN);
			} else {
				seqBean.setType(AppConstants.ABS_UNKNOWN);
			}

			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, seqBean);

			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHAP",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			log(ILog.INFO, "RMCHousingExpenseEJBBean::editChildCareDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editAbsentParentDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editAbsentParentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editAbsentParentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editAbsentParentDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editAbsentParentDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edits the relationship details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editRelationshipDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editRelationshipDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editRelationshipDetails:Start");
			final Map pageCollection = txnBean.getPageCollection();
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			final APP_HSHL_RLT_Collection appHshlRltColl = (APP_HSHL_RLT_Collection) pageCollection
					.get("APP_HSHL_RLT_Collection");
			indivTypeSeqBean.setIndivSeqNum(appHshlRltColl.getCargo(0)
					.getSrc_indv_seq_num());
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editRelationshipDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editRelationshipDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editRelationshipDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editRelationshipDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editRelationshipDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editRelationshipDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edits the medicare details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editMedicareDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.editMedicareDetails() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMedicareDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// Define IndvSeqNum and the SeqNum and Type and RowNum
			String indvSeqNum = null, seqNum = null;
			final APP_IN_MEDCR_Collection medcrColl = (APP_IN_MEDCR_Collection) pageCollection
					.get("APP_IN_MEDCR_Collection");
			indvSeqNum = medcrColl.getResult(0).getIndv_seq_num();
			seqNum = medcrColl.getResult(0).getSeq_num();

			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(seqNum);

			// make Medicare Deatils page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMD",
					driverArray, appNum);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::editMedicareDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editMedicareDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMedicareDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editMedicareDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editMedicareDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editMedicareDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edits the school enrollment details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editSchoolEnrollmentDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		try {
			final long startTime = System.currentTimeMillis();
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.editSchoolEnrollmentDetails() - START");
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editSchoolEnrollmentDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Define IndvSeqNum and the SeqNum and Type and RowNum
			String indvSeqNum = null;
			String type = null;
			final APP_IN_SCHLE_Collection schleColl = (APP_IN_SCHLE_Collection) pageCollection
					.get("APP_IN_SCHLE_Collection");

			indvSeqNum = schleColl.getResult(0).getIndv_seq_num();
			type = schleColl.getResult(0).getEduc_cd();

			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setType(type);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);
			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editSchoolEnrollmentDetails:End");
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.editSchoolEnrollmentDetails() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editSchoolEnrollmentDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editSchoolEnrollmentDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editSchoolEnrollmentDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editSchoolEnrollmentDetails");
		}

	}

	// EDSP ADDED - DRUG FELONY

	/**
	 * Load drug felony details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadDrugFelonyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		try {
			final long startTime = System.currentTimeMillis();
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.loadDrugFelonyDetails() - START");
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadDrugFelonyDetails:Start");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final String pageId = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int pageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catDrugFelnTypes = new HashMap();
			catDrugFelnTypes.put(AppConstants.BECAME_DRUG_FELONY,
					AppConstants.CHANGE_DRUG_FELONY);

			if (pageStatus == FwConstants.DRIVER_REQUIRED
					|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catDrugFelnTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_HO_COMP_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);

			final DrugFelonyBO indrugfelnBO = new DrugFelonyBO();

			final short[] responseType = new short[] { IRMCResponseProfileManager.DRUG_FELON };
			SortedSet drugFelonyProfile = null;
			SortedSet drugFelonyCategoryProfile = null;
			SortedSet drugFelonyRmcProfile = null;
			String categType = FwConstants.EMPTY_STRING;

			final String[] catType = new String[] {
					AppConstants.BECAME_DRUG_FELONY,
					AppConstants.CHANGE_DRUG_FELONY, AppConstants.DRUG_FELONY };

			if (!pageId.equals(previousPageId)) {
				drugFelonyProfile = new TreeSet(
						new CategorySequenceDetailsComparator());
				if (categorySelectionProfile != null) {
					drugFelonyCategoryProfile = createPageProfile(
							categorySelectionProfile, catType);
					drugFelonyProfile.addAll(drugFelonyCategoryProfile);
				}
				if (rmcInPrflColl != null) {
					// COMM RMVD
					drugFelonyRmcProfile = createPageProfile(
							drugFelonyRmcProfile, rmcInPrflColl, responseType);
					drugFelonyProfile.addAll(drugFelonyRmcProfile);
				}

				if (pageStatus != FwConstants.DRIVER_REQUIRED) {
					final APP_IN_DRUG_FELN_Collection newDrugFelColl = indrugfelnBO
							.getDrugFelonyList(appNumber);
					if (newDrugFelColl != null && !newDrugFelColl.isEmpty()) {
						APP_IN_DRUG_FELN_Cargo appInDrugFelCargo = null;
						final int newDrugFelCollSize = newDrugFelColl.size();

						for (int i = 0; i < newDrugFelCollSize; i++) {
							appInDrugFelCargo = newDrugFelColl.getCargo(i);

							if (AppConstants.RMC_NEW_RECORD_IND
									.equals(appInDrugFelCargo.getSrc_app_ind())) {
								categType = AppConstants.BECAME_DRUG_FELONY;
							} else {
								categType = AppConstants.CHANGE_DRUG_FELONY;
							}
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									drugFelonyProfile, null, null,
									Short.parseShort(appInDrugFelCargo
											.getIndv_seq_num()),
											(short) 0, categType);

						}
					}
				}
				if (pageStatus == FwConstants.DRIVER_REQUIRED
						|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(drugFelonyProfile);
				}
				if (pageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(drugFelonyProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				final Map beforeColl = (Map) session
						.get(FwConstants.BEFORE_COLLECTION);
				drugFelonyProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			final DrugFelonyBO inDrugFelBO = new DrugFelonyBO();
			final IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								drugFelonyProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					String userEndIndicator = indivSeqBean.getUserEndInd();
					if (userEndIndicator == null) {
						userEndIndicator = FwConstants.ZERO;
					}

					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(userEndIndicator)) {
						categorySelectionProfileManager
						.updateUserEndSelInd(drugFelonyProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							drugFelonyProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != Short
								.parseShort(userEndIndicator)) {
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType(),
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
						if (rmcInPrflColl != null) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl,
											indivSeqBean.getIndivSeqNum());
						} else {
							rmcInPrflColl = new RMC_IN_PRFL_Collection();
						}
						if (rmcInPrflCargo == null) {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setApp_num(appNumber);
							rmcInPrflCargo.setIndv_seq_num(indivSeqBean
									.getIndivSeqNum());
							rmcResponseProfileManager
							.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflColl.addCargo(rmcInPrflCargo);
						}
						/*
						 * VG SONAR Cleanup - 08/31/2015 Deleted 15 (1 token),
						 * 1/2, 1/2 part lines Commented Code in this block
						 */

						final short[] responseArray = new short[] { IRMCResponseProfileManager.DRUG_FELON };
						rmcResponseProfileManager.makeAddNew(responseArray,
								rmcInPrflCargo, true);
						categorySelectionProfileManager
						.insertSequenceDetail(drugFelonyProfile, null,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertSequenceDetail(drugFelonyProfile, null,
								AppConstants.DRUG_FELON, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(drugFelonyProfile,
								null, Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());

						categorySelectionProfileManager
						.insertSequenceDetail(categorySelectionProfile,
								appNumber, AppConstants.DRUG_FELON,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put(FwConstants.DETAIL_KEY_BEAN, indivSeqBean);
				session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
						categorySelectionProfile);
			}

			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					drugFelonyProfile);
			session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
					categorySelectionProfile);
			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(drugFelonyProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(drugFelonyProfile);
			}

			final String categoryType = categorySeqDetail.getCategoryType();
			final String indvSeqNum = Short.toString(categorySeqDetail
					.getIndividualSequence());
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1,1 lines Commented Code in
			 * this block
			 */

			APP_IN_DRUG_FELN_Collection appInDrugFelnColl = new APP_IN_DRUG_FELN_Collection();

			appInDrugFelnColl = indrugfelnBO.loadDrugFelonyDTLs(appNumber,
					indvSeqNum);

			pageCollection
			.put("APP_IN_DRUG_FELN_Collection", appInDrugFelnColl);

			if (!"BD".equals(categoryType) || !"DR".equals(categoryType)) {
				APP_IN_DRUG_FELN_Cargo cwwDrugFelnCargo = indrugfelnBO
						.splitDrugFelInfoColl(appInDrugFelnColl,
								AppConstants.CWW_RECORD_IND);
				if (cwwDrugFelnCargo == null) {
					cwwDrugFelnCargo = new APP_IN_DRUG_FELN_Cargo();
				}
				pageCollection.put("SEC_DRUGFELN_DETAIL",
						indrugfelnBO.settingDefaultValues(cwwDrugFelnCargo));

				final APP_IN_DRUG_FELN_Cargo cwwRMInDrugFelCargo = inDrugFelBO
						.splitDrugFelInfoColl(appInDrugFelnColl,
								AppConstants.RMC_MODIFIED_RECORD_IND);
				if (cwwRMInDrugFelCargo != null) {
					pageCollection.put("FST_DRUGFELN_DETAIL", inDrugFelBO
							.settingDefaultValues(cwwRMInDrugFelCargo));
				} else {
					pageCollection.put("FST_DRUGFELN_DETAIL",
							inDrugFelBO.settingDefaultValues(cwwDrugFelnCargo));
				}

			} else {
				final APP_IN_DRUG_FELN_Cargo rmcDrugFelnCargo = indrugfelnBO
						.splitDrugFelInfoColl(appInDrugFelnColl,
								AppConstants.RMC_NEW_RECORD_IND);
				if (rmcDrugFelnCargo != null) {
					pageCollection
					.put("FST_DRUGFELN_DETAIL", indrugfelnBO
							.settingDefaultValues(rmcDrugFelnCargo));
				}
			}

			String srcAppInd = FwConstants.EMPTY_STRING;
			String pageMode = FwConstants.EMPTY_STRING;

			if (appInDrugFelnColl != null && !appInDrugFelnColl.isEmpty()) {
				final APP_IN_DRUG_FELN_Cargo appDrugFelnCargo = appInDrugFelnColl
						.getCargo(0);
				if (!"BD".equals(categoryType) || !"DR".equals(categoryType)) {
					srcAppInd = appDrugFelnCargo.getSrc_app_ind();
				} else {
					srcAppInd = AppConstants.RMC_NEW_RECORD_IND;
				}
			}

			if ((AppConstants.CWW_RECORD_IND.equalsIgnoreCase(srcAppInd) || AppConstants.RMC_MODIFIED_RECORD_IND
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";

			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ZERO.equals(indivSeqBean.getUserEndInd())
						&& AppConstants.RMC_MODIFIED_RECORD_IND
						.equalsIgnoreCase(srcAppInd)
						|| AppConstants.CWW_RECORD_IND
						.equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else {
				pageMode = FwConstants.NO;
			}

			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNum));

			// Add the page collection to before collection
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::loadDrugFelonyDetails:End");

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.loadDrugFelonyDetails() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadDrugFelonyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadDrugFelonyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadDrugFelonyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadDrugFelonyDetails");
		}
	}

	/**
	 * Store drug felony details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storeDrugFelonyDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeDrugFelonyDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeDrugFelonyDetails:Start");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			APP_IN_DRUG_FELN_Collection beforeAppInDrugFelnCollection = null;
			APP_IN_DRUG_FELN_Collection appInDrugFelnCollection = null;
			APP_IN_DRUG_FELN_Cargo beforeAppInDrugFelnCargo = null;
			final StringBuilder dateConverter1 = new StringBuilder();
			final String sAppDate1 = fwDate.getToday();

			dateConverter1.append(sAppDate1.substring(0, 4)).append(
					sAppDate1.substring(5, 7));
			dateConverter1.toString();

			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			// testing

			final String appNumber = (String) session
					.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);

			final SortedSet drugFelonyProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			if (beforeColl.containsKey("APP_IN_DRUG_FELN_Collection")) {
				beforeAppInDrugFelnCollection = (APP_IN_DRUG_FELN_Collection) beforeColl
						.get("APP_IN_DRUG_FELN_Collection");
			}

			if (pageCollection.containsKey("APP_IN_DRUG_FELN_Collection")) {
				appInDrugFelnCollection = (APP_IN_DRUG_FELN_Collection) pageCollection
						.get("APP_IN_DRUG_FELN_Collection");
			}
			APP_IN_DRUG_FELN_Cargo appInDrugFelnCargo = appInDrugFelnCollection
					.getCargo(0);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(drugFelonyProfile);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			final long catSeqNum = categorySeqDetailBean.getCategorySequence();
			final String catType = categorySeqDetailBean.getCategoryType();
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			beforeColl.get(AppConstants.FIRST_NAME);

			final DrugFelonyBO drugFelonyBO = new DrugFelonyBO();

			final ARDFDValidator ardfdValidator = new ARDFDValidator();
			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			if (backToMyAccess != null) {
				if (checkBackToMyAccessSelected(request)) {
					request.get(FwConstants.WARNING_MSG_DETAILS);
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					return;
				}
			}

			if (backToMyAccess == null) {
				appInDrugFelnCargo = appInDrugFelnCollection.getCargo(0);
				ardfdValidator.validateDrugFelonyDetails(
						appInDrugFelnCollection, appInDrugFelnCargo,
						peopleHandler, indvSeqNum);
			}
			if (checkBackToMyAccessSelected(request)
					|| ardfdValidator.hasMessages()) {
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							ardfdValidator.getMessageList());
				}
				// To retain CWW values
				final DrugFelonyBO inDrugFelnBO1 = new DrugFelonyBO();
				final APP_IN_DRUG_FELN_Collection inDrugFelnColl1 = inDrugFelnBO1
						.loadDrugFelonyDetails(appNumber);
				APP_IN_DRUG_FELN_Cargo cwwInDrugFelnCargo1 = inDrugFelnBO1
						.splitDrugFelInfoColl(inDrugFelnColl1,
								AppConstants.CWW_RECORD_IND);

				if (cwwInDrugFelnCargo1 == null) {
					cwwInDrugFelnCargo1 = new APP_IN_DRUG_FELN_Cargo();
				} else {
					if (cwwInDrugFelnCargo1.getDrug_use_ind() == null) {
						cwwInDrugFelnCargo1
						.setDrug_use_ind(FwConstants.EMPTY_STRING);
					}
					if (cwwInDrugFelnCargo1.getDrug_possessed_ind() == null) {
						cwwInDrugFelnCargo1
						.setDrug_possessed_ind(FwConstants.EMPTY_STRING);
					}
					if (cwwInDrugFelnCargo1.getDrug_distribution_ind() == null) {
						cwwInDrugFelnCargo1
						.setDrug_distribution_ind(FwConstants.EMPTY_STRING);
					}
					if (cwwInDrugFelnCargo1.getPeriodic_testing_ind() == null) {
						cwwInDrugFelnCargo1
						.setPeriodic_testing_ind(FwConstants.EMPTY_STRING);
					}
					if (cwwInDrugFelnCargo1.getDrug_treatment_ind() == null) {
						cwwInDrugFelnCargo1
						.setDrug_treatment_ind(FwConstants.EMPTY_STRING);
					}
					if (cwwInDrugFelnCargo1.getOther_actions_ind() == null) {
						cwwInDrugFelnCargo1
						.setOther_actions_ind(FwConstants.EMPTY_STRING);
					}
					if (cwwInDrugFelnCargo1.getCrt_assgn_act_fin_ind() == null) {
						cwwInDrugFelnCargo1
						.setCrt_assgn_act_fin_ind(FwConstants.EMPTY_STRING);
					}
					if (cwwInDrugFelnCargo1.getSrc_app_ind() == null) {
						cwwInDrugFelnCargo1
						.setSrc_app_ind(FwConstants.EMPTY_STRING);
					}
				}

				pageCollection.put("SEC_DRUGFELN_DETAIL",
						drugFelonyBO.settingDefaultValues(cwwInDrugFelnCargo1));
				// To retain CWW values - end
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CATEGORY_DRUG_FELN_TYPE", catType);
				pageCollection.put("CATEGORY_STATUS",
						beforeColl.get("CATEGORY_STATUS"));
				if (beforeAppInDrugFelnCollection != null) {
					pageCollection.put("APP_IN_DRUG_FELN_Collection",
							beforeAppInDrugFelnCollection);
				}
				pageCollection.put("APP_IN_DRUG_FELN_Collection",
						appInDrugFelnCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				return;
			}
			boolean drugFelonyDetailsUpdate = false;
			String recordInd = null;

			appInDrugFelnCargo.setApp_num(appNumber);
			appInDrugFelnCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			// EDSP Team Commented

			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3,2,1 lines Commented Code
			 * in this block
			 */

			if (appInDrugFelnCargo.getDrug_use_ind() == null) {
				appInDrugFelnCargo.setDrug_use_ind(FwConstants.SPACE);
			}
			if (appInDrugFelnCargo.getDrug_possessed_ind() == null) {
				appInDrugFelnCargo.setDrug_possessed_ind(FwConstants.SPACE);
			}
			if (appInDrugFelnCargo.getDrug_distribution_ind() == null) {
				appInDrugFelnCargo.setDrug_distribution_ind(FwConstants.SPACE);
			}
			if (appInDrugFelnCargo.getPeriodic_testing_ind() == null) {
				appInDrugFelnCargo.setPeriodic_testing_ind(FwConstants.SPACE);
			}
			if (appInDrugFelnCargo.getDrug_treatment_ind() == null) {
				appInDrugFelnCargo.setDrug_treatment_ind(FwConstants.SPACE);
			}
			if (appInDrugFelnCargo.getOther_actions_ind() == null) {
				appInDrugFelnCargo.setOther_actions_ind(FwConstants.SPACE);
			}
			if (appInDrugFelnCargo.getCrt_assgn_act_fin_ind() == null) {
				appInDrugFelnCargo.setCrt_assgn_act_fin_ind(FwConstants.SPACE);
			}

			String sourceAppIndicator = null;

			if (beforeAppInDrugFelnCollection != null
					&& !beforeAppInDrugFelnCollection.isEmpty()) {

				final int sizeDrugFlnColl = beforeAppInDrugFelnCollection
						.size();
				int size = 0;
				for (int i = 0; i < sizeDrugFlnColl; i++) {
					beforeAppInDrugFelnCargo = beforeAppInDrugFelnCollection
							.getCargo(i);
					if (AppConstants.CWW_RECORD_IND
							.equals(beforeAppInDrugFelnCargo.getSrc_app_ind())
							|| AppConstants.RMC_MODIFIED_RECORD_IND
							.equals(beforeAppInDrugFelnCargo
									.getSrc_app_ind())) {
						beforeAppInDrugFelnCargo.getDrug_use_ind();

						size++;
					}

				}

				if (size > 1
						&& (!"BD".equals(catType) || !"DR".equals(catType))) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty

					beforeAppInDrugFelnCargo = drugFelonyBO
							.splitDrugFelInfoColl(
									beforeAppInDrugFelnCollection,
									AppConstants.CWW_RECORD_IND);
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					// COMM RMVD
					beforeAppInDrugFelnCargo = drugFelonyBO
							.splitDrugFelInfoColl(
									beforeAppInDrugFelnCollection,
									sourceAppIndicator);
					appInDrugFelnCargo = drugFelonyBO.splitDrugFelInfoColl(
							beforeAppInDrugFelnCollection, sourceAppIndicator);
					appInDrugFelnCargo.setRowAction(recordInd);
					if (beforeAppInDrugFelnCargo.getDrug_use_ind() != null
							&& FwConstants.YES.equals(beforeAppInDrugFelnCargo
									.getDrug_use_ind().trim())) {
						appInDrugFelnCargo
						.setDrug_use_ind(beforeAppInDrugFelnCargo
								.getDrug_use_ind().trim());
					}
					if (beforeAppInDrugFelnCargo.getDrug_possessed_ind() != null
							&& FwConstants.YES.equals(beforeAppInDrugFelnCargo
									.getDrug_possessed_ind().trim())) {
						appInDrugFelnCargo
						.setDrug_possessed_ind(beforeAppInDrugFelnCargo
								.getDrug_possessed_ind().trim());
					}
					if (beforeAppInDrugFelnCargo.getDrug_distribution_ind() != null
							&& FwConstants.YES.equals(beforeAppInDrugFelnCargo
									.getDrug_distribution_ind().trim())) {
						appInDrugFelnCargo
						.setDrug_distribution_ind(beforeAppInDrugFelnCargo
								.getDrug_distribution_ind().trim());
					}
					if (beforeAppInDrugFelnCargo.getPeriodic_testing_ind() != null
							&& FwConstants.YES.equals(beforeAppInDrugFelnCargo
									.getPeriodic_testing_ind().trim())) {
						appInDrugFelnCargo
						.setPeriodic_testing_ind(beforeAppInDrugFelnCargo
								.getPeriodic_testing_ind().trim());
					}
					if (beforeAppInDrugFelnCargo.getDrug_treatment_ind() != null
							&& FwConstants.YES.equals(beforeAppInDrugFelnCargo
									.getDrug_treatment_ind().trim())) {
						appInDrugFelnCargo
						.setDrug_treatment_ind(beforeAppInDrugFelnCargo
								.getDrug_treatment_ind().trim());
					}
					if (beforeAppInDrugFelnCargo.getOther_actions_ind() != null
							&& FwConstants.YES.equals(beforeAppInDrugFelnCargo
									.getOther_actions_ind().trim())) {
						appInDrugFelnCargo
						.setOther_actions_ind(beforeAppInDrugFelnCargo
								.getOther_actions_ind().trim());
					}
					if (beforeAppInDrugFelnCargo.getCrt_assgn_act_fin_ind() != null
							&& FwConstants.YES.equals(beforeAppInDrugFelnCargo
									.getCrt_assgn_act_fin_ind().trim())) {
						appInDrugFelnCargo
						.setCrt_assgn_act_fin_ind(beforeAppInDrugFelnCargo
								.getCrt_assgn_act_fin_ind().trim());
					}

					appInDrugFelnCargo.setSrc_app_ind(sourceAppIndicator);
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented
					 * Code in this block
					 */

				} else {
					// now we are checking this record is CW or RN
					beforeAppInDrugFelnCargo = drugFelonyBO
							.splitDrugFelInfoColl(
									beforeAppInDrugFelnCollection,
									AppConstants.CWW_RECORD_IND);
					if (beforeAppInDrugFelnCargo != null && size == 1
							&& (!"BD".equals(catType) || !"DR".equals(catType))) {
						sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
						recordInd = FwConstants.ROWACTION_INSERT;
						appInDrugFelnCargo.setRowAction(recordInd);
						/*
						 * VG SONAR Cleanup - 08/31/2015 Changed Commented code
						 * block to javadoc
						 */
						/**
						 * // appInDrugFelnCargo.setPgm_typ(pgmType); // EDSP
						 * Commented /*
						 * if(beforeAppInDrugFelnCargo.getDrug_test_resp() !=
						 * null &&
						 * beforeAppInDrugFelnCargo.getDrug_test_resp().trim
						 * ().equals(FwConstants.YES))
						 * appInDrugFelnCargo.setDrug_test_resp
						 * (beforeAppInDrugFelnCargo
						 * .getDrug_test_resp().trim());
						 * appInDrugFelnCargo.setEff_beg_mo(effBegMoCWW);
						 */

						if (beforeAppInDrugFelnCargo.getDrug_use_ind() != null
								&& FwConstants.YES
								.equals(beforeAppInDrugFelnCargo
										.getDrug_use_ind().trim())) {
							appInDrugFelnCargo
							.setDrug_use_ind(beforeAppInDrugFelnCargo
									.getDrug_use_ind().trim());
						}
						if (beforeAppInDrugFelnCargo.getDrug_possessed_ind() != null
								&& FwConstants.YES
								.equals(beforeAppInDrugFelnCargo
										.getDrug_possessed_ind().trim())) {
							appInDrugFelnCargo
							.setDrug_possessed_ind(beforeAppInDrugFelnCargo
									.getDrug_possessed_ind().trim());
						}
						if (beforeAppInDrugFelnCargo.getDrug_distribution_ind() != null
								&& FwConstants.YES
								.equals(beforeAppInDrugFelnCargo
										.getDrug_distribution_ind()
										.trim())) {
							appInDrugFelnCargo
							.setDrug_distribution_ind(beforeAppInDrugFelnCargo
									.getDrug_distribution_ind().trim());
						}
						if (beforeAppInDrugFelnCargo.getPeriodic_testing_ind() != null
								&& FwConstants.YES
								.equals(beforeAppInDrugFelnCargo
										.getPeriodic_testing_ind()
										.trim())) {
							appInDrugFelnCargo
							.setPeriodic_testing_ind(beforeAppInDrugFelnCargo
									.getPeriodic_testing_ind().trim());
						}
						if (beforeAppInDrugFelnCargo.getDrug_treatment_ind() != null
								&& FwConstants.YES
								.equals(beforeAppInDrugFelnCargo
										.getDrug_treatment_ind().trim())) {
							appInDrugFelnCargo
							.setDrug_treatment_ind(beforeAppInDrugFelnCargo
									.getDrug_treatment_ind().trim());
						}
						if (beforeAppInDrugFelnCargo.getOther_actions_ind() != null
								&& FwConstants.YES
								.equals(beforeAppInDrugFelnCargo
										.getOther_actions_ind().trim())) {
							appInDrugFelnCargo
							.setOther_actions_ind(beforeAppInDrugFelnCargo
									.getOther_actions_ind().trim());
						}
						if (beforeAppInDrugFelnCargo.getCrt_assgn_act_fin_ind() != null
								&& FwConstants.YES
								.equals(beforeAppInDrugFelnCargo
										.getCrt_assgn_act_fin_ind()
										.trim())) {
							appInDrugFelnCargo
							.setCrt_assgn_act_fin_ind(beforeAppInDrugFelnCargo
									.getCrt_assgn_act_fin_ind().trim());
						}
					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						beforeAppInDrugFelnCargo = drugFelonyBO
								.splitDrugFelInfoColl(
										beforeAppInDrugFelnCollection,
										sourceAppIndicator);
						if (beforeAppInDrugFelnCargo != null) {
							recordInd = FwConstants.ROWACTION_UPDATE;
						} else {
							recordInd = FwConstants.ROWACTION_INSERT;
						}

					}
				}

				// Check Dirty
				appInDrugFelnCargo = (APP_IN_DRUG_FELN_Cargo) isChanged(
						beforeAppInDrugFelnCargo, appInDrugFelnCargo);

				appInDrugFelnCargo.setSrc_app_ind(sourceAppIndicator);
				appInDrugFelnCargo.setRowAction(recordInd);

				if (appInDrugFelnCargo.isDirty()) {
					drugFelonyDetailsUpdate = true;
				}
			} else {
				appInDrugFelnCargo.setApp_num(appNumber);
				appInDrugFelnCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

				if (appInDrugFelnCargo.getDrug_use_ind() == null) {
					appInDrugFelnCargo.setDrug_use_ind(FwConstants.SPACE);
				}
				if (appInDrugFelnCargo.getDrug_possessed_ind() == null) {
					appInDrugFelnCargo.setDrug_possessed_ind(FwConstants.SPACE);
				}
				if (appInDrugFelnCargo.getDrug_distribution_ind() == null) {
					appInDrugFelnCargo
					.setDrug_distribution_ind(FwConstants.SPACE);
				}
				if (appInDrugFelnCargo.getPeriodic_testing_ind() == null) {
					appInDrugFelnCargo
					.setPeriodic_testing_ind(FwConstants.SPACE);
				}
				if (appInDrugFelnCargo.getDrug_treatment_ind() == null) {
					appInDrugFelnCargo.setDrug_treatment_ind(FwConstants.SPACE);
				}
				if (appInDrugFelnCargo.getOther_actions_ind() == null) {
					appInDrugFelnCargo.setOther_actions_ind(FwConstants.SPACE);
				}
				if (appInDrugFelnCargo.getCrt_assgn_act_fin_ind() == null) {
					appInDrugFelnCargo
					.setCrt_assgn_act_fin_ind(FwConstants.SPACE);
				}

				if (AppConstants.CHANGE_DRUG_FELONY.equals(catType)
						&& session.get(FwConstants.ACCESS_APPLICATION_TYPE)
						.equals(String
								.valueOf(FwConstants.RMB_APP_TYPE))) {
					appInDrugFelnCargo
					.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
				}
				if (AppConstants.BECAME_DRUG_FELONY.equals(catType)
						|| AppConstants.DRUG_FELONY.equals(catType)) {
					appInDrugFelnCargo
					.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				}

				recordInd = FwConstants.ROWACTION_INSERT;
				appInDrugFelnCargo.setRowAction(recordInd);
				appInDrugFelnCargo = (APP_IN_DRUG_FELN_Cargo) isChanged(
						beforeAppInDrugFelnCargo, appInDrugFelnCargo);
				if (appInDrugFelnCargo.isDirty()) {
					drugFelonyDetailsUpdate = true;
				}
				drugFelonyDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using update Mehod()
				categorySelectionProfileManager.updateSequence(
						drugFelonyProfile, null,
						categorySeqDetailBean.getIndividualSequence(),
						(short) catSeqNum,
						categorySeqDetailBean.getCategoryType());
			}
			if (drugFelonyDetailsUpdate) {
				if (FwConstants.ROWACTION_INSERT.equals(appInDrugFelnCargo
						.getRowAction())) {
					drugFelonyBO
					.storeDrugFelonyDetails(appInDrugFelnCollection);
				} else {
					drugFelonyBO
					.storeDrugFelonyDetails(appInDrugFelnCollection);
				}
			}
			// TEMP Commented
			// now i need to update the rmc_in_prfl if looping question is null
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.DRUG_FELON,
							rmcInPrflCargo, true);
				}
			}
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}
			categorySelectionProfileManager.makeSequenceDetailComplete(
					drugFelonyProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());

			if (categorySelectionProfileManager
					.areAllSequencesComplete(drugFelonyProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(drugFelonyProfile);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeDrugFelonyDetails:End");

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.storeDrugFelonyDetails() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeDrugFelonyDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeDrugFelonyDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeDrugFelonyDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeDrugFelonyDetails");
		}
	}

	// EDSP Ends

	/**
	 * EDSP CP: added new method.
	 *
	 * @param session the session
	 * @param pageCollection the page collection
	 * @return the map
	 */
	private Map displayProgramSpecificInfo(final Map session,
			final Map pageCollection) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.displayProgramSpecificInfo() - START");
		final short[] programKeyArray = (short[]) session
				.get(FwConstants.RMC_PROGRAM_KEY);
		final boolean isFMARequestedFlag = false;
		final boolean isCCRequestedFlag = false;
		boolean isSNAPRequestedFlag = false;
		boolean isTANFRequestedFlag = false;
		boolean isEARequestedFlag = false;
		final List cmpList = (ArrayList) pageCollection
				.get("PAGE_COMPONENT_LIST");

		if (programManager.isThisProgramRequested(programKeyArray,
				FwConstants.TANF_INDEX)) {
			pageCollection.put("TANF_FLAG", true);
			isTANFRequestedFlag = true;
		}
		if (programManager.isThisProgramRequested(programKeyArray,
				FwConstants.FS_INDEX)) {
			pageCollection.put("SNAP_FLAG", true);
			isSNAPRequestedFlag = true;
		}
		if (programManager.isThisProgramRequested(programKeyArray,
				FwConstants.CRISIS_ASST_INDEX)
				|| programManager.isThisProgramRequested(programKeyArray,
						FwConstants.COOLING_ASST_INDEX)
						|| programManager.isThisProgramRequested(programKeyArray,
								FwConstants.FUEL_ASST_INDEX)) {
			isEARequestedFlag = true;
		}
		if (!isCCRequestedFlag && !isFMARequestedFlag & !isTANFRequestedFlag
				&& !isSNAPRequestedFlag && isEARequestedFlag) {
			pageCollection.put("EA_FLAG", true);
		}
		pageCollection.put("PROGRAM_SPECIFIC_FLAG", true);
		pageCollection.put("PAGE_COMPONENT_LIST", cmpList);

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.displayProgramSpecificInfo() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
		return pageCollection;
	}

	/**
	 * EDSP CP: added new method.
	 *
	 * @param rmcRespCustomColl the rmc resp custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param compID the comp id
	 * @param getRelevant the get relevant
	 * @param txnBean the txn bean
	 * @param rmbRqstCargo the rmb rqst cargo
	 * @param pageLoad the page load
	 * @return the people collection and update maps for edsp
	 */
	private Map getPeopleCollectionAndUpdateMapsForEDSP(
			final RMC_RESPONSE_Custom_Collection rmcRespCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String compID, final boolean getRelevant,
			final FwTransaction txnBean, final RMB_RQST_Cargo rmbRqstCargo,
			final boolean pageLoad) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMapsForEDSP() - START");
		try {
			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo;
			INDIVIDUAL_Custom_Collection indivColl;
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(compID);
			final Map session = txnBean.getSession();

			// try to get a filtered list. If it doesn't exist, get the
			// peopleHandler getIndividuals
			if (pageCollection.get(indivCollKey.toString()) == null) {
				indivColl = peopleHandler.getAllIndividuals();
			} else {
				indivColl = (INDIVIDUAL_Custom_Collection) pageCollection
						.get(indivCollKey.toString());
			}

			// set the passed response map = new map
			final Map questionRespMap = new HashMap();
			RMC_RESPONSE_Custom_Cargo rmcRspnseCustomCargo = null;
			final int indivCollSize = indivColl.size();
			final SortedSet selectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final short catSeqNum = 0;

			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);
				indivSeqNum = indivCargo.getIndv_seq_num();
				String questionResp = FwConstants.NO;
				String tempCode = FwConstants.EMPTY_STRING;
				if ("5199".equals(compID)) {
					tempCode = AppConstants.PROBATION_PAROL;
				} else if ("5200".equals(compID)) {
					tempCode = AppConstants.ROOMER_BOARDER;
				} else {
					tempCode = compID;
				}

				if (selectionProfile != null) {
					questionResp = String
							.valueOf(categorySelectionProfileManager
									.getSequenceDetailStatusView(
											selectionProfile,
											Short.parseShort(indivSeqNum),
											catSeqNum, tempCode));
				}
				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

				// create the cargo
				if (rmbRqstCargo != null) {
					boolean isAddCargo = false;

					if (AppConstants.LEFT_THE_HOME.equals(compID)) {
						// AppConstants.LEFT_THE_HOME
						if (rmbRqstCargo.getPrsn_move_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getPrsn_move_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.DISABLED_BLIND
							.equalsIgnoreCase(compID)) {
						// AppConstants.DISABLED_BLIND
						if (rmbRqstCargo.getDabl_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getDabl_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.BECAME_DRUG_FELONY.equals(compID)) {
						// drug/felony
						if (rmbRqstCargo.getDrug_feln_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getDrug_feln_stat_ind())) {
							isAddCargo = true;
						}
					} else if (AppConstants.PAROLE_VIOLATION_CHG_QUESTION
							.equals(compID)) {
						// paroleviolation
						if (rmbRqstCargo.getParole_violation_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getParole_violation_stat_ind())) {
							isAddCargo = true;
						}
					} else if ("5200".equals(compID)) {
						// roomer/boarder
						if (rmbRqstCargo.getRoom_brd_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getRoom_brd_stat_ind())) {
							isAddCargo = true;
						}
					} else if ("5199".equals(compID)) {
						// roomer/boarder
						if (rmbRqstCargo.getParole_violation_stat_ind() != null
								&& FwConstants.YES.equals(rmbRqstCargo
										.getParole_violation_stat_ind())) {
							isAddCargo = true;
						}
					}

					if (isAddCargo) {
						rmcRspnseCustomCargo = new RMC_RESPONSE_Custom_Cargo();
						rmcRspnseCustomCargo.setIndvSeqNum(indivSeqNum);
						rmcRspnseCustomCargo.setCategoryType(compID);
						rmcRspnseCustomCargo.setResponse(questionResp);
						rmcRespCustomColl.addCargo(rmcRspnseCustomCargo);
					}
				}

			}// end for loop

			// Store all maps in page collection
			String respMapString = new String();
			respMapString = AppConstants.RESP_MAP;
			respMapString = respMapString + compID;
			pageCollection.put(respMapString, questionRespMap);

			// store people collection in page collection
			String peopleString = new String();
			peopleString = AppConstants.PEOPLE;
			peopleString = peopleString + compID;
			pageCollection.put(peopleString, indivColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMapsForEDSP() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(compID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMapsForEDSP");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionAndUpdateMapsForEDSP", e);
			fe.setParameterText(compID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMapsForEDSP");
		}
	}

	/**
	 * Creates the and load response maps to page collection arhoh.
	 *
	 * @param appInPrflColl the app in prfl coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @param aAppNumber the a app number
	 * @return Map
	 */
	private Map createAndLoadResponseMapsToPageCollectionARHOH(
			final RMC_IN_PRFL_Collection appInPrflColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean pageLoad, final int driverStatus,
			final String aAppNumber) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.createAndLoadResponseMapsToPageCollectionARHOH() - START");
		try {

			getPeopleCollectionAndUpdateMapsARHOH(appInPrflColl,
					pageCollection, peopleHandler, "5261",
					IRMCResponseProfileManager.HEAD_OF_HOUSE, pageLoad,
					driverStatus, false, aAppNumber);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.createAndLoadResponseMapsToPageCollectionARHOH() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
			// exit

		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createAndLoadResponseMapsToPageCollectionARHOH");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"createAndLoadABHHQResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createAndLoadResponseMapsToPageCollectionARHOH");
		}
	}

	/**
	 * Filterindiv custome collection.
	 *
	 * @param peopleHandler the people handler
	 * @return the INDIVIDUA l_ custom_ collection
	 * @Description Method is to get adults in the home. If not adults then
	 *              retuns total members of the home.
	 */
	private INDIVIDUAL_Custom_Collection filterindivCustomeCollection(
			final PeopleHandler peopleHandler) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.filterindivCustomeCollection() - START");
		INDIVIDUAL_Custom_Collection indivColl = peopleHandler
				.getInHomeIndividuals();
		INDIVIDUAL_Custom_Cargo indivCargo;
		INDIVIDUAL_Custom_Collection newindivColl;
		IndividualAge indvAge = null;
		if (indivColl != null && !indivColl.isEmpty()) {
			newindivColl = new INDIVIDUAL_Custom_Collection();
			for (int i = 0; i < indivColl.size(); i++) {
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);
				indvAge = indivCargo.getIndv_age();
				if (indvAge.getYears() >= 18) {
					newindivColl.addCargo(indivCargo);
				}
			}
			if (!newindivColl.isEmpty()) {
				return newindivColl;
			}
		} else {
			indivColl = new INDIVIDUAL_Custom_Collection();
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.filterindivCustomeCollection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
		return indivColl;
	}

	/**
	 * Gets the people collection and update maps arhoh.
	 *
	 * @param appInPrflColl the app in prfl coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param compID the comp id
	 * @param questionName the question name
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @param getRelevant the get relevant
	 * @param aAppNumber the a app number
	 * @return the people collection and update maps arhoh
	 */
	/*
	 * This method gets the people collection for a questions page, populates
	 * maps for AFBIndividualsTags and creates a map of noOneChecked strings -
	 * padmana
	 */
	public Map getPeopleCollectionAndUpdateMapsARHOH(
			final RMC_IN_PRFL_Collection appInPrflColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String compID, final short questionName,
			final boolean pageLoad, final int driverStatus,
			final boolean getRelevant, final String aAppNumber) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMapsARHOH() - START");
		try {
			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo;
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(compID);

			final INDIVIDUAL_Custom_Collection indivColl = filterindivCustomeCollection(peopleHandler);

			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			// create an appInPrfl object
			RMC_IN_PRFL_Cargo appInPrflCargo = null;

			// get size of the collection
			final int indivCollSize = indivColl.size();

			// Define NoOneChecked = YES flags for the question
			String noOneChecked = FwConstants.YES;

			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				// get the indivCargo
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);

				// get app_indiv_seq_num
				indivSeqNum = indivCargo.getIndv_seq_num();

				// Get the appInPrflCargo for this person
				appInPrflCargo = rmcResponseProfileManager.getProfile(
						appInPrflColl, indivSeqNum);

				// get the AIP Response for the given question from this cargo
				final String questionResp = rmcResponseProfileManager
						.getProfileResponse(appInPrflCargo, questionName);

				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

				if (pageLoad == true) {
					// for each question, set the noOneChecked flag
					// check if there is anything other than not required - if
					// so, change flag
					if (questionResp.charAt(0) != IRMCResponseProfileManager.STATUS_NOT_REQUIRED) {
						noOneChecked = FwConstants.NO;
					}
				}

			}// end for loop

			if (pageLoad == true) {
				if (driverStatus == FwConstants.DRIVER_REQUIRED) {
					noOneChecked = FwConstants.NO;
				}

				// get the NoOneChecked map from the pagecollection
				Map noOneCheckedMap = (Map) pageCollection
						.get(AppConstants.NO_ONE_CHECKED_MAP);
				if (noOneCheckedMap == null) {
					noOneCheckedMap = new HashMap();
				}

				// update the noOneCheckedMap and re-add it to the page coll
				final StringBuilder noOneCheckedString = new StringBuilder();
				noOneCheckedString.append(AppConstants.NO_ONE_CHECKED);
				noOneCheckedString.append(compID);
				noOneCheckedMap
				.put(noOneCheckedString.toString(), noOneChecked);
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
			}

			// Store all maps in page collection
			final StringBuilder respMapString = new StringBuilder();
			respMapString.append(AppConstants.RESP_MAP);
			respMapString.append(compID);
			pageCollection.put(respMapString.toString(), questionRespMap);

			// store people collection in page collection
			final StringBuilder peopleString = new StringBuilder();
			peopleString.append(AppConstants.PEOPLE);
			peopleString.append(compID);
			pageCollection.put(peopleString.toString(), indivColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMapsARHOH() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(compID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMapsARHOH");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionAndUpdateMaps", e);
			fe.setParameterText(compID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPeopleCollectionAndUpdateMapsARHOH");
		}
	}

	/**
	 * Add a new Roomer/Boarder.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void addRoomerBoarder(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addRoomerBoarder() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::addRoomerBoarder:Start");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();

			String indivSeqNum = (String) request
					.get("firstName_roomerBoarder");
			indivSeqNum = indivSeqNum == null ? FwConstants.EMPTY_STRING
					: indivSeqNum.trim();
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final ARHCSValidator validator = new ARHCSValidator();
			validator.validateAddRoomerBoarder(indivSeqNum);

			if (validator.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST,
						validator.getMessageList());
				txnBean.setPageCollection((Map) session
						.get(FwConstants.BEFORE_COLLECTION));
				return;
			}

			final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection persistCollection = new RMC_IN_PRFL_Collection();
			RMC_IN_PRFL_Cargo cargo;

			for (int i = 0; i < rmcInPrflCollRB.size(); i++) {
				cargo = rmcInPrflCollRB.getCargo(i);
				if (indivSeqNum.equals(cargo.getIndv_seq_num())) {
					cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					cargo.setRoom_board_resp(AppConstants.YES);
					persistCollection.addCargo(cargo);
					break;
				}
			}

			final ABHouseholdInformationSummaryBO bo = new ABHouseholdInformationSummaryBO();
			bo.storeRoomerBoarderCollection(persistCollection);

			final RMC_IN_PRFL_Collection newrmcInPrfl = rmcResponseProfileManager
					.loadProfile(appNum);
			session.put(AppConstants.RMC_IN_PRFL_MASTER, newrmcInPrfl);

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::addRoomerBoarder:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addRoomerBoarder");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addRoomerBoarder");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addRoomerBoarder", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addRoomerBoarder");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addRoomerBoarder() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Add a new Roomer/Boarder.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void addProbationParole(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.addProbationParole() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::addProbationParole");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();

			String indivSeqNum = (String) request
					.get("firstName_probationParole");
			indivSeqNum = indivSeqNum == null ? FwConstants.EMPTY_STRING
					: indivSeqNum.trim();
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final ARHCSValidator validator = new ARHCSValidator();
			validator.validateAddRoomerBoarder(indivSeqNum);

			if (validator.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST,
						validator.getMessageList());
				txnBean.setPageCollection((Map) session
						.get(FwConstants.BEFORE_COLLECTION));
				return;
			}

			final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection persistCollection = new RMC_IN_PRFL_Collection();
			RMC_IN_PRFL_Cargo cargo;

			for (int i = 0; i < rmcInPrflCollRB.size(); i++) {
				cargo = rmcInPrflCollRB.getCargo(i);
				if (indivSeqNum.equals(cargo.getIndv_seq_num())) {
					cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					cargo.setParole_violation_resp(AppConstants.YES);
					persistCollection.addCargo(cargo);
					break;
				}
			}

			final ABHouseholdInformationSummaryBO bo = new ABHouseholdInformationSummaryBO();
			bo.storeProbationParoleCollection(persistCollection);

			final RMC_IN_PRFL_Collection newrmcInPrfl = rmcResponseProfileManager
					.loadProfile(appNum);
			session.put(AppConstants.RMC_IN_PRFL_MASTER, newrmcInPrfl);

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::addProbationParole:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("addProbationParole");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addProbationParole");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"addProbationParole", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "addProbationParole");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.addProbationParole() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Erase a Roomer/Boarder.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void eraseRoomerBoarder(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseRoomerBoarder() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseRoomerBoarder:Start");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final RMC_IN_PRFL_Cargo prflCargo = ((RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection")).getCargo(0);
			final String indivSeqNum = prflCargo.getIndv_seq_num();
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indivSeqNum);

			boolean warningMsgFlag = false;
			final ARHCSValidator validator = new ARHCSValidator();
			validator.validateEraseRoomerBoarder(name);

			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					return;
				}
			}

			final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection persistCollection = new RMC_IN_PRFL_Collection();
			RMC_IN_PRFL_Cargo cargo;

			for (int i = 0; i < rmcInPrflCollRB.size(); i++) {
				cargo = rmcInPrflCollRB.getCargo(i);
				if (indivSeqNum.equals(cargo.getIndv_seq_num())) {
					cargo.setRoom_board_resp(AppConstants.NO);
					cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					persistCollection.addCargo(cargo);
					break;
				}
			}

			final ABHouseholdInformationSummaryBO bo = new ABHouseholdInformationSummaryBO();
			bo.storeRoomerBoarderCollection(persistCollection);

			final RMC_IN_PRFL_Collection newrmcInPrfl = rmcResponseProfileManager
					.loadProfile(appNum);
			session.put(AppConstants.RMC_IN_PRFL_MASTER, newrmcInPrfl);

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseRoomerBoarder:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseRoomerBoarder");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseRoomerBoarder");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseRoomerBoarder", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseRoomerBoarder");
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseRoomerBoarder() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Erase a Roomer/Boarder.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void eraseProbationParole(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.eraseProbationParole() - START");
		try {
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseProbationParole:Start");

			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();

			final RMC_IN_PRFL_Cargo prflCargo = ((RMC_IN_PRFL_Collection) pageCollection
					.get("RMC_IN_PRFL_Collection")).getCargo(0);
			final String indivSeqNum = prflCargo.getIndv_seq_num();
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indivSeqNum);

			boolean warningMsgFlag = false;
			final ARHCSValidator validator = new ARHCSValidator();
			validator.validateEraseRoomerBoarder(name);

			if (validator.hasMessages()) {
				final String reqWarningMsgs = (String) request
						.get(FwConstants.WARNING_MSG_DETAILS);
				warningMsgFlag = checkForWarningMesgs(reqWarningMsgs,
						validator.getMessageList());
				if (!warningMsgFlag) {
					request.put(FwConstants.MESSAGE_LIST,
							validator.getMessageList());
					txnBean.setPageCollection((Map) session
							.get(FwConstants.BEFORE_COLLECTION));
					return;
				}
			}

			final RMC_IN_PRFL_Collection rmcInPrflCollRB = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final RMC_IN_PRFL_Collection persistCollection = new RMC_IN_PRFL_Collection();
			RMC_IN_PRFL_Cargo cargo;

			for (int i = 0; i < rmcInPrflCollRB.size(); i++) {
				cargo = rmcInPrflCollRB.getCargo(i);
				if (indivSeqNum.equals(cargo.getIndv_seq_num())) {
					cargo.setParole_violation_resp(AppConstants.NO);
					cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
					persistCollection.addCargo(cargo);
					break;
				}
			}

			final ABHouseholdInformationSummaryBO bo = new ABHouseholdInformationSummaryBO();
			bo.storeProbationParoleCollection(persistCollection);

			final RMC_IN_PRFL_Collection newrmcInPrfl = rmcResponseProfileManager
					.loadProfile(appNum);
			session.put(AppConstants.RMC_IN_PRFL_MASTER, newrmcInPrfl);

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::eraseProbationParole:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseProbationParole");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseProbationParole");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseProbationParole", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseProbationParole");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseProbationParole() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Change the Head of Household.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void changeHeadOfHousehold(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.changeHeadOfHousehold() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::changeHeadOfHousehold:Start");

			log(ILog.INFO, "RMCHouseHoldInfoEJBBean::changeHeadOfHousehold:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("changeHeadOfHousehold");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "changeHeadOfHousehold");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"changeHeadOfHousehold", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "changeHeadOfHousehold");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.changeHeadOfHousehold() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Gets the current past pending assistance details.
	 *
	 * @param txnBean the txn bean
	 */
	// EDSP CP starts: CPP Assistnce screen
	public void getCurrentPastPendingAssistanceDetails(
			final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getCurrentPastPendingAssistanceDetails() - START");
		try {
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			Map pageCollection = txnBean.getPageCollection();

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final AssistanceBO assistanceBO = new AssistanceBO();
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);

			// if previous pageID is not equal to the present pageID then clean
			// the session and Before Collection
			if (!((String) request.get(FwConstants.PREVIOUS_PAGE_ID))
					.equals(currentPageID)) {
				session.remove("CP_APP_IN_ASSISTANCE_Custom_Collection");
				session.remove(FwConstants.BEFORE_COLLECTION);
			}

			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);

			// when user hits the Back button or comes from the Summary Page
			if (pageCollection.get(FwConstants.DETAIL_KEY_BEAN) != null) {
				// get assistance details from Cp_App_In_Assistance detials
				// table in database
				final IndivTypeSeqBean indvBean = (IndivTypeSeqBean) pageCollection
						.get(FwConstants.DETAIL_KEY_BEAN);

				// get Details_Collection from DataBase and set to
				// PageCollection
				pageCollection
				.put("CP_APP_IN_ASSISTANCE_Custom_Collection",
						assistanceBO
						.loadIndividualCurrentPastPendingAssistanceDetails(
								(String) session
								.get(AppConstants.APP_NUMBER),
								indvBean.getIndivSeqNum()));

				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(indvBean.getIndivSeqNum()));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						indvBean.getIndivSeqNum());
			} else {
				pageCollection = new HashMap();
				// check the session and pageCollection for
				// if not found read the database and populate the RecordArray.
				if (pageCollection
						.get("CP_APP_IN_ASSISTANCE_Custom_Collection") == null) {
					putCurrentPastPendingAssistanceCollectionInSession(txnBean,
							driverStatus);
				}
				// check if pageStatus is REQ OR ADDNEW or VISIT_AGAIN
				if (driverStatus == FwConstants.DRIVER_REQUIRED
						|| driverStatus == FwConstants.DRIVER_ADD_NEW
						|| driverStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					final RMC_IN_PRFL_Collection appInPrflCollSession = (RMC_IN_PRFL_Collection) session
							.get(AppConstants.RMC_IN_PRFL_MASTER);
					RMC_IN_PRFL_Cargo appinprflCargo = null;

					String indvSeqNum = null;
					final int cargoSize = appInPrflCollSession.size();
					final String utilityType = null;
					char typeStatus = 'N';
					boolean successFlag = false;
					// loop thru APP_IN_PRFL Collection
					// Check status of each UtilityCost type in alphabetical
					// order as defined in Reference table for each Cargo
					for (int i = 0; i < cargoSize; i++) {
						appinprflCargo = appInPrflCollSession.getCargo(i);
						indvSeqNum = appinprflCargo.getIndv_seq_num();
						// EDSP temp
						appinprflCargo.setAdpt_asst_resp("R");
						typeStatus = rmcResponseProfileManager
								.getProfileResponse(
										appinprflCargo,
										IRMCResponseProfileManager.ADOPTION_ASSISTANCE)
										.charAt(0);

						if (typeStatus == IRMCResponseProfileManager.STATUS_VISIT_AGAIN) {
							setApplicationAssistanceFromSession(session,
									pageCollection, driverStatus, indvSeqNum,
									utilityType);
							pageCollection.put(
									AppConstants.CURRENT_INDIV_SEQ_NUM,
									indvSeqNum);
							successFlag = true;
							break;
						} else if (typeStatus == IRMCResponseProfileManager.STATUS_REQUIRED
								|| typeStatus == IRMCResponseProfileManager.STATUS_ADD_NEW) {
							setCurrentPastPendingCargo(indvSeqNum, utilityType,
									session, pageCollection);
							successFlag = true;
							break;
						}

						if (successFlag) {
							break;
						}
					}
				} else // the driverStatus is Complete
				{
					final CP_APP_IN_ASSISTANCE_Custom_Collection collSes = (CP_APP_IN_ASSISTANCE_Custom_Collection) session
							.get("CP_APP_IN_ASSISTANCE_Custom_Collection");
					CP_APP_IN_ASSISTANCE_Custom_Cargo cargoSes = null;
					final int size = collSes.size();
					if (size > 0) {
						// get last cargo from session
						cargoSes = collSes.getCargo(size - 1);
					}
					final CP_APP_IN_ASSISTANCE_Custom_Collection newColl = new CP_APP_IN_ASSISTANCE_Custom_Collection();
					newColl.addCargo(cargoSes);
					// set Details_Collection from session to PageCollection
					pageCollection.put(
							"CP_APP_IN_ASSISTANCE_Custom_Collection", newColl);
					// set frist Name to PageCollection
					pageCollection.put(AppConstants.FIRST_NAME, peopleHandler
							.getFirstName(cargoSes.getIndv_seq_num()));
					pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
							cargoSes.getIndv_seq_num());
				}
			}
			txnBean.setPageCollection(pageCollection);
			// Run ComponentManager to get the components for the current page
			componentManager.getComponents(currentPageID, txnBean);
			// Add the page collection to before collection
			if (session.get(FwConstants.BEFORE_COLLECTION) != null) {
				((Map) session.get(FwConstants.BEFORE_COLLECTION))
				.putAll(pageCollection);
			} else {
				final Map beforeColl = new HashMap();
				beforeColl.putAll(pageCollection);
				session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBEan::getCurrentPastPendingAssistanceDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("getCurrentPastPendingAssistanceDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getCurrentPastPendingAssistanceDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"getCurrentPastPendingAssistanceDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getCurrentPastPendingAssistanceDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getCurrentPastPendingAssistanceDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Creates an empty <code>CP_APP_IN_ASSISTANCE_Custom_Collection</code> and
	 * stores it in <code>pageCollection</code>.
	 *
	 * @param indvSeqNum the indv seq num
	 * @param type the type
	 * @param session the session
	 * @param pageCollection the page collection
	 */
	private void setCurrentPastPendingCargo(final String indvSeqNum,
			final String type, final Map session, final Map pageCollection) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.setCurrentPastPendingCargo() - START");
		try {
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);

			// create IndivSeqTypeBean for the cargo and populate Record Array
			final IndivTypeSeqBean indvTSBean = new IndivTypeSeqBean(
					indvSeqNum, type, null);
			populateRecordArray(indvTSBean, session);

			// set cargo into Collection
			final CP_APP_IN_ASSISTANCE_Custom_Collection appInAssistanceCustomColl = new CP_APP_IN_ASSISTANCE_Custom_Collection();
			final CP_APP_IN_ASSISTANCE_Custom_Cargo cargo = new CP_APP_IN_ASSISTANCE_Custom_Cargo();
			cargo.setIndv_seq_num(indvSeqNum);
			appInAssistanceCustomColl.addCargo(cargo);

			// set Details_Collection to PageCollection
			pageCollection.put("CP_APP_IN_ASSISTANCE_Custom_Collection",
					appInAssistanceCustomColl);

			// put FirstName in PageCollection
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNum));
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM, indvSeqNum);
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("setCurrentPastPendingCargo");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "setCurrentPastPendingCargo");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"setCurrentPastPendingCargo", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "setCurrentPastPendingCargo");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.setCurrentPastPendingCargo() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Sets the application assistance from session.
	 *
	 * @param session the session
	 * @param pageCollection the page collection
	 * @param driverStatus the driver status
	 * @param indvSeqNum the indv seq num
	 * @param utilityType the utility type
	 */
	private void setApplicationAssistanceFromSession(final Map session,
			final Map pageCollection, final int driverStatus,
			final String indvSeqNum, final String utilityType) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.setApplicationAssistanceFromSession() - START");
		try {
			final RMC_IN_PRFL_Collection appInPrflCollSession = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final CP_APP_IN_ASSISTANCE_Collection collSes = (CP_APP_IN_ASSISTANCE_Collection) pageCollection
					.get("CP_APP_IN_ASSISTANCE_Custom_Collection");
			CP_APP_IN_ASSISTANCE_Cargo cargoSes = null;
			final int size = collSes.size();
			final CP_APP_IN_ASSISTANCE_Collection newColl = new CP_APP_IN_ASSISTANCE_Collection();

			for (int i = 0; i < size; i++) {
				if (collSes.getCargo(i).getIndv_seq_num().equals(indvSeqNum)) {
					cargoSes = collSes.getCargo(i);

					if (size > i + 1
							&& collSes.getCargo(i + 1).getIndv_seq_num()
							.equals(indvSeqNum)) {
					}
					newColl.addCargo(cargoSes);
				}
			}

			if (driverStatus == FwConstants.DRIVER_VISIT_AGAIN) {
				// set the current record index for the record array
				setCurrentRecord(
						new IndivTypeSeqBean(
								cargoSes.getIndv_seq_num(),
								String.valueOf(IRMCResponseProfileManager.ADOPTION_ASSISTANCE),
								FwConstants.EMPTY_STRING), session);
			}
			// set Details_Collection from session to PageCollection
			pageCollection.put("CP_APP_IN_ASSISTANCE_Custom_Collection",
					newColl);
			// set frist Name to PageCollection
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(cargoSes.getIndv_seq_num()));
			rmcResponseProfileManager.getProfile(appInPrflCollSession,
					cargoSes.getIndv_seq_num());

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("setApplicationAssistanceFromSession");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "setApplicationAssistanceFromSession");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"setApplicationAssistanceFromSession", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "setApplicationAssistanceFromSession");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.setApplicationAssistanceFromSession() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * <code>storeCurrentPastPendingAssistanceDetails</code> method stores the
	 * data from <code>Current/Past/Pending Assistance</code> page.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storeCurrentPastPendingAssistanceDetails(
			final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeCurrentPastPendingAssistanceDetails() - START");
		String appNumber = null;
		String indvSeqNumber = null;
		FwMessageList validateInfo = null;
		try {
			log(ILog.INFO,
					"HouseHoldInfoEJBBEan::storeCurrentPastPendingAssistanceDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			indvSeqNumber = (String) pageCollection
					.get(AppConstants.CURRENT_INDIV_SEQ_NUM);

			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			request.get(FwConstants.PREVIOUS_PAGE_ID);

			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			final int driverStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);
			final int currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, currentPageID, driverArray);

			final AssistanceBO assistanceBO = new AssistanceBO();
			final CP_APP_IN_ASSISTANCE_Custom_Collection assistanceColl = (CP_APP_IN_ASSISTANCE_Custom_Collection) pageCollection
					.get("CP_APP_IN_ASSISTANCE_Custom_Collection");
			final CP_APP_IN_ASSISTANCE_Custom_Cargo assistanceCargo = assistanceColl
					.getCargo(0);
			assistanceCargo.setApp_num(appNumber);

			final RMC_IN_PRFL_Collection sessionAppInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			final CP_APP_IN_ASSISTANCE_Custom_Collection assistanceBeforeColl = (CP_APP_IN_ASSISTANCE_Custom_Collection) beforeColl
					.get("CP_APP_IN_ASSISTANCE_Custom_Collection");
			CP_APP_IN_ASSISTANCE_Custom_Cargo assistanceBeforeCargo = new CP_APP_IN_ASSISTANCE_Custom_Cargo();
			if (assistanceBeforeColl != null && !assistanceBeforeColl.isEmpty()
					&& assistanceBeforeColl.getCargo(0) != null) {
				assistanceBeforeCargo = assistanceBeforeColl.getCargo(0);
				assistanceBeforeCargo.setApp_num(appNumber);
				indvSeqNumber = assistanceBeforeCargo.getIndv_seq_num();
				assistanceCargo.setIndv_seq_num(indvSeqNumber);
			}
			if (indvSeqNumber == null) {
				indvSeqNumber = (String) beforeColl
						.get(AppConstants.CURRENT_INDIV_SEQ_NUM);
				assistanceCargo.setIndv_seq_num(indvSeqNumber);
			}

			// Validate
			validateInfo = assistanceBO.validateCurrentPastPendingAssistance(
					appNumber, indvSeqNumber, assistanceCargo);
			if (validateInfo != null && validateInfo.hasMessages()) {
				request.put(FwConstants.MESSAGE_LIST, validateInfo);
				pageCollection.put("CP_APP_IN_ASSISTANCE_Custom_Collection",
						assistanceColl);
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						indvSeqNumber);
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						indvSeqNumber);
				pageCollection.put("CurrentPageStatus",
						String.valueOf(currentPageStatus));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(indvSeqNumber));
				return;
			}

			final CP_APP_IN_ASSISTANCE_Collection assistanceDBColl = assistanceBO
					.convertData(assistanceColl);
			if (assistanceBeforeColl != null) {
				// Delete all previous existing rows
				assistanceBO.deleteRecords(assistanceBO
						.convertData(assistanceBeforeColl));
			}

			assistanceBO.insertRecordsRMC(appNumber, indvSeqNumber,
					assistanceDBColl);

			RMC_IN_PRFL_Cargo appInPrflSessCargo = null;
			// get the matching APP_IN_PRFL_Cargo
			final String indvSeqNum = assistanceCargo.getIndv_seq_num();

			// Remove first Cargo from DetailCollection
			final CP_APP_IN_ASSISTANCE_Custom_Collection assistanceSessColl = (CP_APP_IN_ASSISTANCE_Custom_Collection) pageCollection
					.get("CP_APP_IN_ASSISTANCE_Custom_Collection");

			appInPrflSessCargo = rmcResponseProfileManager.getProfile(
					sessionAppInPrflColl, indvSeqNum);

			if (assistanceSessColl != null) {
				assistanceSessColl.remove(assistanceBeforeColl);
			}
			if (driverStatus != FwConstants.DRIVER_COMPLETE) {
				// Make "Complete" for Type and persist
				rmcResponseProfileManager.makeComplete(
						IRMCResponseProfileManager.ADOPTION_ASSISTANCE,
						appInPrflSessCargo, true);
			}

			// Define DetailsFinishedFlag as True
			boolean detailsFinishedFlag = true;
			RMC_IN_PRFL_Cargo appInPrflCargo = null;
			final int cargoSize = sessionAppInPrflColl.size();
			// loop thru appInPrflColl_Session
			char typeStatus = ' ';
			for (int i = 0; i < cargoSize; i++) {
				appInPrflCargo = sessionAppInPrflColl.getCargo(i);
				typeStatus = 'N';
				// check if any type is required, visitAgain and AddNew
				typeStatus = rmcResponseProfileManager.getProfileResponse(
						appInPrflCargo,
						IRMCResponseProfileManager.ADOPTION_ASSISTANCE).charAt(
								0);
				if (typeStatus == IRMCResponseProfileManager.STATUS_REQUIRED
						|| typeStatus == IRMCResponseProfileManager.STATUS_ADD_NEW
						|| typeStatus == IRMCResponseProfileManager.STATUS_VISIT_AGAIN) {
					detailsFinishedFlag = false;
					break;
				}
			}

			// check the detailsFinishedFlag
			if (detailsFinishedFlag) {
				// Make driver for this page "COMPLETE"
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray,
						(String) session.get(AppConstants.APP_NUMBER));
			}

			log(ILog.INFO,
					"HouseHoldInfoEJBBEan::storeCurrentPastPendingAssistanceDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeCurrentPastPendingAssistanceDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeCurrentPastPendingAssistanceDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeCurrentPastPendingAssistanceDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeCurrentPastPendingAssistanceDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeCurrentPastPendingAssistanceDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Put current past pending assistance collection in session.
	 *
	 * @param txnBean the txn bean
	 * @param driverStatus the driver status
	 */
	private void putCurrentPastPendingAssistanceCollectionInSession(
			final FwTransaction txnBean, final int driverStatus) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.putCurrentPastPendingAssistanceCollectionInSession() - START");
		final Map session = txnBean.getSession();
		try {
			final CP_APP_IN_ASSISTANCE_Custom_Collection coll = new CP_APP_IN_ASSISTANCE_Custom_Collection();
			final AssistanceBO assistanceBo = new AssistanceBO();
			final RMC_IN_PRFL_Collection appInPrflCollSession = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			RMC_IN_PRFL_Cargo appinprflCargoSes = null;

			final CP_APP_IN_ASSISTANCE_Custom_Collection assistanceCustomColl = assistanceBo
					.loadIndividualCurrentPastPendingAssistanceDetails((String) session
							.get(AppConstants.APP_NUMBER));
			if (assistanceCustomColl != null) {
				final int sessAppPrflCollSize = appInPrflCollSession.size();
				final int emplCollSize = assistanceCustomColl.size();
				String indvPrflSeqNum = null;
				for (int i = 0; i < sessAppPrflCollSize; i++) {
					indvPrflSeqNum = appInPrflCollSession.getCargo(i)
							.getIndv_seq_num();
					String indvSeqNum = null;
					for (int j = 0; j < emplCollSize; j++) {
						indvSeqNum = assistanceCustomColl.getCargo(j)
								.getIndv_seq_num();
						if (indvSeqNum.equals(indvPrflSeqNum)) {
							coll.addCargo(assistanceCustomColl.getCargo(j));
						}
					}
				}
			}

			// create IndivSeqTypeBean for each cargo and populate Record Array
			IndivTypeSeqBean indvTSBean = null;
			CP_APP_IN_ASSISTANCE_Custom_Cargo tempCargo = null;
			CP_APP_IN_ASSISTANCE_Custom_Collection appInAssistanceCustomNewColl = null;
			final int size = coll.size();
			for (int k = 0; k < size; k++) {
				tempCargo = new CP_APP_IN_ASSISTANCE_Custom_Cargo();
				tempCargo = coll.getCargo(k);
				appinprflCargoSes = appInPrflCollSession.getCargo(k);
				if (driverStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// populate Record array if the Self_Employment response
					// Status is other than "Complete"
					if (rmcResponseProfileManager.getProfileResponse(
							appinprflCargoSes,
							IRMCResponseProfileManager.ADOPTION_ASSISTANCE)
							.charAt(0) != IRMCResponseProfileManager.STATUS_COMPLETE) {
						if (appInAssistanceCustomNewColl == null) {
							appInAssistanceCustomNewColl = new CP_APP_IN_ASSISTANCE_Custom_Collection();
						}
						appInAssistanceCustomNewColl.add(tempCargo);
					}
				}
				indvTSBean = new IndivTypeSeqBean(tempCargo.getIndv_seq_num(),
						FwConstants.EMPTY_STRING, null);
				populateRecordArray(indvTSBean, session);
			}
			if (driverStatus == FwConstants.DRIVER_VISIT_AGAIN) {
				if (appInAssistanceCustomNewColl != null
						&& !appInAssistanceCustomNewColl.isEmpty()) {
					// put the appInAssistanceCustomNewColl in session
					session.put("CP_APP_IN_ASSISTANCE_Custom_Collection",
							appInAssistanceCustomNewColl);
				}
			} else if (!coll.isEmpty()) {
				// put the appInAssistanceCustomNewColl in session
				session.put("CP_APP_IN_ASSISTANCE_Custom_Collection", coll);

			}
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("putCurrentPastPendingAssistanceCollectionInSession");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "putCurrentPastPendingAssistanceCollectionInSession");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"putCurrentPastPendingAssistanceCollectionInSession", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "putCurrentPastPendingAssistanceCollectionInSession");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.putCurrentPastPendingAssistanceCollectionInSession() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	// EDSP CP ends: CPP Assistnce screen
	/**
	 * Load house hold info work related expense details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void loadHouseHoldInfoWorkRelatedExpenseDetails(
			final FwTransaction txnBean) throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoWorkRelatedExpenseDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoWorkRelatedExpenseDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			String pageId = null;
			String previousPageId = null;
			Map beforeColl = null;
			PeopleHandler peopleHandler = null;
			int[] driverArray = null;
			String appNumber = null;
			int currentPageStatus = 0;
			String indvSeqNumber = null;
			String pageMode = null;
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final WorkRelatedExpenseBO wrkRelExpenseBO = new WorkRelatedExpenseBO();

			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.WORK_RELATED_EXPENSE,
					AppConstants.WORK_RELATED_EXPENSE);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.WORK_RELATED_EXPENSE);
			} else if (currentPageStatus == FwConstants.DRIVER_COMPLETE
					&& !pageId.equals(previousPageId)
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.WORK_RELATED_EXPENSE);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.WORK_RELATED_EXPENSE_RESP };
			SortedSet wrkRelExpenseProfile = null;
			final String categType = AppConstants.WORK_RELATED_EXPENSE;

			if (!pageId.equals(previousPageId)) {
				wrkRelExpenseProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
					final CP_APP_IN_IRWE_Collection appInIrweColl = wrkRelExpenseBO
							.loadWorkRelatedDetails(appNumber);
					final CP_APP_IN_IRWE_Collection newIrweColl = wrkRelExpenseBO
							.splitWorkRelExpenseColl(appInIrweColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newIrweColl != null && !newIrweColl.isEmpty()) {
						CP_APP_IN_IRWE_Cargo appWrkRelExpCargo = null;
						final int newWrkRelExpCollSize = newIrweColl.size();
						for (int i = 0; i < newWrkRelExpCollSize; i++) {
							appWrkRelExpCargo = newIrweColl.getCargo(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									wrkRelExpenseProfile, null, null,
									Short.parseShort(appWrkRelExpCargo
											.getIndv_seq_num()),
											Short.parseShort(appWrkRelExpCargo
													.getSeq_num()), categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(wrkRelExpenseProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(wrkRelExpenseProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				wrkRelExpenseProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			// if details key bean not null means this bean is comming from the
			// summary page

			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("Impairment_IndSeqBean");
			}

			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								wrkRelExpenseProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								indivSeqBean.getType());
				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != Short
							.parseShort(indivSeqBean.getUserEndInd())) {
						categorySelectionProfileManager
						.updateUserEndSelInd(wrkRelExpenseProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							wrkRelExpenseProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							indivSeqBean.getType());
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType());
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != Short
								.parseShort(indivSeqBean.getUserEndInd())) {
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()), indivSeqBean
													.getType(), Short
													.parseShort(indivSeqBean
															.getUserEndInd()));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
						if (rmcInPrflColl != null) {
							rmcInPrflCargo = rmcResponseProfileManager
									.getProfile(rmcInPrflColl,
											indivSeqBean.getIndivSeqNum());
						} else {
							rmcInPrflColl = new RMC_IN_PRFL_Collection();
						}
						if (rmcInPrflCargo == null) {
							rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
							rmcInPrflCargo.setApp_num(appNumber);
							rmcInPrflCargo.setIndv_seq_num(indivSeqBean
									.getIndivSeqNum());
							rmcResponseProfileManager
							.createRMCIndividualProfile(rmcInPrflCargo);
							rmcInPrflColl.addCargo(rmcInPrflCargo);
						}

						rmcResponseProfileManager
						.makeAddNew(
								IRMCResponseProfileManager.WORK_RELATED_EXPENSE_RESP,
								rmcInPrflCargo, true);
						rmcResponseProfileManager
						.makeAddNew(
								rmcResponseProfileManager
								.getResponseByType(
										IRMCResponseProfileManager.WORK_RELATED_EXPENSE_RESP,
										indivSeqBean.getType()),
										rmcInPrflCargo, true);
						categorySelectionProfileManager
						.insertSequenceDetail(wrkRelExpenseProfile,
								null, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType(), Short
												.parseShort(indivSeqBean
														.getUserEndInd()));
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}

						categorySelectionProfileManager
						.insertSequenceDetail(wrkRelExpenseProfile,
								null,
								AppConstants.WORK_RELATED_EXPENSE,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								wrkRelExpenseProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertSequenceDetail(categorySelectionProfile,
								appNumber,
								AppConstants.WORK_RELATED_EXPENSE,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}

				session.put("Impairment_IndSeqBean", indivSeqBean);
				session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
						categorySelectionProfile);
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					wrkRelExpenseProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(wrkRelExpenseProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(wrkRelExpenseProfile);
			}

			categorySeqDetail.getCategoryType();
			final String categorySeqNum = Long.toString(categorySeqDetail
					.getCategorySequence());

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final CP_APP_IN_IRWE_Collection appInWrkRelExpColl = wrkRelExpenseBO
					.loadIndividualWorkRelatedExpenseDetails(appNumber,
							indvSeqNumber, categorySeqNum);

			pageCollection.put(AppConstants.CP_APP_IN_IRWE_COLLECTION,
					appInWrkRelExpColl);

			CP_APP_IN_IRWE_Cargo cwAppInWrkRelExpCargo = wrkRelExpenseBO
					.splitWorkRelExpenseCargo(appInWrkRelExpColl,
							AppConstants.CWW_RECORD_IND);

			if (cwAppInWrkRelExpCargo == null) {
				cwAppInWrkRelExpCargo = new CP_APP_IN_IRWE_Cargo();
			}
			pageCollection
			.put(AppConstants.SEC_WRE, wrkRelExpenseBO
					.settingDefaultValues(cwAppInWrkRelExpCargo));

			CP_APP_IN_IRWE_Cargo rmcWrkRelExpCargo = wrkRelExpenseBO
					.splitWorkRelExpenseCargo(appInWrkRelExpColl,
							AppConstants.RMC_NEW_RECORD_IND);
			if (rmcWrkRelExpCargo != null) {
				pageCollection
				.put(AppConstants.FST_WRE, wrkRelExpenseBO
						.settingDefaultValues(rmcWrkRelExpCargo));
			} else {
				rmcWrkRelExpCargo = wrkRelExpenseBO.splitWorkRelExpenseCargo(
						appInWrkRelExpColl,
						AppConstants.RMC_MODIFIED_RECORD_IND);
				if (rmcWrkRelExpCargo != null) {
					pageCollection.put(AppConstants.FST_WRE, wrkRelExpenseBO
							.settingDefaultValues(rmcWrkRelExpCargo));
				} else {
					rmcWrkRelExpCargo = wrkRelExpenseBO
							.splitWorkRelExpenseCargo(appInWrkRelExpColl,
									AppConstants.RMC_END_RECORD_IND);
					if (rmcWrkRelExpCargo != null) {
						pageCollection
						.put(AppConstants.FST_WRE,
								wrkRelExpenseBO
								.settingDefaultValues(rmcWrkRelExpCargo));
					} else {
						pageCollection
						.put(AppConstants.FST_WRE,
								wrkRelExpenseBO
								.settingDefaultValues(cwAppInWrkRelExpCargo));
					}
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 1,3,3 lines
					 * Commented Code in this block
					 */
				}
			}
			String srcAppInd = AppConstants.EMPTY_STRING;
			if (appInWrkRelExpColl != null && !appInWrkRelExpColl.isEmpty()) {
				final CP_APP_IN_IRWE_Cargo appInWrkRelExpCargo = appInWrkRelExpColl
						.getCargo(0);
				srcAppInd = appInWrkRelExpCargo.getSrc_app_ind();
			}
			if ((AppConstants.CWW_RECORD_IND.equalsIgnoreCase(srcAppInd) || AppConstants.RMC_MODIFIED_RECORD_IND
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = AppConstants.COMPLETE;
			}
			if (categorySeqDetail.getUserEndSelectionInd() == 1) {

				pageMode = AppConstants.ENDED;
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (AppConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd()))

				{
					pageMode = AppConstants.ENDED;
				} else if (AppConstants.ZERO.equals(indivSeqBean
						.getUserEndInd())
						&& AppConstants.RMC_MODIFIED_RECORD_IND
						.equalsIgnoreCase(srcAppInd)
						|| AppConstants.CWW_RECORD_IND
						.equalsIgnoreCase(srcAppInd)) {
					pageMode = AppConstants.COMPLETE;
				} else {
					pageMode = AppConstants.NEW;
				}
			} else if (!(pageMode == AppConstants.COMPLETE || pageMode == AppConstants.ENDED)) {
				pageMode = AppConstants.NEW;
			}
			String showLoopingQuestionFlag = FwConstants.YES;

			char typeStatus = 'N';
			typeStatus = categorySeqDetail.getStatus();
			if (typeStatus == IRMCResponseProfileManager.STATUS_VISIT_AGAIN
					|| typeStatus == IRMCResponseProfileManager.STATUS_COMPLETE) {
				showLoopingQuestionFlag = FwConstants.NO;

			}

			pageCollection.put("showLoopingQuestion", showLoopingQuestionFlag);
			pageCollection.put(AppConstants.PAGE_MODE, pageMode);
			request.put(AppConstants.PAGE_MODE, pageMode);
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			txnBean.setRequest(request);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}
			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadHouseHoldInfoWorkRelatedExpenseDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadHouseHoldInfoWorkRelatedExpenseDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoWorkRelatedExpenseDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadHouseHoldInfoWorkRelatedExpenseDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadHouseHoldInfoWorkRelatedExpenseDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.loadHouseHoldInfoWorkRelatedExpenseDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Method to store values in CP_APP_IN_MEDCR table for Medicare Detail
	 * screen.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 * @throws javax.ejb.EJBException the javax.ejb. ejb exception
	 */
	public void storeHouseHoldInfoWorkRelatedExpenseDetails(
			final FwTransaction txnBean) throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoWorkRelatedExpenseDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeHouseHoldInfoWorkRelatedExpenseDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final List modifiedFields = (ArrayList) session
					.get(AppConstants.MODIFIED_FIELDS);
			final String pageMode = (String) beforeColl
					.get(AppConstants.PAGE_MODE);
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);
			driverManager.getAFBStatus(FwConstants.RMC_DRIVER, currentPageID,
					driverArray);
			session.remove("Impairment_IndSeqBean");
			final WorkRelatedExpenseBO wrkRelExpenseBO = new WorkRelatedExpenseBO();
			// data entered on screen is rpesent in page Collection
			final CP_APP_IN_IRWE_Collection appInWrkRelExpColl = (CP_APP_IN_IRWE_Collection) pageCollection
					.get(AppConstants.CP_APP_IN_IRWE_COLLECTION);
			CP_APP_IN_IRWE_Cargo appInWrkRelExpCargo = appInWrkRelExpColl
					.getCargo(0);
			// data already set in beforeCollection or data currently in DB
			final CP_APP_IN_IRWE_Collection beforeCollAppInWrkRelExpColl = (CP_APP_IN_IRWE_Collection) beforeColl
					.get(AppConstants.CP_APP_IN_IRWE_COLLECTION);
			CP_APP_IN_IRWE_Cargo appInWrkRelExpBeforeCargo = null;
			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final SortedSet appInWrkRelExpProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(appInWrkRelExpProfile);

			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			final String indvSeqNum = new Short(
					categorySeqDetailBean.getIndividualSequence()).toString();
			String.valueOf(categorySeqDetailBean.getCategorySequence());
			peopleHandler.getBirthDt(indvSeqNum);
			final short userEndInd = categorySeqDetailBean
					.getUserEndSelectionInd();
			categorySeqDetailBean.getCategoryType();

			if (appInWrkRelExpCargo.getMo_exp_amt() == null) {
				appInWrkRelExpCargo.setMo_exp_amt(AppConstants.EMPTY_STRING);
			}

			if (appInWrkRelExpCargo.getMo_exp_amt() == null) {
				appInWrkRelExpCargo.setMo_exp_amt(AppConstants.EMPTY_STRING);
			}
			// initializing validator for form data validations
			wrkRelExpenseBO.validateRMBPageContentsForWorkRelatedExpense(
					appInWrkRelExpCargo, appInWrkRelExpCargo.getMo_exp_amt(),
					appInWrkRelExpCargo.getExpense_reason(), userEndInd);

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);
			if (checkBackToMyAccessSelected(request)
					|| wrkRelExpenseBO.hasMessages()) {
				// if Back to my Access is not clicked then show validation
				// errors
				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							wrkRelExpenseBO.getMessageList());
				}
				// put the first Name into request to avoid null pointer in JSP
				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				if (beforeColl.containsKey(AppConstants.SEC_WRE)) {
					pageCollection.put(AppConstants.SEC_WRE,
							beforeColl.get(AppConstants.SEC_WRE));
				}
				pageCollection.put(AppConstants.FST_WRE, appInWrkRelExpCargo);
				request.put(AppConstants.PAGE_MODE, pageMode);
				if (request.get("loopingQuestion") != null) {
					request.put("loopingQuestion",
							request.get("loopingQuestion"));
				}
				pageCollection.put("showLoopingQuestion",
						beforeColl.get("showLoopingQuestion"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				return;
			}
			// setting correct set of values before inserting in DB
			appInWrkRelExpCargo.setApp_num(appNum);
			appInWrkRelExpCargo.setIndv_seq_num(indvSeqNum);

			String sourceAppIndicator = null;
			String recordInd = null;
			long medcrSeqNum = 0;
			boolean medCareUpdate = false;
			if (beforeCollAppInWrkRelExpColl != null
					&& !beforeCollAppInWrkRelExpColl.isEmpty()) {
				final int size = beforeCollAppInWrkRelExpColl.size();
				medcrSeqNum = categorySeqDetailBean.getCategorySequence();

				if ("C".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
				} else if ("E".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
				} else {
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				}

				appInWrkRelExpBeforeCargo = wrkRelExpenseBO
						.splitWorkRelExpenseCargo(beforeCollAppInWrkRelExpColl,
								sourceAppIndicator);
				if (appInWrkRelExpBeforeCargo == null
						&& (AppConstants.RMC_MODIFIED_RECORD_IND
								.equals(sourceAppIndicator) || AppConstants.RMC_END_RECORD_IND
								.equals(sourceAppIndicator))) {
					appInWrkRelExpBeforeCargo = wrkRelExpenseBO
							.splitWorkRelExpenseCargo(
									beforeCollAppInWrkRelExpColl,
									AppConstants.CWW_RECORD_IND);
				}

				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					recordInd = FwConstants.ROWACTION_UPDATE;
				} else {
					// now we are checking this record is CW or RN
					recordInd = FwConstants.ROWACTION_INSERT;
					if (AppConstants.RMC_NEW_RECORD_IND
							.equals(sourceAppIndicator)
							&& appInWrkRelExpBeforeCargo != null) {
						recordInd = FwConstants.ROWACTION_UPDATE;
					}
				}

				if ("E".equalsIgnoreCase(pageMode)) {
					appInWrkRelExpCargo.setMo_exp_amt(appInWrkRelExpBeforeCargo
							.getMo_exp_amt());

				}

				appInWrkRelExpCargo.setApp_num(appNum);
				//
				appInWrkRelExpCargo.setIndv_seq_num(appInWrkRelExpBeforeCargo
						.getIndv_seq_num());
				appInWrkRelExpCargo.setSeq_num(appInWrkRelExpBeforeCargo
						.getSeq_num());
				appInWrkRelExpCargo.setSrc_app_ind(sourceAppIndicator);
				if (appInWrkRelExpCargo.getMo_exp_amt() != null
						&& AppConstants.ON_FILE
						.equalsIgnoreCase(appInWrkRelExpCargo
								.getMo_exp_amt())) {
					appInWrkRelExpCargo.setMo_exp_amt(appInWrkRelExpBeforeCargo
							.getMo_exp_amt());
					if (modifiedFields.contains(appInWrkRelExpCargo
							.getIndv_seq_num()
							+ "_"
							+ appInWrkRelExpCargo.getSeq_num()
							+ "_"
							+ "mo_exp_amt")) {
						modifiedFields.remove(appInWrkRelExpCargo
								.getIndv_seq_num()
								+ "_"
								+ appInWrkRelExpCargo.getSeq_num()
								+ "_"
								+ "mo_exp_amt");
					}
				} else {
					if (!modifiedFields.contains(appInWrkRelExpCargo
							.getIndv_seq_num()
							+ "_"
							+ appInWrkRelExpCargo.getSeq_num()
							+ "_"
							+ "mo_exp_amt")) {
						modifiedFields.add(appInWrkRelExpCargo
								.getIndv_seq_num()
								+ "_"
								+ appInWrkRelExpCargo.getSeq_num()
								+ "_"
								+ "mo_exp_amt");
					}
				}
				appInWrkRelExpCargo = (CP_APP_IN_IRWE_Cargo) isChanged(
						appInWrkRelExpBeforeCargo, appInWrkRelExpCargo);

				appInWrkRelExpCargo.setRowAction(recordInd);
				// PersistData if the cargo is dirty
				if (appInWrkRelExpCargo.isDirty()) {
					medCareUpdate = true;
				}
			} else {
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				appInWrkRelExpCargo
				.setIndv_seq_num(String.valueOf(categorySeqDetailBean
						.getIndividualSequence()));
				// get the MAX seq number from data base
				medcrSeqNum = wrkRelExpenseBO.getMaxPolicySeqNumber(appNum,
						indvSeqNum);
				medcrSeqNum = medcrSeqNum + 1;
				appInWrkRelExpCargo.setSeq_num(String.valueOf(medcrSeqNum));
				appInWrkRelExpCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;
				appInWrkRelExpCargo.setRowAction(recordInd);
				medCareUpdate = true;
				categorySelectionProfileManager.updateSequence(
						appInWrkRelExpProfile, null,
						categorySeqDetailBean.getIndividualSequence(),
						medcrSeqNum, categorySeqDetailBean.getCategoryType());
			}

			if (medCareUpdate) {
				wrkRelExpenseBO
				.storeWorkRelatedExpenseDetails(appInWrkRelExpColl);
			}

			boolean loopingQuestion = false;
			if (request.get("loopingQuestion") != null
					&& FwConstants.YES.equals(request.get("loopingQuestion"))) {
				loopingQuestion = true;
				// Insert into APP_IN_EMPL and APP_IN_EMPL_A_WAGE
				categorySelectionProfileManager.insertSequenceDetail(
						appInWrkRelExpProfile, null, null,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategoryType());
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNum);
			}
			// now i need to update the rmc_in_prfl if looping question is null
			if (!loopingQuestion
					&& categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager
					.makeComplete(
							IRMCResponseProfileManager.WORK_RELATED_EXPENSE_RESP,
							rmcInPrflCargo, true);
				}
			}

			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					appInWrkRelExpProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNum,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			if (categorySelectionProfileManager
					.areAllSequencesComplete(appInWrkRelExpProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNum);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(appInWrkRelExpProfile);
			}
			session.remove(AppConstants.CP_APP_IN_IRWE_COLLECTION);
			session.put(AppConstants.CP_APP_IN_IRWE_COLLECTION,
					appInWrkRelExpColl);
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeHouseHoldInfoWorkRelatedExpenseDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldInfoWorkRelatedExpenseDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoWorkRelatedExpenseDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeHouseHoldInfoWorkRelatedExpenseDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeHouseHoldInfoWorkRelatedExpenseDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.storeHouseHoldInfoWorkRelatedExpenseDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Edits the household member info.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void editHouseholdMemberInfo(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editHouseholdMemberInfo() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editHouseholdMemberInfo:Start");
			
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			String appType = (String) session.get(AppConstants.APP_TYPE);
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get appNumber from the session
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);

			// Get the pageCollection INDV_LIVE_CHG_Collection
			final APP_INDV_Collection appIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");

			/*
			 * Prepare cargo and build profile if it is null 
			 * */
			final String previousPageId = (String) request
					.get(FwConstants.PREVIOUS_PAGE_ID);
			String pageId = null;
			int pageStatus = 0;
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			pageStatus = driverManager.getAFBStatus(FwConstants.RMC_DRIVER,
								pageId, driverArray);
			final Map peopleType = new HashMap<String, String>();
			// Define IndvSeqNum
						String indvSeqNum = null;

			// Get the results from INDV_LIVE_CHG_Collection
			indvSeqNum = appIndvColl.getCargo(0).getIndv_seq_num();

			peopleType.put(AppConstants.CITIZEN_INFO,
					AppConstants.CITIZEN_INFO);
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			boolean loadCategoryProfile =false;
					
//			if (pageStatus == FwConstants.DRIVER_REQUIRED
//								|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
//								&& categorySelectionProfileManager.isEmpty(
//										categorySelectionProfile, peopleType)) {
//							loadCategoryProfile=true;
//						} else if (pageStatus == FwConstants.DRIVER_COMPLETE
//								&& !pageId.equals(previousPageId)
//								&& categorySelectionProfileManager.isEmpty(
//										categorySelectionProfile, peopleType)) {
//							loadCategoryProfile=true;
//						}
//			
//			
//			if(loadCategoryProfile==true){
//				categorySelectionProfile = categorySelectionProfileManager
//						.loadCategoryChangeSelectionProfile(appNum,
//								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,AppConstants.CITIZEN_INFO);
//				if(null!=categorySelectionProfile && !categorySelectionProfile.isEmpty())
//				{
//				categorySelectionProfileManager
//				.insertExistingSequenceDetail(
//						categorySelectionProfile, null,
//						AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
//						Short.parseShort(indvSeqNum), Long
//								.parseLong(FwConstants.ZERO),
//										AppConstants.CITIZEN_INFO, Short
//										.parseShort(FwConstants.ZERO));
//				categorySelectionProfileManager
//				.makeSequenceDetailRequired(
//						categorySelectionProfile, null,
//						Short.parseShort(indvSeqNum)
//								, Long.parseLong(FwConstants.ZERO),
//								AppConstants.CITIZEN_INFO);
//				}
//			}
//
//			if(null == categorySelectionProfile || categorySelectionProfile.isEmpty()){
//				if(AppConstants.RMC.equals(appType)){
//					storeHouseHoldCompIndvSelectionForIndv(txnBean,session,pageCollection,appNum,categorySelectionProfile,indvSeqNum);	
//				}
//			}
			if (pageStatus == FwConstants.DRIVER_REQUIRED
								|| pageStatus == FwConstants.DRIVER_VISIT_AGAIN
								&& categorySelectionProfileManager.isEmpty(
										categorySelectionProfile, peopleType)) {
				            loadCategoryProfile=true;
						} else if (pageStatus == FwConstants.DRIVER_COMPLETE
								&& !pageId.equals(previousPageId)
								&& categorySelectionProfileManager.isEmpty(
										categorySelectionProfile, peopleType)) {
							loadCategoryProfile=true;
						}
			if(loadCategoryProfile==true){
							categorySelectionProfile = categorySelectionProfileManager
									.loadCategoryChangeSelectionProfile(appNum,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL,AppConstants.CITIZEN_INFO);
				if(null!=categorySelectionProfile && !categorySelectionProfile.isEmpty())
				{
				categorySelectionProfileManager
				.insertExistingSequenceDetail(
						categorySelectionProfile, null,
						AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
						Short.parseShort(indvSeqNum), Long
								.parseLong(FwConstants.ZERO),
										AppConstants.CITIZEN_INFO, Short
										.parseShort(FwConstants.ZERO));
				categorySelectionProfileManager
				.makeSequenceDetailRequired(
						categorySelectionProfile, null,
						Short.parseShort(indvSeqNum)
								, Long.parseLong(FwConstants.ZERO),
								AppConstants.CITIZEN_INFO);
						}
			}
			
			if(null == categorySelectionProfile || categorySelectionProfile.isEmpty()){
				if(AppConstants.RMC.equals(appType)){
					storeHouseHoldCompIndvSelectionForIndv(txnBean,session,pageCollection,appNum,categorySelectionProfile,indvSeqNum);	
				}
			}
			// Set the indvTypeSeqBean
			final IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
			indivTypeSeqBean.setSeqNum(FwConstants.ZERO);
			indivTypeSeqBean.setType(AppConstants.PERSONAL_INFO);
			indivTypeSeqBean.setUserEndInd(FwConstants.ZERO);
			// make Moved In Details page as required
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines Commented Code in
			 * this block
			 */

			// now we have set Hshl_chg_stat_ind to YES in RMB_RQST if it is N
			// or H.

			final RMB_RQST_Collection rmbColl = (RMB_RQST_Collection) session
					.get(AppConstants.RMB_RQST_COLLECTION);

			// Get RMB_RQST_Cargo for appNum
			if(null != rmbColl && !rmbColl.isEmpty())
			{
			final RMB_RQST_Cargo rmbRqstCargo = rmbColl.getCargo(0);
			if (rmbRqstCargo.getHshl_chg_stat_ind() != null
					&& !FwConstants.YES.equals(rmbRqstCargo
							.getHshl_chg_stat_ind())) {
				rmbRqstCargo.setHshl_chg_stat_ind(FwConstants.YES);
				rmbRqstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
				rmbColl.addCargo(rmbRqstCargo);
				rmbColl.persist(FwConstants.DAO);
			}
			}
			// add to session
			session.put(AppConstants.RMB_RQST_COLLECTION, rmbColl);

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMI",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHMX",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			// put the indivTypeSeqBean in pageCollection
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);
			// end
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::editHouseholdMemberInfo:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("editHouseholdMemberInfo");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editHouseholdMemberInfo");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"editHouseholdMemberInfo", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "editHouseholdMemberInfo");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.editHouseholdMemberInfo() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	
	/**
	 * Build category profile RMC if it is null while coming from Home Summary
	 * @param txnBean
	 * @param session
	 * @param pageCollection
	 * @param appNum
	 * @param categorySelectionProfile
	 * @param indvSeqNum
	 */
	public void storeHouseHoldCompIndvSelectionForIndv(final FwTransaction txnBean,Map session,Map pageCollection,String appNum,SortedSet categorySelectionProfile,String indvSeqNum){
		final int numQuestions = 6;
		final short[] questionsArrayForIndv = new short[numQuestions];
		questionsArrayForIndv[0] = IRMCResponseProfileManager.PRSN_INFO_STAT_SW;
		questionsArrayForIndv[1] = IRMCResponseProfileManager.RLT_CHG_STAT_SW;
		questionsArrayForIndv[2] = IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP;
		questionsArrayForIndv[3] = IRMCResponseProfileManager.PREG_ADD_STAT_SW;
		questionsArrayForIndv[4] = IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP;
		questionsArrayForIndv[5] = IRMCResponseProfileManager.PREG_CHG_STAT_SW;
		final String[] indivResponseArrayForIndv = { FwConstants.NO,
				FwConstants.NO, FwConstants.NO, FwConstants.NO,
				FwConstants.NO, FwConstants.NO };
		final RMC_IN_PRFL_Collection rmcInPrflSessColl = (RMC_IN_PRFL_Collection) session
				.get(AppConstants.RMC_IN_PRFL_MASTER);
		RMC_IN_PRFL_Collection rmcInPrflPageColl = new RMC_IN_PRFL_Collection();
		final RMC_RQST_Cargo rmcRqstCargo = (RMC_RQST_Cargo) session
				.get(AppConstants.RMC_RQST);
		final Map indivResponseMapForIndv = new HashMap();
		final RMC_RESPONSE_Custom_Collection rmcRespCustomColl = new RMC_RESPONSE_Custom_Collection();
		for (int i = 0; i < rmcInPrflSessColl.size(); i++) {
			final RMC_IN_PRFL_Cargo sessionCargo = rmcInPrflSessColl
					.getCargo(i);
			if(sessionCargo.getIndv_seq_num().equals(indvSeqNum)){
				rmcInPrflPageColl.add(sessionCargo);
			final RMC_IN_PRFL_Cargo pageCollCargo = rmcResponseProfileManager
					.getProfile(rmcInPrflPageColl,
							sessionCargo.getIndv_seq_num());
			if ((rmcRqstCargo.getChange_in_personal_info() != null
					&& FwConstants.YES.equals(rmcRqstCargo
							.getChange_in_personal_info()))||FwConstants.YES.equals(rmcRqstCargo.getAdd_chg_stat_sw()) || FwConstants.YES.equals(rmcRqstCargo.getPreg_chg_stat_sw())
							|| FwConstants.YES.equals(rmcRqstCargo.getPrsn_move_stat_sw())
							|| FwConstants.YES.equals(rmcRqstCargo.getRlt_stat_sw())
							|| FwConstants.YES.equals(rmcRqstCargo.getDabl_stat_sw())) {
				if (pageCollCargo == null) {
					sessionCargo.setPrsn_info_stat_sw(FwConstants.NO);
				} else {
					if (null != pageCollCargo.getPrsn_info_stat_sw()
							&& !"null".equalsIgnoreCase(pageCollCargo
									.getPrsn_info_stat_sw())) {
						pageCollCargo.setPrsn_info_stat_sw(FwConstants.YES);
						if (FwConstants.YES.equals(pageCollCargo
								.getPrsn_info_stat_sw())) {
							/* personal info */
//							final RMC_RESPONSE_Custom_Cargo rmcRespCustomCargo = new RMC_RESPONSE_Custom_Cargo();
//							rmcRespCustomCargo.setIndvSeqNum(sessionCargo
//									.getIndv_seq_num());
//							rmcRespCustomCargo
//							.setCategoryType(AppConstants.PERSONAL_INFO);
//							rmcRespCustomCargo.setSeqNum(i
//									+ FwConstants.EMPTY_STRING);
//							rmcRespCustomCargo
//							.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
//							rmcRespCustomColl.addCargo(rmcRespCustomCargo);

							/* immigration status */
							final RMC_RESPONSE_Custom_Cargo rmcRespImCustomCargo = new RMC_RESPONSE_Custom_Cargo();
							rmcRespImCustomCargo.setIndvSeqNum(sessionCargo
									.getIndv_seq_num());
							rmcRespImCustomCargo
							.setCategoryType(AppConstants.CITIZEN_INFO);
							rmcRespImCustomCargo.setSeqNum(FwConstants.ZERO);
							rmcRespImCustomCargo
							.setChangeSelectionCategoryCd(AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
							rmcRespCustomColl
							.addCargo(rmcRespImCustomCargo);
						}
					} else {
						sessionCargo.setPrsn_info_stat_sw(FwConstants.NO);
					}

				}
				indivResponseArrayForIndv[0] = sessionCargo
						.getPrsn_info_stat_sw();
				indivResponseMapForIndv.put(sessionCargo.getIndv_seq_num(),
						indivResponseArrayForIndv);
			
	rmcResponseProfileManager.persist(appNum, sessionCargo
					.getIndv_seq_num(), questionsArrayForIndv,
					(String[]) indivResponseMapForIndv.get(sessionCargo
							.getIndv_seq_num()));
	categorySelectionProfile = categorySelectionProfileManager
					.buildSelectionProfile(rmcRespCustomColl, appNum,
							AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
	session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
			categorySelectionProfile);
			}
}
		}
	}
	
	/**
	 * Erase household member details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void eraseHouseholdMemberDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseHouseholdMemberDetails() - START");
		try {
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseHouseholdMemberDetails:Start");
			final Map session = txnBean.getSession();
			final Map request = txnBean.getRequest();
			final Map pageCollection = txnBean.getPageCollection();
			final Map beforeColl = (Map) session
					.get(FwConstants.BEFORE_COLLECTION);
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// Get RMCSessionBean from the session

			String indvSeqNum = null;

			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			// Get the APP_INDV_Collection from pageCollection.
			final APP_INDV_Collection appIndvColl = (APP_INDV_Collection) pageCollection
					.get("APP_INDV_Collection");
			final APP_INDV_Cargo appIndvCargo = appIndvColl.getCargo(0);

			// delete record from rmc selection profile
			final SortedSet rmcSelPrfl = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);

			indvSeqNum = appIndvCargo.getIndv_seq_num();
			final String seqNum = FwConstants.ZERO;

			APP_INDV_Cargo beforeindvCargo = (APP_INDV_Cargo) beforeColl
					.get("APP_INDV_Cargo");
			final MovedInBO movedInBo = new MovedInBO();
			final PeopleHandler peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final String name = peopleHandler.getFirstName(indvSeqNum);
			if (beforeindvCargo == null
					|| movedInBo.isDifferentIndividual(appIndvCargo,
							beforeindvCargo)) {

				movedInBo.validateEraseChanges(name);
				request.put(FwConstants.MESSAGE_LIST,
						movedInBo.getMessageList());
				beforeindvCargo = new APP_INDV_Cargo();
				beforeindvCargo.setIndv_seq_num(indvSeqNum);
				beforeColl.put("APP_INDV_Cargo", beforeindvCargo);
				txnBean.setPageCollection(beforeColl);
				return;

			}

			movedInBo.deleteHouseHoldMemberRecords(indvSeqNum, appNum);

			final String catUtilType = AppConstants.RMC_CAT_HH_SUMMARY_PRFL;
			SortedSet categorySelectionProfile = null;
			if(null!=rmcSelPrfl && !rmcSelPrfl.isEmpty())
			{
				categorySelectionProfile = rmcSelPrfl;
			}else{
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNum,
								AppConstants.RMC_CAT_HH_SUMMARY_PRFL);
			}
			// delete record from rmc selection profile
			categorySelectionProfileManager.removeSequenceDetail(categorySelectionProfile,
					appNum, Short.parseShort(indvSeqNum),
					Short.parseShort(seqNum), catUtilType,
					AppConstants.PERSONAL_INFO);
			categorySelectionProfileManager.removeSequenceDetail(categorySelectionProfile,
					appNum, Short.parseShort(indvSeqNum),
					Short.parseShort(seqNum), catUtilType,
					AppConstants.CITIZEN_INFO);
			
			categorySelectionProfileManager.insertSequenceDetail(categorySelectionProfile,
					appNum, AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
					Short.parseShort(indvSeqNum), Short.parseShort(seqNum),
					AppConstants.PERSONAL_INFO, (short) 2, 'N');
			categorySelectionProfileManager.insertSequenceDetail(categorySelectionProfile,
					appNum, AppConstants.RMC_CAT_HH_SUMMARY_PRFL,
					Short.parseShort(indvSeqNum), Short.parseShort(seqNum),
					AppConstants.CITIZEN_INFO, (short) 2, 'N');

			boolean rmcPrflNotRequeired = false;
			// here we need to check we have no entrys in rmcPrfl for the other
			// income detail
			// as well as we need to check
			if (rmcInPrflColl != null && !rmcInPrflColl.isEmpty()) {
				if (rmcResponseProfileManager.isAppResponseNotRequired(
						rmcInPrflColl, IRMCResponseProfileManager.DRUG_FELON)) {
					rmcPrflNotRequeired = true;
				}
			} else {
				rmcPrflNotRequeired = true;
			}
			final Map catType = new HashMap();
			catType.put("DC", "DC");

			if (!checkDetailPageRequired(rmcSelPrfl, catType)
					&& rmcPrflNotRequeired) {
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMI", driverArray, appNum);
				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARHMX", driverArray, appNum);	
			}

			// make summary page as required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARHCS",
					driverArray, appNum);

			// Add the page collection to collection
			txnBean.setPageCollection(pageCollection);

			// end
			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::eraseHouseholdMemberDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseHouseholdMemberDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseHouseholdMemberDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"eraseHouseholdMemberDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "eraseHouseholdMemberDetails");
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.eraseHouseholdMemberDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Check detail page required.
	 *
	 * @param categorySelectionProfile the category selection profile
	 * @param catType the cat type
	 * @return true, if successful
	 */
	public boolean checkDetailPageRequired(
			final SortedSet categorySelectionProfile, final Map catType) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.checkDetailPageRequired() - START");
		try {
			boolean isexpensePageRequired = false;
			if (categorySelectionProfile != null) {
				// this one form the category selection profile
				final Iterator iter = categorySelectionProfile.iterator();
				CategorySequenceDetail categorySeqDtl = null;
				while (iter.hasNext()) {
					categorySeqDtl = (CategorySequenceDetail) iter.next();
					if (catType != null
							&& catType.get(categorySeqDtl.getCategoryType()) != null
							&& categorySeqDtl.getUserEndSelectionInd() != AppConstants.RMB_NO_CHANGE_SEL_IND) {
						isexpensePageRequired = true;
						break;
					}
				}
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.checkDetailPageRequired() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return isexpensePageRequired;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkDetailPageRequired");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"checkExpenseDetailPageRequired", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkDetailPageRequired");
		}
	}

	/**
	 * Creates the and load armov response maps to page collection.
	 *
	 * @param appInPrflColl the app in prfl coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @return the map
	 */
	private Map createAndLoadARMOVResponseMapsToPageCollection(
			final RMC_IN_PRFL_Collection appInPrflColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean pageLoad, final int driverStatus) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"HouseHoldInfoEJBBean.createAndLoadARMOVResponseMapsToPageCollection() - START");
		try {
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection,
					peopleHandler, "20055",
					IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP,
					pageLoad, driverStatus, false);
			log(ILog.INFO,
					"HouseHoldInfoEJBBean.createAndLoadARMOVResponseMapsToPageCollection() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createAndLoadARMOVResponseMapsToPageCollection");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"createAndLoadAROBCResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createAndLoadARMOVResponseMapsToPageCollection");
		}
	}

	/**
	 * Creates the and load arhin response maps to page collection.
	 *
	 * @param appInPrflColl the app in prfl coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @param indvSeqNumber the indv seq number
	 * @return the map
	 */
	private Map createAndLoadARHINResponseMapsToPageCollection(
			final RMC_IN_PRFL_Collection appInPrflColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean pageLoad, final int driverStatus,
			final String indvSeqNumber) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"HouseHoldInfoEJBBean.createAndLoadARMOVResponseMapsToPageCollection() - START");
		try {
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection,
					peopleHandler, HOUSEHOLD_INDIV_COVERED_COMP_ID,
					IRMCResponseProfileManager.HEALTHCARE_COVERAGE, pageLoad,
					driverStatus, false, indvSeqNumber);
			log(ILog.INFO,
					"HouseHoldInfoEJBBean.createAndLoadARMOVResponseMapsToPageCollection() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return pageCollection;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createAndLoadARHINResponseMapsToPageCollection");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"createAndLoadAROBCResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "createAndLoadARHINResponseMapsToPageCollection");
		}
	}

	/**
	 * Load preg response maps to page collection.
	 *
	 * @param rmcInPrflColl the rmc in prfl coll
	 * @param rmcRspnseCustomColl the rmc rspnse custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @param txnBean the txn bean
	 * @return the map
	 */
	private Map LoadPregResponseMapsToPageCollection(
			final RMC_IN_PRFL_Collection rmcInPrflColl,
			final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean pageLoad, final int driverStatus,
			final FwTransaction txnBean) {

		try {

			getPregPeopleCollectionAndUpdateMaps(rmcInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler, "AC",
					IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP, true,
					false, driverStatus, txnBean);
			getPregPeopleCollectionAndUpdateMaps(rmcInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler, "UB",
					IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP, true,
					false, driverStatus, txnBean);

		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "LoadPregResponseMapsToPageCollection");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"LoadARPGQResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "LoadPregResponseMapsToPageCollection");
		}
		return pageCollection;

	}

	/**
	 * Load pregnancy response maps to page collection.
	 *
	 * @param rmcInPrflColl the rmc in prfl coll
	 * @param rmcRspnseCustomColl the rmc rspnse custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param pageLoad the page load
	 * @param driverStatus the driver status
	 * @param txnBean the txn bean
	 * @return the map
	 */
	private Map LoadPregnancyResponseMapsToPageCollection(
			final RMC_IN_PRFL_Collection rmcInPrflColl,
			final RMC_RESPONSE_Custom_Collection rmcRspnseCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final boolean pageLoad, final int driverStatus,
			final FwTransaction txnBean) {

		try {

			getPregPeopleCollectionAndUpdateMaps(rmcInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler, "AC",
					IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP, true,
					true, driverStatus, txnBean);
			getPregPeopleCollectionAndUpdateMaps(rmcInPrflColl,
					rmcRspnseCustomColl, pageCollection, peopleHandler, "UB",
					IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP, true,
					true, driverStatus, txnBean);

		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "LoadPregnancyResponseMapsToPageCollection");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"LoadARPGQResponseMapsToPageCollection", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "LoadPregnancyResponseMapsToPageCollection");
		}
		return pageCollection;

	}

	/**
	 * Gets the preg people collection and update maps.
	 *
	 * @param appInPrflColl the app in prfl coll
	 * @param rmcRespCustomColl the rmc resp custom coll
	 * @param pageCollection the page collection
	 * @param peopleHandler the people handler
	 * @param categoryID the category id
	 * @param questionName the question name
	 * @param pageLoad the page load
	 * @param summaryPage the summary page
	 * @param driverStatus the driver status
	 * @param txnBean the txn bean
	 * @return the preg people collection and update maps
	 */
	public Map getPregPeopleCollectionAndUpdateMaps(
			final RMC_IN_PRFL_Collection appInPrflColl,
			final RMC_RESPONSE_Custom_Collection rmcRespCustomColl,
			final Map pageCollection, final PeopleHandler peopleHandler,
			final String categoryID, final short questionName,
			final boolean pageLoad, final boolean summaryPage,
			final int driverStatus, final FwTransaction txnBean) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - START");
		try {

			// Declarations
			String indivSeqNum = null;
			INDIVIDUAL_Custom_Cargo indivCargo = new INDIVIDUAL_Custom_Cargo();
			INDIVIDUAL_Custom_Collection indivColl = new INDIVIDUAL_Custom_Collection();
			final StringBuilder indivCollKey = new StringBuilder();
			indivCollKey.append(AppConstants.PEOPLE);
			indivCollKey.append(categoryID);
			final Map session = txnBean.getSession();
			final APP_IN_PREG_Collection appInPreg = (APP_IN_PREG_Collection) pageCollection
					.get(APP_IN_PREG_COLLECTION_KEY);

			// try to get a filtered list. If it doesn't exist, get the
			// peopleHandler getIndividuals
			if (pageCollection.get(indivCollKey.toString()) == null) {
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 2,7 lines Commented
				 * Code in this block
				 */

				indivColl = peopleHandler.getAllIndividuals();
			} else {
				indivColl = (INDIVIDUAL_Custom_Collection) pageCollection
						.get(indivCollKey.toString());
			}
			// set the passed response map = new map
			final Map questionRespMap = new HashMap();

			// create an appInPrfl object
			RMC_IN_PRFL_Cargo rmcInPrflCargo = null;

			// get size of the collection
			final int indivCollSize = indivColl.size();

			String noOneChecked = FwConstants.NO;

			boolean anyPersonChecked = false;


			// Loop for each Cargo in the people collection (for each person)
			for (int i = 0; i < indivCollSize; i++) {
				// get the indivCargo
				indivCargo = (INDIVIDUAL_Custom_Cargo) indivColl.get(i);

				// get app_indiv_seq_num
				indivSeqNum = indivCargo.getIndv_seq_num();
				String questionResp = null;
				// Get the rmcInPrflCargo for this person

				rmcInPrflCargo = rmcResponseProfileManager.getProfile(
						appInPrflColl, indivSeqNum);

				// get the RMC_IN_PRFL Response for the given question from this
				// cargo
				questionResp = rmcResponseProfileManager.getProfileResponse(
						rmcInPrflCargo, questionName);
				if (questionResp == null) {
					questionResp = AppConstants.NO;
				}

				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1,1,1 lines Commented
				 * Code in this block
				 */

				if (AppConstants.BECAME_PREGNANT.equals(categoryID)
						&& IRMCResponseProfileManager.PREG_ADD_STAT_SW == questionName) {
					if (FwConstants.YES.equalsIgnoreCase(questionResp)) {
						questionResp = "R";
					}
				}

				if (AppConstants.ABLE_TO_CONCEIVE.equals(categoryID)
						&& IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP == questionName) {
					if (FwConstants.YES.equalsIgnoreCase(questionResp)) {
						questionResp = "R";
					}
				}
				if (AppConstants.UNDERWEIGHT_BIRTH.equals(categoryID)
						&& IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP == questionName) {
					if (FwConstants.YES.equalsIgnoreCase(questionResp)) {
						questionResp = "R";
					}
				}

				/*
				 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
				 * javadoc
				 */
				/**
				 * // get the AIP Response for the given question from this
				 * cargo /* int currRespCustomCollSize =
				 * rmcRespCustomColl.size(); for (int j = 0; j <
				 * currRespCustomCollSize; j++) { RMC_RESPONSE_Custom_Cargo
				 * tempCargo = (RMC_RESPONSE_Custom_Cargo)
				 * rmcRespCustomColl.get(j); if
				 * (tempCargo.getIndvSeqNum().equals(indivSeqNum) &&
				 * categoryID.equals(tempCargo.getCategoryType())) { if
				 * (AppConstants.LEFT_THE_HOME.equals(categoryID) &&
				 * IRMCResponseProfileManager.MOVED_OUT_OF_HOME_RESP ==
				 * questionName) { questionResp =
				 * String.valueOf(ICategorySelectionProfileManager
				 * .STATUS_REQUIRED);
				 * rmcInPrflCargo.setMoved_out_of_home_resp(questionResp); }
				 * else if (AppConstants.BECAME_PREGNANT.equals(categoryID) &&
				 * IRMCResponseProfileManager.PREG_ADD_STAT_SW == questionName)
				 * { questionResp =
				 * String.valueOf(ICategorySelectionProfileManager
				 * .STATUS_REQUIRED);
				 * rmcInPrflCargo.setPreg_add_stat_sw(questionResp); } else if
				 * (AppConstants.PREGNANCY_ENDED.equals(categoryID) &&
				 * IRMCResponseProfileManager.PREG_CHG_STAT_SW == questionName)
				 * { questionResp =
				 * String.valueOf(ICategorySelectionProfileManager
				 * .STATUS_REQUIRED);
				 * rmcInPrflCargo.setPreg_chg_stat_sw(questionResp); } else if
				 * (AppConstants.ABLE_TO_CONCEIVE.equals(categoryID) &&
				 * IRMCResponseProfileManager.ABLE_TO_CONCEIVE_RESP ==
				 * questionName) { questionResp =
				 * String.valueOf(ICategorySelectionProfileManager
				 * .STATUS_REQUIRED);
				 * rmcInPrflCargo.setAble_to_conceive_resp(questionResp); } else
				 * if (AppConstants.UNDERWEIGHT_BIRTH.equals(categoryID) &&
				 * IRMCResponseProfileManager.UNDERWEIGHT_BIRTH_RESP ==
				 * questionName) { questionResp =
				 * String.valueOf(ICategorySelectionProfileManager
				 * .STATUS_REQUIRED);
				 * rmcInPrflCargo.setUnderweight_birth_resp(questionResp); }
				 * break; } }
				 */

				// for this question, add the person's response to a map
				questionRespMap.put(indivSeqNum, questionResp);

				if (pageLoad == true) {
					noOneChecked = FwConstants.YES;
					// for each question, set the noOneChecked flag
					// check if there is anything other than not required - if
					// so, change flag
					if (null != questionResp
							&& questionResp.charAt(0) != IApplicationManager.STATUS_NOT_REQUIRED) {
						if (!anyPersonChecked) {
							anyPersonChecked = true;
						}
					}
					if (null == questionResp
							|| questionResp.charAt(0) != IApplicationManager.STATUS_NOT_REQUIRED) {
						noOneChecked = FwConstants.NO;
					}
				}

			}// end for loop

			if (pageLoad == true) {
				if (driverStatus == FwConstants.DRIVER_REQUIRED && !summaryPage) {
					noOneChecked = FwConstants.NO;
				}

				// get the NoOneChecked map from the pagecollection
				Map noOneCheckedMap = (Map) pageCollection
						.get(AppConstants.NO_ONE_CHECKED_MAP);
				if (noOneCheckedMap == null) {
					noOneCheckedMap = new HashMap();
				}
				if (anyPersonChecked) {
					noOneChecked = FwConstants.NO;
				}
				// update the noOneCheckedMap and re-add it to the page coll
				final StringBuilder noOneCheckedString = new StringBuilder();
				noOneCheckedString.append(AppConstants.NO_ONE_CHECKED);
				noOneCheckedString.append(categoryID);
				if (!noOneCheckedMap.containsKey(noOneCheckedString.toString())) {
					noOneCheckedMap.put(noOneCheckedString.toString(),
							noOneChecked);
				}
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP,
						noOneCheckedMap);
			}

			// Store all maps in page collection
			String respMapString = new String();
			respMapString = AppConstants.RESP_MAP;
			respMapString = respMapString + categoryID;
			pageCollection.put(respMapString, questionRespMap);

			// store people collection in page collection
			String peopleString = new String();
			peopleString = AppConstants.PEOPLE;
			peopleString = peopleString + categoryID;

			final PeopleRulesBO peopleRulesBO = new PeopleRulesBO();
			// Updated by Srividhya to have only females populating under
			// pregnancy details section
			if (AppConstants.UNDERWEIGHT_BIRTH.equalsIgnoreCase(categoryID)
					|| AppConstants.ABLE_TO_CONCEIVE
					.equalsIgnoreCase(categoryID)) {
				indivColl = PeopleRulesBO.getPregnantableIndividuals(indivColl);

				pageCollection.put(peopleString, indivColl);
			} else if (AppConstants.PREGNANCY_ENDED
					.equalsIgnoreCase(categoryID)) {
				indivColl = peopleRulesBO.getNonPregnantableIndividuals(
						indivColl, appInPreg);

				pageCollection.put(peopleString, indivColl);
			} else if (AppConstants.BECAME_PREGNANT
					.equalsIgnoreCase(categoryID)) {
				indivColl = peopleRulesBO.getPregnantableIndividuals(indivColl,
						appInPreg);

				pageCollection.put(peopleString, indivColl);
			
			/*
			 * VG SONAR Cleanup - 08/31/2015 Changed Commented code block to
			 * javadoc
			 */
			/**
			 * else if
			 * (categoryID.equalsIgnoreCase(AppConstants.PREGNANCY_ENDED)) {
			 * APP_IN_PREG_Collection appInPregColl =
			 * pregBO.loadPregnancyDetails(appNum, AppConstants.CWW_RECORD_IND);
			 * for (int i = 0; i < appInPregColl.size(); i++) { appInPregCargo =
			 * appInPregColl.getCargo(i); for (int j = 0; j < indivCollSize;
			 * j++) { indivCargo = indivColl.getResult(j); if
			 * (appInPregCargo.getIndv_seq_num
			 * ().equals(indivCargo.getIndv_seq_num())) {
			 * pregnancyColl.addCargo(indivCargo); } } }
			 * pageCollection.put(peopleString, pregnancyColl); }
			 */

			} else {
				pageCollection.put(peopleString, indivColl);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.getPeopleCollectionAndUpdateMaps() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");

			return pageCollection;
			// exit
		} catch (final FwException fe) {
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPregPeopleCollectionAndUpdateMaps");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"getPeopleCollectionAndUpdateMaps", e);
			fe.setParameterText(categoryID);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "getPregPeopleCollectionAndUpdateMaps");
		}
	}

	/**
	 * Check detail page required for end.
	 *
	 * @param categorySelectionProfile the category selection profile
	 * @param catType the cat type
	 * @return true, if successful
	 */
	private boolean checkDetailPageRequiredForEnd(
			final SortedSet categorySelectionProfile, final Map catType) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.checkDetailPageRequired() - START");
		try {
			boolean isexpensePageRequired = false;
			if (categorySelectionProfile != null) {
				// this one form the category selection profile
				final Iterator iter = categorySelectionProfile.iterator();
				CategorySequenceDetail categorySeqDtl = null;
				while (iter.hasNext()) {
					categorySeqDtl = (CategorySequenceDetail) iter.next();
					if (catType != null
							&& catType.get(categorySeqDtl.getCategoryType()) != null
							&& categorySeqDtl.getUserEndSelectionInd() == AppConstants.RMC_END_SEL_IND) {
						isexpensePageRequired = true;
						break;
					}
				}
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean.checkDetailPageRequired() - END , Time Taken : "
							+ (System.currentTimeMillis() - startTime)
							+ " milliseconds");
			return isexpensePageRequired;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkDetailPageRequiredForEnd");
		} catch (final Exception e) {
			final FwException fe = createFwException(this.getClass().getName(),
					"checkExpenseDetailPageRequired", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "checkDetailPageRequiredForEnd");
		}
	}

	/**
	 * Load lost health insurance details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadLostHealthInsuranceDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.loadLostHealthInsuranceDetails - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::loadLostHealthInsuranceDetails:Start");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String catSeqNumber = null;
		// PCR# 40362 changes: page mode
		String pageMode = null;
		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final LostHealthInsBO lostHealthInsBO = new LostHealthInsBO();

			// PCR# 40362 Changes: To retain RMC functionality
			// PCR# 40362 Changes for RMB/SMIRF starts here

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.LOST_HEALTH_INS,
					AppConstants.LOST_HEALTH_INS);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.LOST_HEALTH_INS_IND };
			SortedSet lostHealthInsDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.LOST_HEALTH_INSURANCE;

			if (!pageId.equals(previousPageId)) {
				lostHealthInsDetailsProfile = createPageProfile(
						categorySelectionProfile, rmcInPrflColl, responseType);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {

					final CP_APP_IN_LST_HLTH_INS_Collection lostHealthInsColl = lostHealthInsBO
							.loadLostHealthInsInfo(appNumber);
					final CP_APP_IN_LST_HLTH_INS_Collection newLostHealthInsColl = lostHealthInsBO
							.splitLostHealthInsColl(lostHealthInsColl,
									AppConstants.RMC_NEW_RECORD_IND);

					if (newLostHealthInsColl != null
							&& !newLostHealthInsColl.isEmpty()) {
						CP_APP_IN_LST_HLTH_INS_Cargo appInLostInsCargo = null;
						final int newLostHealthInsCollSize = newLostHealthInsColl
								.size();
						rnRecordFound = true;

						for (int i = 0; i < newLostHealthInsCollSize; i++) {
							appInLostInsCargo = newLostHealthInsColl
									.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									lostHealthInsDetailsProfile, null,
									null,
									Short.parseShort(appInLostInsCargo
											.getIndv_seq_num()),
											Long
                                            .parseLong(appInLostInsCargo
                                                    .getSeq_num()), categType);
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(lostHealthInsDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(lostHealthInsDetailsProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				lostHealthInsDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("LostHealthIns_IndSeqBean");
			}
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								lostHealthInsDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Long.parseLong(indivSeqBean.getSeqNum()),
								AppConstants.LOST_HEALTH_INS);
				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.updateUserEndSelInd(
								lostHealthInsDetailsProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.LOST_HEALTH_INS, Short
												.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							lostHealthInsDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.LOST_HEALTH_INS);
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.LOST_HEALTH_INS);
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.LOST_HEALTH_INS,
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.LOST_HEALTH_INS);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.LOST_HEALTH_INS.equals(indivSeqBean
								.getType())) {
							// first we are checking rnc in profile exists in
							// the sess
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}
							// now we need to make required the MAPP page
							rmcResponseProfileManager
							.makeAddNew(
									IRMCResponseProfileManager.LOST_HEALTH_INS_IND,
									rmcInPrflCargo, true);

							CategorySequenceDetail catseqDet = null;
							if (!lostHealthInsDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												lostHealthInsDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														Long.parseLong(indivSeqBean.getSeqNum()),
														AppConstants.LOST_HEALTH_INS);
							}
							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										lostHealthInsDetailsProfile,
										null, null,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.LOST_HEALTH_INS);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean sErowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;
									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.LOST_HEALTH_INS
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												sErowExists = true;
												break;
											}
										}

									}
								}
								if (sErowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													Long.parseLong(indivSeqBean.getSeqNum()),
													AppConstants.LOST_HEALTH_INS);
								categorySelectionProfileManager
									.insertExistingSequenceDetail(
											categorySelectionProfile,
											null,
											AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													Long.parseLong(indivSeqBean.getSeqNum()),
													AppConstants.LOST_HEALTH_INS);
								} else {
									categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.LOST_HEALTH_INS);
								}

								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.LOST_HEALTH_INS);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.LOST_HEALTH_INS };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!lostHealthInsDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													lostHealthInsDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															Long.parseLong(indivSeqBean.getSeqNum()),
															AppConstants.LOST_HEALTH_INS);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											lostHealthInsDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													Long.parseLong(indivSeqBean.getSeqNum()),
													AppConstants.LOST_HEALTH_INS);
									lostHealthInsDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									lostHealthInsDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!lostHealthInsDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													lostHealthInsDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															Long.parseLong(indivSeqBean.getSeqNum()),
															AppConstants.LOST_HEALTH_INS);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											lostHealthInsDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													Long.parseLong(indivSeqBean.getSeqNum()),
													AppConstants.LOST_HEALTH_INS);
									categorySelectionProfileManager
									.insertSequenceDetail(
											lostHealthInsDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.LOST_HEALTH_INS);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											lostHealthInsDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.LOST_HEALTH_INS);
								}
							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								lostHealthInsDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								lostHealthInsDetailsProfile, null,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put("LostHealthIns_IndSeqBean", indivSeqBean);
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					lostHealthInsDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(lostHealthInsDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(lostHealthInsDetailsProfile);
			}

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());
			catSeqNumber = Long.toString(categorySeqDetail
                    .getCategorySequence());

			final CP_APP_IN_LST_HLTH_INS_Collection appInHealthInsColl = lostHealthInsBO
					.loadLostHealthInsResponse(appNumber, indvSeqNumber,catSeqNumber);

			pageCollection.put(AppConstants.CP_APP_IN_LST_HLTH_INS_COLLECTION,
					appInHealthInsColl);

			CP_APP_IN_LST_HLTH_INS_Cargo cwwInLstHlthInsCargo = lostHealthInsBO
					.splitLostInsColl(appInHealthInsColl,
							AppConstants.CWW_RECORD_IND);

			if (cwwInLstHlthInsCargo == null) {
				cwwInLstHlthInsCargo = new CP_APP_IN_LST_HLTH_INS_Cargo();
			}
			pageCollection.put("SEC_LST_INS",
					lostHealthInsBO.settingDefaultValues(cwwInLstHlthInsCargo));

			CP_APP_IN_LST_HLTH_INS_Cargo rmcInLostHealthInsCargo = lostHealthInsBO
					.splitLostInsColl(appInHealthInsColl,
							AppConstants.RMC_NEW_RECORD_IND);
			if (rmcInLostHealthInsCargo != null) {
				pageCollection.put("FST_MEDA", lostHealthInsBO
						.settingDefaultValues(rmcInLostHealthInsCargo));
			} else {
				rmcInLostHealthInsCargo = lostHealthInsBO.splitLostInsColl(
						appInHealthInsColl,
						AppConstants.RMC_MODIFIED_RECORD_IND);
				if (rmcInLostHealthInsCargo != null) {
					pageCollection.put("FST_MEDA", lostHealthInsBO
							.settingDefaultValues(rmcInLostHealthInsCargo));
				} else {
					if (null != appInHealthInsColl && appInHealthInsColl.size() > 0) {
						pageCollection.put("FST_MEDA", lostHealthInsBO
								.settingDefaultValues(appInHealthInsColl
										.getCargo(0)));
					}
					
				}

			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (appInHealthInsColl != null && !appInHealthInsColl.isEmpty()) {
				final CP_APP_IN_LST_HLTH_INS_Cargo appInHealthInsCargo = appInHealthInsColl
						.getResult(0);
				srcAppInd = appInHealthInsCargo.getSrc_app_ind();
			}

			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}

			if (categorySeqDetail.getUserEndSelectionInd() == 1) // categorySeqDetail.getUserEndSelectionInd()==
				// 1)
				// userEndInd.equals(FwConstants.ONE)
			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd())) // categorySeqDetail.getUserEndSelectionInd()==
				// 1)
				// userEndInd.equals(FwConstants.ONE)
				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equalsIgnoreCase(pageMode) || "E"
					.equalsIgnoreCase(pageMode))) {
				pageMode = FwConstants.NO;
			}

			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);
			String immuneStatus = "false";
			final short[] programKeyArray = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			final short tanf = 9;
			if (programKeyArray[tanf] != 0) {
				final IndividualAge indvAge = indvCargo.getIndv_age();
				if (indvAge.getYears() <= 18) {
					immuneStatus = "true";
				}
			}
			pageCollection.put("DISPLAY_IMMUNIZATION", immuneStatus);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadLostHealthInsuranceDetails:END");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadLostHealthInsuranceDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadLostHealthInsuranceDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadLostHealthInsuranceDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadLostHealthInsuranceDetails");
		}

		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.loadLostHealthInsuranceDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	// NextGen NG-6481 Phase 1 updates to ACA Streamline changes  end

	/**
	 * Store lost health insurance details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	// NextGen NG-6481 Phase 1 updates to ACA Streamline changes  start
	public void storeLostHealthInsuranceDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.storeLostHealthInsDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeLostHealthInsDetails");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateMsg = new FwMessageList();

		String changeEffDate = null;
		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			final String pageMode = (String) beforeColl.get("PAGE_MODE");

			// PCR# 40362 Changes: To retail RMC flow

			// PCR# 40362 Changes Starts here: For RMB/SMIRF

			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			// get the BeforeCollection

			final SortedSet inSchoolProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			final CP_APP_IN_LST_HLTH_INS_Collection appInLostHealthInsCollection = (CP_APP_IN_LST_HLTH_INS_Collection) pageCollection
					.get("CP_APP_IN_LST_HLTH_INS_Collection");
			CP_APP_IN_LST_HLTH_INS_Cargo appInLostHealthInsCargo = appInLostHealthInsCollection
					.getResult(0);

			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inSchoolProfile);

			final LostHealthInsBO lostHealthBo = new LostHealthInsBO();

			// Calling the Validator method

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			final ARLHIValidator arlhiValidator = new ARLHIValidator();

			if (backToMyAccess == null) {

				if ("C".equals(pageMode) || FwConstants.NO.equals(pageMode)) {

					validateMsg = arlhiValidator
							.validateLostHealthInsDetailsCheck(appInLostHealthInsCargo);
				}
				if ("E".equals(pageMode)) {
					validateMsg = arlhiValidator
							.validateEndDate(appInLostHealthInsCargo);
				}

			}

			if (checkBackToMyAccessSelected(request) || validateMsg != null
					&& validateMsg.hasMessages()) {

				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							arlhiValidator.getMessageList());
				}

				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("CP_APP_IN_LST_HLTH_INS_Collection",
						appInLostHealthInsCollection);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put("FST_MEDA", beforeColl.get("FST_MEDA"));
				pageCollection.put("SEC_LST_INS", beforeColl.get("SEC_LST_INS"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				return;
			}

			appInLostHealthInsCargo.setApp_num(appNumber);
			appInLostHealthInsCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			// For Check boxe is unchecked, is null I am setting it to '0'(Zero)
			if (appInLostHealthInsCargo.getLst_dy_hlth_dt() == null
					|| appInLostHealthInsCargo.getLst_dy_hlth_dt().trim()
					.length() == 0) {
				appInLostHealthInsCargo.setLst_dy_hlth_dt(FwConstants.SPACE);
			} else {
				appInLostHealthInsCargo.setLst_dy_hlth_dt(displayFormatter
						.getYYYYMMDDDate(appInLostHealthInsCargo
								.getLst_dy_hlth_dt()));
			}

			if (appInLostHealthInsCargo.getEcp_id() == null
					|| appInLostHealthInsCargo.getEcp_id().trim().length() == 0) {
				appInLostHealthInsCargo.setEcp_id(FwConstants.ZERO);
			} else {
				appInLostHealthInsCargo.setEcp_id(AppConstants.ONE);
			}

			// Setting Values to Zero if null.
			if (appInLostHealthInsCargo.getFamily_cvrg_ind() == null) {
				appInLostHealthInsCargo.setFamily_cvrg_ind(FwConstants.ZERO);
			}

			if (appInLostHealthInsCargo.getDiscontinued_cvrg_ind() == null) {
				appInLostHealthInsCargo
				.setDiscontinued_cvrg_ind(FwConstants.ZERO);
			}

			if (appInLostHealthInsCargo.getEmp_stop_cvrg_ind() == null) {
				appInLostHealthInsCargo.setEmp_stop_cvrg_ind(FwConstants.ZERO);
			}

			if (appInLostHealthInsCargo.getChng_empl_ind() == null) {
				appInLostHealthInsCargo.setChng_empl_ind(FwConstants.ZERO);
			}

			if (appInLostHealthInsCargo.getSpcl_hlth_cr_ind() == null) {
				appInLostHealthInsCargo.setSpcl_hlth_cr_ind(FwConstants.ZERO);
			}

			if (appInLostHealthInsCargo.getLst_cvrg_dth_ind() == null) {
				appInLostHealthInsCargo.setLst_cvrg_dth_ind(FwConstants.ZERO);
			}

			if (appInLostHealthInsCargo.getChld_born_ind() == null) {
				appInLostHealthInsCargo.setChld_born_ind(FwConstants.ZERO);
			}

			if (appInLostHealthInsCargo.getOth_ind() == null) {
				appInLostHealthInsCargo.setOth_ind(FwConstants.ZERO);
			}
			if (appInLostHealthInsCargo.getEnd_date() == null
					|| appInLostHealthInsCargo.getEnd_date().trim().length() == 0) {
				appInLostHealthInsCargo.setEnd_date(FwConstants.SPACE);
			} else {
				appInLostHealthInsCargo
				.setEnd_date(displayFormatter
						.getYYYYMMDDDate(appInLostHealthInsCargo
								.getEnd_date()));
			}

			final CP_APP_IN_LST_HLTH_INS_Collection beforeAppInLostInsColl = (CP_APP_IN_LST_HLTH_INS_Collection) beforeColl
					.get("CP_APP_IN_LST_HLTH_INS_Collection");
			CP_APP_IN_LST_HLTH_INS_Cargo beforeInLostInsCargo = null;

			String sourceAppIndicator = null;
			String recordInd = null;

			// now we are checking for the before collection

			boolean lostInsDetailsUpdate = false;

			if (beforeAppInLostInsColl != null
					&& !beforeAppInLostInsColl.isEmpty()) {
				final int size = beforeAppInLostInsColl.size();
				if ("C".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
				} else if ("E".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
				} else {
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				}
				beforeInLostInsCargo = lostHealthBo.splitLostInsColl(
						beforeAppInLostInsColl, sourceAppIndicator);
				if (beforeInLostInsCargo == null
						&& (AppConstants.RMC_MODIFIED_RECORD_IND
								.equals(sourceAppIndicator) || AppConstants.RMC_END_RECORD_IND
								.equals(sourceAppIndicator))) {
					beforeInLostInsCargo = lostHealthBo
							.splitLostInsColl(beforeAppInLostInsColl,
									AppConstants.CWW_RECORD_IND);
				}

				if (size > 1) {
					// if we have two records means cw and rm or cw and re
					// now we are getting RM/RE record to compare
					// now we need to update the data base if it dirty
					recordInd = FwConstants.ROWACTION_UPDATE;
					
					
				} else {
					// now we are checking this record is CW or RN
					recordInd = FwConstants.ROWACTION_INSERT;
					
					if (AppConstants.RMC_NEW_RECORD_IND
							.equals(sourceAppIndicator)
							&& beforeInLostInsCargo != null) {
						recordInd = FwConstants.ROWACTION_UPDATE;
						
					}
				}
				// check dirty
				if (beforeInLostInsCargo != null) {
					// Source App Indicator set to 'RM' and the default values
					// for appInSelfeCargo populated from the before cargo
					appInLostHealthInsCargo.setSrc_app_ind(beforeInLostInsCargo
							.getSrc_app_ind());
					appInLostHealthInsCargo
					.setIndv_seq_num(beforeInLostInsCargo
							.getIndv_seq_num());
					appInLostHealthInsCargo.setEcp_id(beforeInLostInsCargo
							.getEcp_id());
					appInLostHealthInsCargo.setSeq_num(beforeInLostInsCargo
							.getSeq_num());

				} else {

					if (beforeAppInLostInsColl != null) {
						final CP_APP_IN_LST_HLTH_INS_Cargo beforeCargo = beforeAppInLostInsColl
								.getCargo(0);
						appInLostHealthInsCargo.setEcp_id(beforeCargo
								.getEcp_id());
					}

				}

				if ("E".equalsIgnoreCase(pageMode)) {
					appInLostHealthInsCargo
					.setFamily_cvrg_ind(beforeInLostInsCargo
							.getFamily_cvrg_ind());
					appInLostHealthInsCargo
					.setEmp_stop_cvrg_ind(beforeInLostInsCargo
							.getEmp_stop_cvrg_ind());
					appInLostHealthInsCargo
					.setDiscontinued_cvrg_ind(beforeInLostInsCargo
							.getDiscontinued_cvrg_ind());
					appInLostHealthInsCargo
					.setChng_empl_ind(beforeInLostInsCargo
							.getChng_empl_ind());
					// HHS Next Gen : set Other Income Source & Ecp ID for RM &
					// RE records
					appInLostHealthInsCargo
					.setChld_born_ind(beforeInLostInsCargo
							.getChld_born_ind());
					appInLostHealthInsCargo
					.setSpcl_hlth_cr_ind(beforeInLostInsCargo
							.getSpcl_hlth_cr_ind());
					appInLostHealthInsCargo.setOth_ind(beforeInLostInsCargo
							.getOth_ind());
					appInLostHealthInsCargo
					.setLst_cvrg_dth_ind(beforeInLostInsCargo
							.getLst_cvrg_dth_ind());
					appInLostHealthInsCargo
					.setLst_dy_hlth_dt(beforeInLostInsCargo
							.getLst_dy_hlth_dt());
					appInLostHealthInsCargo.setEcp_id(beforeInLostInsCargo
							.getEcp_id());

				}

				// check dirty
				appInLostHealthInsCargo = (CP_APP_IN_LST_HLTH_INS_Cargo) isChanged(
						beforeInLostInsCargo, appInLostHealthInsCargo);
				if (appInLostHealthInsCargo.isDirty()) {
					appInLostHealthInsCargo.setSrc_app_ind(sourceAppIndicator);
					appInLostHealthInsCargo.setRowAction(recordInd);

					lostInsDetailsUpdate = true;
					// EDSP RMB

					if (changeEffDate == null) {
						changeEffDate = AppConstants.HIGH_DATE;
					}

				}
			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				appInLostHealthInsCargo.setSeq_num(String.valueOf(lostHealthBo
						.getMaxLstHlthSeqNumber(appNumber,
								String.valueOf(indvSeqNum)) + 1));

				appInLostHealthInsCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInLostHealthInsCargo.setRowAction(recordInd);

				lostInsDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inSchoolProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(), categorySeqDetailBean.getCategoryType());
				/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code
				 * in this block
				 */

				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(), categorySeqDetailBean.getCategoryType());

			}

			// now we need to check the flags
			if (lostInsDetailsUpdate) {

				if (FwConstants.ROWACTION_INSERT.equals(appInLostHealthInsCargo
						.getRowAction())) {

					lostHealthBo
					.insertExistingDetails(appInLostHealthInsCollection);
				} else {
					lostHealthBo
					.storeLostHealthInsDetails(appInLostHealthInsCollection);
				}

			}

			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.LOST_HEALTH_INS_IND,
							rmcInPrflCargo, true);
				}
			}

			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inSchoolProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			if (categorySelectionProfileManager
					.areAllSequencesComplete(inSchoolProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inSchoolProfile);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeLostHealthInsDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeLostHealthInsDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeLostHealthInsuranceDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeLostHealthInsDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeLostHealthInsuranceDetails");
		}

		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.storeLostHealthInsDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * End lost health insurance details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void endLostHealthInsuranceDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCOtherIncomeEJBBean.endLostHealthInsuranceDetails() - START");
		try {

			log(ILog.INFO,
					"RMCOtherIncomeEJBBean::endLostHealthInsuranceDetails");
			final Map session = txnBean.getSession();
			final Map pageCollection = txnBean.getPageCollection();
			// Get driver info.
			final int[] driverArray = (int[]) session
					.get(FwConstants.RMC_DRIVER);

			final CP_APP_IN_LST_HLTH_INS_Collection lostColl = (CP_APP_IN_LST_HLTH_INS_Collection) pageCollection
					.get("CP_APP_IN_LST_HLTH_INS_Collection");
			final CP_APP_IN_LST_HLTH_INS_Cargo lostCargo = lostColl.getCargo(0);

			final IndivTypeSeqBean seqBean = new IndivTypeSeqBean();
			seqBean.setIndivSeqNum(lostCargo.getIndv_seq_num());
			seqBean.setSeqNum(FwConstants.ZERO);
			seqBean.setType(lostCargo.getSrc_app_ind());
			seqBean.setUserEndInd(FwConstants.ONE);
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, seqBean);
			// Get App Number
			final String appNum = (String) session.get(AppConstants.APP_NUMBER);
			// Set RMC page Other Income Details make required
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARLHI",
					driverArray, appNum);
			driverManager.makeRequired(FwConstants.RMC_DRIVER, "AROBS",
					driverArray, appNum);

			// End
			log(ILog.INFO,
					"RMCOtherIncomeEJBBean::endLostHealthInsuranceDetails:End");

		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("endLostHealthInsuranceDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endLostHealthInsuranceDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"endLostHealthInsuranceDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "endLostHealthInsuranceDetails");
		}

		log(ILog.DEBUG,
				"RMCOtherIncomeEJBBean.endLostHealthInsuranceDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Load tax return details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadTaxReturnDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.loadTaxReturnDetails() - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::loadTaxReturnDetails:Start");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		boolean pageModeEnd = false;
		// PCR# 40362 changes: page mode
		String pageMode = null;
		final String newPersonInd = (String) session.get("ADD_NEW_PERSON");
		try {
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			session.put("editMode", false);
			request.put("spouseNotExist", false);
			final TaxReturnBO taxReturnBO = new TaxReturnBO();

			// PCR# 40362 Changes: To retain RMC functionality
			// PCR# 40362 Changes for RMB/SMIRF starts here

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.TAX_RETURN_CHANGE,
					AppConstants.TAX_RETURN_CHANGE);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.TAX_INFO_IND };
			SortedSet taxReturnDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.TAX_RETURN_INFO;

			if (!pageId.equals(previousPageId)) {
				taxReturnDetailsProfile = createPageProfileTax(
						categorySelectionProfile, rmcInPrflColl, responseType);
				CP_APP_IN_TAX_RETURN_Collection newtaxReturnColl = null;
				final CP_APP_IN_TAX_RETURN_Collection taxReturnColl = taxReturnBO
						.loadTaxReturnInfo(appNumber);
				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {
					newtaxReturnColl = taxReturnBO.splitTaxReturnColl(
							taxReturnColl, AppConstants.RMC_NEW_RECORD_IND);
					newtaxReturnColl.addAll(taxReturnBO
							.splitTaxReturnColl(taxReturnColl,
									AppConstants.RMC_MODIFIED_RECORD_IND));
					newtaxReturnColl.addAll(taxReturnBO.splitTaxReturnColl(
							taxReturnColl, AppConstants.RMC_END_RECORD_IND));
					if (newtaxReturnColl != null && !newtaxReturnColl.isEmpty()) {
						CP_APP_IN_TAX_RETURN_Cargo appInTaxReturnCargo = null;
						final int newTaxReturnCollSize = newtaxReturnColl
								.size();
						rnRecordFound = true;

						for (int i = 0; i < newTaxReturnCollSize; i++) {
							appInTaxReturnCargo = newtaxReturnColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									taxReturnDetailsProfile,
									null,
									null,
									Short.parseShort(appInTaxReturnCargo
											.getIndv_seq_num()),
											(short) 0, categType);
						}
					} else {
						newtaxReturnColl = taxReturnBO.splitTaxReturnColl(
								taxReturnColl,
								AppConstants.RMC_MODIFIED_RECORD_IND);
						if (newtaxReturnColl != null
								&& !newtaxReturnColl.isEmpty()) {
							CP_APP_IN_TAX_RETURN_Cargo appInTaxDepCargo = null;
							final int newTaxDepInfoCollSize = newtaxReturnColl
									.size();
							rnRecordFound = true;

							for (int i = 0; i < newTaxDepInfoCollSize; i++) {
								appInTaxDepCargo = newtaxReturnColl
										.getResult(i);
								categorySelectionProfileManager
								.insertExistingSequenceDetail(
										taxReturnDetailsProfile,
										null,
										null,
										Short.parseShort(appInTaxDepCargo
												.getIndv_seq_num()),
												(short) 0, categType);
							}
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(taxReturnDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(taxReturnDetailsProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				taxReturnDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("TaxReturn_IndSeqBean");
			}
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								taxReturnDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.TAX_RETURN_CHANGE);
				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.updateUserEndSelInd(taxReturnDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.TAX_RETURN_CHANGE, Short
												.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							taxReturnDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.TAX_RETURN_CHANGE);
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.TAX_RETURN_CHANGE);
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.TAX_RETURN_CHANGE,
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.TAX_RETURN_CHANGE);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						if (AppConstants.ADD_TAX_RETURN.equals(indivSeqBean
								.getType())) {
							// first we are checking rnc in profile exists in
							// the sess
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}
							// now we need to make required the MAPP page
							rmcResponseProfileManager.makeAddNew(
									IRMCResponseProfileManager.TAX_INFO_IND,
									rmcInPrflCargo, true);

							CategorySequenceDetail catseqDet = null;
							if (!taxReturnDetailsProfile.isEmpty()) {
								catseqDet = categorySelectionProfileManager
										.getCategorySequenceDetail(
												taxReturnDetailsProfile,
												Short.parseShort(indivSeqBean
														.getIndivSeqNum()),
														(short) 0,
														AppConstants.TAX_RETURN_CHANGE);
							}

							if (catseqDet == null) {
								categorySelectionProfileManager
								.insertSequenceDetail(
										taxReturnDetailsProfile, null,
										null,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.TAX_RETURN_CHANGE);
							}
						} else {

							if (AppConstants.RMC_MODIFIED_RECORD_IND
									.equals(indivSeqBean.getType())
									|| AppConstants.CWW_RECORD_IND
									.equals(indivSeqBean.getType())) {
								boolean seRowExists = false;
								if (categorySelectionProfileManager != null) {
									final Iterator iter = categorySelectionProfile
											.iterator();
									CategorySequenceDetail catSeqDetail = null;
									while (iter.hasNext()) {
										catSeqDetail = (CategorySequenceDetail) iter
												.next();
										if (catSeqDetail != null) {
											if (catSeqDetail
													.getIndividualSequence() == Short
													.parseShort(indivSeqBean
															.getIndivSeqNum())
															&& AppConstants.TAX_RETURN_CHANGE
															.equals(catSeqDetail
																	.getCategoryType()
																	.trim())
																	&& AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL
															.equals(catSeqDetail
																			.getChangeSelectionCategoryCd())) {
												seRowExists = true;
												break;
											}
										}

									}
								}
								if (seRowExists) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											categorySelectionProfile,
											appNumber,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.TAX_RETURN_CHANGE);
								}
								categorySelectionProfileManager
								.insertSequenceDetail(
										categorySelectionProfile,
										appNumber,
										AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												AppConstants.TAX_RETURN_CHANGE);
								categorySelectionProfileManager
								.makeSequenceDetailRequired(
										categorySelectionProfile,
										appNumber,
										Short.parseShort(indivSeqBean
												.getIndivSeqNum()),
												Short.parseShort(indivSeqBean
														.getSeqNum()),
														AppConstants.TAX_RETURN_CHANGE);

								SortedSet pregAddSortedSet = null;
								final String[] catTypePregAdd = { AppConstants.TAX_RETURN_CHANGE };
								pregAddSortedSet = createPageProfile(
										categorySelectionProfile,
										catTypePregAdd);
								CategorySequenceDetail catseqDet = null;
								if (!taxReturnDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													taxReturnDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.TAX_RETURN_CHANGE);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											taxReturnDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.TAX_RETURN_CHANGE);
									taxReturnDetailsProfile
									.addAll(pregAddSortedSet);
								} else {
									taxReturnDetailsProfile
									.addAll(pregAddSortedSet);
								}

							} else {
								CategorySequenceDetail catseqDet = null;
								if (!taxReturnDetailsProfile.isEmpty()) {
									catseqDet = categorySelectionProfileManager
											.getCategorySequenceDetail(
													taxReturnDetailsProfile,
													Short.parseShort(indivSeqBean
															.getIndivSeqNum()),
															(short) 0,
															AppConstants.TAX_RETURN_CHANGE);
								}
								if (catseqDet != null) {
									categorySelectionProfileManager
									.removeSequenceDetail(
											taxReturnDetailsProfile,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													(short) 0,
													AppConstants.TAX_RETURN_CHANGE);
									categorySelectionProfileManager
									.insertSequenceDetail(
											taxReturnDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.TAX_RETURN_CHANGE);
								} else {
									categorySelectionProfileManager
									.insertSequenceDetail(
											taxReturnDetailsProfile,
											null,
											null,
											Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
													AppConstants.TAX_RETURN_CHANGE);
								}

							}
						}

						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
						session.put(AppConstants.RMC_CATEGORY_PROFILE_MASTER,
								categorySelectionProfile);

					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								taxReturnDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								taxReturnDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
				session.put("TaxReturn_IndSeqBean", indivSeqBean);
				request.put("ShowLoopingQuestionFlag", FwConstants.NO);
				session.put("editMode", true);
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					taxReturnDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(taxReturnDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(taxReturnDetailsProfile);
			}

			categorySeqDetail.getCategoryType();

			indvSeqNumber = Short.toString(categorySeqDetail
					.getIndividualSequence());

			final CP_APP_IN_TAX_RETURN_Collection appInTaxReturnColl = taxReturnBO
					.loadTaxReturnResponse(appNumber, indvSeqNumber);

			pageCollection.put(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
					appInTaxReturnColl);

			final CP_APP_IN_TAX_DEPENDENTS_Collection appInTaxDependatColl = taxReturnBO
					.loadIndividualTaxDependentDetailsAFB(appNumber,
							indvSeqNumber);

			pageCollection.put(
					AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION,
					appInTaxDependatColl);

			CP_APP_IN_TAX_RETURN_Cargo cwwInTaxReturnCargo = taxReturnBO
					.splitTaxReturnInfoColl(appInTaxReturnColl,
							AppConstants.CWW_RECORD_IND);

			final CP_APP_IN_TAX_RETURN_Cargo reInTaxReturnCargo = taxReturnBO
					.splitTaxReturnInfoColl(appInTaxReturnColl,
							AppConstants.RMC_END_RECORD_IND);

			if (cwwInTaxReturnCargo == null) {
				cwwInTaxReturnCargo = new CP_APP_IN_TAX_RETURN_Cargo();
			}
			pageCollection.put("SEC_TAXRET",
					taxReturnBO.settingDefaultValues(cwwInTaxReturnCargo));

			CP_APP_IN_TAX_RETURN_Cargo rmcInTaxReturnCargo = taxReturnBO
					.splitTaxReturnInfoColl(appInTaxReturnColl,
							AppConstants.RMC_NEW_RECORD_IND);
			if (reInTaxReturnCargo != null) {
				pageCollection.put("FST_TAXRET",
						taxReturnBO.settingDefaultValues(reInTaxReturnCargo));
				pageModeEnd = true;
			} else {
				if (rmcInTaxReturnCargo != null) {
					pageCollection.put("FST_TAXRET", taxReturnBO
							.settingDefaultValues(rmcInTaxReturnCargo));
				} else {
					rmcInTaxReturnCargo = taxReturnBO.splitTaxReturnInfoColl(
							appInTaxReturnColl,
							AppConstants.RMC_MODIFIED_RECORD_IND);
					if (rmcInTaxReturnCargo != null) {
						pageCollection.put("FST_TAXRET", taxReturnBO
								.settingDefaultValues(rmcInTaxReturnCargo));
					} else if (!appInTaxReturnColl.isEmpty()) {
						pageCollection.put("FST_TAXRET", taxReturnBO
								.settingDefaultValues(appInTaxReturnColl
										.getCargo(0)));
					} else {
						final CP_APP_IN_TAX_RETURN_Cargo cargoTopreventBreak = new CP_APP_IN_TAX_RETURN_Cargo();
						pageCollection.put("FST_TAXRET", taxReturnBO
								.settingDefaultValues(cargoTopreventBreak));
					}

				}
			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (appInTaxReturnColl != null && !appInTaxReturnColl.isEmpty()) {
				final CP_APP_IN_TAX_RETURN_Cargo appInTaxReturnCargo = appInTaxReturnColl
						.getResult(0);
				srcAppInd = appInTaxReturnCargo.getSrc_app_ind();
			}

			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& categorySeqDetail.getUserEndSelectionInd() == 0) {
				pageMode = "C";
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3,3 lines Commented Code in
			 * this block
			 */

			if (categorySeqDetail.getUserEndSelectionInd() == 1)

			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd()))

				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equalsIgnoreCase(pageMode) || "E"
					.equalsIgnoreCase(pageMode))) {
				pageMode = FwConstants.NO;
			}

			if (!"E".equals(pageMode) && FwConstants.YES.equals(newPersonInd)) {
				pageMode = FwConstants.NO;
			}
			if (pageModeEnd) {
				pageMode = "E";
			}
			pageCollection.put("PAGE_MODE", pageMode);
			if (pageMode != null && "E".equals(pageMode)) {
				pageCollection.put("FST_TAXRET", taxReturnBO
						.splitTaxReturnInfoColl(appInTaxReturnColl,
								AppConstants.RMC_END_RECORD_IND));
			}

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);

			String immuneStatus = "false";
			final short[] programKeyArray = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			final short tanf = 9;
			if (programKeyArray[tanf] != 0) {
				final IndividualAge indvAge = indvCargo.getIndv_age();
				if (indvAge.getYears() <= 18) {
					immuneStatus = "true";
				}
			}
			pageCollection.put("DISPLAY_IMMUNIZATION", immuneStatus);

			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			final INDIVIDUAL_Custom_Collection indivCustCol = new INDIVIDUAL_Custom_Collection();
			for (int i = 0; i < peopleHandler.getAllIndividualsOnCase().size(); i++) {
				final INDIVIDUAL_Custom_Collection i1 = peopleHandler
						.getAllIndividualsOnCase();
				final INDIVIDUAL_Custom_Cargo c1 = (INDIVIDUAL_Custom_Cargo) i1
						.get(i);

				if (!pageCollection.get("CURRENT_INDIV_SEQ_NUM").toString()
						.equals(c1.getIndv_seq_num().toString())) {
					indivCustCol.add(c1);
				}
			}
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 1 lines Commented Code in
			 * this block
			 */

			pageCollection.put("PEOPLE", indivCustCol);
			// Relationship Logic-start
			final APP_HSHL_RLT_Collection relationshipColl = taxReturnBO
					.loadRelationShipDetails(appNumber);
			final String spouseIndvSeqNum = taxReturnBO.getSpouseIndvId(
					appNumber, pageCollection.get("CURRENT_INDIV_SEQ_NUM")
					.toString());
			if (FwConstants.ZERO.equalsIgnoreCase(spouseIndvSeqNum)) {
				request.put("spouseNotExist", true);
			}

			relationShipMap.clear();
			relationShipMap.put(pageCollection.get("CURRENT_INDIV_SEQ_NUM")
					.toString(), FwConstants.YES);
			for (final APP_HSHL_RLT_Cargo cargo : relationshipColl.getResults()) {
				if (!cargo.getRef_indv_seq_num().equalsIgnoreCase(
						spouseIndvSeqNum)) {
					relationShipMap.put(cargo.getRef_indv_seq_num(),
							FwConstants.YES);
				}
			}
			String spouseNm = FwConstants.EMPTY_STRING;
			if (!FwConstants.ZERO.equalsIgnoreCase(spouseIndvSeqNum)) {
				spouseNm = taxReturnBO.extractFirstName(appNumber,
						spouseIndvSeqNum);
			}
			pageCollection.put(AppConstants.SPOUSE_SEQ_NUM, spouseNm);
			session.put(AppConstants.SPOUSE_SEQ_NUM, spouseIndvSeqNum);
			// Relationship logic-end
			txnBean.setPageCollection(pageCollection);
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadTaxReturnDetails:END");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadTaxReturnDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadTaxReturnDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadTaxReturnDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadTaxReturnDetails");
		}

		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.loadTaxReturnDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store tax return details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeTaxReturnDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {

		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.storeTaxReturnDetails() - START");
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean::storeTaxReturnDetails");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;
		FwMessageList validateInfo = null;

		String indvSeqNumber = null;
		PeopleHandler peopleHandler = null;
		final int currentPageStatus = 0;
		String pageId = null;
		boolean endInd = false;

		CP_APP_IN_TAX_RETURN_Collection appInTaxInfoCollection = null;
		CP_APP_IN_TAX_RETURN_Cargo appInTaxInfoCargo = null;
		CP_APP_IN_TAX_RETURN_Cargo taxReturnCargo = null;
		CP_APP_IN_TAX_DEPENDENTS_Collection appBeforeTaxColl = null;
		CP_APP_IN_TAX_DEPENDENTS_Collection appInTaxDepColl = null;
		CP_APP_IN_TAX_DEPENDENTS_Cargo appInTaxDepCheckCargo = null;

		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);

			// PCR# 40362 Changes: To retail RMC flow

			// PCR# 40362 Changes Starts here: For RMB/SMIRF

			final String newPersonInd = (String) session.get("ADD_NEW_PERSON");

			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);
			// get the BeforeCollection

			final SortedSet inSchoolProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);

			beforeColl.get(AppConstants.FIRST_NAME);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inSchoolProfile);

			// Run Validations

			final TaxReturnBO taxBo = new TaxReturnBO();

			// Calling the Validator method

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();
			String indvSeq = String.valueOf(indvSeqNum);

			request.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			final CP_APP_IN_TAX_RETURN_Collection beforeAppInTaxInfoColl = (CP_APP_IN_TAX_RETURN_Collection) beforeColl
					.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);
			CP_APP_IN_TAX_RETURN_Cargo beforeInTaxInfoCargo = null;
			if (beforeAppInTaxInfoColl != null
					&& !beforeAppInTaxInfoColl.isEmpty()) {
				beforeInTaxInfoCargo = beforeAppInTaxInfoColl.getCargo(0);
				beforeInTaxInfoCargo.setApp_num(appNumber);
				indvSeqNumber = beforeInTaxInfoCargo.getIndv_seq_num();
				beforeInTaxInfoCargo.setIndv_seq_num(indvSeqNumber);
			}
			appBeforeTaxColl = (CP_APP_IN_TAX_DEPENDENTS_Collection) beforeColl
					.get(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION);

			String sourceAppIndicator = null;
			String recordInd = null;
			String spouseNm = FwConstants.EMPTY_STRING;

			// now we are checking for the before collection

			boolean inSchoolDetailsUpdate = false;

			if (beforeAppInTaxInfoColl != null
					&& !beforeAppInTaxInfoColl.isEmpty()) {
				final int size = beforeAppInTaxInfoColl.size();
				taxBo.deleteTaxDependentsRmcRecords(String.valueOf(indvSeqNum),
						appNumber);
/*				if (size > 1) {
					// if we have two records means cw and rm
					// now we are getting RM record to compare
					// now we need to update the data base if it dirty
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
					recordInd = FwConstants.ROWACTION_UPDATE;
					beforeInTaxInfoCargo = taxBo.splitTaxReturnInfoColl(
							beforeAppInTaxInfoColl, sourceAppIndicator);
					taxBo.splitTaxDependantInfoColl(appBeforeTaxColl,
							sourceAppIndicator);

				} else {*/
					// now we are checking this record is CW or RN
					sourceAppIndicator = AppConstants.CWW_RECORD_IND;
					beforeInTaxInfoCargo = taxBo.splitTaxReturnInfoColl(
							beforeAppInTaxInfoColl, sourceAppIndicator);
					taxBo.splitTaxDependantInfoColl(appBeforeTaxColl,
							sourceAppIndicator);

					if (beforeInTaxInfoCargo != null) {
						sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
						if(size >1)
							recordInd = FwConstants.ROWACTION_UPDATE;
						else
							recordInd = FwConstants.ROWACTION_INSERT;
						if (pageCollection
								.containsKey(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION)) {
							appInTaxInfoCollection = (CP_APP_IN_TAX_RETURN_Collection) pageCollection
									.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);
							appInTaxDepColl = (CP_APP_IN_TAX_DEPENDENTS_Collection) pageCollection
									.get(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION);
							for (final CP_APP_IN_TAX_DEPENDENTS_Cargo cargo : appInTaxDepColl
									.getResults()) {
								if (!Character.isDigit(cargo
										.getDependent_indv_seq_num().charAt(0))) {
									appInTaxDepColl.remove(cargo);
								}
							}
							for (final CP_APP_IN_TAX_DEPENDENTS_Cargo cargo : appInTaxDepColl
									.getResults()) {
								cargo.setApp_num(appNumber);
								cargo.setSrc_app_ind(sourceAppIndicator);
								cargo.setIndv_seq_num(String
										.valueOf(indvSeqNum));
								cargo.setRowAction(FwConstants.ROWACTION_INSERT);
								if (cargo.getEcp_id() == null
										|| cargo.getEcp_id().trim().length() == 0) {
									cargo.setEcp_id(FwConstants.ZERO);
								} else {
									cargo.setEcp_id(FwConstants.ONE);
								}
							}
						}

						// Filter Individuals -start
						final INDIVIDUAL_Custom_Collection indivCustCol = new INDIVIDUAL_Custom_Collection();
						final INDIVIDUAL_Custom_Collection i1 = peopleHandler
								.getAllIndividualsOnCase();
						for (int j = 0; j < i1.size(); j++) {							
							final INDIVIDUAL_Custom_Cargo c1 = (INDIVIDUAL_Custom_Cargo) i1
									.get(j);

							if (!c1.getIndv_seq_num()
									.toString().equals(indvSeqNumber)) {
								indivCustCol.add(c1);
							}
						}
						// Filter Individuals -end

						// For Check boxe is unchecked, is null I am setting it
						// to '0'(Zero)

						if (!FwConstants.ZERO.equalsIgnoreCase(String
								.valueOf(session
										.get(AppConstants.SPOUSE_SEQ_NUM)))) {
							spouseNm = taxBo.extractFirstName(appNumber,
									(String) session
									.get(AppConstants.SPOUSE_SEQ_NUM));
						}

						if (appInTaxInfoCollection != null
								&& !appInTaxInfoCollection.isEmpty()) {
							appInTaxInfoCargo = appInTaxInfoCollection
									.getCargo(0);
							appInTaxInfoCargo.setApp_num(appNumber);
							if (appInTaxInfoCargo.getJointly_file_sw() == null
									|| FwConstants.EMPTY_STRING
									.equalsIgnoreCase(appInTaxInfoCargo
											.getJointly_file_sw())) {
								appInTaxInfoCargo
								.setJointly_file_sw(FwConstants.NO);
							}
							if (!FwConstants.ZERO.equalsIgnoreCase(String
									.valueOf(session
											.get(AppConstants.SPOUSE_SEQ_NUM)))) {
								appInTaxInfoCargo
								.setSpouse_indv_id((String) session
										.get(AppConstants.SPOUSE_SEQ_NUM));
							} else {
								appInTaxInfoCargo
								.setSpouse_indv_id(FwConstants.ZERO);
							}
							boolean noOneFlag = indivCustCol.size()>=1?true:false;
							validateInfo = taxBo.validateTaxReturnDetail(
									appInTaxInfoCargo, peopleHandler, request,
									appInTaxDepColl, noOneFlag);
							if (validateInfo != null
									&& validateInfo.hasMessages()) {
								request.put(FwConstants.MESSAGE_LIST,
										validateInfo);
								pageCollection
								.put(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
										appInTaxInfoCollection);
								pageCollection
								.put(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION,
										appInTaxDepColl);
								pageCollection
								.put(FwConstants.PAGE_COMPONENT_LIST,
										beforeColl
										.get(FwConstants.PAGE_COMPONENT_LIST));
								pageCollection.put(
										AppConstants.INDV_SEQUENCE_NUMBERS,
										indvSeq);
								pageCollection.put(
										AppConstants.CURRENT_INDIV_SEQ_NUM,
										indvSeq);
								pageCollection.put("CurrentPageStatus",
										String.valueOf(currentPageStatus));
								pageCollection.put(AppConstants.FIRST_NAME,
										peopleHandler.getFirstName(indvSeq));
								pageCollection.put("PEOPLE", indivCustCol);
								pageCollection.put(AppConstants.SPOUSE_SEQ_NUM,
										spouseNm);
								pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
								if (FwConstants.ZERO
										.equalsIgnoreCase(String.valueOf(session
												.get(AppConstants.SPOUSE_SEQ_NUM)))) {
									request.put("spouseNotExist", true);
								}
								return;
							}
						}
						if (appInTaxDepColl != null
								&& !appInTaxDepColl.isEmpty()) {

							for (int i = 0; i < appInTaxDepColl.size(); i++) {
								appInTaxDepCheckCargo = appInTaxDepColl
										.getCargo(0);
								appInTaxDepCheckCargo.setApp_num(appNumber);

								validateInfo = taxBo.validateTaxDepDetail(
										appInTaxDepColl, peopleHandler,
										request, appInTaxInfoCargo, spouseNm);
								if (validateInfo != null
										&& validateInfo.hasMessages()) {
									request.put(FwConstants.MESSAGE_LIST,
											validateInfo);
									pageCollection
									.put(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
											appInTaxInfoCollection);
									pageCollection
									.put(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION,
											appInTaxDepColl);
									pageCollection
									.put(FwConstants.PAGE_COMPONENT_LIST,
											beforeColl
											.get(FwConstants.PAGE_COMPONENT_LIST));
									pageCollection.put(
											AppConstants.INDV_SEQUENCE_NUMBERS,
											indvSeq);
									pageCollection.put(
											AppConstants.CURRENT_INDIV_SEQ_NUM,
											indvSeq);
									pageCollection.put("CurrentPageStatus",
											String.valueOf(currentPageStatus));
									pageCollection
									.put(AppConstants.FIRST_NAME,
											peopleHandler
											.getFirstName(indvSeq));
									pageCollection.put(
											AppConstants.SPOUSE_SEQ_NUM,
											spouseNm);
									pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
									if (FwConstants.ZERO
											.equalsIgnoreCase(String.valueOf(session
													.get(AppConstants.SPOUSE_SEQ_NUM)))) {
										request.put("spouseNotExist", true);
									}
									pageCollection.put("PEOPLE", indivCustCol);
									return;

								}
							}
						}

					} else {
						sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
						recordInd = FwConstants.ROWACTION_UPDATE;
						beforeInTaxInfoCargo = taxBo.splitTaxReturnInfoColl(
								beforeAppInTaxInfoColl, sourceAppIndicator);
						if (pageCollection
								.containsKey(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION)) {
							appInTaxInfoCollection = (CP_APP_IN_TAX_RETURN_Collection) pageCollection
									.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);
							appInTaxDepColl = (CP_APP_IN_TAX_DEPENDENTS_Collection) pageCollection
									.get(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION);
							for (final CP_APP_IN_TAX_DEPENDENTS_Cargo cargo : appInTaxDepColl
									.getResults()) {
								if (!Character.isDigit(cargo
										.getDependent_indv_seq_num().charAt(0))) {
									appInTaxDepColl.remove(cargo);
								}
							}
							for (final CP_APP_IN_TAX_DEPENDENTS_Cargo cargo : appInTaxDepColl
									.getResults()) {
								cargo.setApp_num(appNumber);
								cargo.setSrc_app_ind(sourceAppIndicator);
								cargo.setIndv_seq_num(String
										.valueOf(indvSeqNum));
								cargo.setRowAction(FwConstants.ROWACTION_INSERT);
								if (cargo.getEcp_id() == null
										|| cargo.getEcp_id().trim().length() == 0) {
									cargo.setEcp_id(FwConstants.ZERO);
								} else {
									cargo.setEcp_id(FwConstants.ONE);
								}
							}
						}
						// Filter Individuals -start
						final INDIVIDUAL_Custom_Collection indivCustCol = new INDIVIDUAL_Custom_Collection();

						for (int j = 0; j < peopleHandler
								.getInHomeIndividuals().size(); j++) {
							final INDIVIDUAL_Custom_Collection i1 = peopleHandler
									.getAllIndividualsOnCase();
							final INDIVIDUAL_Custom_Cargo c1 = (INDIVIDUAL_Custom_Cargo) i1
									.get(j);

							if (!c1.getIndv_seq_num()
									.toString().equals(indvSeqNumber)) {
								indivCustCol.add(c1);
							}
						}
						// Filter Individuals -end

						// For Check boxe is unchecked, is null I am setting it
						// to '0'(Zero)

						if (!FwConstants.ZERO.equalsIgnoreCase(String
								.valueOf(session
										.get(AppConstants.SPOUSE_SEQ_NUM)))) {
							spouseNm = taxBo.extractFirstName(appNumber,
									(String) session
									.get(AppConstants.SPOUSE_SEQ_NUM));
						}

						if (appInTaxInfoCollection != null
								&& !appInTaxInfoCollection.isEmpty()) {
							appInTaxInfoCargo = appInTaxInfoCollection
									.getCargo(0);
							appInTaxInfoCargo.setApp_num(appNumber);
							if (appInTaxInfoCargo.getJointly_file_sw() == null
									|| FwConstants.EMPTY_STRING
									.equalsIgnoreCase(appInTaxInfoCargo
											.getJointly_file_sw())) {
								appInTaxInfoCargo
								.setJointly_file_sw(FwConstants.NO);
							}
							if (!FwConstants.ZERO.equalsIgnoreCase(String
									.valueOf(session
											.get(AppConstants.SPOUSE_SEQ_NUM)))) {
								appInTaxInfoCargo
								.setSpouse_indv_id((String) session
										.get(AppConstants.SPOUSE_SEQ_NUM));
							} else {
								appInTaxInfoCargo
								.setSpouse_indv_id(FwConstants.ZERO);
							}
							boolean noOneFlag = indivCustCol.size()>=1?true:false;
							validateInfo = taxBo.validateTaxReturnDetail(
									appInTaxInfoCargo, peopleHandler, request,
									appInTaxDepColl,noOneFlag);
							if (validateInfo != null
									&& validateInfo.hasMessages()) {
								request.put(FwConstants.MESSAGE_LIST,
										validateInfo);
								pageCollection
								.put(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
										appInTaxInfoCollection);
								pageCollection
								.put(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION,
										appInTaxDepColl);
								pageCollection
								.put(FwConstants.PAGE_COMPONENT_LIST,
										beforeColl
										.get(FwConstants.PAGE_COMPONENT_LIST));
								pageCollection.put(
										AppConstants.INDV_SEQUENCE_NUMBERS,
										indvSeq);
								pageCollection.put(
										AppConstants.CURRENT_INDIV_SEQ_NUM,
										indvSeq);
								pageCollection.put("CurrentPageStatus",
										String.valueOf(currentPageStatus));
								pageCollection.put(AppConstants.FIRST_NAME,
										peopleHandler.getFirstName(indvSeq));
								pageCollection.put("PEOPLE", indivCustCol);
								pageCollection.put(AppConstants.SPOUSE_SEQ_NUM,
										spouseNm);
								pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
								if (FwConstants.ZERO
										.equalsIgnoreCase(String.valueOf(session
												.get(AppConstants.SPOUSE_SEQ_NUM)))) {
									request.put("spouseNotExist", true);
								}
								return;
							}
						}
						if (appInTaxDepColl != null
								&& !appInTaxDepColl.isEmpty()) {

							for (int i = 0; i < appInTaxDepColl.size(); i++) {
								appInTaxDepCheckCargo = appInTaxDepColl
										.getCargo(0);
								appInTaxDepCheckCargo.setApp_num(appNumber);

								validateInfo = taxBo.validateTaxDepDetail(
										appInTaxDepColl, peopleHandler,
										request, appInTaxInfoCargo, spouseNm);
								if (validateInfo != null
										&& validateInfo.hasMessages()) {
									request.put(FwConstants.MESSAGE_LIST,
											validateInfo);
									pageCollection
									.put(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
											appInTaxInfoCollection);
									pageCollection
									.put(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION,
											appInTaxDepColl);
									pageCollection
									.put(FwConstants.PAGE_COMPONENT_LIST,
											beforeColl
											.get(FwConstants.PAGE_COMPONENT_LIST));
									pageCollection.put(
											AppConstants.INDV_SEQUENCE_NUMBERS,
											indvSeq);
									pageCollection.put(
											AppConstants.CURRENT_INDIV_SEQ_NUM,
											indvSeq);
									pageCollection.put("CurrentPageStatus",
											String.valueOf(currentPageStatus));
									pageCollection
									.put(AppConstants.FIRST_NAME,
											peopleHandler
											.getFirstName(indvSeq));
									pageCollection.put(
											AppConstants.SPOUSE_SEQ_NUM,
											spouseNm);
									pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
									if (FwConstants.ZERO
											.equalsIgnoreCase(String.valueOf(session
													.get(AppConstants.SPOUSE_SEQ_NUM)))) {
										request.put("spouseNotExist", true);
									}
									pageCollection.put("PEOPLE", indivCustCol);
									return;

								}
							}
						}
					}
//				}

				if (appInTaxInfoCargo == null) {
					final CP_APP_IN_TAX_RETURN_Collection appInTaxInfoCollectionTemp = (CP_APP_IN_TAX_RETURN_Collection) pageCollection
							.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);
					appInTaxInfoCargo = appInTaxInfoCollectionTemp.getCargo(0);
				}
				// check dirty
				appInTaxInfoCargo = (CP_APP_IN_TAX_RETURN_Cargo) isChanged(
						beforeInTaxInfoCargo, appInTaxInfoCargo);

				appInTaxInfoCargo.setIndv_seq_num(String.valueOf(indvSeqNum));
				appInTaxInfoCargo.setRowAction(recordInd);
				if (appInTaxInfoCargo.getEnd_dt() == null) {
					appInTaxInfoCargo.setSrc_app_ind(sourceAppIndicator);
				} else {

					appInTaxInfoCargo
					.setSrc_app_ind(AppConstants.RMC_END_RECORD_IND);
					appInTaxInfoCargo
					.setDpndts_outside_household_sw(FwConstants.NO);
					endInd = true;
				}

				if (appInTaxInfoCargo.getEcp_id() == null
						|| appInTaxInfoCargo.getEcp_id().trim().length() == 0) {
					appInTaxInfoCargo.setEcp_id(FwConstants.ZERO);
				} else {
					appInTaxInfoCargo.setEcp_id(FwConstants.ONE);
				}

				if (appInTaxInfoCargo.isDirty()) {
					inSchoolDetailsUpdate = true;
				}
			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;

				if (pageCollection
						.containsKey(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION)) {
					appInTaxInfoCollection = (CP_APP_IN_TAX_RETURN_Collection) pageCollection
							.get(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION);
					appInTaxDepColl = (CP_APP_IN_TAX_DEPENDENTS_Collection) pageCollection
							.get(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION);
					for (final CP_APP_IN_TAX_DEPENDENTS_Cargo cargo : appInTaxDepColl
							.getResults()) {
						if (!Character.isDigit(cargo
								.getDependent_indv_seq_num().charAt(0))) {
							appInTaxDepColl.remove(cargo);
						}
					}
					for (final CP_APP_IN_TAX_DEPENDENTS_Cargo cargo : appInTaxDepColl
							.getResults()) {
						cargo.setApp_num(appNumber);
						cargo.setSrc_app_ind(sourceAppIndicator);
						cargo.setIndv_seq_num(String.valueOf(indvSeqNum));
						cargo.setRowAction(FwConstants.ROWACTION_INSERT);
						if (cargo.getEcp_id() == null
								|| cargo.getEcp_id().trim().length() == 0) {
							cargo.setEcp_id(FwConstants.ZERO);
						} else {
							cargo.setEcp_id(FwConstants.ONE);
						}
					}
				}

				// For Check boxe is unchecked, is null I am setting it to
				// '0'(Zero)

				if (!FwConstants.ZERO.equalsIgnoreCase(String.valueOf(session
						.get(AppConstants.SPOUSE_SEQ_NUM)))) {
					spouseNm = taxBo.extractFirstName(appNumber,
							(String) session.get(AppConstants.SPOUSE_SEQ_NUM));
				}
				// Filter Individuals -start
				final INDIVIDUAL_Custom_Collection indivCustCol = new INDIVIDUAL_Custom_Collection();

				for (int j = 0; j < peopleHandler.getAllIndividualsOnCase().size(); j++) {
					final INDIVIDUAL_Custom_Collection i1 = peopleHandler
							.getAllIndividualsOnCase();
					final INDIVIDUAL_Custom_Cargo c1 = (INDIVIDUAL_Custom_Cargo) i1
							.get(j);

					if (!indvSeq.equals(c1.getIndv_seq_num().toString())) {
						indivCustCol.add(c1);
					}
				}
				// Filter Individuals -end

				if (appInTaxInfoCollection != null
						&& !appInTaxInfoCollection.isEmpty()) {
					appInTaxInfoCargo = appInTaxInfoCollection.getCargo(0);
					appInTaxInfoCargo.setApp_num(appNumber);
					if (appInTaxInfoCargo.getJointly_file_sw() == null
							|| FwConstants.EMPTY_STRING
							.equalsIgnoreCase(appInTaxInfoCargo
									.getJointly_file_sw())) {
						appInTaxInfoCargo.setJointly_file_sw(FwConstants.NO);
					}
					if (!FwConstants.ZERO.equalsIgnoreCase(String
							.valueOf(session.get(AppConstants.SPOUSE_SEQ_NUM)))) {
						appInTaxInfoCargo.setSpouse_indv_id((String) session
								.get(AppConstants.SPOUSE_SEQ_NUM));
					} else {
						appInTaxInfoCargo.setSpouse_indv_id(FwConstants.ZERO);
					}
					boolean noOneFlag = indivCustCol.size()>=1?true:false;
					validateInfo = taxBo.validateTaxReturnDetail(
							appInTaxInfoCargo, peopleHandler, request,
							appInTaxDepColl,noOneFlag);
					if (validateInfo != null && validateInfo.hasMessages()) {
						request.put(FwConstants.MESSAGE_LIST, validateInfo);
						pageCollection.put(
								AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
								appInTaxInfoCollection);
						pageCollection
						.put(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION,
								appInTaxDepColl);
						pageCollection
						.put(FwConstants.PAGE_COMPONENT_LIST,
								beforeColl
								.get(FwConstants.PAGE_COMPONENT_LIST));
						pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
								indvSeq);
						pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
								indvSeq);
						pageCollection.put("CurrentPageStatus",
								String.valueOf(currentPageStatus));
						pageCollection.put(AppConstants.FIRST_NAME,
								peopleHandler.getFirstName(indvSeq));
						pageCollection.put("PEOPLE", indivCustCol);
						pageCollection.put(AppConstants.SPOUSE_SEQ_NUM,
								spouseNm);
						pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
						if (FwConstants.ZERO.equalsIgnoreCase(String
								.valueOf(session
										.get(AppConstants.SPOUSE_SEQ_NUM)))) {
							request.put("spouseNotExist", true);
						}
						return;
					}
				}
				if (appInTaxDepColl != null && !appInTaxDepColl.isEmpty()) {

					for (int i = 0; i < appInTaxDepColl.size(); i++) {
						appInTaxDepCheckCargo = appInTaxDepColl.getCargo(0);
						appInTaxDepCheckCargo.setApp_num(appNumber);

						validateInfo = taxBo.validateTaxDepDetail(
								appInTaxDepColl, peopleHandler, request,
								appInTaxInfoCargo, spouseNm);
						if (validateInfo != null && validateInfo.hasMessages()) {
							request.put(FwConstants.MESSAGE_LIST, validateInfo);
							pageCollection
							.put(AppConstants.CP_APP_IN_TAX_RETURN_COLLECTION,
									appInTaxInfoCollection);
							pageCollection
							.put(AppConstants.CP_APP_IN_TAX_DEPENDENTS_COLLECTION,
									appInTaxDepColl);
							pageCollection
							.put(FwConstants.PAGE_COMPONENT_LIST,
									beforeColl
									.get(FwConstants.PAGE_COMPONENT_LIST));
							pageCollection
							.put(AppConstants.INDV_SEQUENCE_NUMBERS,
									indvSeq);
							pageCollection
							.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
									indvSeq);
							pageCollection.put("CurrentPageStatus",
									String.valueOf(currentPageStatus));
							pageCollection.put(AppConstants.FIRST_NAME,
									peopleHandler.getFirstName(indvSeq));
							pageCollection.put(AppConstants.SPOUSE_SEQ_NUM,
									spouseNm);
							if (FwConstants.ZERO.equalsIgnoreCase(String
									.valueOf(session
											.get(AppConstants.SPOUSE_SEQ_NUM)))) {
								request.put("spouseNotExist", true);
							}
							pageCollection.put("PEOPLE", indivCustCol);
							pageCollection.put("FST_TAXRET",
									beforeColl.get("FST_TAXRET"));
							pageCollection.put("PAGE_MODE",
									beforeColl.get("PAGE_MODE"));
							pageCollection.put("SEC_TAXRET",
									beforeColl.get("SEC_TAXRET"));
							return;

						}
					}
				}

				appInTaxInfoCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInTaxInfoCargo.setRowAction(recordInd);
				appInTaxInfoCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

				if (appInTaxInfoCargo.getEcp_id() == null
						|| appInTaxInfoCargo.getEcp_id().trim().length() == 0) {
					appInTaxInfoCargo.setEcp_id(FwConstants.ZERO);
				} else {
					appInTaxInfoCargo.setEcp_id(FwConstants.ONE);
				}
				inSchoolDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inSchoolProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}

			// now we need to check the flags
			if (inSchoolDetailsUpdate) {
				taxBo.storeTaxReturnDetails(appInTaxInfoCollection);

			}
			if (appInTaxDepColl != null && !appInTaxDepColl.isEmpty()) {

				taxBo.storeTaxDepDetails(appInTaxDepColl);

			}
			RMC_IN_PRFL_Collection rmcInPrflColl = new RMC_IN_PRFL_Collection();
			RMC_IN_PRFL_Cargo rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				rmcInPrflCargo = rmcResponseProfileManager.getProfile(
						rmcInPrflColl, String.valueOf(categorySeqDetailBean
								.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							IRMCResponseProfileManager.TAX_INFO_IND,
							rmcInPrflCargo, true);
				}
			}

			// Mark complete job sequence using common methods
			categorySelectionProfileManager.makeSequenceDetailComplete(
					inSchoolProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			final String spouseIndvSeqNum = taxBo.getSpouseIndvId(appNumber,
					String.valueOf(indvSeqNum));

			final Iterator it = inSchoolProfile.iterator();
			if (FwConstants.YES.equalsIgnoreCase(appInTaxInfoCargo
					.getJointly_file_sw())) {
				while (it.hasNext()) {
					final CategorySequenceDetail csd = (CategorySequenceDetail) it
							.next();
					if (spouseIndvSeqNum != null
							&& !FwConstants.EMPTY_STRING
							.equalsIgnoreCase(spouseIndvSeqNum)
							&& spouseIndvSeqNum.equalsIgnoreCase(String
									.valueOf(csd.getIndividualSequence()))) {
						csd.setStatus('C');
						RMC_IN_PRFL_Cargo rmcInPrflSpouseCargo = new RMC_IN_PRFL_Cargo();
						rmcInPrflSpouseCargo = rmcResponseProfileManager
								.getProfile(rmcInPrflColl, String.valueOf(csd
										.getIndividualSequence()));
						if (rmcInPrflSpouseCargo != null) {
							rmcResponseProfileManager.makeComplete(
									IRMCResponseProfileManager.TAX_INFO_IND,
									rmcInPrflSpouseCargo, true);
						}

						break;
					}
				}
			}
			if (categorySelectionProfileManager
					.areAllSequencesComplete(inSchoolProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);

			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inSchoolProfile);
			}
			
			
			
	       
	            SortedSet catprofileDB = categorySelectionProfileManager.loadCategoryChangeSelectionProfile(appNumber);
	            CP_APP_IN_TAX_RETURN_Collection taxReColl = taxBo.loadTaxReturnInfo(appNumber);
	            boolean isOHPageReq = false; 
	            
	            for(Object o : taxReColl){
	            	CP_APP_IN_TAX_RETURN_Cargo cargo = (CP_APP_IN_TAX_RETURN_Cargo) o;
	                if(cargo.getSrc_app_ind()!= null &&( cargo.getSrc_app_ind().equalsIgnoreCase(AppConstants.RMC_NEW_RECORD_IND)
	                        || cargo.getSrc_app_ind().equalsIgnoreCase(AppConstants.RMC_MODIFIED_RECORD_IND))
	                        && FwConstants.YES.equals(cargo.getDpndts_outside_household_sw())){
	                	isOHPageReq = true;
	                    break;
	                }
	            }
			
			
				indvSeq=String.valueOf(indvSeqNum);
				rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl,indvSeq );
						RMC_IN_PRFL_Collection rmcInPrflColltoUpdate = new RMC_IN_PRFL_Collection();
						final CP_APP_IN_TAX_RETURN_Collection taxReturnColl = taxBo
								.loadIndividualTaxDetailsAFB(appNumber, indvSeq);
						if (taxReturnColl != null && !taxReturnColl.isEmpty()) {
							/*
							 * VG SONAR Cleanup - 08/31/2015 Deleted 2 lines
							 * Commented Code in this block
							 */

							taxReturnCargo = taxBo.splitTaxReturnInfoColl(
									taxReturnColl,
									AppConstants.RMC_MODIFIED_RECORD_IND);
							if (taxReturnCargo == null) {
								taxReturnCargo = taxBo.splitTaxReturnInfoColl(
										taxReturnColl,
										AppConstants.RMC_NEW_RECORD_IND);
								if (taxReturnCargo == null) {
									taxReturnCargo = taxReturnColl.getCargo(0);
								}
							}

							if (taxReturnCargo != null
									&& FwConstants.YES
									.equalsIgnoreCase(taxReturnCargo
											.getDpndts_outside_household_sw())) {

						if(null != categorySelectionProfileManager.getCategorySequenceDetail(catprofileDB, Short.parseShort(taxReturnCargo.getIndv_seq_num()), categorySeqDetailBean.getCategorySequence(), AppConstants.TAX_DEPENDENT_CHANGE)){
		                    categorySelectionProfileManager.makeSequenceDetailRequired(catprofileDB, appNumber, Short.parseShort(taxReturnCargo.getIndv_seq_num()), categorySeqDetailBean.getCategorySequence(), AppConstants.TAX_DEPENDENT_CHANGE);
							} else {
		                    categorySelectionProfileManager.insertSequenceDetail(catprofileDB,
		                            appNumber,
		                            AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL, 
		                            Short.parseShort(taxReturnCargo.getIndv_seq_num()), categorySeqDetailBean.getCategorySequence(),
		                            AppConstants.TAX_DEPENDENT_CHANGE , 
		                            Short.parseShort("0"));
							}
		                driverManager.makeRequired(FwConstants.RMC_DRIVER, "ARTDP", driverArray, appNumber);
				} else {
			                if(null != categorySelectionProfileManager.getCategorySequenceDetail(catprofileDB, Short.parseShort(taxReturnCargo.getIndv_seq_num()), categorySeqDetailBean.getCategorySequence(), AppConstants.TAX_DEPENDENT_CHANGE)){
			                    categorySelectionProfileManager.removeSequenceDetail(catprofileDB, appNumber, Short.parseShort(taxReturnCargo.getIndv_seq_num()), categorySeqDetailBean.getCategorySequence(), AppConstants.TAX_DEPENDENT_CHANGE, AppConstants.TAX_DEPENDENT_CHANGE);
			                    taxBo.eraseTaxDependentsOH(taxReturnCargo.getApp_num(), taxReturnCargo.getIndv_seq_num(),taxReturnCargo.getSrc_app_ind());
								}
			                if(!isOHPageReq){
			                    driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
			                            "ARTDP", driverArray, appNumber);
							}
					}

				}

			if (endInd) {

				driverManager.makeAbsoluteNotRequired(FwConstants.RMC_DRIVER,
						"ARTDP", driverArray, appNumber);
			}

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeTaxReturnDetails:End");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeTaxReturnDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeTaxReturnDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeTaxReturnDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeTaxReturnDetails");
		}

		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.storeTaxReturnDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");

	}

	/**
	 * Load tax dependents outside details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void loadTaxDependentsOutsideDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.loadTaxDependentsOutsideDetails - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::loadTaxDependentsOutsideDetails:Start");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		String pageId = null;
		String previousPageId = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		int[] driverArray = null;
		String appNumber = null;
		int currentPageStatus = 0;
		String indvSeqNumber = null;
		String seqNumber = null;
		String userEndSelection = null;
		String pageMode = null;
		final String newPersonInd = (String) session.get("ADD_NEW_PERSON");
		INDIVIDUAL_Custom_Cargo indvCustCargo =null;
		String sexInd=null;

		try {
			if (pageCollection.get("CP_APP_IN_TAXDEPENDENTS_OH_Collection") != null) {
				/* Commenting method to fix defect 20424 - Jul292015 */
				pageCollection.remove("CP_APP_IN_TAXDEPENDENTS_OH_Collection");
			}
			if (session.get("CP_APP_IN_TAXDEPENDENTS_OH_Collection") != null) {
				session.remove("CP_APP_IN_TAXDEPENDENTS_OH_Collection");
			}
			if (request.get("CP_APP_IN_TAXDEPENDENTS_OH_Collection") != null) {
				request.remove("CP_APP_IN_TAXDEPENDENTS_OH_Collection");
			}
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(
					FwConstants.RMC_DRIVER, pageId, driverArray);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);
			final TaxReturnBO taxReturnBO = new TaxReturnBO();

			// build category selection profile
			SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			final Map catMappTypes = new HashMap();
			catMappTypes.put(AppConstants.TAX_DEPENDENT_CHANGE,
					AppConstants.TAX_DEPENDENT_CHANGE);

			if (currentPageStatus == FwConstants.DRIVER_REQUIRED
					|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& categorySelectionProfileManager.isEmpty(
							categorySelectionProfile, catMappTypes)) {
				categorySelectionProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
			}else if (currentPageStatus == FwConstants.DRIVER_COMPLETE
                    && !pageId.equals(previousPageId)
                    && categorySelectionProfileManager.isEmpty(
                            categorySelectionProfile, catMappTypes)) {
                categorySelectionProfile = categorySelectionProfileManager
                        .loadCategoryChangeSelectionProfile(appNumber,
                                AppConstants.RMC_CAT_EMP_PRFL);
			}

			RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
					.get(AppConstants.RMC_IN_PRFL_MASTER);
			previousPageId = (String) request.get(FwConstants.PREVIOUS_PAGE_ID);

			final short[] responseType = new short[] { IRMCResponseProfileManager.TAX_DEPENDENT_IND };
			SortedSet taxInfoDetailsProfile = null;
			boolean rnRecordFound = false;
			final String categType = AppConstants.TAX_DEPENDENT_INFO;

			if (!pageId.equals(previousPageId)) {
				taxInfoDetailsProfile = createPageProfileTax(
						categorySelectionProfile, rmcInPrflColl, responseType);
				taxInfoDetailsProfile.iterator();

				if (currentPageStatus != FwConstants.DRIVER_REQUIRED) {

					/**
					 * CP_APP_IN_TAXDEPENDENTS_OH_Collection taxDepInfoColl =
					 * taxReturnBO
					 * .loadTaxDependentOutsideDetailsAFB(appNumber);
					 */
					/**
					 * Updated logic to fetch
					 * CP_APP_IN_TAXDEPENDENTS_OH_Collection from pageCollection
					 * to retain the values after validation failure - 29Jul15
					 */
					/**
					 * CP_APP_IN_TAXDEPENDENTS_OH_Collection taxDepInfoColl =
					 * (CP_APP_IN_TAXDEPENDENTS_OH_Collection)
					 * pageCollection.get
					 * (AppConstants.CP_APP_IN_TAXDEPENDENTS_OH_Collection);
					 * if(null==taxDepInfoColl) {
					 */
					final CP_APP_IN_TAXDEPENDENTS_OH_Collection taxDepInfoColl = taxReturnBO
							.loadTaxDependentOutsideDetailsAFB(appNumber);

					CP_APP_IN_TAXDEPENDENTS_OH_Collection newTaxDepInfoColl = null;
					if (currentPageStatus != FwConstants.DRIVER_VISIT_AGAIN) {
						newTaxDepInfoColl = taxReturnBO
								.splitTaxDependentsOutsideColl(taxDepInfoColl,
										AppConstants.RMC_NEW_RECORD_IND);
						newTaxDepInfoColl.addAll(taxReturnBO
								.splitTaxDependentsOutsideColl(taxDepInfoColl,
										AppConstants.RMC_MODIFIED_RECORD_IND));
					}
					if (newTaxDepInfoColl != null
							&& !newTaxDepInfoColl.isEmpty()) {
						CP_APP_IN_TAXDEPENDENTS_OH_Cargo appInTaxDepCargo = null;
						final int newTaxDepInfoCollSize = newTaxDepInfoColl
								.size();
						rnRecordFound = true;

						for (int i = 0; i < newTaxDepInfoCollSize; i++) {
							appInTaxDepCargo = newTaxDepInfoColl.getResult(i);
							categorySelectionProfileManager
							.insertExistingSequenceDetail(
									taxInfoDetailsProfile, null, null,
									Short.parseShort(appInTaxDepCargo
											.getIndv_seq_num()),
											Short.parseShort(appInTaxDepCargo
													.getSeq_num()), categType);
						}
					} else {
						newTaxDepInfoColl = taxReturnBO
								.splitTaxDependentsOutsideColl(taxDepInfoColl,
										AppConstants.RMC_MODIFIED_RECORD_IND);
						if (newTaxDepInfoColl != null
								&& !newTaxDepInfoColl.isEmpty()) {
							CP_APP_IN_TAXDEPENDENTS_OH_Cargo appInTaxDepCargo = null;
							final int newTaxDepInfoCollSize = newTaxDepInfoColl
									.size();
							rnRecordFound = true;

							for (int i = 0; i < newTaxDepInfoCollSize; i++) {
								appInTaxDepCargo = newTaxDepInfoColl
										.getResult(i);
								categorySelectionProfileManager
								.insertExistingSequenceDetail(
										taxInfoDetailsProfile,
										null,
										null,
										Short.parseShort(appInTaxDepCargo
												.getIndv_seq_num()),
												(short) 0, categType);
							}
						}
					}
				}

				if (currentPageStatus == FwConstants.DRIVER_REQUIRED
						|| currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN) {
					// set the current record indicator to the first one
					categorySelectionProfileManager
					.setCurrentRecordIndToFirst(taxInfoDetailsProfile);
				}

				if (currentPageStatus == FwConstants.DRIVER_COMPLETE
						&& !taxInfoDetailsProfile.isEmpty()) {
					// set the current record indicator to the end of the detail
					// bean
					categorySelectionProfileManager
					.setCurrentRecordIndToLast(taxInfoDetailsProfile);
				}
				// create add new sorted set
				// we need to remove the vallues from the session
				session.remove(FwConstants.BEFORE_COLLECTION);
			} else {
				// catAddNewProfile get it from the before collection
				beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
				taxInfoDetailsProfile = (SortedSet) beforeColl
						.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			}

			IndivTypeSeqBean indivSeqBean = (IndivTypeSeqBean) pageCollection
					.get(FwConstants.DETAIL_KEY_BEAN);
			if (indivSeqBean == null
					&& currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN
					&& !pageId.equals(previousPageId)) {
				indivSeqBean = (IndivTypeSeqBean) session
						.get("TaxDepInfo_IndSeqBean");
			}
			// if details key bean not null means this bean is comming from the
			// summary page
			if (indivSeqBean != null) {
				final CategorySequenceDetail categorySeqDetail1 = categorySelectionProfileManager
						.getCategorySequenceDetail(
								taxInfoDetailsProfile,
								Short.parseShort(indivSeqBean.getIndivSeqNum()),
								Short.parseShort(indivSeqBean.getSeqNum()),
								AppConstants.TAX_DEPENDENT_CHANGE);
				if (categorySeqDetail1 != null) {
					if (categorySeqDetail1.getUserEndSelectionInd() != 1
							&& !rnRecordFound) {
						String userEndIndicator = indivSeqBean.getUserEndInd();
						if (userEndIndicator == null) {
							userEndIndicator = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.updateUserEndSelInd(taxInfoDetailsProfile,
								appNumber, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.TAX_DEPENDENT_CHANGE,
												Short.parseShort(userEndIndicator));
					}
					categorySelectionProfileManager.makeSequenceDetailRequired(
							taxInfoDetailsProfile, null,
							Short.parseShort(indivSeqBean.getIndivSeqNum()),
							Short.parseShort(indivSeqBean.getSeqNum()),
							AppConstants.TAX_DEPENDENT_CHANGE);
					final CategorySequenceDetail categorySeqDetail2 = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()), Short
											.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.TAX_DEPENDENT_CHANGE);
					if (categorySeqDetail2 != null) {
						if (categorySeqDetail2.getUserEndSelectionInd() != 1
								&& !rnRecordFound) {
							String userEndIndicator = indivSeqBean
									.getUserEndInd();
							if (userEndIndicator == null) {
								userEndIndicator = FwConstants.ZERO;
							}
							categorySelectionProfileManager
							.updateUserEndSelInd(
									categorySelectionProfile,
									appNumber, Short
									.parseShort(indivSeqBean
											.getIndivSeqNum()),
											Short.parseShort(indivSeqBean
													.getSeqNum()),
													AppConstants.TAX_DEPENDENT_CHANGE,
													Short.parseShort(userEndIndicator));
						}
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												AppConstants.TAX_DEPENDENT_CHANGE);
					}
				} else {
					if (FwConstants.ZERO.equals(indivSeqBean.getSeqNum())) {
						
							// first we are checking rnc in profile exists in
							// the sess
							RMC_IN_PRFL_Cargo rmcInPrflCargo = null;
							if (rmcInPrflColl != null) {
								rmcInPrflCargo = rmcResponseProfileManager
										.getProfile(rmcInPrflColl,
												indivSeqBean.getIndivSeqNum());
							} else {
								rmcInPrflColl = new RMC_IN_PRFL_Collection();
							}
							if (rmcInPrflCargo == null) {
								rmcInPrflCargo = new RMC_IN_PRFL_Cargo();
								rmcInPrflCargo.setApp_num(appNumber);
								rmcInPrflCargo.setIndv_seq_num(indivSeqBean
										.getIndivSeqNum());
								rmcResponseProfileManager
								.createRMCIndividualProfile(rmcInPrflCargo);
								rmcInPrflColl.addCargo(rmcInPrflCargo);
							}
		                        // now we need to make required the employment
		                        if (AppConstants.EMPL_REGULAR.equals(indivSeqBean
		                                .getType())) {
		                            rmcResponseProfileManager.makeAddNew(
									IRMCResponseProfileManager.TAX_DEPENDENT_IND,
									rmcInPrflCargo, true);
											}

									categorySelectionProfileManager
		                        .insertSequenceDetail(taxInfoDetailsProfile, null,
		                                null, Short.parseShort(indivSeqBean
													.getIndivSeqNum()),
		                                        indivSeqBean.getType());
						session.put(AppConstants.RMC_IN_PRFL_MASTER,
								rmcInPrflColl);
					} else {
						String userEndInd = indivSeqBean.getUserEndInd();
						if (userEndInd == null) {
							userEndInd = FwConstants.ZERO;
						}
						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								taxInfoDetailsProfile,
								null,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								taxInfoDetailsProfile, null, Short
								.parseShort(indivSeqBean
										.getIndivSeqNum()),
										Short.parseShort(indivSeqBean
												.getSeqNum()), indivSeqBean
												.getType());

						categorySelectionProfileManager
						.insertExistingSequenceDetail(
								categorySelectionProfile,
								appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType(), Short
												.parseShort(userEndInd));
						categorySelectionProfileManager
						.makeSequenceDetailRequired(
								categorySelectionProfile, appNumber,
								Short.parseShort(indivSeqBean
										.getIndivSeqNum()), Short
										.parseShort(indivSeqBean
												.getSeqNum()),
												indivSeqBean.getType());
					}
				}
			}
			pageCollection.put(AppConstants.RMC_CATEGORY_PAGE_PRFL,
					taxInfoDetailsProfile);

			CategorySequenceDetail categorySeqDetail = categorySelectionProfileManager
					.getCurrentSequenceDetail(taxInfoDetailsProfile);
			if (categorySeqDetail == null) {
				categorySeqDetail = categorySelectionProfileManager
						.getNextSequenceDetail(taxInfoDetailsProfile);
			}
			if (categorySeqDetail != null) {
				indvSeqNumber = Short.toString(categorySeqDetail
						.getIndividualSequence());
				seqNumber = Long.toString(categorySeqDetail
						.getCategorySequence());
				userEndSelection = Long.toString(categorySeqDetail
						.getUserEndSelectionInd());
			} else {
				if (categorySelectionProfile != null) {
					// this one form the category selection profile
					final Iterator iter = categorySelectionProfile.iterator();
					CategorySequenceDetail categorySeqDtl = null;
					while (iter.hasNext()) {
						categorySeqDtl = (CategorySequenceDetail) iter.next();
					}
					/*
					 * VG SONAR Cleanup - 08/31/2015 Deleted 1,2 lines Commented
					 * Code in this block
					 */

					indvSeqNumber = Short.toString(categorySeqDtl
							.getIndividualSequence());
					seqNumber = Long.toString(categorySeqDtl
							.getCategorySequence());
					userEndSelection = Long.toString(categorySeqDtl
							.getUserEndSelectionInd());
				}
			}

			CP_APP_IN_TAXDEPENDENTS_OH_Collection appInTaxDepColl;
			/* Modifications to fix defect 20424 - Jul292015 */

			if (seqNumber != null && !FwConstants.ZERO.equals(seqNumber.trim())) {
				appInTaxDepColl = taxReturnBO.loadTaxDepResponse(appNumber,
						indvSeqNumber, seqNumber);
			} else {
				appInTaxDepColl = taxReturnBO.loadTaxDepResponse(appNumber,
						indvSeqNumber);
			}
			if (request.get("loopingQuestion") == null
					|| !FwConstants.YES.equalsIgnoreCase((String) request
							.get("loopingQuestion"))) {
				pageCollection.put(
						AppConstants.CP_APP_IN_TAXDEPENDENTS_OH_COLLECTION,
						appInTaxDepColl);
			}

			CP_APP_IN_TAXDEPENDENTS_OH_Cargo cwwInTaxDepCargo = taxReturnBO
					.splitTaxDepColl(appInTaxDepColl,
							AppConstants.CWW_RECORD_IND);

			if (cwwInTaxDepCargo == null) {
				cwwInTaxDepCargo = new CP_APP_IN_TAXDEPENDENTS_OH_Cargo();
			}
			pageCollection.put("SEC_TAX_DEP",
					taxReturnBO.settingDefaultValues(cwwInTaxDepCargo));

			CP_APP_IN_TAXDEPENDENTS_OH_Cargo rmcInTaxDepCargo = taxReturnBO
					.splitTaxDepColl(appInTaxDepColl,
							AppConstants.RMC_NEW_RECORD_IND);
			if (rmcInTaxDepCargo != null) {
				pageCollection.put("FST_MEDA",
						taxReturnBO.settingDefaultValues(rmcInTaxDepCargo));
			} else {
				rmcInTaxDepCargo = taxReturnBO.splitTaxDepColl(appInTaxDepColl,
						AppConstants.RMC_MODIFIED_RECORD_IND);
				if (rmcInTaxDepCargo != null) {
					pageCollection.put("FST_MEDA",
							taxReturnBO.settingDefaultValues(rmcInTaxDepCargo));
				} else if (!appInTaxDepColl.isEmpty()) {
					pageCollection.put("FST_MEDA", taxReturnBO
							.settingDefaultValues(appInTaxDepColl.getCargo(0)));
				} else {
					final CP_APP_IN_TAXDEPENDENTS_OH_Cargo cargoToPreventBreak = new CP_APP_IN_TAXDEPENDENTS_OH_Cargo();
					pageCollection.put("FST_MEDA", taxReturnBO
							.settingDefaultValues(cargoToPreventBreak));
				}

			}

			String srcAppInd = FwConstants.EMPTY_STRING;

			if (appInTaxDepColl != null && !appInTaxDepColl.isEmpty()) {
				final CP_APP_IN_TAXDEPENDENTS_OH_Cargo appInTaxDepCargo = appInTaxDepColl
						.getResult(0);
				srcAppInd = appInTaxDepCargo.getSrc_app_ind();
			}

			if (("CW".equalsIgnoreCase(srcAppInd) || "RM"
					.equalsIgnoreCase(srcAppInd))
					&& FwConstants.ZERO.equals(userEndSelection)) {
				pageMode = "C";
			}

			if (FwConstants.ONE.equals(userEndSelection))
			/*
				 * VG SONAR Cleanup - 08/31/2015 Deleted 3,3 lines Commented Code in
				 * this block
				 */

			{
				pageMode = "E";
			} else if (indivSeqBean != null
					&& indivSeqBean.getUserEndInd() != null) {
				if (FwConstants.ONE.equalsIgnoreCase(indivSeqBean
						.getUserEndInd()))

				{
					pageMode = "E";
				} else if (FwConstants.ZERO
						.equals(indivSeqBean.getUserEndInd())
						&& "RM".equalsIgnoreCase(srcAppInd)
						|| "CW".equalsIgnoreCase(srcAppInd)) {
					pageMode = "C";
				} else {
					pageMode = FwConstants.NO;
				}
			} else if (!("C".equalsIgnoreCase(pageMode) || "E"
					.equalsIgnoreCase(pageMode))) {
				pageMode = FwConstants.NO;
			}

			if (FwConstants.YES.equals(newPersonInd)) {
				pageMode = FwConstants.NO;
			}
			final String pageModeInd = (String) session.get("LOOPING_MODE");
			if (FwConstants.NO.equals(pageModeInd)) {
				pageMode = FwConstants.NO;
			}
			pageCollection.put("PAGE_MODE", pageMode);

			// set first name to page collection
			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			if(indvSeqNumber !=null){
				indvCustCargo =peopleHandler.getIndividual(indvSeqNumber);
				if(indvCustCargo!=null){
					sexInd=indvCustCargo.getSex_ind();					
				}					
			}

			// This code is added for the enhancement
			final INDIVIDUAL_Custom_Cargo indvCargo = peopleHandler
					.getIndividual(indvSeqNumber);
			final INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
			indvCustColl.addCargo(indvCargo);
			pageCollection.put("PEOPLE_362", indvCustColl);
			String immuneStatus = "false";
			final short[] programKeyArray = (short[]) session
					.get(FwConstants.RMC_PROGRAM_KEY);
			final short tanf = 9;
			if (programKeyArray[tanf] != 0) {
				final IndividualAge indvAge = indvCargo.getIndv_age();
				if (indvAge.getYears() <= 18) {
					immuneStatus = "true";
				}
			}
			pageCollection.put("DISPLAY_IMMUNIZATION", immuneStatus);
			pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
					indvSeqNumber);
			pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
					indvSeqNumber);
			// PCR 30421 - Added first name to the pagecollection to use in JSP
			pageCollection.put(AppConstants.FIRST_NAME,
					peopleHandler.getFirstName(indvSeqNumber));
			txnBean.setPageCollection(pageCollection);
			
			//Getting the relation map based on gender specific 
			if(sexInd!=null){
				Map<String,String> relationMapEN= new HashMap<>();
				Map<String,String> relationMapES= new HashMap<>();
				final IReferenceTableManager iref = ReferenceTableManager.getInstance();
				IReferenceTableData refDataEN = null;
				IReferenceTableData refDataES = null;
				int[] filterColumnId = { 66 };
				String[] filterValue = new String[1];
				if(AppConstants.SEX_IND_MALE.equals(sexInd)){
					  filterValue[0]=AppConstants.SEX_IND_FEMALE;
					}else{
					 filterValue[0]=AppConstants.SEX_IND_MALE;
					}
				refDataEN = iref.filterDataOnSingleColumn("TREL",
						AppConstants.EN, filterColumnId[0],
						IReferenceConstants.FILTER_EXCLUDE_MATCH_ONE, filterValue);
				refDataES = iref.filterDataOnSingleColumn("TREL",
						AppConstants.ES, filterColumnId[0],
						IReferenceConstants.FILTER_EXCLUDE_MATCH_ONE, filterValue);
				// Relation map for English for Gender Specific
				if(refDataEN !=null){
				final String[] codeEN = refDataEN.getCodeValues();
				final String[] descEN = refDataEN.getDescriptionValues(65);
				final int lenEN = codeEN.length;
				for (int i = 0; i < lenEN; i++) {
					if(!codeEN[i].equals(AppConstants.SEL)){
						relationMapEN.put(codeEN[i],descEN[i]);
					}
				 }
			 }
				// Relation map for Spanish for Gender Specific
				if(refDataES !=null){
					final String[] codeES = refDataES.getCodeValues();
					final String[] descES = refDataES.getDescriptionValues(65);
					final int lenEN = codeES.length;
					for (int i = 0; i < lenEN; i++) {
						if(!codeES[i].equals(AppConstants.SEL)){
							relationMapES.put(codeES[i],descES[i]);
						}
					 }
				 }
				ObjectWriter ow = new ObjectMapper().writer().withDefaultPrettyPrinter();
				pageCollection.put("relationMapEN",ow.writeValueAsString(relationMapEN));
				pageCollection.put("relationMapES",ow.writeValueAsString(relationMapES));
				pageCollection.put(AppConstants.SEX_IND, sexInd);
				
				
			}
			
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			// Calling Component Manager for Page components
			componentManager.getComponents(pageId, txnBean);
			// Checking for Before Collection is Null
			if (beforeColl == null) {
				beforeColl = new HashMap();
			}

			beforeColl.putAll(pageCollection);
			session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
			if (session.containsKey("LOOPING_MODE")) {
				session.remove("LOOPING_MODE");
			}
			
			

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::loadTaxDependentsOutsideDetails");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("loadTaxDependentsOutsideDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadTaxDependentsOutsideDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"loadTaxDependentsOutsideDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "loadTaxDependentsOutsideDetails");
		}

		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.loadTaxDependentsOutsideDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Store tax dependents outside details.
	 *
	 * @param txnBean the txn bean
	 * @throws javax.ejb.EJBException the EJB exception
	 */
	public void storeTaxDependentsOutsideDetails(final FwTransaction txnBean)
			throws javax.ejb.EJBException {
		final long startTime = System.currentTimeMillis();
		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.storeTaxDependentsOutsideDetails() - START");
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean::storeTaxDependentsOutsideDetails");
		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		int[] driverArray = null;
		String appNumber = null;
		Map beforeColl = null;
		PeopleHandler peopleHandler = null;
		String pageId = null;
		FwMessageList validateMsg = new FwMessageList();
		String changeEffDate = null;

		try {
			// Get the status of the Driver from Session
			driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
			// Get the current Page Id from the Request
			pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
			// Get the APP_NUM from the Session
			appNumber = (String) session.get(AppConstants.APP_NUMBER);
			// Get the before Collection from the Session
			beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
			final String pageMode = (String) beforeColl.get("PAGE_MODE");

			// build category selection profile
			final SortedSet categorySelectionProfile = (SortedSet) session
					.get(AppConstants.RMC_CATEGORY_PROFILE_MASTER);

			// get the BeforeCollection
			 SortedSet inTaxDepProfile = (SortedSet) beforeColl
					.get(AppConstants.RMC_CATEGORY_PAGE_PRFL);
			if(inTaxDepProfile.isEmpty()){				
				inTaxDepProfile = categorySelectionProfileManager
						.loadCategoryChangeSelectionProfile(appNumber,
								AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL,
								AppConstants.TAX_DEPENDENT_CHANGE);
			}
				
			final CP_APP_IN_TAXDEPENDENTS_OH_Collection appInTaxDepCollection = (CP_APP_IN_TAXDEPENDENTS_OH_Collection) pageCollection
					.get("CP_APP_IN_TAXDEPENDENTS_OH_Collection");
			CP_APP_IN_TAXDEPENDENTS_OH_Cargo appInTaxDepCargo = appInTaxDepCollection
					.getResult(0);

			beforeColl.get(AppConstants.FIRST_NAME);
			final String currentPageID = (String) request
					.get(FwConstants.CURRENT_PAGE_ID);

			final CategorySequenceDetail categorySeqDetailBean = categorySelectionProfileManager
					.getCurrentSequenceDetail(inTaxDepProfile);

			final TaxReturnBO taxReturnBO = new TaxReturnBO();

			peopleHandler = (PeopleHandler) session
					.get(AppConstants.INDIV_MASTER_HANDLER);
			final short indvSeqNum = categorySeqDetailBean
					.getIndividualSequence();

			final String backToMyAccess = (String) request
					.get(AppConstants.BACK_TO_MY_ACCESS_BUTTON);

			// Call Validator
			final ARTDPValidator artdpValidator = new ARTDPValidator();
			if (backToMyAccess == null) {
				validateMsg = artdpValidator
						.validateTaxDepDetails(appInTaxDepCargo);

			}

			final CP_APP_IN_TAXDEPENDENTS_OH_Collection beforeAppInTaxDepColl = (CP_APP_IN_TAXDEPENDENTS_OH_Collection) beforeColl
					.get("CP_APP_IN_TAXDEPENDENTS_OH_Collection");

			if (checkBackToMyAccessSelected(request) || validateMsg != null
					&& validateMsg.hasMessages()) {

				if (backToMyAccess == null) {
					request.put(FwConstants.MESSAGE_LIST,
							artdpValidator.getMessageList());
				}
				/*
				 * Added to have values populating post validation failure -
				 * Jul302015
				 */
				final CP_APP_IN_TAXDEPENDENTS_OH_Collection collectoinTogetCargo = (CP_APP_IN_TAXDEPENDENTS_OH_Collection) pageCollection
						.get("CP_APP_IN_TAXDEPENDENTS_OH_Collection");
				final CP_APP_IN_TAXDEPENDENTS_OH_Cargo cargoToPass = collectoinTogetCargo
						.getCargo(0);

				pageCollection.put(AppConstants.FIRST_NAME,
						beforeColl.get(AppConstants.FIRST_NAME));
				pageCollection.put("FST_MEDA", cargoToPass);
				pageCollection.put("PAGE_MODE", beforeColl.get("PAGE_MODE"));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST,
						beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
				pageCollection.put("ShowLoopingQuestionFlag",
						beforeColl.get("ShowLoopingQuestionFlag"));
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,
						String.valueOf(indvSeqNum));
				pageCollection.put(AppConstants.FIRST_NAME,
						peopleHandler.getFirstName(String.valueOf(indvSeqNum)));
				pageCollection
				.put("SEC_TAX_DEP", beforeColl.get("SEC_TAX_DEP"));
				pageCollection.put("relationMapEN", beforeColl.get("relationMapEN"));
				pageCollection.put("relationMapES", beforeColl.get("relationMapES"));
				pageCollection.put(AppConstants.SEX_IND, beforeColl.get(AppConstants.SEX_IND));
				

				return;
			}

			appInTaxDepCargo.setApp_num(appNumber);
			appInTaxDepCargo.setIndv_seq_num(String.valueOf(indvSeqNum));

			// For Check boxe is unchecked, is null I am setting it to '0'(Zero)
			if (appInTaxDepCargo.getDate_of_birth() == null
					|| appInTaxDepCargo.getDate_of_birth().trim().length() == 0) {
				appInTaxDepCargo.setDate_of_birth(FwConstants.SPACE);
			} else {
				appInTaxDepCargo.setDate_of_birth(displayFormatter
						.getYYYYMMDDDate(appInTaxDepCargo.getDate_of_birth()));
			}

			if (appInTaxDepCargo.getEcp_id() == null
					|| appInTaxDepCargo.getEcp_id().trim().length() == 0) {
				appInTaxDepCargo.setEcp_id(FwConstants.ZERO);
			} else {
				appInTaxDepCargo.setEcp_id(FwConstants.ONE);
			}

			CP_APP_IN_TAXDEPENDENTS_OH_Cargo beforeAppInTaxDepCargo = null;

			String sourceAppIndicator = null;
			String recordInd = null;
			boolean changeProfileUpdate = false;

			// now we are checking for the before collection
			boolean taxDepDetailsUpdate = false;

			if (beforeAppInTaxDepColl != null
					&& !beforeAppInTaxDepColl.isEmpty()) {
				final int size = beforeAppInTaxDepColl.size();
				if ("C".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_MODIFIED_RECORD_IND;
				} else if ("E".equalsIgnoreCase(pageMode)) {
					sourceAppIndicator = AppConstants.RMC_END_RECORD_IND;
				} else {
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				}
				beforeAppInTaxDepCargo = taxReturnBO.splitTaxDepColl(
						beforeAppInTaxDepColl, sourceAppIndicator);
				if (beforeAppInTaxDepCargo == null
						&& (AppConstants.RMC_MODIFIED_RECORD_IND
								.equals(sourceAppIndicator) || AppConstants.RMC_END_RECORD_IND
								.equals(sourceAppIndicator))) {
					beforeAppInTaxDepCargo = taxReturnBO.splitTaxDepColl(
							beforeAppInTaxDepColl, AppConstants.CWW_RECORD_IND);
				}
				final String loopingMode = (String) session.get("LOOPING_MODE");
				if (loopingMode != null && FwConstants.NO.equals(loopingMode)) {
					sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;
				}
				if (size > 1) {
					// if we have two records means cw and rm or cw and re
					// now we are getting RM/RE record to compare
					// now we need to update the data base if it dirty
					recordInd = FwConstants.ROWACTION_UPDATE;
				} else {
					// now we are checking this record is CW or RN
					recordInd = FwConstants.ROWACTION_INSERT;
					if (AppConstants.RMC_NEW_RECORD_IND
							.equals(sourceAppIndicator)
							&& beforeAppInTaxDepCargo != null) {
						recordInd = FwConstants.ROWACTION_UPDATE;
					}
				}

				if (recordInd == FwConstants.ROWACTION_UPDATE) {
					changeProfileUpdate = true;
				}
				// check dirty
				if (beforeAppInTaxDepCargo != null) {
					// Source App Indicator set to 'RM' and the default values
					// for appInSelfeCargo populated from the before cargo
					appInTaxDepCargo.setSrc_app_ind(beforeAppInTaxDepCargo
							.getSrc_app_ind());
					appInTaxDepCargo.setIndv_seq_num(beforeAppInTaxDepCargo
							.getIndv_seq_num());
					appInTaxDepCargo.setSeq_num(beforeAppInTaxDepCargo
							.getSeq_num());
				}

				if ("E".equalsIgnoreCase(pageMode)) {
					appInTaxDepCargo.setFirst_name(beforeAppInTaxDepCargo
							.getFirst_name());
					appInTaxDepCargo.setLast_name(beforeAppInTaxDepCargo
							.getLast_name());
					appInTaxDepCargo.setDate_of_birth(beforeAppInTaxDepCargo
							.getDate_of_birth());
					appInTaxDepCargo.setSsn(beforeAppInTaxDepCargo.getSsn());
					appInTaxDepCargo
					.setRelationship_wth_filer(beforeAppInTaxDepCargo
							.getRelationship_wth_filer());
					appInTaxDepCargo
					.setAvg_monthly_earned_inc(beforeAppInTaxDepCargo
							.getAvg_monthly_earned_inc());
					appInTaxDepCargo
					.setAvg_mnthly_unearned_inc(beforeAppInTaxDepCargo
							.getAvg_mnthly_unearned_inc());
					appInTaxDepCargo.setPregnant_sw(beforeAppInTaxDepCargo
							.getPregnant_sw());
					appInTaxDepCargo.setNumber_of_babies(beforeAppInTaxDepCargo
							.getNumber_of_babies());

				}

				// check dirty
				appInTaxDepCargo = (CP_APP_IN_TAXDEPENDENTS_OH_Cargo) isChanged(
						beforeAppInTaxDepCargo, appInTaxDepCargo);
				if (appInTaxDepCargo.isDirty()) {
					appInTaxDepCargo.setSrc_app_ind(sourceAppIndicator);
					appInTaxDepCargo.setRowAction(recordInd);

					taxDepDetailsUpdate = true;
					// EDSP RMB

					if (changeEffDate == null) {
						changeEffDate = AppConstants.HIGH_DATE;
					}

				}
			} else {
				// if there is no before collection means this is new record
				sourceAppIndicator = AppConstants.RMC_NEW_RECORD_IND;

				appInTaxDepCargo.setSrc_app_ind(sourceAppIndicator);
				recordInd = FwConstants.ROWACTION_INSERT;

				appInTaxDepCargo.setRowAction(recordInd);

				taxDepDetailsUpdate = true;

				// insert into RMC_SELECTION_PROFILE using Common Mehod()
				categorySelectionProfileManager.updateSequence(inTaxDepProfile,
						null, categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

				categorySelectionProfileManager.updateSequence(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						(short) 0, categorySeqDetailBean.getCategoryType());

			}

			// now we need to check the flags
			if (taxDepDetailsUpdate) {

				if (FwConstants.ROWACTION_INSERT.equals(appInTaxDepCargo
						.getRowAction())) {

					taxReturnBO.insertExistingDetails(appInTaxDepCollection);
				} else {
					taxReturnBO
					.storeTaxDepOutsideDetails(appInTaxDepCollection);
				}

			}

			// now i need to update the rmc_in_prfl
			if (categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {

				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
				if (rmcInPrflCargo != null) {
					rmcResponseProfileManager.makeComplete(
							 rmcResponseProfileManager
	                            .getResponseByType(
							IRMCResponseProfileManager.TAX_DEPENDENT_IND,
	                                    categorySeqDetailBean
	                                    .getCategoryType()),
							rmcInPrflCargo, true);
				}
			}

			categorySelectionProfileManager.makeSequenceDetailComplete(
					inTaxDepProfile, null,
					categorySeqDetailBean.getIndividualSequence(),
					categorySeqDetailBean.getCategorySequence(),
					categorySeqDetailBean.getCategoryType());
			if (categorySelectionProfile != null) {
				categorySelectionProfileManager.makeSequenceDetailComplete(
						categorySelectionProfile, appNumber,
						categorySeqDetailBean.getIndividualSequence(),
						categorySeqDetailBean.getCategorySequence(),
						categorySeqDetailBean.getCategoryType());
			}

			// Looping
			boolean loopingQuestion = false;
			if (request.get("loopingQuestion") != null
					&& FwConstants.YES.equals(request.get("loopingQuestion"))) {
				loopingQuestion = true;
				categorySeqDetailBean.setStatus('R');
				/*
				 * Updated logic to check for existing sequence detail before
				 * inserting new one -- 16Sep15 - Srividhya
				 */
				CategorySequenceDetail catseqDet = null;
				if (!categorySelectionProfile.isEmpty()) {
					catseqDet = categorySelectionProfileManager
							.getCategorySequenceDetail(
									categorySelectionProfile,
									categorySeqDetailBean
									.getIndividualSequence(),
									(short) 0, categorySeqDetailBean
									.getCategoryType());
				}
				if (catseqDet != null) {
					categorySelectionProfileManager.removeSequenceDetail(
							categorySelectionProfile, appNumber,
							categorySeqDetailBean.getIndividualSequence(),
							(short) 0, categorySeqDetailBean.getCategoryType());
					categorySelectionProfileManager.insertSequenceDetail(
							categorySelectionProfile, appNumber, "C",
							categorySeqDetailBean.getIndividualSequence(),
							categorySeqDetailBean.getCategoryType());
				} else {
					categorySelectionProfileManager.insertSequenceDetail(
							categorySelectionProfile, appNumber, "C",
							categorySeqDetailBean.getIndividualSequence(),
							categorySeqDetailBean.getCategoryType());
				}
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
				session.put("LOOPING_MODE", FwConstants.NO);
			}

			// now i need to update the rmc_in_prfl if looping question is null
			if (!loopingQuestion
					&& categorySeqDetailBean.getChangeSelectionCategoryCd() == null) {
				final RMC_IN_PRFL_Collection rmcInPrflColl = (RMC_IN_PRFL_Collection) session
						.get(AppConstants.RMC_IN_PRFL_MASTER);
				final RMC_IN_PRFL_Cargo rmcInPrflCargo = rmcResponseProfileManager
						.getProfile(rmcInPrflColl, String
								.valueOf(categorySeqDetailBean
										.getIndividualSequence()));
//				if (rmcInPrflCargo != null) {
//					rmcResponseProfileManager.makeComplete(
//							IRMCResponseProfileManager.TAX_DEPENDENT_IND,
//							rmcInPrflCargo, true);
//				}
			}
			/*if (!changeProfileUpdate) {
				final RMC_CHG_SEL_PRFL_Collection newRmcSelPrflCollection = new RMC_CHG_SEL_PRFL_Collection();
				final RMC_CHG_SEL_PRFL_Cargo newCHGCargo = new RMC_CHG_SEL_PRFL_Cargo();
				newCHGCargo.setApp_num(appNumber);
				newCHGCargo
				.setIndv_seq_num(String.valueOf(categorySeqDetailBean
						.getIndividualSequence()));
				newCHGCargo.setCat_seq_num(String.valueOf(categorySeqDetailBean
						.getCategorySequence()));
				newCHGCargo
				.setChg_sel_cat_cd(AppConstants.RMC_CAT_OTHER_BENEFITS_PRFL);
				newCHGCargo.setCat_typ(AppConstants.TAX_DEPENDENT_CHANGE);
				newCHGCargo.setStat_ind("C");
				newCHGCargo.setUser_end_sel_ind(FwConstants.ZERO);
				newRmcSelPrflCollection.add(newCHGCargo);
				newCHGCargo.setRowAction("I");
				try {
					newRmcSelPrflCollection.persist(FwConstants.DAO);
				} catch (final FwException e) {
					throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(e, getClass().getName(), "storeTaxDependentsOutsideDetails");
				}
			}*/

			// Mark complete job sequence using common methods

			if (categorySelectionProfileManager
					.areAllSequencesComplete(inTaxDepProfile)) {
				driverManager.makeComplete(FwConstants.RMC_DRIVER, pageId,
						driverArray, appNumber);
			} else {
				categorySelectionProfileManager
				.getNextSequenceDetail(inTaxDepProfile);
			}
			if (loopingQuestion) {
				driverManager.makeRequired(FwConstants.RMC_DRIVER,
						currentPageID, driverArray, appNumber);
			}

			// here
			/*
			 * VG SONAR Cleanup - 08/31/2015 Deleted 3 lines Commented Code in
			 * this block
			 */

			log(ILog.INFO,
					"RMCHouseHoldInfoEJBBean::storeTaxDependentsOutsideDetails");
		} catch (final FwException fe) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwWrappedException we = new FwWrappedException(fe);
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeTaxDependentsOutsideDetails");
			we.setFwException(fe);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeTaxDependentsOutsideDetails");
		} catch (final Exception e) {
			if (ctx != null) {
				ctx.setRollbackOnly();
			}
			final FwException fe = createFwException(this.getClass().getName(),
					"storeTaxDependentsOutsideDetails", e);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(e, getClass().getName(), "storeTaxDependentsOutsideDetails");
		}

		log(ILog.DEBUG,
				"RMCHouseHoldInfoEJBBean.storeTaxDependentsOutsideDetails() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ " milliseconds");
	}

	/**
	 * Method gets welcome back.
	 *
	 * @param txnBean the txn bean
	 */
	//TODO remove unnecessary method
	public void getRMCWelcomeBack(final FwTransaction txnBean) {
		// do nothing
			}

	/**
	 * Method gets welcome back.
	 *
	 * @param txnBean the txn bean
	 */
	//TODO remove unnecessary method
	public void getRMBWelcomeBack(final FwTransaction txnBean) {
		// do nothing
	}

	/**
	 * Check people page required.
	 *
	 * @param categorySelectionProfile the category selection profile
	 * @param catType the cat type
	 * @return true, if successful
	 */
	private boolean checkPeoplePageRequired(
			final SortedSet categorySelectionProfile, final Map catType) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.checkPeoplePageRequired() - START");
		boolean isPageRequired = false;
		if (categorySelectionProfile != null) {
			// this one form the category selection profile
			final Iterator iter = categorySelectionProfile.iterator();
			CategorySequenceDetail categorySeqDtl = null;
			while (iter.hasNext()) {
				categorySeqDtl = (CategorySequenceDetail) iter.next();
				if (catType != null
						&& catType.get(categorySeqDtl.getCategoryType()) != null
						&& categorySeqDtl.getStatus() != IRMCResponseProfileManager.STATUS_COMPLETE
						&& categorySeqDtl.getUserEndSelectionInd() != AppConstants.RMB_NO_CHANGE_SEL_IND) {
					isPageRequired = true;
					break;
				}
			}
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.checkPeoplePageRequired() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ AppConstants.SPACE + AppConstants.MILLISECONDS);
		return isPageRequired;

	}

	/**
	 * Update with page collection.
	 *
	 * @param beforeIndv the before indv
	 * @param pageIndv the page indv
	 * @return the AP p_ ind v_ cargo
	 */
	private APP_INDV_Cargo updateWithPageCollection(
			final APP_INDV_Cargo beforeIndv, final APP_INDV_Cargo pageIndv) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.updateWithPageCollection() - START");
		 APP_INDV_Cargo tempBeforeCargo = null;
		 APP_INDV_Collection tempColl = new APP_INDV_Collection();
		 APP_INDV_Collection befColl = new APP_INDV_Collection();
		 befColl.addCargo(beforeIndv);
		 APP_INDV_Cargo [] tempArray = befColl.cloneResults();
		 tempColl.setResults(tempArray);
		 tempBeforeCargo = tempColl.getCargo(0);
		
		String birthDate = tempBeforeCargo.getBrth_dt();
		if (birthDate != null) {
			if (!"".equals(birthDate.trim()) && birthDate.length() >= 10) {
				birthDate = birthDate.substring(0, 10);
			}
			if (AppConstants.HIGH_DATE.equals(birthDate)) {
				birthDate = null;
			} else if (birthDate.length() >= 10
					&& (birthDate.charAt(4) == '-' || birthDate.charAt(4) == '/')) {
				birthDate = DisplayFormatter.getInstance().getMMDDYYYYDate(
						birthDate);
			}
		}
		tempBeforeCargo.setBrth_dt(birthDate);

		String ssNumDate = tempBeforeCargo.getSs_num_app_dt();
		if (ssNumDate != null) {
			if (!"".equals(ssNumDate.trim()) && ssNumDate.length() >= 10) {
				ssNumDate = ssNumDate.substring(0, 10);
			}
			if (AppConstants.HIGH_DATE.equals(ssNumDate)) {
				ssNumDate = null;
			} else if (ssNumDate.length() >= 10
					&& (ssNumDate.charAt(4) == '-' || ssNumDate.charAt(4) == '/')) {
				ssNumDate = DisplayFormatter.getInstance().getMMDDYYYYDate(
						ssNumDate);
			}
		}
		tempBeforeCargo.setSs_num_app_dt(ssNumDate);

		if ("--".equals(pageIndv.getSuffix_name())) {
			pageIndv.setSuffix_name(null);
		}
		if (AppConstants.EMPTY_STRING.equals(pageIndv.getLang_oth_dsc())) {
			pageIndv.setLang_oth_dsc(null);
		}
		if (AppConstants.EMPTY_STRING.equals(pageIndv.getInter_oth_dsc())) {
			pageIndv.setInter_oth_dsc(null);
		}
		if (AppConstants.EMPTY_STRING.equals(pageIndv.getAlias_fst_nam())) {
			pageIndv.setAlias_fst_nam(null);
		}
		if (AppConstants.EMPTY_STRING.equals(pageIndv.getAlias_last_nam())) {
			pageIndv.setAlias_last_nam(null);
		}
		if (AppConstants.EMPTY_STRING.equals(pageIndv.getAlias_mid_init())) {
			pageIndv.setAlias_mid_init(null);
		}
		if (AppConstants.EMPTY_STRING.equals(pageIndv.getTribe_name())) {
			pageIndv.setTribe_name(null);
		}
		if (AppConstants.SEL.equals(pageIndv.getIf_out_arrangement())) {
			pageIndv.setIf_out_arrangement(null);
		}
		if (pageIndv.getTax_dp_outside_home_ind() == null) {
			pageIndv.setTax_dp_outside_home_ind(beforeIndv.getTax_dp_outside_home_ind());
		}
		pageIndv.setTax_flr_otsd_ind(beforeIndv.getTax_flr_otsd_ind());

		final Map changedAttributes = tempBeforeCargo.compareAttributes(pageIndv);
		if (changedAttributes.keySet().size()>0) pageIndv.setDirty(true);
		if (changedAttributes.containsKey("fst_nam")) {
			tempBeforeCargo.setFst_nam(pageIndv.getFst_nam());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("mid_init")) {
			tempBeforeCargo.setMid_init(pageIndv.getMid_init());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("last_nam")) {
		    tempBeforeCargo.setLast_nam(pageIndv.getLast_nam());
		    tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("sex_ind")) {
			tempBeforeCargo.setSex_ind(pageIndv.getSex_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("brth_dt")) {
			tempBeforeCargo.setBrth_dt(pageIndv.getBrth_dt());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("mrtl_stat_cd")) {
			tempBeforeCargo.setMrtl_stat_cd(pageIndv.getMrtl_stat_cd());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("ssn_num")) {
			tempBeforeCargo.setSsn_num(pageIndv.getSsn_num());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("ss_num_app_dt")) {
			tempBeforeCargo.setSs_num_app_dt(pageIndv.getSs_num_app_dt());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("hspc_dsc_cd")) {
			tempBeforeCargo.setHspc_dsc_cd(pageIndv.getHspc_dsc_cd());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("lang_cd")) {
			tempBeforeCargo.setLang_cd(pageIndv.getLang_cd());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("ai_ind")) {
			tempBeforeCargo.setAi_ind(pageIndv.getAi_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("asia_ind")) {
			tempBeforeCargo.setAsia_ind(pageIndv.getAsia_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("blk_ind")) {
			tempBeforeCargo.setBlk_ind(pageIndv.getBlk_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("hspc_ind")) {
			tempBeforeCargo.setHspc_ind(pageIndv.getHspc_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("non_hspc_ind")) {
			tempBeforeCargo.setNon_hspc_ind(pageIndv.getNon_hspc_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("pac_isl_ind")) {
			tempBeforeCargo.setPac_isl_ind(pageIndv.getPac_isl_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("wht_ind")) {
			tempBeforeCargo.setWht_ind(pageIndv.getWht_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("suffix_name")) {
			tempBeforeCargo.setSuffix_name(pageIndv.getSuffix_name());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("lang_oth_dsc")) {
			tempBeforeCargo.setLang_oth_dsc(pageIndv.getLang_oth_dsc());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("req_interp_ind")) {
			tempBeforeCargo.setReq_interp_ind(pageIndv.getReq_interp_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_sl_interp_ind")) {
			tempBeforeCargo.setComm_asst_sl_interp_ind(pageIndv
					.getComm_asst_sl_interp_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_fl_interp_ind")) {
			tempBeforeCargo.setComm_asst_fl_interp_ind(pageIndv
					.getComm_asst_fl_interp_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_tty_ind")) {
			tempBeforeCargo.setComm_asst_tty_ind(pageIndv.getComm_asst_tty_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_lg_print_ind")) {
			tempBeforeCargo.setComm_asst_lg_print_ind(pageIndv
					.getComm_asst_lg_print_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_email_ind")) {
			tempBeforeCargo
			.setComm_asst_email_ind(pageIndv.getComm_asst_email_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_baille_ind")) {
			tempBeforeCargo.setComm_asst_baille_ind(pageIndv
					.getComm_asst_baille_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_vedrel_ind")) {
			tempBeforeCargo.setComm_asst_vedrel_ind(pageIndv
					.getComm_asst_vedrel_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("comm_asst_none_ind")) {
			tempBeforeCargo.setComm_asst_none_ind(pageIndv.getComm_asst_none_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("inter_oth_dsc")) {
			tempBeforeCargo.setInter_oth_dsc(pageIndv.getInter_oth_dsc());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("living_arrangement_cd")) {
			tempBeforeCargo.setLiving_arrangement_cd(pageIndv
					.getLiving_arrangement_cd());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("if_out_arrangement")) {
			tempBeforeCargo.setIf_out_arrangement(pageIndv.getIf_out_arrangement());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("tax_joint_file_ind")) {
			tempBeforeCargo.setTax_joint_file_ind(pageIndv.getTax_joint_file_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("tax_dp_outside_home_ind")) {
			tempBeforeCargo.setTax_dp_outside_home_ind(pageIndv
					.getTax_dp_outside_home_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("live_at_same_addr_ind")) {
			tempBeforeCargo.setLive_at_same_addr_ind(pageIndv
					.getLive_at_same_addr_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("alias_ind")) {
			tempBeforeCargo.setAlias_ind(pageIndv.getAlias_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("alias_fst_nam")) {
			tempBeforeCargo.setAlias_fst_nam(pageIndv.getAlias_fst_nam());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("alias_last_nam")) {
			tempBeforeCargo.setAlias_last_nam(pageIndv.getAlias_last_nam());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("alias_mid_init")) {
			tempBeforeCargo.setAlias_mid_init(pageIndv.getAlias_mid_init());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("alias_suffix_name")) {
			tempBeforeCargo.setAlias_suffix_name(pageIndv.getAlias_suffix_name());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_filipino_ind")) {
			tempBeforeCargo.setRace_filipino_ind(pageIndv.getRace_filipino_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_vie_ind")) {
			tempBeforeCargo.setRace_vie_ind(pageIndv.getRace_vie_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_guam_ind")) {
			tempBeforeCargo.setRace_guam_ind(pageIndv.getRace_guam_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_japanese_ind")) {
			tempBeforeCargo.setRace_japanese_ind(pageIndv.getRace_japanese_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_oth_asian_ind")) {
			tempBeforeCargo.setRace_oth_asian_ind(pageIndv.getRace_oth_asian_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_samoan_ind")) {
			tempBeforeCargo.setRace_samoan_ind(pageIndv.getRace_samoan_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_chinese_ind")) {
			tempBeforeCargo.setRace_chinese_ind(pageIndv.getRace_chinese_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_korean_ind")) {
			tempBeforeCargo.setRace_korean_ind(pageIndv.getRace_korean_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_nhpi_ind")) {
			tempBeforeCargo.setRace_nhpi_ind(pageIndv.getRace_nhpi_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_oth_ind")) {
			tempBeforeCargo.setRace_oth_ind(pageIndv.getRace_oth_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_memb_fed_rec_trb_ind")) {
			tempBeforeCargo.setRace_memb_fed_rec_trb_ind(pageIndv
					.getRace_memb_fed_rec_trb_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_persian_ind")) {
			tempBeforeCargo.setRace_persian_ind(pageIndv.getRace_persian_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_eastasian_ind")) {
			tempBeforeCargo.setRace_eastasian_ind(pageIndv
					.getRace_eastasian_ind());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("race_unknown_ind")) {
			tempBeforeCargo.setRace_unknown_ind(pageIndv
					.getRace_unknown_ind());
			tempBeforeCargo.setDirty(true);
		}
		
		if (changedAttributes.containsKey("tribe_name")) {
			tempBeforeCargo.setTribe_name(pageIndv.getTribe_name());
			tempBeforeCargo.setDirty(true);
		}
		if (changedAttributes.containsKey("ssn_info_ack_ind")) {
			tempBeforeCargo.setSsn_info_ack_ind(pageIndv.getSsn_info_ack_ind());
			tempBeforeCargo.setDirty(true);
		}
		
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.updateWithPageCollection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ AppConstants.SPACE + AppConstants.MILLISECONDS);
		return tempBeforeCargo;
	}

	/**
	 * Update cit with page collection.
	 *
	 * @param beforeIndv the before indv
	 * @param pageIndv the page indv
	 * @return the AP p_ ind v_ cargo
	 */
	private APP_INDV_Cargo updateCitWithPageCollection(
			final APP_INDV_Cargo beforeIndv, final APP_INDV_Cargo pageIndv) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.updateCitWithPageCollection() - START");

		if (AppConstants.EMPTY_STRING.equals(pageIndv.getDt_entry_into_us())) {
			pageIndv.setDt_entry_into_us(null);
		}
		if(AppConstants.EMPTY_STRING.equals(pageIndv.getAlien_num())){
			pageIndv.setAlien_num(null);
		}
		final Map changedAttributes = beforeIndv.compareAttributes(pageIndv);

		if (changedAttributes.containsKey("res_ga_ind")) {
			beforeIndv.setRes_ga_ind(pageIndv.getRes_ga_ind());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("disabled_resp")) {
			beforeIndv.setDisabled_resp(pageIndv.getDisabled_resp());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("us_ctzn_sw")) {
			beforeIndv.setUs_ctzn_sw(pageIndv.getUs_ctzn_sw());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("alien_status_cd")) {
			beforeIndv.setAlien_status_cd(pageIndv.getAlien_status_cd());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("dt_entry_into_us")) {
			beforeIndv.setDt_entry_into_us(pageIndv.getDt_entry_into_us());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("alien_num")) {
			beforeIndv.setAlien_num(pageIndv.getAlien_num());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("alien_doc_cd")) {
			beforeIndv.setAlien_doc_cd(pageIndv.getAlien_doc_cd());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("vet_resp")) {
			beforeIndv.setVet_resp(pageIndv.getVet_resp());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("vet_act_duty_resp")) {
			beforeIndv.setVet_act_duty_resp(pageIndv.getVet_act_duty_resp());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("chld_pa_act_duty_resp")) {
			beforeIndv.setChld_pa_act_duty_resp(pageIndv.getBlk_ind());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("vld_immgrtn_sts")) {
			beforeIndv.setVld_immgrtn_sts(pageIndv.getVld_immgrtn_sts());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("chg_dt")) {
			beforeIndv.setChg_dt(pageIndv.getChg_dt());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("wic_clnc_cnty")) {
			beforeIndv.setWic_clnc_cnty(pageIndv.getWic_clnc_cnty());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("wic_clnc_cd")) {
			beforeIndv.setWic_clnc_cd(pageIndv.getWic_clnc_cd());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("chld_pa_act_duty_resp")) {
			beforeIndv.setChld_pa_act_duty_resp(pageIndv.getChld_pa_act_duty_resp());
			beforeIndv.setDirty(true);
		}
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.updateCitWithPageCollection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ AppConstants.SPACE + AppConstants.MILLISECONDS);
		return beforeIndv;
	}

	/**
	 * Gets the moved in indv coll.
	 *
	 * @param allIndvColl the all indv coll
	 * @return the moved in indv coll
	 */
	private APP_INDV_Collection getMovedInIndvColl(
			final APP_INDV_Collection allIndvColl) {
		final APP_INDV_Collection movedInColl = new APP_INDV_Collection();

		for (int i = 0; i < allIndvColl.size(); i++) {
			final APP_INDV_Cargo aCargo = allIndvColl.getCargo(i);
			if (AppConstants.RMC_NEW_RECORD_IND.equals(aCargo.getSrc_app_ind())) {
				movedInColl.addCargo(aCargo);
			}
		}

		return movedInColl;
	}

	/**
	 * Det row actn and src app ind.
	 *
	 * @param appInOutColl the app in out coll
	 * @param persistCargo the persist cargo
	 * @return true, if successful
	 */
	private boolean detRowActnAndSrcAppInd(
			final APP_IN_OUT_ST_BNFT_Collection appInOutColl,
			final APP_IN_OUT_ST_BNFT_Cargo persistCargo) {

		final OutOfStateBenefitsBO outBO = new OutOfStateBenefitsBO();
		boolean isChanged = false;
		String rowAction;
		String srcAppInd;

		final APP_IN_OUT_ST_BNFT_Cargo cwCargo = outBO.splitOutOfColl(
				appInOutColl, AppConstants.CWW_RECORD_IND);
		final APP_IN_OUT_ST_BNFT_Cargo rmCargo = outBO.splitOutOfColl(
				appInOutColl, AppConstants.RMC_MODIFIED_RECORD_IND);
		final APP_IN_OUT_ST_BNFT_Cargo rnCargo = outBO.splitOutOfColl(
				appInOutColl, AppConstants.RMC_NEW_RECORD_IND);
		if (rnCargo != null) {
			isChanged = isUpdated(persistCargo, rnCargo);
			srcAppInd = AppConstants.RMC_NEW_RECORD_IND;
			rowAction = FwConstants.ROWACTION_UPDATE;
		} else if (rmCargo != null) {
			isChanged = isUpdated(persistCargo, rmCargo);
			srcAppInd = AppConstants.RMC_MODIFIED_RECORD_IND;
			rowAction = FwConstants.ROWACTION_UPDATE;
		} else {
			isChanged = isUpdated(persistCargo, cwCargo);
			srcAppInd = AppConstants.RMC_MODIFIED_RECORD_IND;
			rowAction = FwConstants.ROWACTION_INSERT;
		}
		persistCargo.setRowAction(rowAction);
		persistCargo.setSrc_app_ind(srcAppInd);

		return isChanged;
	}

	/**
	 * Checks if is updated.
	 *
	 * @param persistCargo the persist cargo
	 * @param aCargo the a cargo
	 * @return true, if is updated
	 */
	private boolean isUpdated(final APP_IN_OUT_ST_BNFT_Cargo persistCargo,
			final APP_IN_OUT_ST_BNFT_Cargo aCargo) {
		boolean isChanged = false;
		Map changedAttributes;

		// update date format before compare

		if (aCargo.getFb_rcv_out_of_st_bnft_date() != null
				&& !FwConstants.EMPTY_STRING.equals(aCargo
						.getFb_rcv_out_of_st_bnft_date())) {
			aCargo.setFb_rcv_out_of_st_bnft_date(displayFormatter
					.getYYYYMMDDDate(aCargo.getFb_rcv_out_of_st_bnft_date()));
		}
		if (aCargo.getFma_rcv_out_of_st_bnft_date() != null
				&& !FwConstants.EMPTY_STRING.equals(aCargo
						.getFma_rcv_out_of_st_bnft_date())) {
			aCargo.setFma_rcv_out_of_st_bnft_date(displayFormatter
					.getYYYYMMDDDate(aCargo.getFma_rcv_out_of_st_bnft_date()));
		}
		if (aCargo.getTanf_rcv_out_of_st_bnft_date() != null
				&& !FwConstants.EMPTY_STRING.equals(aCargo
						.getTanf_rcv_out_of_st_bnft_date())) {
			aCargo.setTanf_rcv_out_of_st_bnft_date(displayFormatter
					.getYYYYMMDDDate(aCargo.getTanf_rcv_out_of_st_bnft_date()));
		}

		changedAttributes = aCargo.compareAttributes(persistCargo);

		if (changedAttributes != null && !changedAttributes.isEmpty()) {
			final String fsState = persistCargo.getFb_out_of_st_bnft_sta_cd();
			final String maState = persistCargo.getFma_out_of_st_bnft_sta_cd();
			final String tfState = persistCargo.getTanf_out_of_st_bnft_sta_cd();

			if (fsState != null && !fsState.isEmpty()
					&& !AppConstants.SEL.equals(fsState)) {
				if (changedAttributes.containsKey("fb_out_of_st_bnft_sta_cd")
						|| changedAttributes
						.containsKey("fb_curr_rcv_out_of_st_bnft_ind")
						|| changedAttributes
						.containsKey("fb_rcv_out_of_st_bnft_date")) {
					isChanged = true;
				}
			} else if (maState != null && !maState.isEmpty()
					&& !AppConstants.SEL.equals(maState)) {
				if (changedAttributes.containsKey("fma_out_of_st_bnft_sta_cd")
						|| changedAttributes
						.containsKey("fma_curr_rcv_out_of_st_bnft_ind")
						|| changedAttributes
						.containsKey("fma_rcv_out_of_st_bnft_date")) {
					isChanged = true;
				}
			} else if (tfState != null && !tfState.isEmpty()
					&& !AppConstants.SEL.equals(tfState)) {
				if (changedAttributes.containsKey("tanf_out_of_st_bnft_sta_cd")
						|| changedAttributes
						.containsKey("tanf_curr_rcv_out_of_st_bnft_ind")
						|| changedAttributes
						.containsKey("tanf_rcv_out_of_st_bnft_date")) {
					isChanged = true;
				}
			}
		}

		return isChanged;
	}

	/**
	 * Normalize app prgm indv.
	 *
	 * @param appPrgmCargo the app prgm cargo
	 */
	private void normalizeAppPrgmIndv(final APP_PRGM_INDV_Cargo appPrgmCargo) {

		if (AppConstants.ONE.equals(appPrgmCargo.getMa_ind())) {
			appPrgmCargo.setMa_ind(AppConstants.YES);
		} else {
			appPrgmCargo.setMa_ind(AppConstants.NO);
		}
		if (AppConstants.ONE.equals(appPrgmCargo.getFs_ind())) {
			appPrgmCargo.setFs_ind(AppConstants.YES);
		} else {
			appPrgmCargo.setFs_ind(AppConstants.NO);
		}
		if (AppConstants.ONE.equals(appPrgmCargo.getTa_ind())) {
			appPrgmCargo.setTa_ind(AppConstants.YES);
		} else {
			appPrgmCargo.setTa_ind(AppConstants.NO);
		}
		if (AppConstants.ONE.equals(appPrgmCargo.getCc_ind())) {
			appPrgmCargo.setCc_ind(AppConstants.YES);
		} else {
			appPrgmCargo.setCc_ind(AppConstants.NO);
		}
		if (AppConstants.ONE.equals(appPrgmCargo.getWc_ind())) {
			appPrgmCargo.setWc_ind(AppConstants.YES);
		} else {
			appPrgmCargo.setWc_ind(AppConstants.NO);
		}
	}

	/**
	 * Update prgm indv with page collection.
	 *
	 * @param beforeIndv the before indv
	 * @param pageIndv the page indv
	 * @return the AP p_ prg m_ ind v_ cargo
	 */
	private APP_PRGM_INDV_Cargo updatePrgmIndvWithPageCollection(
			final APP_PRGM_INDV_Cargo beforeIndv,
			final APP_PRGM_INDV_Cargo pageIndv) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.updatePrgmIndvWithPageCollection() - START");
		final Map changedAttributes = beforeIndv.compareAttributes(pageIndv);

		if (changedAttributes.containsKey("cc_ind")) {
			beforeIndv.setCc_ind(pageIndv.getCc_ind());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("ma_ind")) {
			beforeIndv.setMa_ind(pageIndv.getMa_ind());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("fs_ind")) {
			beforeIndv.setFs_ind(pageIndv.getFs_ind());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("ta_ind")) {
			beforeIndv.setTa_ind(pageIndv.getTa_ind());
			beforeIndv.setDirty(true);
		}
		if (changedAttributes.containsKey("wc_ind")) {
			beforeIndv.setWc_ind(pageIndv.getWc_ind());
			beforeIndv.setDirty(true);
		}

		log(ILog.INFO,
				"RMCHouseHoldInfoEJBBean.updatePrgmIndvWithPageCollection() - END , Time Taken : "
						+ (System.currentTimeMillis() - startTime)
						+ AppConstants.SPACE + AppConstants.MILLISECONDS);
		return beforeIndv;
	}

	/**
	 * Checks if is equal.
	 *
	 * @param appInd the app ind
	 * @param indvInd the indv ind
	 * @return true, if is equal
	 */
	private boolean isEqual(final String appInd, final String indvInd) {

		if (AppConstants.ZERO.equals(appInd) && AppConstants.NO.equals(indvInd)) {
			return true;
		} else if (AppConstants.ONE.equals(appInd)
				&& AppConstants.YES.equals(indvInd)) {
			return true;
		} else {
			return false;
		}

	}
	
	private APP_HSHL_RLT_Cargo updateSrcIndnRowAction(APP_HSHL_RLT_Collection aColl, APP_HSHL_RLT_Cargo updateCargo) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.updateSrcIndnRowAction() - START");

		APP_HSHL_RLT_Collection newColl = new APP_HSHL_RLT_Collection();

		for (int i = 0; i < aColl.size(); i++) {

			APP_HSHL_RLT_Cargo aCargo = aColl.getCargo(i);
			if ((aCargo.getSrc_indv_seq_num().equals(updateCargo.getSrc_indv_seq_num()))
					&& (aCargo.getRef_indv_seq_num().equals(updateCargo.getRef_indv_seq_num()))) {
				newColl.addCargo(aCargo);

			}

		}

		int collSize = newColl.size();

		if (collSize == 0) {
			updateCargo.setRlt_cd(newColl.getCargo(0).getRlt_cd());
			updateCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
			updateCargo.setRowAction(FwConstants.ROWACTION_INSERT);
		} else if (collSize == 1) {
			if (newColl.getCargo(0).getSrc_app_ind().equals(AppConstants.CWW_RECORD_IND)) {				
				updateCargo.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
				updateCargo.setRowAction(FwConstants.ROWACTION_INSERT);
			} else {
				updateCargo.setSrc_app_ind(AppConstants.RMC_NEW_RECORD_IND);
				updateCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
			}
			updateCargo.setRlt_cd(newColl.getCargo(0).getRlt_cd());
		} else {
			updateCargo.setRlt_cd(newColl.getCargo(1).getRlt_cd());
			updateCargo.setSrc_app_ind(AppConstants.RMC_MODIFIED_RECORD_IND);
			updateCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
		}

		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.updateSrcIndnRowAction() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
				+ AppConstants.SPACE + AppConstants.MILLISECONDS);

		return updateCargo;
	}
	
	
	private APP_HSHL_RLT_Collection combineSessionPageCollection(APP_HSHL_RLT_Collection sCollection, APP_HSHL_RLT_Collection pCollection) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.combineSessionPageCollection() - START");
		APP_HSHL_RLT_Collection combinedCollection = new APP_HSHL_RLT_Collection();
		combinedCollection.addAll(pCollection);
		for (int i = 0; i < sCollection.size(); i++) {
			boolean isPresent = false;
			APP_HSHL_RLT_Cargo sCargo = sCollection.getCargo(i);
			for (int j = 0; j < pCollection.size(); j++) {
				APP_HSHL_RLT_Cargo pCargo = pCollection.getCargo(j);
				if (pCargo.getSrc_indv_seq_num().equals(sCargo.getSrc_indv_seq_num())
						&& pCargo.getRef_indv_seq_num().equals(sCargo.getRef_indv_seq_num())) {
					isPresent = true;
				}
			}

			if (!isPresent) {
				sCargo.setCare_resp(AppConstants.NO);
				combinedCollection.addCargo(sCargo);
			}
		}
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.combineSessionPageCollection() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
				+ AppConstants.SPACE + AppConstants.MILLISECONDS);

		return combinedCollection;
	}
	
	private APP_HSHL_RLT_Cargo getMatchingRMHsHlRltCargo(final APP_HSHL_RLT_Cargo cwwCargo, final APP_HSHL_RLT_Collection rmColl) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.getMatchingRMHsHlRltCargo() - START");
		try {
			APP_HSHL_RLT_Cargo rmCargo = null;
			APP_HSHL_RLT_Cargo tempCargo = null;
			//final int size = (rmColl != null) ? rmColl.size() : 0;
			if (rmColl != null && !rmColl.isEmpty()) {
				for (int i = 0; i < rmColl.size(); i++) {
					rmCargo = rmColl.getCargo(i);
					if (cwwCargo.getSrc_indv_seq_num().equals(rmCargo.getSrc_indv_seq_num())
							&& cwwCargo.getRef_indv_seq_num().equals(rmCargo.getRef_indv_seq_num()) && rmCargo.getSrc_app_ind().equals(AppConstants.RMC_MODIFIED_RECORD_IND)) {
						tempCargo = rmCargo;
						break;
					}
				}
			}
			log(ILog.INFO, "RMCHouseHoldInfoEJBBean.getMatchingRMHsHlRltCargo() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
					+ AppConstants.SPACE + AppConstants.MILLISECONDS);

			return tempCargo;
		} catch (final FwException fe) {
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeTaxDependentsOutsideDetails");
		} catch (final Exception e) {
			final FwException fe = new FwException(e);
			fe.setClassID(this.getClass().getName());
			fe.setMethodID("getMatchingRMHsHlRltCargo");			
			fe.setExceptionText(String.valueOf(e));
			fe.setExceptionType(FwConstants.EXP_TYP_APPLICATION);
			throw rmcHouseHoldInfoEJBBean.exceptionManagerLog(fe, getClass().getName(), "storeTaxDependentsOutsideDetails");
		}
	}
	
	private void populateCareTaker(final FwTransaction txnBean, boolean isSumm) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.populateCareTaker() - START");

		final Map session = txnBean.getSession();
		final Map request = txnBean.getRequest();
		final Map pageCollection = txnBean.getPageCollection();
		final String appNumber = (String) session.get(AppConstants.APP_NUMBER);
		final String pageId = (String) request.get(FwConstants.CURRENT_PAGE_ID);
		final int[] driverArray = (int[]) session.get(FwConstants.RMC_DRIVER);
		final int pageStatus = driverManager.getAFBStatus(FwConstants.RMC_DRIVER, pageId, driverArray);
		final PeopleHandler peopleHandler = (PeopleHandler) session.get(AppConstants.INDIV_MASTER_HANDLER);
		final ABHouseHoldRelationshipBO houseHoldRelationBo = new ABHouseHoldRelationshipBO();
		final INDIVIDUAL_Custom_Collection indvSortedCustColl = peopleHandler.getAllIndividuals();
		final INDIVIDUAL_Custom_Collection indvColl = peopleHandler.getSortedIndividualsByIndvSeqNum();
		pageCollection.put("INDV_SRC_CUST_Collection", indvColl);
		INDIVIDUAL_Custom_Collection indvSrcCustColl = new INDIVIDUAL_Custom_Collection();
		final Map beforeColl = (Map) session.get(FwConstants.BEFORE_COLLECTION);
		INDIVIDUAL_Custom_Collection careTakerCustColl = null;
		INDIVIDUAL_Custom_Collection careTakerCustCWColl = null;
		final List<INDIVIDUAL_Custom_Collection> custCollList = new ArrayList<INDIVIDUAL_Custom_Collection>();
		final List<APP_HSHL_RLT_Collection> hshlCollList = new ArrayList<APP_HSHL_RLT_Collection>();
		final List<Map> careTakerMapList = new ArrayList<Map>();
		final List<Map> careTakerMapCwList = new ArrayList<Map>();
		final List<NO_ONE_Collection> noOneList = new ArrayList<NO_ONE_Collection>();
		final INDIVIDUAL_Custom_Collection childNameList = new INDIVIDUAL_Custom_Collection();
		final List<INDIVIDUAL_Custom_Collection> custCollCwList = new ArrayList<INDIVIDUAL_Custom_Collection>();

		final String appType = (String) session.get(FwConstants.ACCESS_APPLICATION_TYPE);
		APP_HSHL_RLT_Collection appCareTakerHshlSessColl = new APP_HSHL_RLT_Collection();
		if (session.containsKey("APP_HSHL_CARE_TAKER_Collection")) {
			appCareTakerHshlSessColl = (APP_HSHL_RLT_Collection) session.get("APP_HSHL_CARE_TAKER_Collection");
		}

		boolean isAddIndividualMode = false;

		if (beforeColl.containsKey("RMB_ADD_INDIVIDUAL_MODE") && FwConstants.YES.equals(beforeColl.get("RMB_ADD_INDIVIDUAL_MODE"))) {
			isAddIndividualMode = true;
			pageCollection.put("RMB_ADD_INDIVIDUAL_MODE", FwConstants.YES);
		} else {
			pageCollection.put("RMB_ADD_INDIVIDUAL_MODE", FwConstants.NO);
		}

		if (indvSortedCustColl != null) {
			for (int i = 0; i < indvSortedCustColl.size(); i++) {
				final INDIVIDUAL_Custom_Cargo indvSortCargo = indvSortedCustColl.getResult(i);
				if (indvSortCargo.getIndv_age().getYears() <= 18) {
					indvSrcCustColl.add(indvSortCargo);
				}
			}
		}

		final INDIVIDUAL_Custom_Collection indvSrcCustColltemp = new INDIVIDUAL_Custom_Collection();
		if (session.containsKey("CHILD_CARE_TAKER_CHANGE")) {
			final List<String> childIndivSeqNumList = (ArrayList) session.get("CHILD_CARE_TAKER_CHANGE");
			if (childIndivSeqNumList != null && !childIndivSeqNumList.isEmpty()) {
				for (final String childIndivSeqNum : childIndivSeqNumList) {
					if (indvSrcCustColl != null && !indvSrcCustColl.isEmpty()) {
						for (int i = 0; i < indvSrcCustColl.size(); i++) {
							final INDIVIDUAL_Custom_Cargo indvSortCargo = indvSrcCustColl.getResult(i);
							if (childIndivSeqNum.equals(indvSortCargo.getIndv_seq_num())) {
								indvSrcCustColltemp.addCargo(indvSortCargo);
							}
						}
					}
				}
				indvSrcCustColl = null;
				indvSrcCustColl = indvSrcCustColltemp;
				pageCollection.put("RMB_ADD_INDIVIDUAL_MODE", FwConstants.NO);
			}
		}

		APP_HSHL_RLT_Collection careTakerColl = new APP_HSHL_RLT_Collection();
		APP_HSHL_RLT_Collection careTakerNewColl = new APP_HSHL_RLT_Collection();
		APP_HSHL_RLT_Collection careTakerCwColl = new APP_HSHL_RLT_Collection();
		APP_HSHL_RLT_Collection careTakerRMColl = new APP_HSHL_RLT_Collection();

		careTakerCwColl = houseHoldRelationBo.getCareTaker(indvSortedCustColl, peopleHandler, appNumber, AppConstants.CWW_RECORD_IND);

		if (isAddIndividualMode) {
			careTakerColl = houseHoldRelationBo.getCareTaker(indvSortedCustColl, peopleHandler, appNumber, AppConstants.RMC_NEW_RECORD_IND);

		} else {
			if (pageStatus != FwConstants.DRIVER_REQUIRED || isSumm) {
				careTakerRMColl = houseHoldRelationBo
						.getCareTaker(indvSortedCustColl, peopleHandler, appNumber, AppConstants.RMC_MODIFIED_RECORD_IND);

				for (int i = 0; i < careTakerCwColl.size(); i++) {
					APP_HSHL_RLT_Cargo matchingRmCargo = getMatchingRMHsHlRltCargo(careTakerCwColl.getCargo(i), careTakerRMColl);
					if (matchingRmCargo != null) {
						careTakerColl.addCargo(matchingRmCargo);
					} else {
						careTakerColl.addCargo(careTakerCwColl.getCargo(i));
					}
				}

				careTakerNewColl = houseHoldRelationBo.getCareTaker(indvSortedCustColl, peopleHandler, appNumber, AppConstants.RMC_NEW_RECORD_IND);
				if (careTakerNewColl != null && !careTakerNewColl.isEmpty()) {
					careTakerColl.addAll(careTakerNewColl);
				}
			} else {
				careTakerColl = houseHoldRelationBo.getCareTaker(indvSortedCustColl, peopleHandler, appNumber, AppConstants.CWW_RECORD_IND);
				careTakerNewColl = houseHoldRelationBo.getCareTaker(indvSortedCustColl, peopleHandler, appNumber, AppConstants.RMC_NEW_RECORD_IND);
				if (careTakerNewColl != null && !careTakerNewColl.isEmpty()) {
					careTakerColl.addAll(careTakerNewColl);
				}
			}
		}

		for (int i = 0; i < indvSrcCustColl.size(); i++) {
			NO_ONE_Collection pageNoOneColl = null;
			final INDIVIDUAL_Custom_Cargo indvSrcCustCargo = indvSrcCustColl.getResult(i);
			if (careTakerColl != null && !careTakerColl.isEmpty()) {
				final Map careTakerMap = new HashMap();
				final Map careTakerCwMap = new HashMap();
				careTakerCustColl = new INDIVIDUAL_Custom_Collection();
				careTakerCustCWColl = new INDIVIDUAL_Custom_Collection();
				APP_HSHL_RLT_Cargo careTakerCargo = null;
				boolean foundFlag = false;
				boolean foundCwFlag = false;
				for (int j = 0; j < careTakerColl.size(); j++) {
					careTakerCargo = careTakerColl.getCargo(j);
					if (peopleHandler.getIndividual(careTakerCargo.getSrc_indv_seq_num()) != null) {

						if (indvSrcCustCargo.getIndv_seq_num().equals(careTakerCargo.getRef_indv_seq_num())) {
							careTakerCustColl.add(peopleHandler.getIndividual(careTakerCargo.getSrc_indv_seq_num()));
							if (FwConstants.YES.equals(careTakerCargo.getCare_resp())) {
								careTakerMap.put(careTakerCargo.getSrc_indv_seq_num(), "R");
							} else {
								careTakerMap.put(careTakerCargo.getSrc_indv_seq_num(), FwConstants.SPACE);
							}
							foundFlag = true;
						}
					}

//					if (pageStatus != FwConstants.DRIVER_REQUIRED && appCareTakerHshlSessColl != null && !appCareTakerHshlSessColl.isEmpty()) {
//
//						for (int z = 0; z < appCareTakerHshlSessColl.size(); z++) {
//							final APP_HSHL_RLT_Cargo careTakerTempCargo = appCareTakerHshlSessColl.getCargo(z);
//							if (careTakerCargo.getRef_indv_seq_num().equals(careTakerTempCargo.getSrc_indv_seq_num())
//									&& careTakerCargo.getSrc_indv_seq_num().equals(careTakerTempCargo.getRef_indv_seq_num())) {
//								if (FwConstants.YES.equals(careTakerTempCargo.getCare_resp())) {
//									careTakerMap.put(careTakerCargo.getRef_indv_seq_num(), "R");
//								} else {
//									careTakerMap.put(careTakerCargo.getRef_indv_seq_num(), FwConstants.SPACE);
//								}
//							}
//						}
//
//					}

				}

				for (int j = 0; j < careTakerCwColl.size(); j++) {
					APP_HSHL_RLT_Cargo cwCargo = careTakerCwColl.getCargo(j);
					if (peopleHandler.getIndividual(cwCargo.getSrc_indv_seq_num()) != null) {

						if (indvSrcCustCargo.getIndv_seq_num().equals(cwCargo.getRef_indv_seq_num())) {
							careTakerCustCWColl.add(peopleHandler.getIndividual(cwCargo.getSrc_indv_seq_num()));
							if (FwConstants.YES.equals(cwCargo.getCare_resp())) {
								careTakerCwMap.put(cwCargo.getSrc_indv_seq_num(), "R");
							} else {
								careTakerCwMap.put(cwCargo.getSrc_indv_seq_num(), FwConstants.SPACE);
							}
							foundCwFlag = true;
						}
					}
				}

				if (foundFlag) {
					custCollList.add(careTakerCustColl);
					hshlCollList.add(careTakerColl);
					careTakerMapList.add(careTakerMap);
					childNameList.addCargo(indvSrcCustColl.getResult(i));
					pageCollection.put("CareTakerMap", careTakerMap);
				}

				if (foundCwFlag) {
					custCollCwList.add(careTakerCustCWColl);
					careTakerMapCwList.add(careTakerCwMap);
				}

				if (careTakerMap != null && !careTakerMap.containsValue("R")) {
					pageNoOneColl = new NO_ONE_Collection();
					final NO_ONE_Cargo noOneCargo = new NO_ONE_Cargo();
					noOneCargo.setNo_one_name(FwConstants.EMPTY_STRING);
					pageNoOneColl.add(new NO_ONE_Cargo());
					pageCollection.put("NO_ONE_Collection", pageNoOneColl);
					noOneList.add(pageNoOneColl);
				}
			}
		}
		pageCollection.put("custCollList", custCollList);
		pageCollection.put("hshlCollList", hshlCollList);
		pageCollection.put("careTakerMapList", careTakerMapList);
		pageCollection.put("noOneList", noOneList);
		pageCollection.put("childNameList", childNameList);
		pageCollection.put("custCollCwList", custCollCwList);
		pageCollection.put("careTakerMapCwList", careTakerMapCwList);
		session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
		
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.populateCareTaker() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
				+ AppConstants.SPACE + AppConstants.MILLISECONDS);
	}
	
	private APP_HSHL_RLT_Collection splitCollection(APP_HSHL_RLT_Collection aColl, String srcAppIndicator) {
		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.splitCollection() - START");

		APP_HSHL_RLT_Collection resultColl = new APP_HSHL_RLT_Collection();

		for (int i = 0; i < aColl.size(); i++) {
			if (srcAppIndicator.equals(aColl.getCargo(i).getSrc_app_ind())) {
				resultColl.addCargo(aColl.getCargo(i));
			}
		}
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.splitCollection() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
				+ AppConstants.SPACE + AppConstants.MILLISECONDS);
		return resultColl;

	}
	
	private APP_HSHL_RLT_Collection getChildColl(APP_HSHL_RLT_Collection fullCollection, String childIndvId) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.getChildColl() - START");

		APP_HSHL_RLT_Collection childColl = null;
		int childIndvSeqNum = Integer.parseInt(childIndvId);
		if (fullCollection != null && !fullCollection.isEmpty()) {
			childColl = new APP_HSHL_RLT_Collection();
			for (int i = 0; i < fullCollection.size(); i++) {
				int srcIndvSeqNum = Integer.parseInt(fullCollection.getCargo(i).getSrc_indv_seq_num());
				if (childIndvSeqNum < srcIndvSeqNum && !AppConstants.RMC_NEW_RECORD_IND.equals(fullCollection.getCargo(i).getSrc_app_ind()))
					continue;
				if (childIndvId.equals(fullCollection.getCargo(i).getRef_indv_seq_num())) {
					childColl.addCargo(fullCollection.getCargo(i));
				}
			}
		}

		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.getChildColl() - END , Time Taken : " + (System.currentTimeMillis() - startTime) + AppConstants.SPACE
				+ AppConstants.MILLISECONDS);

		return childColl;

	}
	
	private boolean updateCareResponse(APP_HSHL_RLT_Cargo aCargo, APP_HSHL_RLT_Collection pageColl) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.updateCareResponse() - START");

		boolean updateCareResp = true;

		for (int i = 0; i < pageColl.size(); i++) {
			APP_HSHL_RLT_Cargo pageCargo = pageColl.getCargo(i);

			if (aCargo.getSrc_indv_seq_num().equals(pageCargo.getSrc_indv_seq_num())
					&& aCargo.getRef_indv_seq_num().equals(pageCargo.getRef_indv_seq_num())) {
				updateCareResp = false;
			}

		}
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.updateCareResponse() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
				+ AppConstants.SPACE + AppConstants.MILLISECONDS);

		return updateCareResp;
	}
	
	private APP_HSHL_RLT_Collection filterCollUsingSrcAppInd(APP_HSHL_RLT_Collection aColl) {

		final long startTime = System.currentTimeMillis();
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.filterCollUsingSrcAppInd() - START");

		APP_HSHL_RLT_Collection filteredColl = new APP_HSHL_RLT_Collection();

		for (int i = 0; i < aColl.size(); i++) {
			APP_HSHL_RLT_Cargo aCargo = aColl.getCargo(i);

			if (aCargo.getSrc_app_ind().equals(AppConstants.RMC_NEW_RECORD_IND)) {
				filteredColl.addCargo(aCargo);
			} else if (aCargo.getSrc_app_ind().equals(AppConstants.CWW_RECORD_IND)) {
				APP_HSHL_RLT_Cargo rmCargo = getMatchingRMHsHlRltCargo(aCargo, aColl);
				if (rmCargo != null) {
					filteredColl.addCargo(rmCargo);
				} else {
					filteredColl.addCargo(aCargo);
				}
			}
		}
		log(ILog.INFO, "RMCHouseHoldInfoEJBBean.filterCollUsingSrcAppInd() - END , Time Taken : " + (System.currentTimeMillis() - startTime)
				+ AppConstants.SPACE + AppConstants.MILLISECONDS);

		return filteredColl;
	}

	@TransactionAttribute(TransactionAttributeType.REQUIRES_NEW)
	public FwException exceptionManagerLog(Exception e, String className,
			String methodName) {
		return super.exceptionManagerLog(e, className, methodName);
	}
	
	public void setSessionContext(SessionContext sessionContext){
		ctx=sessionContext;
	}
}
